this.BX=this.BX||{};(function(e,t,s,i,r,a,o,l,n){"use strict";let p=e=>e,c,d,u;var b=babelHelpers.classPrivateFieldLooseKey("name");var v=babelHelpers.classPrivateFieldLooseKey("icon");class P{constructor(e){Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.name;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.icon}getContainer(){return n.Tag.render(c||(c=p`
			<span class="rest-market-item">
				${0}
				<span class="rest-market-item__name" title="${0}">${0}</span>
			</span>
		`),this.renderIcon(),this.getName(),this.getName())}renderTo(e){n.Dom.append(this.getContainer(),e)}getName(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}renderIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]){return n.Tag.render(d||(d=p`
				<div class="rest-market-item__icon-container">
					<div class="ui-icon-set --cube-plus rest-market-item__icon"></div>
				</div>
			`))}return n.Tag.render(u||(u=p`
			<div class="rest-market-item__icon-container" 
				style="
					background-image: url(${0});
					background-size: cover;
				">
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,v)[v])}}let _=e=>e,h,L;var g=babelHelpers.classPrivateFieldLooseKey("items");var m=babelHelpers.classPrivateFieldLooseKey("title");var E=babelHelpers.classPrivateFieldLooseKey("link");var B=babelHelpers.classPrivateFieldLooseKey("count");var T=babelHelpers.classPrivateFieldLooseKey("onClick");var k=babelHelpers.classPrivateFieldLooseKey("renderList");class F{constructor(e){Object.defineProperty(this,k,{value:H});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=n.Type.isArray(e.items)?e.items:[];babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e.title;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.link;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.count;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.onClick}render(){return n.Tag.render(h||(h=_`
			<div class="rest-market-list">
				<div class="rest-market-list__header">
					<span class="rest-market-list__title">${0}</span>
					<a class="rest-market-list__link" href="${0}" onclick="${0}">
						${0}
					</a>
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,m)[m],babelHelpers.classPrivateFieldLooseBase(this,E)[E],babelHelpers.classPrivateFieldLooseBase(this,T)[T],n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_LINK",{"#COUNT#":babelHelpers.classPrivateFieldLooseBase(this,B)[B]}),babelHelpers.classPrivateFieldLooseBase(this,k)[k]())}}function H(){if(babelHelpers.classPrivateFieldLooseBase(this,g)[g].length===0){return null}const e=n.Tag.render(L||(L=_`
			<div class="rest-market-list__container"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,g)[g].forEach((t=>{t.renderTo(e)}));return e}let y=e=>e,R;class D{render(){return n.Tag.render(R||(R=y`
			<aside class="rest-market-expired-popup__discount">
				<p class="rest-market-expired-popup__discount-description">
					${0}
				</p>
			</aside>
		`),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DISCOUNT_DESCRIPTION",{"[white-span]":'<span class="rest-market-expired-popup__discount-description-white">',"[/white-span]":"</span>"}))}}var I=babelHelpers.classPrivateFieldLooseKey("send");var O=babelHelpers.classPrivateFieldLooseKey("getType");var f=babelHelpers.classPrivateFieldLooseKey("getP1");class x{constructor(e){Object.defineProperty(this,f,{value:M});Object.defineProperty(this,O,{value:S});Object.defineProperty(this,I,{value:w});this.context=e}sendShow(){babelHelpers.classPrivateFieldLooseBase(this,I)[I]({tool:"infohelper",category:"market",event:"show_popup"})}sendClickButton(e){babelHelpers.classPrivateFieldLooseBase(this,I)[I]({tool:"infohelper",category:"market",event:"click_button",c_element:e})}sendDemoActivated(){babelHelpers.classPrivateFieldLooseBase(this,I)[I]({tool:"intranet",category:"demo",event:"demo_activated"})}}function w(e){l.sendData({...e,type:babelHelpers.classPrivateFieldLooseBase(this,O)[O](),p1:babelHelpers.classPrivateFieldLooseBase(this,f)[f]()})}function S(){return this.context.popupType==="WARNING"?"pre_disconnection_alert":"post_disconnection_notice"}function M(){return`discount_${this.context.withDiscount?"Y":"N"}`}let C=e=>e,K,$,A,N,U;var X=babelHelpers.classPrivateFieldLooseKey("popup");var j=babelHelpers.classPrivateFieldLooseKey("container");var W=babelHelpers.classPrivateFieldLooseKey("appList");var z=babelHelpers.classPrivateFieldLooseKey("integrationList");var G=babelHelpers.classPrivateFieldLooseKey("marketSubscriptionUrl");var q=babelHelpers.classPrivateFieldLooseKey("withDiscount");var Y=babelHelpers.classPrivateFieldLooseKey("discountEarContainer");var J=babelHelpers.classPrivateFieldLooseKey("analytic");var Q=babelHelpers.classPrivateFieldLooseKey("getFeatureCode");var V=babelHelpers.classPrivateFieldLooseKey("getContent");var Z=babelHelpers.classPrivateFieldLooseKey("getContainer");var ee=babelHelpers.classPrivateFieldLooseKey("renderCloseIcon");var te=babelHelpers.classPrivateFieldLooseKey("getDiscountEarContainer");var se=babelHelpers.classPrivateFieldLooseKey("renderMarketList");var ie=babelHelpers.classPrivateFieldLooseKey("renderAboutLink");var re=babelHelpers.classPrivateFieldLooseKey("showOlWidget");class ae extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,re,{value:be});Object.defineProperty(this,ie,{value:ue});Object.defineProperty(this,se,{value:de});Object.defineProperty(this,te,{value:ce});Object.defineProperty(this,ee,{value:pe});Object.defineProperty(this,Z,{value:ne});Object.defineProperty(this,V,{value:le});Object.defineProperty(this,Q,{value:oe});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:null});Object.defineProperty(this,J,{writable:true,value:void 0});this.setEventNamespace("Rest.MarketExpired:Popup");this.transitionPeriodEndDate=e.transitionPeriodEndDate;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=e.appList;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.integrationList;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.marketSubscriptionUrl;babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e.withDiscount;this.withDemo=e.withDemo;this.olWidgetCode=e.olWidgetCode;babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e.analytic}getType(){return""}getTitle(){return""}show(){var e,s,i,r;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,X))[X])!=null?s:e[X]=t.PopupWindowManager.create(`marketExpiredPopup_${this.getType()}`,null,{animation:{showClassName:"rest-market-expired-popup__show",closeAnimationType:"animation"},overlay:true,content:babelHelpers.classPrivateFieldLooseBase(this,V)[V](),disableScroll:true,padding:0,className:"rest-market-expired-popup-wrapper",closeByEsc:true,events:{onClose:this.onClose.bind(this)}});const a=(e,t)=>{e.forEach((e=>{if(!e.isIntersecting){babelHelpers.classPrivateFieldLooseBase(this,X)[X].setDisableScroll(false);t.unobserve(e.target)}}))};const o=new IntersectionObserver(a,{root:null,rootMargin:"0px",threshold:[0,1]});o.observe(babelHelpers.classPrivateFieldLooseBase(this,X)[X].getContentContainer().querySelector(".rest-market-expired-popup__close-icon"));o.observe(babelHelpers.classPrivateFieldLooseBase(this,X)[X].getContentContainer().querySelector(".rest-market-expired-popup__button-container"));(i=babelHelpers.classPrivateFieldLooseBase(this,X)[X])==null?void 0:i.show();(r=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:r.sendShow();if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]){if(babelHelpers.classPrivateFieldLooseBase(this,X)[X].getContentContainer().querySelector(".rest-market-expired-popup__content-wrapper").offsetHeight<window.innerHeight){n.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](),{maxHeight:`${babelHelpers.classPrivateFieldLooseBase(this,te)[te]().offsetHeight}px`})}else{n.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,X)[X].getContentContainer().parentNode,{"backdrop-filter":"none","-webkit-backdrop-filter":"none"})}babelHelpers.classPrivateFieldLooseBase(this,X)[X].adjustPosition()}if(n.Type.isStringFilled(this.olWidgetCode)&&(!this.withDemo||this.getType()==="FINAL")){babelHelpers.classPrivateFieldLooseBase(this,re)[re](window,document,`https://bitrix24.team/upload/crm/site_button/loader_${this.olWidgetCode}.js`)}}onClose(){var e;(e=BX.SiteButton)==null?void 0:e.hide();this.emit("onClose");BX.userOptions.save("rest","marketTransitionPopupTs",null,Math.floor(Date.now()/1e3))}renderDescription(){return null}renderButtons(){return null}getSubscribeButton(){return new s.Button({text:n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_SUBSCRIBE"),className:"rest-market-expired-popup__button",id:"marketExpiredPopup_button_subscribe",size:s.Button.Size.MEDIUM,color:s.Button.Color.SUCCESS,noCaps:true,round:true,tag:s.Button.Tag.LINK,link:babelHelpers.classPrivateFieldLooseBase(this,G)[G],onclick:()=>{var e;(e=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:e.sendClickButton("buy")}})}getDemoButton(){const e=new s.Button({text:n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_DEMO"),className:"rest-market-expired-popup__button",id:"marketExpiredPopup_button_demo",size:s.Button.Size.MEDIUM,color:s.Button.Color.LIGHT_BORDER,noCaps:true,round:true,onclick:()=>{var t;e.unbindEvent("click");e.setState(s.Button.State.WAITING);(t=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:t.sendClickButton("demo");n.ajax({url:"/bitrix/tools/rest.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),action:"activate_demo"},onsuccess:e=>{babelHelpers.classPrivateFieldLooseBase(this,X)[X].close();if(e.error){o.UI.Notification.Center.notify({content:e.error,category:"demo_subscribe_error",position:"top-right"})}else{var t;(t=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:t.sendDemoActivated();r.FeaturePromotersRegistry.getPromoter({code:"limit_market_trial_active"}).show()}}})}});return e}getHideButton(){return new s.Button({text:n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_HIDE"),className:"rest-market-expired-popup__button rest-market-expired-popup__button--link",id:"marketExpiredPopup_button_hide",size:s.Button.Size.EXTRA_SMALL,color:s.Button.Color.LINK,noCaps:true,onclick:()=>{var e,t;(e=babelHelpers.classPrivateFieldLooseBase(this,X)[X])==null?void 0:e.close();(t=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:t.sendClickButton("ok");BX.userOptions.save("rest","marketTransitionPopupDismiss",null,"Y")}})}}function oe(){return`\n\t\t\tlimit_v2_nosubscription_marketplace_withapplications\n\t\t\t${babelHelpers.classPrivateFieldLooseBase(this,q)[q]?"":"_nodiscount"}\n\t\t\t_off\n\t\t\t${this.withDemo?"":"_no_demo"}\n\t\t`}function le(){return n.Tag.render(K||(K=C`
			<div class="rest-market-expired-popup">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]())}function ne(){var e,t;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,j))[j])!=null?t:e[j]=n.Tag.render($||($=C`
			<div class="rest-market-expired-popup__container">
				${0}
				<div class="rest-market-expired-popup__content-wrapper">
					<div class="rest-market-expired-popup__content">
						<span class="rest-market-expired-popup__title">${0}</span>
						${0}
						${0}
						${0}
					</div>
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,q)[q]?babelHelpers.classPrivateFieldLooseBase(this,te)[te]():"",this.getTitle(),this.renderDescription(),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](),this.renderButtons(),babelHelpers.classPrivateFieldLooseBase(this,se)[se](),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]());return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}function pe(){const e=()=>{var e;babelHelpers.classPrivateFieldLooseBase(this,X)[X].close();(e=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:e.sendClickButton("cancel")};return n.Tag.render(A||(A=C`
			<div class="rest-market-expired-popup__close-icon ui-icon-set --cross-30" onclick="${0}"></div>
		`),e)}function ce(){var e,t;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,Y))[Y])!=null?t:e[Y]=new D(this.withDemo).render();return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}function de(){var e,t;return n.Tag.render(N||(N=C`
			<aside class="rest-market-expired-popup__aside">
				${0}
				${0}
			</aside>
		`),(e=babelHelpers.classPrivateFieldLooseBase(this,W)[W])==null?void 0:e.render(),(t=babelHelpers.classPrivateFieldLooseBase(this,z)[z])==null?void 0:t.render())}function ue(){const e=()=>{var e;(e=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:e.sendClickButton("details")};return n.Tag.render(U||(U=C`
			<span class="rest-market-expired-popup__details">
				<a
					class="ui-link rest-market-expired-popup__link"
					href="FEATURE_PROMOTER=${0}"
					onclick="${0}"
				>
					${0}
				</a>
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](),e,n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DETAILS"))}function be(e,t,s){const i=t.createElement("script");i.async=true;i.src=`${s}?${Date.now()/6e4|0}`;const r=t.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r)}let ve=e=>e,Pe,_e,he;class Le extends ae{getType(){return"final"}getTitle(){return n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_TITLE_FINAL")}renderDescription(){return n.Tag.render(Pe||(Pe=ve`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_1"),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_2"),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_3"),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_FINAL"),n.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_FINAL_DESCRIPTION${this.withDemo?"_DEMO":""}`))}renderButtons(){if(this.withDemo){return n.Tag.render(_e||(_e=ve`
				<div class="rest-market-expired-popup__buttons-wrapper">
					${0}
					<div class="rest-market-expired-popup__button-container">
						${0}
						${0}
					</div>
				</div>
			`),this.getSubscribeButton().render(),this.getDemoButton().render(),this.getHideButton().render())}return n.Tag.render(he||(he=ve`
			<div class="rest-market-expired-popup__button-container">
				${0}
				${0}
			</div>
		`),this.getSubscribeButton().render(),this.getHideButton().render())}}let ge=e=>e,me,Ee;class Be extends ae{getType(){return"warning"}renderDescription(){return n.Tag.render(me||(me=ge`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_1"),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_2"),n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_3"),n.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_WARNING_DESCRIPTION${this.withDemo?"_DEMO":""}`,{"#DATE#":this.transitionPeriodEndDate}))}getTitle(){return n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_TITLE_WARNING")}renderButtons(){return n.Tag.render(Ee||(Ee=ge`
			<div class="rest-market-expired-popup__button-container">
				${0}
				${0}
			</div>
		`),this.getSubscribeButton().render(),this.withDemo?this.getDemoButton().render():"")}}const Te={WARNING:Be,FINAL:Le};class ke{static async getPopup(){const e=(e,t,s,i)=>{if(!e||!e.data){return null}const{items:r,count:a}=e.data;const o=[];if(r.length===0||a<1){return null}Object.values(r).forEach((e=>{o.push(new P({name:e.name,icon:e.icon}))}));return new F({title:s,count:a,items:o,link:t,onClick:i})};const t=n.Extension.getSettings("rest.market-expired");let s=null;await Promise.all([n.ajax.runAction("rest.integration.getApplicationList",{data:{limit:3}}),n.ajax.runAction("rest.integration.getIntegrationList",{data:{limit:3}})]).then((([i,r])=>{const a=new x({withDiscount:t.withDiscount,popupType:t.type});const o=e(i,"/market/installed/",n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_TITLE_APPS"),(()=>{a.sendClickButton("view_all_apps")}));const l=e(r,"/devops/list/",n.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_TITLE_INTEGRATIONS"),(()=>{a.sendClickButton("view_all_integrations")}));if(o||l){const e=Te[t.type];if(e){s=new e({transitionPeriodEndDate:t.transitionPeriodEndDate,appList:o,integrationList:l,marketSubscriptionUrl:t.marketSubscriptionUrl,withDiscount:t.withDiscount,withDemo:t.withDemo,olWidgetCode:t.olWidgetCode,analytic:a})}}})).catch((e=>{console.log(e)}));return s}}e.MarketItem=P;e.MarketList=F;e.WarningMarketExpiredPopup=Be;e.FinalMarketExpiredPopup=Le;e.MarketExpired=ke})(this.BX.Rest=this.BX.Rest||{},BX.Main,BX.UI,BX.Event,BX.UI,BX,BX,BX.UI.Analytics,BX);
//# sourceMappingURL=market-expired.bundle.map.js