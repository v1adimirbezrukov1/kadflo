{"version":3,"file":"registry.bundle.js","sources":["../src/base/handlers/classes/message-delete-manager.js","../src/base/handlers/message.js","../src/base/handlers/chat.js","../src/base/handlers/tariff.js","../src/base/handlers/user.js","../src/base/handlers/desktop.js","../src/base/handlers/settings.js","../src/base/handlers/comments.js","../src/base/handlers/application.js","../src/base/handlers/collab.js","../src/base/base.js","../src/recent/classes/new-message-manager.js","../src/recent/classes/recent-update-manager.js","../src/recent/recent.js","../src/notification.js","../src/sidebar.js","../src/notifier.js","../src/online.js","../src/counter.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { EventType } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { InputActionListener } from 'im.v2.lib.input-action';\n\nimport type {\n\tMessageDeletePreparedParams,\n\tMessageDeleteCompletePreparedParams,\n\tDialogUpdateFieldsParams,\n} from '../../../types/message';\n\nexport class MessageDeleteManager\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tdeleteMessage(params: MessageDeletePreparedParams)\n\t{\n\t\tthis.#stopWriting(params.dialogId, params.senderId);\n\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tfields: {\n\t\t\t\ttext: '',\n\t\t\t\tisDeleted: true,\n\t\t\t\tfiles: [],\n\t\t\t\tattach: [],\n\t\t\t\treplyId: 0,\n\t\t\t},\n\t\t});\n\t}\n\n\tdeleteMessageComplete(params: MessageDeleteCompletePreparedParams)\n\t{\n\t\tthis.#stopWriting(params.dialogId, params.senderId);\n\n\t\tconst areChannelCommentsOpened = this.#store.getters['messages/comments/areOpenedForChannelPost'](params.id);\n\t\tif (areChannelCommentsOpened)\n\t\t{\n\t\t\tthis.#closeChannelComments(params);\n\t\t}\n\n\t\tvoid this.#store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t});\n\n\t\tconst dialogUpdateFields = this.#prepareDialogUpdateFields(params);\n\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: dialogUpdateFields,\n\t\t});\n\t}\n\n\t#stopWriting(dialogId: number, userId: number)\n\t{\n\t\tInputActionListener.getInstance().stopUserActionsInChat({ dialogId, userId });\n\t}\n\n\t#closeChannelComments(params: MessageDeleteCompletePreparedParams)\n\t{\n\t\tEventEmitter.emit(EventType.dialog.closeComments);\n\t\tAnalytics.getInstance().messageDelete.onDeletedPostNotification({\n\t\t\tdialogId: params.dialogId,\n\t\t\tmessageId: params.id,\n\t\t});\n\t\tthis.#showNotification(Loc.getMessage('IM_CONTENT_CHAT_CONTEXT_MESSAGE_NOT_FOUND'));\n\t}\n\n\t#showNotification(text: string)\n\t{\n\t\tBX.UI.Notification.Center.notify({ content: text });\n\t}\n\n\t#prepareDialogUpdateFields(params: MessageDeleteCompletePreparedParams): DialogUpdateFieldsParams\n\t{\n\t\tconst dialogUpdateFields = {\n\t\t\tcounter: params.counter,\n\t\t};\n\n\t\tconst lastMessageWasDeleted = Boolean(params.newLastMessage);\n\t\tif (lastMessageWasDeleted)\n\t\t{\n\t\t\tdialogUpdateFields.lastMessageId = params.newLastMessage.id;\n\t\t\tdialogUpdateFields.lastMessageViews = params.lastMessageViews;\n\n\t\t\tvoid this.#store.dispatch('messages/store', params.newLastMessage);\n\t\t}\n\n\t\treturn dialogUpdateFields;\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { UserManager } from 'im.v2.lib.user';\nimport { UuidManager } from 'im.v2.lib.uuid';\nimport { InputActionListener } from 'im.v2.lib.input-action';\nimport { EventType, DialogScrollThreshold, UserRole, ChatType } from 'im.v2.const';\nimport { MessageService } from 'im.v2.provider.service';\n\nimport { MessageDeleteManager } from './classes/message-delete-manager';\n\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\n\nimport type {\n\tMessageAddParams,\n\tMessageUpdateParams,\n\tMessageDeleteParams,\n\tMessageDeleteCompleteParams,\n\tMultipleMessageDeleteParams,\n\tReadMessageParams,\n\tReadMessageOpponentParams,\n\tPinAddParams,\n\tPinDeleteParams,\n\tAddReactionParams,\n\tDeleteReactionParams,\n\tMessageDeleteCompletePreparedParams,\n\tPrepareDeleteMessageParams,\n} from '../../types/message';\nimport type { PullExtraParams, RawFile, RawUser, RawMessage, RawChat } from '../../types/common';\n\ntype UserId = number;\n\nexport class MessagePullHandler\n{\n\t#store: Store;\n\t#messageViews: {[messageId: string]: Set<UserId>} = {};\n\t#messageDeleteManager: MessageDeleteManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#messageDeleteManager = new MessageDeleteManager();\n\t}\n\n\thandleMessageAdd(params: MessageAddParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageAdd', params);\n\t\tthis.#setMessageChat(params);\n\t\tthis.#setUsers(params);\n\t\tthis.#setFiles(params);\n\t\tthis.#setAdditionalEntities(params);\n\t\tthis.#setCommentInfo(params);\n\t\tthis.#setCopilotRole(params);\n\n\t\tconst messageWithTemplateId = this.#store.getters['messages/isInChatCollection']({\n\t\t\tmessageId: params.message.templateId,\n\t\t});\n\n\t\tconst messageWithRealId = this.#store.getters['messages/isInChatCollection']({\n\t\t\tmessageId: params.message.id,\n\t\t});\n\n\t\t// update message with parsed link info\n\t\tif (messageWithRealId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have this message', params.message);\n\t\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\t\tid: params.message.id,\n\t\t\t\tfields: { ...params.message, error: false },\n\t\t\t});\n\t\t\tthis.#sendScrollEvent(params.chatId);\n\t\t}\n\t\telse if (!messageWithRealId && messageWithTemplateId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have the TEMPORARY message', params.message);\n\t\t\tvoid this.#store.dispatch('messages/updateWithId', {\n\t\t\t\tid: params.message.templateId,\n\t\t\t\tfields: { ...params.message, error: false },\n\t\t\t});\n\t\t}\n\t\t// it's an opponent message or our own message from somewhere else\n\t\telse if (!messageWithRealId && !messageWithTemplateId)\n\t\t{\n\t\t\tconst hasLoadingMessage: boolean = this.#store.getters['messages/hasLoadingMessageByMessageId'](\n\t\t\t\tparams.message.templateId,\n\t\t\t);\n\t\t\tif (hasLoadingMessage)\n\t\t\t{\n\t\t\t\tvoid this.#store.dispatch('messages/deleteLoadingMessageByMessageId', {\n\t\t\t\t\tmessageId: params.message.templateId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tLogger.warn('New message pull handler: we dont have this message', params.message);\n\t\t\tthis.#handleAddingMessageToModel(params);\n\t\t}\n\n\t\tInputActionListener.getInstance().stopUserActionsInChat({\n\t\t\tuserId: params.message.senderId,\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\n\t\tthis.#updateDialog(params);\n\t}\n\n\thandleMessageUpdate(params: MessageUpdateParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageUpdate', params);\n\t\tInputActionListener.getInstance().stopUserActionsInChat({\n\t\t\tuserId: params.senderId,\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tfields: {\n\t\t\t\ttext: params.text,\n\t\t\t\tparams: params.params,\n\t\t\t},\n\t\t});\n\t\tthis.#sendScrollEvent(params.chatId);\n\t}\n\n\thandleMessageDeleteV2(params: MultipleMessageDeleteParams)\n\t{\n\t\tLogger.warn('MessageDeletePullHandler: handleMultipleMessageDelete', params);\n\n\t\tconst messages = params.messages;\n\n\t\tmessages.forEach((message) => {\n\t\t\tif (message.completelyDeleted)\n\t\t\t{\n\t\t\t\tconst preparedParams = this.#prepareDeleteMessageParams(params, true, message);\n\t\t\t\tthis.#messageDeleteManager.deleteMessageComplete(preparedParams);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst preparedParams = this.#prepareDeleteMessageParams(params, false, message);\n\t\t\tthis.#messageDeleteManager.deleteMessage(preparedParams);\n\t\t});\n\t}\n\n\thandleMessageDelete(params: MessageDeleteParams)\n\t{\n\t\tLogger.warn('MessageDeletePullHandler: handleMessageDelete', params);\n\t\tconst preparedParams = this.#prepareDeleteMessageParams(params);\n\t\tthis.#messageDeleteManager.deleteMessage(preparedParams);\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tLogger.warn('MessageDeletePullHandler: handleMessageDeleteComplete', params);\n\n\t\tconst preparedParams = this.#prepareDeleteMessageParams(params, true);\n\t\tthis.#messageDeleteManager.deleteMessageComplete(preparedParams);\n\t}\n\n\thandleAddReaction(params: AddReactionParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleAddReaction', params);\n\t\tconst {\n\t\t\tactualReactions: { reaction: actualReactionsState, usersShort },\n\t\t\tuserId,\n\t\t\treaction,\n\t\t} = params;\n\t\tif (Core.getUserId() === userId)\n\t\t{\n\t\t\tactualReactionsState.ownReactions = [reaction];\n\t\t}\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.addUsersToModel(usersShort);\n\n\t\tthis.#store.dispatch('messages/reactions/set', [actualReactionsState]);\n\t}\n\n\thandleDeleteReaction(params: DeleteReactionParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleDeleteReaction', params);\n\t\tconst { actualReactions: { reaction: actualReactionsState } } = params;\n\t\tthis.#store.dispatch('messages/reactions/set', [actualReactionsState]);\n\t}\n\n\thandleMessageParamsUpdate(params)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageParamsUpdate', params);\n\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: { params: params.params },\n\t\t});\n\t}\n\n\thandleReadMessage(params: ReadMessageParams, extra: PullExtraParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleReadMessage', params);\n\t\tconst uuidManager = UuidManager.getInstance();\n\t\tif (uuidManager.hasActionUuid(extra.action_uuid))\n\t\t{\n\t\t\tLogger.warn('MessagePullHandler: handleReadMessage: we have this uuid, skip');\n\t\t\tuuidManager.removeActionUuid(extra.action_uuid);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\tmessageIds: params.viewedMessages,\n\t\t}).then(() => {\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t\tlastId: params.lastId,\n\t\t\t\t},\n\t\t\t});\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('MessagePullHandler: error handling readMessage', error);\n\t\t});\n\t}\n\n\thandleReadMessageOpponent(params: ReadMessageOpponentParams)\n\t{\n\t\tif (params.userId === Core.getUserId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tLogger.warn('MessagePullHandler: handleReadMessageOpponent', params);\n\t\tthis.#updateMessageViewedByOthers(params);\n\t\tthis.#updateChatLastMessageViews(params);\n\t}\n\n\thandlePinAdd(params: PinAddParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handlePinAdd', params);\n\t\tthis.#setFiles(params);\n\t\tthis.#setUsers(params);\n\t\tthis.#store.dispatch('messages/store', params.additionalMessages);\n\t\tthis.#store.dispatch('messages/pin/add', {\n\t\t\tchatId: params.pin.chatId,\n\t\t\tmessageId: params.pin.messageId,\n\t\t});\n\t\tif (Core.getUserId() !== params.pin.authorId)\n\t\t{\n\t\t\t// this.#sendScrollEvent(params.link.chatId);\n\t\t}\n\t}\n\n\thandlePinDelete(params: PinDeleteParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handlePinDelete', params);\n\t\tthis.#store.dispatch('messages/pin/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tmessageId: params.messageId,\n\t\t});\n\t}\n\n\t// helpers\n\t#setMessageChat(params: MessageAddParams)\n\t{\n\t\tconst chat = params.chat?.[params.chatId];\n\t\tif (!chat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatToAdd = { ...params.chat[params.chatId], dialogId: params.dialogId };\n\t\tconst dialogExists = Boolean(this.#getDialog(params.dialogId));\n\t\tconst messageWithoutNotification = !params.notify || params.message?.params?.NOTIFY === 'N';\n\t\tif (!dialogExists && !messageWithoutNotification && !chatToAdd.role)\n\t\t{\n\t\t\tchatToAdd.role = UserRole.member;\n\t\t}\n\t\tthis.#store.dispatch('chats/set', chatToAdd);\n\t}\n\n\t#setUsers(params: {users: {[userId: string]: RawUser} | []})\n\t{\n\t\tif (!params.users)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(Object.values(params.users));\n\t}\n\n\t#setFiles(params: {files: {[fileId: string]: RawFile} | [], message?: RawMessage})\n\t{\n\t\tif (!params.files)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst files = Object.values(params.files);\n\t\tfiles.forEach((file: RawFile) => {\n\t\t\tvoid this.#store.dispatch('files/set', file);\n\t\t});\n\t}\n\n\t#setAdditionalEntities(params: MessageAddParams): void\n\t{\n\t\tif (!params.message.additionalEntities)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tadditionalMessages,\n\t\t\tmessages,\n\t\t\tfiles,\n\t\t\tusers,\n\t\t} = params.message.additionalEntities;\n\t\tconst newMessages = [...messages, ...additionalMessages];\n\t\tthis.#store.dispatch('messages/store', newMessages);\n\t\tthis.#store.dispatch('files/set', files);\n\t\tthis.#store.dispatch('users/set', users);\n\t}\n\n\t#setCommentInfo(params: MessageAddParams): void\n\t{\n\t\tconst chat: RawChat = params.chat?.[params.chatId];\n\t\tif (!chat || chat.type !== ChatType.comment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('messages/comments/set', {\n\t\t\tmessageId: chat.parent_message_id,\n\t\t\tchatId: params.chatId,\n\t\t\tmessageCount: chat.message_count,\n\t\t});\n\t\tthis.#store.dispatch('messages/comments/setLastUser', {\n\t\t\tmessageId: chat.parent_message_id,\n\t\t\tnewUserId: params.message.senderId,\n\t\t});\n\t}\n\n\t#handleAddingMessageToModel(params: MessageAddParams)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId, true);\n\t\tif (dialog.hasNextPage)\n\t\t{\n\t\t\tthis.#store.dispatch('messages/store', params.message);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tconst unreadMessages: ImModelMessage[] = this.#store.getters['messages/getChatUnreadMessages'](params.chatId);\n\t\tconst RELOAD_LIMIT = MessageService.getMessageRequestLimit() * 5;\n\t\tif (dialog.inited && !chatIsOpened && unreadMessages.length > RELOAD_LIMIT)\n\t\t{\n\t\t\tthis.#store.dispatch('messages/store', params.message);\n\t\t\tconst messageService = new MessageService({ chatId: params.chatId });\n\t\t\tmessageService.reloadMessageList();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#addMessageToModel(params.message);\n\t\tthis.#sendScrollEvent(params.chatId);\n\t}\n\n\t#addMessageToModel(message)\n\t{\n\t\tconst newMessage = { ...message };\n\t\tif (message.senderId === Core.getUserId())\n\t\t{\n\t\t\tnewMessage.unread = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewMessage.unread = true;\n\t\t\tnewMessage.viewed = false;\n\t\t}\n\t\tthis.#store.dispatch('messages/setChatCollection', { messages: [newMessage] });\n\t}\n\n\t#updateDialog(params)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId, true);\n\n\t\tconst dialogFieldsToUpdate = {};\n\t\tif (params.message.id > dialog.lastMessageId)\n\t\t{\n\t\t\tdialogFieldsToUpdate.lastMessageId = params.message.id;\n\t\t}\n\n\t\tif (params.message.senderId === Core.getUserId() && params.message.id > dialog.lastReadId)\n\t\t{\n\t\t\tdialogFieldsToUpdate.lastId = params.message.id;\n\t\t}\n\n\t\tdialogFieldsToUpdate.counter = params.counter;\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: dialogFieldsToUpdate,\n\t\t});\n\t\tthis.#store.dispatch('chats/clearLastMessageViews', {\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\t}\n\n\t#updateMessageViewedByOthers(params: ReadMessageOpponentParams)\n\t{\n\t\tthis.#store.dispatch('messages/setViewedByOthers', { ids: params.viewedMessages });\n\t}\n\n\t#updateChatLastMessageViews(params: ReadMessageOpponentParams)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isLastMessage = params.viewedMessages.includes(dialog.lastMessageId);\n\t\tif (!isLastMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#checkMessageViewsRegistry(params.userId, dialog.lastMessageId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasFirstViewer = Boolean(dialog.lastMessageViews.firstViewer);\n\t\tif (hasFirstViewer)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/incrementLastMessageViews', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t});\n\t\t\tthis.#updateMessageViewsRegistry(params.userId, dialog.lastMessageId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/setLastMessageViews', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tuserId: params.userId,\n\t\t\t\tuserName: params.userName,\n\t\t\t\tdate: params.date,\n\t\t\t\tmessageId: dialog.lastMessageId,\n\t\t\t},\n\t\t});\n\n\t\tthis.#updateMessageViewsRegistry(params.userId, dialog.lastMessageId);\n\t}\n\n\t#checkMessageViewsRegistry(userId: number, messageId: number): boolean\n\t{\n\t\treturn Boolean(this.#messageViews[messageId]?.has(userId));\n\t}\n\n\t#updateMessageViewsRegistry(userId: number, messageId: number): void\n\t{\n\t\tif (!this.#messageViews[messageId])\n\t\t{\n\t\t\tthis.#messageViews[messageId] = new Set();\n\t\t}\n\n\t\tthis.#messageViews[messageId].add(userId);\n\t}\n\n\t#sendScrollEvent(chatId: number)\n\t{\n\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, { chatId, threshold: DialogScrollThreshold.nearTheBottom });\n\t}\n\n\t#getDialog(dialogId: string, temporary: boolean = false): ?ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/get'](dialogId, temporary);\n\t}\n\n\t#setCopilotRole(params)\n\t{\n\t\tif (!params.copilot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tvoid copilotManager.handleMessageAdd(params.copilot);\n\t}\n\n\t#prepareDeleteMessageParams(\n\t\tparams: PrepareDeleteMessageParams,\n\t\tisComplete = false,\n\t\tmessage = null,\n\t): MessageDeleteCompletePreparedParams\n\t{\n\t\tconst baseParams = {\n\t\t\tid: message ? message.id : params.id,\n\t\t\tsenderId: message ? message.senderId : params.senderId,\n\t\t\tdialogId: params.dialogId,\n\t\t};\n\n\t\tif (isComplete)\n\t\t{\n\t\t\treturn {\n\t\t\t\t...baseParams,\n\t\t\t\tnewLastMessage: params.newLastMessage,\n\t\t\t\tlastMessageViews: params.lastMessageViews,\n\t\t\t\tcounter: params.counter,\n\t\t\t};\n\t\t}\n\n\t\treturn baseParams;\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { Loc } from 'main.core';\n\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { Messenger } from 'im.public';\nimport { ChatType, UserRole } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { InputActionListener } from 'im.v2.lib.input-action';\nimport { Logger } from 'im.v2.lib.logger';\nimport { getChatRoleForUser } from 'im.v2.lib.role-manager';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport type {\n\tChatOwnerParams,\n\tChatManagersParams,\n\tChatUserAddParams,\n\tChatUserLeaveParams,\n\tInputActionNotifyParams,\n\tChatUnreadParams,\n\tChatMuteNotifyParams,\n\tChatRenameParams,\n\tChatAvatarParams,\n\tChatConvertParams,\n\tChatDeleteParams,\n} from '../../types/chat';\nimport type { RawUser, RawChat } from '../../types/common';\nimport type { ImModelChat } from 'im.v2.model';\n\nexport class ChatPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleChatOwner(params: ChatOwnerParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatOwner', params);\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatManagers(params: ChatManagersParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatManagers', params);\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmanagerList: params.list,\n\t\t\t},\n\t\t});\n\n\t\tconst chat: ImModelChat = this.#store.getters['chats/get'](params.dialogId);\n\t\tif (!chat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userInManagerList = params.list.includes(Core.getUserId());\n\t\tif (chat.role === UserRole.member && userInManagerList)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\trole: UserRole.manager,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (chat.role === UserRole.manager && !userInManagerList)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\trole: UserRole.member,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatUserAdd(params: ChatUserAddParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUserAdd', params);\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (params.newUsers.includes(currentUserId))\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: { role: UserRole.member },\n\t\t\t});\n\t\t}\n\t\tthis.#updateChatUsers(params);\n\t}\n\n\thandleChatUserLeave(params: ChatUserLeaveParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUserLeave', params);\n\t\tconst currentUserIsKicked = params.userId === Core.getUserId();\n\n\t\tif (currentUserIsKicked)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: { inited: false },\n\t\t\t});\n\t\t\tthis.#store.dispatch('messages/clearChatCollection', { chatId: params.chatId });\n\t\t}\n\n\t\tconst isChannel = ChannelManager.isChannel(params.dialogId);\n\t\tif (isChannel)\n\t\t{\n\t\t\tvoid this.#store.dispatch('counters/deleteForChannel', {\n\t\t\t\tchannelChatId: params.chatId,\n\t\t\t});\n\t\t}\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tif (currentUserIsKicked && chatIsOpened)\n\t\t{\n\t\t\tMessenger.openChat();\n\t\t}\n\n\t\tconst chatHasCall = CallManager.getInstance().getCurrentCallDialogId() === params.dialogId;\n\t\tif (currentUserIsKicked && chatHasCall)\n\t\t{\n\t\t\tCallManager.getInstance().leaveCurrentCall();\n\t\t}\n\n\t\tif (currentUserIsKicked)\n\t\t{\n\t\t\tCallManager.getInstance().deleteRecentCall(params.dialogId);\n\t\t}\n\n\t\tthis.#updateChatUsers(params);\n\t}\n\n\thandleInputActionNotify(params: InputActionNotifyParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleInputActionNotify', params);\n\t\tInputActionListener.getInstance().startAction(params);\n\t\tthis.#store.dispatch('users/update', {\n\t\t\tid: params.userId,\n\t\t\tfields: { lastActivityDate: new Date() },\n\t\t});\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUnread', params);\n\t\tlet markedId = 0;\n\t\tif (params.active === true)\n\t\t{\n\t\t\tmarkedId = params.markedId;\n\t\t}\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: { markedId },\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params: ChatMuteNotifyParams)\n\t{\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/mute', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/unmute', {\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\t}\n\n\thandleChatRename(params: ChatRenameParams)\n\t{\n\t\tconst dialog = this.#store.getters['chats/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tname: params.name,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatAvatar(params: ChatAvatarParams)\n\t{\n\t\tconst dialog = this.#store.getters['chats/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tavatar: params.avatar,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleReadAllChats()\n\t{\n\t\tLogger.warn('ChatPullHandler: handleReadAllChats');\n\t\tthis.#store.dispatch('chats/clearCounters');\n\t\tthis.#store.dispatch('recent/clearUnread');\n\t}\n\n\thandleChatConvert(params: ChatConvertParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatConvert', params);\n\t\tconst { dialogId, newType, newPermissions } = params;\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\ttype: newType,\n\t\t\t\tpermissions: newPermissions,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatCopilotRoleUpdate(params)\n\t{\n\t\tif (!params.copilotRole)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tvoid copilotManager.handleRoleUpdate(params.copilotRole);\n\t}\n\n\thandleChatUpdate(params: {chat: RawChat})\n\t{\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.chat.dialogId,\n\t\t\tfields: {\n\t\t\t\trole: getChatRoleForUser(params.chat),\n\t\t\t\t...params.chat,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatDelete(params: ChatDeleteParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatDelete', params);\n\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (params.userId === currentUserId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: { inited: false },\n\t\t});\n\t\tvoid this.#store.dispatch('recent/delete', { id: params.dialogId });\n\n\t\tconst isCommentChat = params.type === ChatType.comment;\n\t\tif (isCommentChat)\n\t\t{\n\t\t\tvoid this.#store.dispatch('counters/deleteForChannel', {\n\t\t\t\tchannelChatId: params.parentChatId,\n\t\t\t\tcommentChatId: params.chatId,\n\t\t\t});\n\t\t}\n\n\t\tconst isChannel = ChannelManager.isChannel(params.dialogId);\n\t\tif (isChannel)\n\t\t{\n\t\t\tvoid this.#store.dispatch('counters/deleteForChannel', {\n\t\t\t\tchannelChatId: params.chatId,\n\t\t\t});\n\t\t}\n\n\t\tvoid this.#store.dispatch('messages/clearChatCollection', { chatId: params.chatId });\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tAnalytics.getInstance().chatDelete.onChatDeletedNotification(params.dialogId);\n\t\t\tthis.#showNotification(Loc.getMessage('IM_CONTENT_CHAT_ACCESS_ERROR_MSGVER_1'));\n\t\t\tvoid LayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t\t\tvoid LayoutManager.getInstance().deleteLastOpenedElementById(params.dialogId);\n\t\t}\n\n\t\tconst chatHasCall = CallManager.getInstance().getCurrentCallDialogId() === params.dialogId;\n\t\tif (chatHasCall)\n\t\t{\n\t\t\tCallManager.getInstance().leaveCurrentCall();\n\t\t}\n\t}\n\n\t#updateChatUsers(params: {\n\t\tusers?: {[userId: string]: RawUser},\n\t\tdialogId: string,\n\t\tuserCount: number\n\t})\n\t{\n\t\tif (params.users)\n\t\t{\n\t\t\tconst userManager = new UserManager();\n\t\t\tuserManager.setUsersToModel(Object.values(params.users));\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: { userCounter: params.userCount },\n\t\t});\n\t}\n\n\t#showNotification(text: string): void\n\t{\n\t\tBX.UI.Notification.Center.notify({ content: text });\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { ChangeTariffParams } from '../../types/tariff';\n\nexport class TariffPullHandler\n{\n\thandleChangeTariff(params: ChangeTariffParams)\n\t{\n\t\tLogger.warn('TariffPullHandler: handleChangeTariff', params);\n\t\tconst { tariffRestrictions } = params;\n\t\tif (!tariffRestrictions)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (tariffRestrictions.fullChatHistory?.isAvailable === true)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('application/tariffRestrictions/set', tariffRestrictions);\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { UserInviteParams } from '../../types/user';\nimport type { UserShowInRecentParams } from '../../types/recent';\n\nexport class UserPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleUserInvite(params: UserInviteParams)\n\t{\n\t\tif (params.invited)\n\t\t{\n\t\t\tconst userManager = new UserManager();\n\t\t\tuserManager.setUsersToModel([params.user]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('users/update', {\n\t\t\tid: params.userId,\n\t\t\tfields: params.user,\n\t\t});\n\t}\n\n\thandleUserShowInRecent(params: UserShowInRecentParams)\n\t{\n\t\tconst usersToStore = params.items.map((item) => item.user);\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(usersToStore);\n\t}\n}\n","import { Logger } from 'im.v2.lib.logger';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { CounterManager } from 'im.v2.lib.counter';\n\nimport type { DesktopOnlineParams } from '../../types/desktop';\n\nexport class DesktopPullHandler\n{\n\thandleDesktopOnline(params: DesktopOnlineParams)\n\t{\n\t\tLogger.warn('DesktopPullHandler: handleDesktopOnline', params);\n\t\tconst desktopManager = DesktopManager.getInstance();\n\t\tdesktopManager.setDesktopActive(true);\n\t\tdesktopManager.setDesktopVersion(params.version);\n\n\t\tCounterManager.getInstance().removeBrowserTitleCounter();\n\t}\n\n\thandleDesktopOffline()\n\t{\n\t\tLogger.warn('DesktopPullHandler: handleDesktopOffline');\n\t\tDesktopManager.getInstance().setDesktopActive(false);\n\t\tDesktopManager.getInstance().setDesktopVersion(0);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { SettingsUpdateParams } from '../../types/settings';\n\nexport class SettingsPullHandler\n{\n\thandleSettingsUpdate(params: SettingsUpdateParams)\n\t{\n\t\tLogger.warn('SettingsPullHandler: handleSettingsUpdate', params);\n\t\tObject.entries(params).forEach(([optionName, optionValue]) => {\n\t\t\tCore.getStore().dispatch('application/settings/set', {\n\t\t\t\t[optionName]: optionValue,\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { CommentSubscribeParams, ReadAllChannelCommentsParams } from '../../types/comments';\n\nexport class CommentsPullHandler\n{\n\thandleCommentSubscribe(params: CommentSubscribeParams)\n\t{\n\t\tconst { messageId, subscribe } = params;\n\t\tLogger.warn('CommentsPullHandler: handleCommentSubscribe', params);\n\t\tif (subscribe)\n\t\t{\n\t\t\tCore.getStore().dispatch('messages/comments/subscribe', messageId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('messages/comments/unsubscribe', messageId);\n\t}\n\n\thandleReadAllChannelComments(params: ReadAllChannelCommentsParams)\n\t{\n\t\tCore.getStore().dispatch('counters/readAllChannelComments', params.chatId);\n\t}\n}\n","import { Messenger } from 'im.public';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { Logger } from 'im.v2.lib.logger';\nimport type { ApplicationOpenChatParams } from '../../types/application';\n\nexport class ApplicationPullHandler\n{\n\thandleApplicationOpenChat(params: ApplicationOpenChatParams): void\n\t{\n\t\tLogger.warn('ApplicationPullHandler: handleOpenChat', params);\n\n\t\tconst hasFocus = document.hasFocus();\n\t\tif (!hasFocus)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (DesktopManager.isDesktop())\n\t\t{\n\t\t\tif (!DesktopManager.isChatWindow())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid Messenger.openChat(params.dialogId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!MessengerSlider.getInstance().isFocused())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Messenger.openChat(params.dialogId);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { UpdateCollabEntityCounterParams, UpdateCollabGuestCountParams } from '../../types/collab';\n\nexport class CollabPullHandler\n{\n\thandleUpdateCollabEntityCounter(params: UpdateCollabEntityCounterParams)\n\t{\n\t\tLogger.warn('CollabPullHandler: handleUpdateCollabEntityCounter', params);\n\t\tconst { chatId, counter, entity } = params;\n\t\tvoid Core.getStore().dispatch('chats/collabs/setCounter', { chatId, entity, counter });\n\t}\n\n\thandleUpdateCollabGuestCount(params: UpdateCollabGuestCountParams)\n\t{\n\t\tLogger.warn('CollabPullHandler: handleUpdateCollabGuestCount', params);\n\t\tconst { chatId, guestCount } = params;\n\t\tvoid Core.getStore().dispatch('chats/collabs/setGuestCount', { chatId, guestCount });\n\t}\n}\n","import { MessagePullHandler } from './handlers/message';\nimport { ChatPullHandler } from './handlers/chat';\nimport { TariffPullHandler } from './handlers/tariff';\nimport { UserPullHandler } from './handlers/user';\nimport { DesktopPullHandler } from './handlers/desktop';\nimport { SettingsPullHandler } from './handlers/settings';\nimport { CommentsPullHandler } from './handlers/comments';\nimport { ApplicationPullHandler } from './handlers/application';\nimport { CollabPullHandler } from './handlers/collab';\n\nexport class BasePullHandler\n{\n\t#messageHandler: MessagePullHandler;\n\t#chatHandler: ChatPullHandler;\n\t#userHandler: UserPullHandler;\n\t#desktopHandler: DesktopPullHandler;\n\t#settingsHandler: SettingsPullHandler;\n\t#commentsHandler: CommentsPullHandler;\n\t#tariffPullHandler: TariffPullHandler;\n\t#applicationPullHandler: ApplicationPullHandler;\n\t#collabPullHandler: CollabPullHandler;\n\n\tconstructor()\n\t{\n\t\tthis.#messageHandler = new MessagePullHandler();\n\t\tthis.#chatHandler = new ChatPullHandler();\n\t\tthis.#userHandler = new UserPullHandler();\n\t\tthis.#desktopHandler = new DesktopPullHandler();\n\t\tthis.#settingsHandler = new SettingsPullHandler();\n\t\tthis.#commentsHandler = new CommentsPullHandler();\n\t\tthis.#tariffPullHandler = new TariffPullHandler();\n\t\tthis.#applicationPullHandler = new ApplicationPullHandler();\n\t\tthis.#collabPullHandler = new CollabPullHandler();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\t// region 'message'\n\thandleMessage(params)\n\t{\n\t\tthis.#messageHandler.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.#messageHandler.handleMessageAdd(params);\n\t}\n\n\thandleMessageUpdate(params)\n\t{\n\t\tthis.#messageHandler.handleMessageUpdate(params);\n\t}\n\n\thandleMessageDeleteV2(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDeleteV2(params);\n\t}\n\n\thandleMessageDelete(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDelete(params);\n\t}\n\n\thandleMessageDeleteComplete(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDeleteComplete(params);\n\t}\n\n\thandleAddReaction(params)\n\t{\n\t\tthis.#messageHandler.handleAddReaction(params);\n\t}\n\n\thandleDeleteReaction(params)\n\t{\n\t\tthis.#messageHandler.handleDeleteReaction(params);\n\t}\n\n\thandleMessageParamsUpdate(params)\n\t{\n\t\tthis.#messageHandler.handleMessageParamsUpdate(params);\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tthis.#messageHandler.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.#messageHandler.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tthis.#messageHandler.handleReadMessageOpponent(params);\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.#messageHandler.handleReadMessageOpponent(params);\n\t}\n\n\thandlePinAdd(params)\n\t{\n\t\tthis.#messageHandler.handlePinAdd(params);\n\t}\n\n\thandlePinDelete(params)\n\t{\n\t\tthis.#messageHandler.handlePinDelete(params);\n\t}\n\t// endregion 'message'\n\n\t// region 'chat'\n\thandleChatOwner(params)\n\t{\n\t\tthis.#chatHandler.handleChatOwner(params);\n\t}\n\n\thandleChatManagers(params)\n\t{\n\t\tthis.#chatHandler.handleChatManagers(params);\n\t}\n\n\thandleChatUserAdd(params)\n\t{\n\t\tthis.#chatHandler.handleChatUserAdd(params);\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tthis.#chatHandler.handleChatUserLeave(params);\n\t}\n\n\thandleInputActionNotify(params)\n\t{\n\t\tthis.#chatHandler.handleInputActionNotify(params);\n\t}\n\n\thandleChatUnread(params)\n\t{\n\t\tthis.#chatHandler.handleChatUnread(params);\n\t}\n\n\thandleReadAllChats()\n\t{\n\t\tthis.#chatHandler.handleReadAllChats();\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tthis.#chatHandler.handleChatMuteNotify(params);\n\t}\n\n\thandleChatRename(params)\n\t{\n\t\tthis.#chatHandler.handleChatRename(params);\n\t}\n\n\thandleChatAvatar(params)\n\t{\n\t\tthis.#chatHandler.handleChatAvatar(params);\n\t}\n\n\thandleChatUpdate(params)\n\t{\n\t\tthis.#chatHandler.handleChatUpdate(params);\n\t}\n\n\thandleChatDelete(params)\n\t{\n\t\tthis.#chatHandler.handleChatDelete(params);\n\t}\n\n\thandleChatConvert(params)\n\t{\n\t\tthis.#chatHandler.handleChatConvert(params);\n\t}\n\n\thandleChatCopilotRoleUpdate(params)\n\t{\n\t\tthis.#chatHandler.handleChatCopilotRoleUpdate(params);\n\t}\n\t// endregion 'chat'\n\n\t// region 'user'\n\thandleUserInvite(params)\n\t{\n\t\tthis.#userHandler.handleUserInvite(params);\n\t}\n\n\thandleUserShowInRecent(params)\n\t{\n\t\tthis.#userHandler.handleUserShowInRecent(params);\n\t}\n\t// endregion 'user'\n\n\t// region 'desktop'\n\thandleDesktopOnline(params)\n\t{\n\t\tthis.#desktopHandler.handleDesktopOnline(params);\n\t}\n\n\thandleDesktopOffline()\n\t{\n\t\tthis.#desktopHandler.handleDesktopOffline();\n\t}\n\t// endregion 'desktop'\n\n\t// region 'settings'\n\thandleSettingsUpdate(params)\n\t{\n\t\tthis.#settingsHandler.handleSettingsUpdate(params);\n\t}\n\t// endregion 'settings'\n\n\t// region 'comments'\n\thandleCommentSubscribe(params)\n\t{\n\t\tthis.#commentsHandler.handleCommentSubscribe(params);\n\t}\n\n\thandleReadAllChannelComments(params)\n\t{\n\t\tthis.#commentsHandler.handleReadAllChannelComments(params);\n\t}\n\t// endregion 'comments'\n\n\t// region 'tariff'\n\thandleChangeTariff(params)\n\t{\n\t\tthis.#tariffPullHandler.handleChangeTariff(params);\n\t}\n\t// endregion 'tariff'\n\n\t// region 'collab'\n\thandleUpdateCollabEntityCounter(params)\n\t{\n\t\tthis.#collabPullHandler.handleUpdateCollabEntityCounter(params);\n\t}\n\n\thandleUpdateCollabGuestCount(params)\n\t{\n\t\tthis.#collabPullHandler.handleUpdateCollabGuestCount(params);\n\t}\n\t// endregion 'collab'\n\n\t// region 'application'\n\thandleApplicationOpenChat(params)\n\t{\n\t\tthis.#applicationPullHandler.handleApplicationOpenChat(params);\n\t}\n\t// endregion 'application'\n}\n","import { Core } from 'im.v2.application.core';\nimport { ChatType } from 'im.v2.const';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport type { PullExtraParams, RawChat } from '../../types/common';\nimport type { MessageAddParams } from '../../types/message';\n\nconst ActionNameByChatType = {\n\t[ChatType.copilot]: 'recent/setCopilot',\n\t[ChatType.channel]: 'recent/setChannel',\n\t[ChatType.openChannel]: 'recent/setChannel',\n\t[ChatType.generalChannel]: 'recent/setChannel',\n\t[ChatType.collab]: 'recent/setCollab',\n\tdefault: 'recent/setRecent',\n};\n\nexport class NewMessageManager\n{\n\t#params: MessageAddParams;\n\t#extra: PullExtraParams;\n\n\tconstructor(params: MessageAddParams, extra: PullExtraParams = {})\n\t{\n\t\tthis.#params = params;\n\t\tthis.#extra = extra;\n\t}\n\n\tgetChatId(): number\n\t{\n\t\treturn this.#params.chatId;\n\t}\n\n\tgetParentChatId(): number\n\t{\n\t\treturn this.getChat()?.parent_chat_id || 0;\n\t}\n\n\tgetChat(): ?RawChat\n\t{\n\t\tconst chatId = this.getChatId();\n\n\t\treturn this.#params.chat?.[chatId];\n\t}\n\n\tgetChatType(): string\n\t{\n\t\tconst chat = this.getChat();\n\n\t\treturn chat?.type ?? '';\n\t}\n\n\tisLinesChat(): boolean\n\t{\n\t\treturn Boolean(this.#params.lines);\n\t}\n\n\tisCommentChat(): boolean\n\t{\n\t\treturn this.getChatType() === ChatType.comment;\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\treturn this.getChatType() === ChatType.collab;\n\t}\n\n\tisChannelChat(): boolean\n\t{\n\t\treturn ChannelManager.channelTypes.has(this.getChatType());\n\t}\n\n\tisUserInChat(): boolean\n\t{\n\t\tconst chatUsers = this.#params.userInChat[this.getChatId()];\n\t\tif (!chatUsers || this.isChannelListEvent())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn chatUsers.includes(Core.getUserId());\n\t}\n\n\tisChannelListEvent(): boolean\n\t{\n\t\treturn this.isChannelChat() && this.#extra.is_shared_event;\n\t}\n\n\tneedToSkipMessageEvent(): boolean\n\t{\n\t\treturn this.isLinesChat() || this.isCommentChat() || !this.isUserInChat();\n\t}\n\n\tgetAddActions(): string[]\n\t{\n\t\t// for open channels there are two similar P&P events\n\t\t// one adds data to default recent, another adds data to channel recent\n\t\t// close channels are added only to default recent\n\t\tif (this.isChannelChat() && !this.isChannelListEvent())\n\t\t{\n\t\t\treturn [ActionNameByChatType.default];\n\t\t}\n\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn [ActionNameByChatType.default, ActionNameByChatType[ChatType.collab]];\n\t\t}\n\n\t\tconst newMessageChatType = this.getChatType();\n\t\tconst actionName = ActionNameByChatType[newMessageChatType] ?? ActionNameByChatType.default;\n\n\t\treturn [actionName];\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { RecentUpdateParams } from '../../types/recent';\n\nexport class RecentUpdateManager\n{\n\t#params: RecentUpdateParams;\n\n\tconstructor(params: RecentUpdateParams)\n\t{\n\t\tthis.#params = params;\n\t}\n\n\tsetLastMessageInfo(): void\n\t{\n\t\tthis.#setMessageChat();\n\t\tthis.#setUsers();\n\t\tthis.#setFiles();\n\t\tthis.#setMessage();\n\t}\n\n\tgetDialogId(): string\n\t{\n\t\treturn this.#params.chat.dialogId;\n\t}\n\n\tgetLastMessageId(): number\n\t{\n\t\tconst [lastMessage] = this.#params.messages;\n\n\t\treturn lastMessage.id;\n\t}\n\n\t#setUsers(): void\n\t{\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(this.#params.users);\n\t}\n\n\t#setFiles(): void\n\t{\n\t\tCore.getStore().dispatch('files/set', this.#params.files);\n\t}\n\n\t#setMessageChat(): void\n\t{\n\t\tconst chat = { ...this.#params.chat, counter: this.#params.counter, dialogId: this.getDialogId() };\n\t\tCore.getStore().dispatch('chats/set', chat);\n\t}\n\n\t#setMessage(): void\n\t{\n\t\tconst [lastChannelPost] = this.#params.messages;\n\t\tCore.getStore().dispatch('messages/store', lastChannelPost);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ImModelMessage } from 'im.v2.model';\n\nimport { NewMessageManager } from './classes/new-message-manager';\nimport { RecentUpdateManager } from './classes/recent-update-manager';\n\nimport type { PullExtraParams, RawMessage } from '../types/common';\nimport type {\n\tMessageAddParams,\n\tAddReactionParams,\n\tMessageDeleteCompleteParams,\n\tMultipleMessageDeleteParams,\n} from '../types/message';\nimport type { ChatUnreadParams } from '../types/chat';\nimport type { UserInviteParams } from '../types/user';\nimport type { RecentUpdateParams, UserShowInRecentParams } from '../types/recent';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// noinspection JSUnusedGlobalSymbols\nexport class RecentPullHandler\n{\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tconst manager = new NewMessageManager(params, extra);\n\t\tif (manager.needToSkipMessageEvent(params))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageAdd', params);\n\t\tconst newRecentItem = {\n\t\t\tid: params.dialogId,\n\t\t\tchatId: params.chatId,\n\t\t\tmessageId: params.message.id,\n\t\t};\n\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (recentItem)\n\t\t{\n\t\t\tnewRecentItem.isFakeElement = false;\n\t\t\tnewRecentItem.isBirthdayPlaceholder = false;\n\t\t\tnewRecentItem.liked = false;\n\t\t}\n\n\t\tconst addActions = manager.getAddActions();\n\t\taddActions.forEach((actionName) => {\n\t\t\tCore.getStore().dispatch(actionName, newRecentItem);\n\t\t});\n\t}\n\n\thandleMessageDeleteV2(params: MultipleMessageDeleteParams)\n\t{\n\t\tthis.#deleteLastMessage(params.dialogId, params.newLastMessage);\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tthis.#deleteLastMessage(params.dialogId, params.newLastMessage);\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUnread', params);\n\t\tCore.getStore().dispatch('recent/unread', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active,\n\t\t});\n\t}\n\n\thandleAddReaction(params: AddReactionParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleAddReaction', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatIsOpened = Core.getStore().getters['application/isChatOpen'](params.dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst message: ?ImModelMessage = Core.getStore().getters['recent/getMessage'](params.dialogId);\n\t\tconst isOwnLike = Core.getUserId() === params.userId;\n\t\tconst isOwnLastMessage = Core.getUserId() === message.authorId;\n\t\tif (isOwnLike || !isOwnLastMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/like', {\n\t\t\tid: params.dialogId,\n\t\t\tmessageId: params.actualReactions.reaction.messageId,\n\t\t\tliked: true,\n\t\t});\n\t}\n\n\thandleChatPin(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatPin', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/pin', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active,\n\t\t});\n\t}\n\n\thandleChatHide(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatHide', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/delete', {\n\t\t\tid: params.dialogId,\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUserLeave', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem || params.userId !== Core.getUserId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/delete', {\n\t\t\tid: params.dialogId,\n\t\t});\n\t}\n\n\thandleUserInvite(params: UserInviteParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserInvite', params);\n\n\t\tconst messageId = Utils.text.getUuidV4();\n\t\tCore.getStore().dispatch('messages/store', {\n\t\t\tid: messageId,\n\t\t\tdate: params.date,\n\t\t});\n\n\t\tCore.getStore().dispatch('recent/setRecent', {\n\t\t\tid: params.user.id,\n\t\t\tinvited: params.invited ?? false,\n\t\t\tisFakeElement: true,\n\t\t\tmessageId,\n\t\t});\n\t}\n\n\thandleUserShowInRecent(params: UserShowInRecentParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserShowInRecent', params);\n\t\tconst { items } = params;\n\n\t\titems.forEach((item) => {\n\t\t\tconst messageId = Utils.text.getUuidV4();\n\t\t\tCore.getStore().dispatch('messages/store', {\n\t\t\t\tid: messageId,\n\t\t\t\tdate: item.date,\n\t\t\t});\n\n\t\t\tCore.getStore().dispatch('recent/setRecent', {\n\t\t\t\tid: item.user.id,\n\t\t\t\tmessageId,\n\t\t\t});\n\t\t});\n\t}\n\n\thandleRecentUpdate(params: RecentUpdateParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleRecentUpdate', params);\n\t\tconst manager = new RecentUpdateManager(params);\n\t\tmanager.setLastMessageInfo();\n\n\t\tconst newRecentItem = {\n\t\t\tid: manager.getDialogId(),\n\t\t\tmessageId: manager.getLastMessageId(),\n\t\t\tlastActivityDate: params.lastActivityDate,\n\t\t};\n\n\t\tCore.getStore().dispatch('recent/setRecent', newRecentItem);\n\t}\n\n\t#deleteLastMessage(dialogId: number, newLastMessage: RawMessage) {\n\t\tconst lastMessageWasDeleted = Boolean(newLastMessage);\n\n\t\tif (lastMessageWasDeleted)\n\t\t{\n\t\t\tthis.#updateRecentForMessageDelete(dialogId, newLastMessage.id);\n\t\t}\n\t}\n\n\t#updateRecentForMessageDelete(dialogId: string, newLastMessageId: number): void\n\t{\n\t\tif (!newLastMessageId)\n\t\t{\n\t\t\tCore.getStore().dispatch('recent/delete', { id: dialogId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/update', {\n\t\t\tid: dialogId,\n\t\t\tfields: { messageId: newLastMessageId },\n\t\t});\n\t}\n}\n","import {Runtime} from 'main.core';\n\nimport {Core} from 'im.v2.application.core';\nimport {UserManager} from 'im.v2.lib.user';\n\nimport type {NotifyAddParams} from './types/notification';\n\nexport class NotificationPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\n\t\tthis.updateCounterDebounced = Runtime.debounce(this.updateCounter, 1500, this);\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn 'server';\n\t}\n\n\thandleNotifyAdd(params: NotifyAddParams)\n\t{\n\t\tif (params.onlyFlash === true)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\t\tthis.store.dispatch('notifications/set', params);\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyConfirm(params)\n\t{\n\t\tthis.store.dispatch('notifications/delete', {\n\t\t\tid: params.id,\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyRead(params)\n\t{\n\t\tparams.list.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/read', {ids: [id], read: true});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyUnread(params)\n\t{\n\t\tparams.list.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/read', {ids: [id], read: false});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyReadAll()\n\t{\n\t\tvoid this.store.dispatch('notifications/readAll');\n\t}\n\n\thandleNotifyDelete(params)\n\t{\n\t\tconst idsToDelete = Object.keys(params.id).map(id => Number.parseInt(id, 10));\n\n\t\tidsToDelete.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/delete', {id});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\tupdateCounter(counter: number)\n\t{\n\t\tthis.store.dispatch('notifications/setCounter', counter);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { SidebarDetailBlock } from 'im.v2.const';\nimport { ChatUnreadParams } from './types/chat';\n\nimport type {\n\tAddMultidialogParams,\n\tChangeMultidialogSessionsLimitParams,\n\tChangeMultidialogStatusParams,\n} from './types/multidialog';\nimport { MessageChatParams, MessageParams, ReadMessageChatParams, ReadMessageParams } from './types/message';\nimport type { ChatUserAddParams, ChatUserLeaveParams } from './types/chat';\nimport type { ImModelSidebarMultidialogItem } from 'im.v2.model';\n\nexport class SidebarPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\t// region members\n\thandleChatUserAdd(params: ChatUserAddParams)\n\t{\n\t\tif (this.getMembersCountFromStore(params.chatId) === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(Object.values(params.users));\n\n\t\tvoid this.store.dispatch('sidebar/members/set', {\n\t\t\tchatId: params.chatId,\n\t\t\tusers: params.newUsers,\n\t\t});\n\t}\n\n\thandleChatUserLeave(params: ChatUserLeaveParams)\n\t{\n\t\tif (this.getMembersCountFromStore(params.chatId) === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/members/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tuserId: params.userId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region task\n\thandleTaskAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\n\t\tvoid this.store.dispatch('sidebar/tasks/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\ttasks: [params.link],\n\t\t});\n\t}\n\n\thandleTaskUpdate(params, extra)\n\t{\n\t\tthis.handleTaskAdd(params, extra);\n\t}\n\n\thandleTaskDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/tasks/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region meetings\n\thandleCalendarAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\n\t\tvoid this.store.dispatch('sidebar/meetings/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tmeetings: [params.link],\n\t\t});\n\t}\n\n\thandleCalendarUpdate(params, extra)\n\t{\n\t\tthis.handleCalendarAdd(params, extra);\n\t}\n\n\thandleCalendarDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/meetings/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region links\n\thandleUrlAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\n\t\tvoid this.store.dispatch('sidebar/links/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tlinks: [params.link],\n\t\t});\n\n\t\tconst counter = this.store.getters['sidebar/links/getCounter'](params.link.chatId);\n\t\tvoid this.store.dispatch('sidebar/links/setCounter', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tcounter: counter + 1,\n\t\t});\n\t}\n\n\thandleUrlDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/links/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region favorite\n\thandleMessageFavoriteAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\t\tvoid this.store.dispatch('files/set', params.files);\n\t\tvoid this.store.dispatch('messages/store', [params.link.message]);\n\n\t\tvoid this.store.dispatch('sidebar/favorites/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tfavorites: [params.link],\n\t\t});\n\n\t\tconst counter = this.store.getters['sidebar/favorites/getCounter'](params.link.chatId);\n\t\tvoid this.store.dispatch('sidebar/favorites/setCounter', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tcounter: counter + 1,\n\t\t});\n\t}\n\n\thandleMessageFavoriteDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/favorites/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region files\n\thandleFileAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\t\tvoid this.store.dispatch('files/set', params.files);\n\n\t\tconst subType = params.link.subType ?? SidebarDetailBlock.fileUnsorted;\n\n\t\tvoid this.store.dispatch('sidebar/files/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tfiles: [params.link],\n\t\t\tsubType,\n\t\t});\n\t}\n\n\thandleFileDelete(params)\n\t{\n\t\tconst chatId = Type.isNumber(params.chatId) ? params.chatId : Number.parseInt(params.chatId, 10);\n\t\tif (!this.isSidebarInited(chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sidebarFileId = params.linkId ?? params.fileId;\n\t\tvoid this.store.dispatch('sidebar/files/delete', {\n\t\t\tchatId,\n\t\t\tid: sidebarFileId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region support24\n\n\thandleChangeMultidialogSessionsLimit(params: ChangeMultidialogSessionsLimitParams)\n\t{\n\t\tvoid this.store.dispatch('sidebar/multidialog/setOpenSessionsLimit', params.limit);\n\t}\n\n\thandleAddMultidialog(params: AddMultidialogParams)\n\t{\n\t\tconst { multidialog, count } = params;\n\t\tconst isSupport = multidialog.isSupport;\n\t\tif (!isSupport)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/multidialog/setChatsCount', count);\n\t\tvoid this.store.dispatch('sidebar/multidialog/addMultidialogs', [multidialog]);\n\t}\n\n\thandleReadMessageChat(params: ReadMessageChatParams)\n\t{\n\t\tthis.deleteUnreadSupportChats(params);\n\t}\n\n\thandleReadMessage(params: ReadMessageParams)\n\t{\n\t\tthis.deleteUnreadSupportChats(params);\n\t}\n\n\thandleChangeMultidialogStatus(params: ChangeMultidialogStatusParams)\n\t{\n\t\tconst { bot, chat, multidialog } = params;\n\n\t\tconst isSupport = multidialog.isSupport;\n\t\tif (!isSupport)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (chat)\n\t\t{\n\t\t\tvoid this.store.dispatch('chats/set', chat);\n\t\t}\n\n\t\tif (bot)\n\t\t{\n\t\t\tvoid this.userManager.setUsersToModel(bot);\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/multidialog/addMultidialogs', [multidialog]);\n\t}\n\n\thandleMessage(params: MessageParams)\n\t{\n\t\tthis.setUnreadSupportTickets(params.multidialog);\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tconst { chatId, dialogId } = params;\n\n\t\tconst isSupport = this.store.getters['sidebar/multidialog/isSupport'](dialogId);\n\t\tconst isInited = this.store.getters['sidebar/multidialog/isInited'];\n\n\t\tif (isSupport && isInited)\n\t\t{\n\t\t\tvoid this.store.dispatch('sidebar/multidialog/setUnreadChats', [chatId]);\n\t\t}\n\t}\n\t// endregion\n\n\t// region files unsorted and support24\n\thandleMessageChat(params: MessageChatParams)\n\t{\n\t\t// handle new files while migration is not finished.\n\t\tthis.setFiles(params);\n\n\t\t// handle new unread chats.\n\t\tthis.setUnreadSupportTickets(params.multidialog);\n\t}\n\t// endregion\n\n\tdeleteUnreadSupportChats(params: ReadMessageChatParams | ReadMessageParams)\n\t{\n\t\tconst notCounter = params.counter === 0;\n\n\t\tif (notCounter)\n\t\t{\n\t\t\tvoid this.store.dispatch('sidebar/multidialog/deleteUnreadChats', params.chatId);\n\t\t}\n\t}\n\n\tsetUnreadSupportTickets(multidialog: ImModelSidebarMultidialogItem)\n\t{\n\t\tif (!multidialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMultidialog = this.store.getters['sidebar/multidialog/get'](multidialog.chatId);\n\t\tconst status = oldMultidialog?.status || multidialog.status;\n\n\t\tvoid this.store.dispatch('sidebar/multidialog/addMultidialogs', [{ ...multidialog, status }]);\n\t\tvoid this.store.dispatch('sidebar/multidialog/setUnreadChats', [multidialog.chatId]);\n\t}\n\n\tsetFiles(params: MessageChatParams)\n\t{\n\t\tconst { chatId, users, files } = params;\n\n\t\tif (!this.isSidebarInited(chatId) || this.areFilesMigrated())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(Object.values(users));\n\t\tvoid this.store.dispatch('files/set', Object.values(files));\n\n\t\tObject.values(files).forEach((file) => {\n\t\t\tvoid this.store.dispatch('sidebar/files/set', {\n\t\t\t\tchatId: file.chatId,\n\t\t\t\tfiles: [file],\n\t\t\t\tsubType: SidebarDetailBlock.fileUnsorted,\n\t\t\t});\n\t\t});\n\t}\n\n\tisSidebarInited(chatId: number): boolean\n\t{\n\t\treturn this.store.getters['sidebar/isInited'](chatId);\n\t}\n\n\tareFilesMigrated(): boolean\n\t{\n\t\treturn this.store.state.sidebar.isFilesMigrated;\n\t}\n\n\tgetMembersCountFromStore(chatId: number): number\n\t{\n\t\treturn this.store.getters['sidebar/members/getSize'](chatId);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { SoundType, UserStatus, LocalStorageKey, Settings, RawSettings, UserType } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { NotifierManager } from 'im.v2.lib.notifier';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { CallManager } from 'im.v2.lib.call';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { SoundNotificationManager } from 'im.v2.lib.sound-notification';\n\nimport type { MessageAddParams } from './types/message';\nimport type { NotifyAddParams } from './types/notification';\n\nexport class NotifierPullHandler\n{\n\tlastNotificationId: number = 0;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\n\t\tthis.#setCurrentUserStatus();\n\t\tthis.#restoreLastNotificationId();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params, extraData)\n\t{\n\t\tthis.handleMessageAdd(params, extraData);\n\t}\n\n\thandleMessageChat(params, extraData)\n\t{\n\t\tthis.handleMessageAdd(params, extraData);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extraData: PullExtraData)\n\t{\n\t\tif (!this.#shouldShowNotification(params, extraData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isChatOpened(params.dialogId))\n\t\t{\n\t\t\tthis.#playOpenedChatMessageSound(params);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#playMessageSound(params);\n\t\tthis.#flashDesktopIcon();\n\n\t\tconst message = this.store.getters['messages/getById'](params.message.id);\n\t\tconst dialog = this.store.getters['chats/get'](params.dialogId, true);\n\t\tconst user = this.store.getters['users/get'](message.authorId);\n\n\t\tNotifierManager.getInstance().showMessage({\n\t\t\tmessage,\n\t\t\tdialog,\n\t\t\tuser,\n\t\t\tlines: Boolean(params.lines),\n\t\t});\n\n\t\tthis.#updateLastNotificationId(params.message.id);\n\t}\n\n\thandleNotifyAdd(params: NotifyAddParams, extraData: PullExtraData)\n\t{\n\t\tif (extraData.server_time_ago > 10)\n\t\t{\n\t\t\tLogger.warn('NotifierPullHandler: notification arrived to the user 30 seconds after it was actually sent, ignore notification');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.id <= this.lastNotificationId)\n\t\t{\n\t\t\tLogger.warn('NotifierPullHandler: new notification id is smaller than lastNotificationId');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tparams.onlyFlash === true\n\t\t\t|| this.#isUserDnd()\n\t\t\t|| this.#desktopWillShowNotification()\n\t\t\t|| CallManager.getInstance().hasCurrentCall()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (document.hasFocus())\n\t\t{\n\t\t\tconst areNotificationsOpen = this.store.getters['application/areNotificationsOpen'];\n\t\t\tif (areNotificationsOpen)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst notification = this.store.getters['notifications/getById'](params.id);\n\t\tconst user = this.store.getters['users/get'](params.userId);\n\n\t\tif (params.silent !== 'Y')\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().playOnce(SoundType.reminder);\n\t\t}\n\n\t\tthis.#flashDesktopIcon();\n\n\t\tNotifierManager.getInstance().showNotification(notification, user);\n\n\t\tthis.#updateLastNotificationId(params.id);\n\t}\n\n\t#shouldShowNotification(params: MessageAddParams, extraData: PullExtraData): boolean\n\t{\n\t\tif (extraData.server_time_ago > 10)\n\t\t{\n\t\t\tLogger.warn('NotifierPullHandler: message arrived to the user 30 seconds after it was actually sent, ignore message');\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.message.id <= this.lastNotificationId)\n\t\t{\n\t\t\tLogger.warn('NotifierPullHandler: new message id is smaller than lastNotificationId');\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Core.getUserId() === params.message.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.lines && !this.#shouldShowLinesNotification(params))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst messageWithoutNotification = !params.notify || params.message?.params?.NOTIFY === 'N';\n\t\tif (messageWithoutNotification || !this.#shouldShowToUser(params) || this.#desktopWillShowNotification())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst callIsActive = CallManager.getInstance().hasCurrentCall();\n\t\tif (callIsActive && CallManager.getInstance().getCurrentCallDialogId() !== params.dialogId.toString())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst screenSharingIsActive = CallManager.getInstance().hasCurrentScreenSharing();\n\t\tif (screenSharingIsActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#shouldShowLinesNotification(params: MessageAddParams): boolean\n\t{\n\t\tif (this.#isLinesChatOpened(params.dialogId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst authorId = params.message.senderId;\n\t\tif (authorId > 0 && params.users[authorId].type !== UserType.extranet)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst counter = this.store.getters['counters/getSpecificLinesCounter'](params.chatId);\n\n\t\treturn counter === 0;\n\t}\n\n\t#isChatOpened(dialogId: string): boolean\n\t{\n\t\tconst isChatOpen = this.store.getters['application/isChatOpen'](dialogId);\n\n\t\treturn Boolean(document.hasFocus() && isChatOpen);\n\t}\n\n\t#isLinesChatOpened(dialogId: string): boolean\n\t{\n\t\tconst isLinesChatOpen = this.store.getters['application/isLinesChatOpen'](dialogId);\n\n\t\treturn Boolean(document.hasFocus() && isLinesChatOpen);\n\t}\n\n\t#isImportantMessage(params: MessageAddParams): boolean\n\t{\n\t\tconst { message } = params;\n\n\t\treturn message.isImportant || message.importantFor.includes(Core.getUserId());\n\t}\n\n\t#shouldShowToUser(params: MessageAddParams): boolean\n\t{\n\t\tif (this.#isImportantMessage(params))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst dialog = this.store.getters['chats/get'](params.dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\n\t\treturn !this.#isUserDnd() && !isMuted;\n\t}\n\n\t#isUserDnd(): boolean\n\t{\n\t\tconst status = this.store.getters['application/settings/get'](Settings.user.status);\n\n\t\treturn status === UserStatus.dnd;\n\t}\n\n\t#desktopWillShowNotification(): boolean\n\t{\n\t\tconst isDesktopChatWindow = DesktopManager.isChatWindow();\n\n\t\treturn !isDesktopChatWindow && DesktopManager.getInstance().isDesktopActive();\n\t}\n\n\t#flashDesktopIcon(): void\n\t{\n\t\tif (!DesktopManager.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.flashIcon();\n\t}\n\n\t#playOpenedChatMessageSound(params: MessageAddParams)\n\t{\n\t\tif (this.#isImportantMessage(params))\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().forcePlayOnce(SoundType.newMessage2);\n\n\t\t\treturn;\n\t\t}\n\n\t\tSoundNotificationManager.getInstance().playOnce(SoundType.newMessage2);\n\t}\n\n\t#playMessageSound(params: MessageAddParams)\n\t{\n\t\tif (this.#isImportantMessage(params))\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().forcePlayOnce(SoundType.newMessage1);\n\n\t\t\treturn;\n\t\t}\n\n\t\tSoundNotificationManager.getInstance().playOnce(SoundType.newMessage1);\n\t}\n\n\t#restoreLastNotificationId()\n\t{\n\t\tconst rawLastNotificationId = LocalStorageManager.getInstance().get(LocalStorageKey.lastNotificationId, 0);\n\n\t\tthis.lastNotificationId = Number.parseInt(rawLastNotificationId, 10);\n\t}\n\n\t#updateLastNotificationId(notificationId: number)\n\t{\n\t\tconst WRITE_TO_STORAGE_TIMEOUT = 2000;\n\n\t\tthis.lastNotificationId = notificationId;\n\t\tclearTimeout(this.writeToStorageTimeout);\n\t\tthis.writeToStorageTimeout = setTimeout(() => {\n\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.lastNotificationId, notificationId);\n\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t}\n\n\t#setCurrentUserStatus()\n\t{\n\t\tconst applicationData: { settings: RawSettings } = Core.getApplicationData();\n\t\tif (!applicationData.settings?.status)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('application/settings/set', {\n\t\t\t[Settings.user.status]: applicationData.settings.status,\n\t\t});\n\t}\n}\n","import { Type } from 'main.core';\nimport { Core } from 'im.v2.application.core';\n\nexport class OnlinePullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'online';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn 'online';\n\t}\n\n\thandleUserStatus(params: {\n\t\tusers: Object,\n\t})\n\t{\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (Type.isPlainObject(params.users[currentUserId]))\n\t\t{\n\t\t\tconst { status } = params.users[currentUserId];\n\t\t\tthis.store.dispatch('application/settings/set', { status });\n\t\t}\n\n\t\tObject.values(params.users).forEach((userInfo) => {\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: userInfo.id,\n\t\t\t\tfields: {\n\t\t\t\t\tlastActivityDate: userInfo.last_activity_date,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { NewMessageManager } from 'im.v2.provider.pull';\nimport { Core } from 'im.v2.application.core';\nimport { CounterType } from 'im.v2.const';\n\nimport type { ImModelRecentItem } from 'im.v2.model';\nimport type { MessageAddParams, PullExtraParams, ReadMessageParams, UnreadMessageParams } from 'im.v2.provider.pull';\nimport type { ChatMuteNotifyParams, ChatUnreadParams } from './types/chat';\nimport type { MessageDeleteCompleteParams } from './types/message';\n\ntype CounterParams = {\n\tdialogId: string,\n\tchatId: number,\n\tparentChatId: number,\n\tcounter: number,\n\tmuted: boolean,\n\tunread: boolean,\n\tcounterType: $Values<typeof CounterType>\n};\n\nexport class CounterPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tconst manager = new NewMessageManager(params, extra);\n\t\tif (!manager.isCommentChat())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateCommentCounter({\n\t\t\tchannelChatId: manager.getParentChatId(),\n\t\t\tcommentChatId: manager.getChatId(),\n\t\t\tcommentCounter: params.counter,\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleReadMessage(params: ReadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleReadMessageChat(params: ReadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleUnreadMessage(params: UnreadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleUnreadMessageChat(params: UnreadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tthis.#handleCounters({\n\t\t\t...params,\n\t\t\tunread: params.active,\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params: ChatMuteNotifyParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\t#handleCounters(params: CounterParams)\n\t{\n\t\tconst {\n\t\t\tchatId,\n\t\t\tdialogId,\n\t\t\tcounter,\n\t\t\tcounterType = CounterType.chat,\n\t\t\tparentChatId = 0,\n\t\t} = params;\n\n\t\tif (counterType === CounterType.openline)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('CounterPullHandler: handleCounters:', params);\n\n\t\tif (counterType === CounterType.comment)\n\t\t{\n\t\t\tthis.#updateCommentCounter({\n\t\t\t\tchannelChatId: parentChatId,\n\t\t\t\tcommentChatId: chatId,\n\t\t\t\tcommentCounter: counter,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](dialogId);\n\t\t// for now existing common chats counters are stored in corresponding chat model objects\n\t\tif (recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newCounter = this.#getNewCounter(params);\n\t\t// collab counters are stored in two structures - for common chats and collabs\n\t\t// because collab counters are included in both total chat counter and total collab counter\n\t\tif (counterType === CounterType.collab)\n\t\t{\n\t\t\tCore.getStore().dispatch('counters/setUnloadedCollabCounters', { [chatId]: newCounter });\n\t\t}\n\n\t\tCore.getStore().dispatch('counters/setUnloadedChatCounters', { [chatId]: newCounter });\n\t}\n\n\t#getNewCounter(params: CounterParams): number\n\t{\n\t\tconst { counter, muted, unread } = params;\n\n\t\tlet newCounter = 0;\n\t\tif (muted)\n\t\t{\n\t\t\tnewCounter = 0;\n\t\t}\n\t\telse if (unread && counter === 0)\n\t\t{\n\t\t\tnewCounter = 1;\n\t\t}\n\t\telse if (unread && counter > 0)\n\t\t{\n\t\t\tnewCounter = counter;\n\t\t}\n\t\telse if (!unread)\n\t\t{\n\t\t\tnewCounter = counter;\n\t\t}\n\n\t\treturn newCounter;\n\t}\n\n\t#updateCommentCounter(payload: { channelChatId: number, commentChatId: number, commentCounter: number })\n\t{\n\t\tconst { channelChatId, commentChatId, commentCounter } = payload;\n\t\tif (Type.isUndefined(commentCounter))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst counters = {\n\t\t\t[channelChatId]: {\n\t\t\t\t[commentChatId]: commentCounter,\n\t\t\t},\n\t\t};\n\n\t\tCore.getStore().dispatch('counters/setCommentCounters', counters);\n\t}\n}\n"],"names":["MessageDeleteManager","constructor","Core","getStore","deleteMessage","params","dialogId","senderId","dispatch","id","fields","text","isDeleted","files","attach","replyId","deleteMessageComplete","areChannelCommentsOpened","getters","dialogUpdateFields","userId","InputActionListener","getInstance","stopUserActionsInChat","EventEmitter","emit","EventType","dialog","closeComments","Analytics","messageDelete","onDeletedPostNotification","messageId","Loc","getMessage","BX","UI","Notification","Center","notify","content","counter","lastMessageWasDeleted","Boolean","newLastMessage","lastMessageId","lastMessageViews","MessagePullHandler","handleMessageAdd","Logger","warn","messageWithTemplateId","message","templateId","messageWithRealId","error","chatId","hasLoadingMessage","handleMessageUpdate","handleMessageDeleteV2","messages","forEach","completelyDeleted","preparedParams","handleMessageDelete","handleMessageDeleteComplete","handleAddReaction","actualReactions","reaction","actualReactionsState","usersShort","getUserId","ownReactions","userManager","UserManager","addUsersToModel","handleDeleteReaction","handleMessageParamsUpdate","handleReadMessage","extra","uuidManager","UuidManager","hasActionUuid","action_uuid","removeActionUuid","messageIds","viewedMessages","then","lastId","catch","console","handleReadMessageOpponent","handlePinAdd","additionalMessages","pin","authorId","handlePinDelete","chat","chatToAdd","dialogExists","messageWithoutNotification","NOTIFY","role","UserRole","member","users","setUsersToModel","Object","values","file","additionalEntities","newMessages","type","ChatType","comment","parent_message_id","messageCount","message_count","newUserId","hasNextPage","chatIsOpened","unreadMessages","RELOAD_LIMIT","MessageService","getMessageRequestLimit","inited","length","messageService","reloadMessageList","newMessage","unread","viewed","dialogFieldsToUpdate","lastReadId","ids","isLastMessage","includes","hasFirstViewer","firstViewer","userName","date","has","Set","add","scrollToBottom","threshold","DialogScrollThreshold","nearTheBottom","temporary","copilot","copilotManager","CopilotManager","isComplete","baseParams","ChatPullHandler","handleChatOwner","ownerId","handleChatManagers","managerList","list","userInManagerList","manager","handleChatUserAdd","currentUserId","newUsers","handleChatUserLeave","currentUserIsKicked","isChannel","ChannelManager","channelChatId","Messenger","openChat","chatHasCall","CallManager","getCurrentCallDialogId","leaveCurrentCall","deleteRecentCall","handleInputActionNotify","startAction","lastActivityDate","Date","handleChatUnread","markedId","active","handleChatMuteNotify","muted","handleChatRename","name","handleChatAvatar","avatar","handleReadAllChats","handleChatConvert","newType","newPermissions","permissions","handleChatCopilotRoleUpdate","copilotRole","handleRoleUpdate","handleChatUpdate","getChatRoleForUser","handleChatDelete","isCommentChat","parentChatId","commentChatId","chatDelete","onChatDeletedNotification","LayoutManager","clearCurrentLayoutEntityId","deleteLastOpenedElementById","userCounter","userCount","TariffPullHandler","handleChangeTariff","tariffRestrictions","fullChatHistory","isAvailable","UserPullHandler","handleUserInvite","invited","user","handleUserShowInRecent","usersToStore","items","map","item","DesktopPullHandler","handleDesktopOnline","desktopManager","DesktopManager","setDesktopActive","setDesktopVersion","version","CounterManager","removeBrowserTitleCounter","handleDesktopOffline","SettingsPullHandler","handleSettingsUpdate","entries","optionName","optionValue","CommentsPullHandler","handleCommentSubscribe","subscribe","handleReadAllChannelComments","ApplicationPullHandler","handleApplicationOpenChat","hasFocus","document","isDesktop","isChatWindow","MessengerSlider","isFocused","CollabPullHandler","handleUpdateCollabEntityCounter","entity","handleUpdateCollabGuestCount","guestCount","BasePullHandler","getModuleId","handleMessage","handleMessageChat","handleReadMessageChat","handleReadMessageChatOpponent","ActionNameByChatType","channel","openChannel","generalChannel","collab","default","NewMessageManager","getChatId","getParentChatId","getChat","parent_chat_id","getChatType","isLinesChat","lines","isCollabChat","isChannelChat","channelTypes","isUserInChat","chatUsers","userInChat","isChannelListEvent","is_shared_event","needToSkipMessageEvent","getAddActions","newMessageChatType","actionName","RecentUpdateManager","setLastMessageInfo","getDialogId","getLastMessageId","lastMessage","lastChannelPost","RecentPullHandler","newRecentItem","recentItem","isFakeElement","isBirthdayPlaceholder","liked","addActions","action","isOwnLike","isOwnLastMessage","handleChatPin","handleChatHide","Utils","getUuidV4","handleRecentUpdate","newLastMessageId","NotificationPullHandler","store","updateCounterDebounced","Runtime","debounce","updateCounter","getSubscriptionType","handleNotifyAdd","onlyFlash","handleNotifyConfirm","handleNotifyRead","read","handleNotifyUnread","handleNotifyReadAll","handleNotifyDelete","idsToDelete","keys","Number","parseInt","SidebarPullHandler","getMembersCountFromStore","handleTaskAdd","isSidebarInited","link","tasks","handleTaskUpdate","handleTaskDelete","linkId","handleCalendarAdd","meetings","handleCalendarUpdate","handleCalendarDelete","handleUrlAdd","links","handleUrlDelete","handleMessageFavoriteAdd","favorites","handleMessageFavoriteDelete","handleFileAdd","subType","SidebarDetailBlock","fileUnsorted","handleFileDelete","Type","isNumber","sidebarFileId","fileId","handleChangeMultidialogSessionsLimit","limit","handleAddMultidialog","multidialog","count","isSupport","deleteUnreadSupportChats","handleChangeMultidialogStatus","bot","setUnreadSupportTickets","isInited","setFiles","notCounter","oldMultidialog","status","areFilesMigrated","state","sidebar","isFilesMigrated","NotifierPullHandler","lastNotificationId","extraData","NotifierManager","showMessage","server_time_ago","hasCurrentCall","areNotificationsOpen","notification","silent","SoundNotificationManager","playOnce","SoundType","reminder","showNotification","callIsActive","toString","screenSharingIsActive","hasCurrentScreenSharing","UserType","extranet","isChatOpen","isLinesChatOpen","isImportant","importantFor","isMuted","muteList","Settings","UserStatus","dnd","isDesktopChatWindow","isDesktopActive","DesktopApi","flashIcon","forcePlayOnce","newMessage2","newMessage1","rawLastNotificationId","LocalStorageManager","get","LocalStorageKey","notificationId","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","writeToStorageTimeout","setTimeout","set","applicationData","getApplicationData","settings","OnlinePullHandler","handleUserStatus","isPlainObject","userInfo","last_activity_date","CounterPullHandler","commentCounter","handleUnreadMessage","handleUnreadMessageChat","counterType","CounterType","openline","newCounter","payload","isUndefined","counters"],"mappings":"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"}