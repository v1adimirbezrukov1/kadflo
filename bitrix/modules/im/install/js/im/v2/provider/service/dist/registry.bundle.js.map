{"version":3,"file":"registry.bundle.js","sources":["../src/recent/classes/recent-data-extractor.js","../src/recent/recent.js","../src/chat/classes/delete.js","../src/chat/classes/chat-data-extractor.js","../src/chat/classes/load.js","../src/chat/classes/create.js","../src/chat/classes/update.js","../src/chat/classes/rename.js","../src/chat/classes/mute.js","../src/chat/classes/pin.js","../src/chat/classes/read.js","../src/chat/classes/user.js","../src/chat/chat.js","../src/message/classes/load.js","../src/message/classes/pin.js","../src/message/classes/edit.js","../src/message/classes/delete.js","../src/message/classes/mark.js","../src/message/classes/favorite.js","../src/message/message.js","../src/sending/sending.js","../src/notification/notification.js","../src/disk/disk.js","../src/uploading/classes/uploader-wrapper.js","../src/uploading/uploading.js","../src/settings/settings.js","../src/lines/lines.js","../src/copilot/copilot.js","../src/comments/comments.js","../src/input-sender/input-sender.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatType, UserRole, MessageStatus, FakeMessagePrefix } from 'im.v2.const';\n\nimport type { ImModelMessage } from 'im.v2.model';\nimport type {\n\tRecentRestResult,\n\tRawUser,\n\tRawChat,\n\tRawRecentItem,\n\tRawMessage,\n\tRawCopilot,\n} from '../../types/rest';\n\ntype RecentFile = {\n\tid: number,\n\tname: string,\n\ttype: string,\n};\n\ntype ExtractionResult = {\n\tusers: RawUser[],\n\tchats: RawChat[],\n\tmessages: RawMessage[],\n\tfiles: RecentFile[],\n\trecentItems: RawRecentItem[],\n\tcopilot?: RawCopilot,\n};\n\nexport class RecentDataExtractor\n{\n\t#restResult: RecentRestResult;\n\t#withBirthdays: boolean;\n\n\t#users: { [id: string]: RawUser } = {};\n\t#chats: { [id: string]: RawChat } = {};\n\t#messages: { [id: string]: RawMessage } = {};\n\t#files: { [id: string]: RecentFile } = {};\n\t#recentItems: { [id: string]: RawRecentItem } = {};\n\n\tconstructor(params: { rawData: RecentRestResult, withBirthdays?: boolean })\n\t{\n\t\tconst { rawData, withBirthdays = true } = params;\n\t\tthis.#withBirthdays = withBirthdays;\n\t\tthis.#restResult = rawData;\n\t}\n\n\tgetItems(): ExtractionResult\n\t{\n\t\tconst { items = [], copilot } = this.#restResult;\n\t\titems.forEach((item: RawRecentItem) => {\n\t\t\tthis.#extractUser(item);\n\t\t\tthis.#extractChat(item);\n\t\t\tthis.#extractMessage(item);\n\t\t\tthis.#extractRecentItem(item);\n\t\t});\n\n\t\tthis.#extractBirthdayItems();\n\n\t\treturn {\n\t\t\tusers: Object.values(this.#users),\n\t\t\tchats: Object.values(this.#chats),\n\t\t\tmessages: Object.values(this.#messages),\n\t\t\tfiles: Object.values(this.#files),\n\t\t\trecentItems: Object.values(this.#recentItems),\n\t\t\tcopilot,\n\t\t};\n\t}\n\n\t#extractUser(item: RawRecentItem)\n\t{\n\t\tif (item.user?.id && !this.#users[item.user.id])\n\t\t{\n\t\t\tthis.#users[item.user.id] = item.user;\n\t\t}\n\t}\n\n\t#extractChat(item: RawRecentItem)\n\t{\n\t\tif (item.chat)\n\t\t{\n\t\t\tthis.#chats[item.id] = this.#prepareGroupChat(item);\n\n\t\t\tif (item.user.id && !this.#chats[item.user.id])\n\t\t\t{\n\t\t\t\tthis.#chats[item.user.id] = this.#prepareChatForAdditionalUser(item.user);\n\t\t\t}\n\t\t}\n\t\telse if (item.user.id)\n\t\t{\n\t\t\tconst existingRecentItem = Core.getStore().getters['recent/get'](item.user.id);\n\t\t\t// we should not update real chat with \"default\" chat data\n\t\t\tif (!existingRecentItem || !item.options.default_user_record)\n\t\t\t{\n\t\t\t\tthis.#chats[item.user.id] = this.#prepareChatForUser(item);\n\t\t\t}\n\t\t}\n\t}\n\n\t#extractMessage(item: RawRecentItem): void\n\t{\n\t\tconst message = item.message;\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.id === 0)\n\t\t{\n\t\t\tmessage.id = `${FakeMessagePrefix}-${item.id}`;\n\t\t}\n\n\t\tlet viewedByOthers = false;\n\t\tif (message.status === MessageStatus.delivered)\n\t\t{\n\t\t\tviewedByOthers = true;\n\t\t}\n\n\t\tconst existingMessage: ImModelMessage = Core.getStore().getters['messages/getById'](message.id);\n\t\t// recent has shortened attach format, we should not rewrite attach if model has it\n\t\tif (Type.isArrayFilled(existingMessage?.attach))\n\t\t{\n\t\t\tdelete message.attach;\n\t\t}\n\n\t\tif (Type.isPlainObject(message.file))\n\t\t{\n\t\t\tconst file: RecentFile = message.file;\n\t\t\tif (existingMessage)\n\t\t\t{\n\t\t\t\t// recent doesn't know about several files in one message,\n\t\t\t\t// we should not rewrite message files, so we merge it.\n\t\t\t\tmessage.files = this.#mergeFileIds(existingMessage, file.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage.files = [file.id];\n\t\t\t}\n\n\t\t\tconst existingFile = Core.getStore().getters['files/get'](file.id);\n\t\t\t// recent has shortened file format, we should not rewrite file if model has it\n\t\t\tif (!existingFile)\n\t\t\t{\n\t\t\t\tthis.#files[file.id] = file;\n\t\t\t}\n\t\t}\n\n\t\tthis.#messages[message.id] = { ...message, viewedByOthers };\n\t}\n\n\t#extractRecentItem(item: RawRecentItem): void\n\t{\n\t\tconst messageId = item.message?.id ?? 0;\n\t\tthis.#recentItems[item.id] = { ...item, messageId };\n\t}\n\n\t#extractBirthdayItems()\n\t{\n\t\tif (!this.#withBirthdays)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { birthdayList = [] } = this.#restResult;\n\t\tbirthdayList.forEach((item) => {\n\t\t\tif (!this.#users[item.id])\n\t\t\t{\n\t\t\t\tthis.#users[item.id] = item;\n\t\t\t}\n\n\t\t\tif (!this.#chats[item.id])\n\t\t\t{\n\t\t\t\tthis.#chats[item.id] = this.#prepareChatForAdditionalUser(item);\n\t\t\t}\n\n\t\t\tif (!this.#recentItems[item.id])\n\t\t\t{\n\t\t\t\tconst messageId = `${FakeMessagePrefix}-${item.id}`;\n\t\t\t\tthis.#recentItems[item.id] = { ...this.#getBirthdayPlaceholder(item), messageId };\n\t\t\t\tthis.#messages[messageId] = { id: messageId };\n\t\t\t}\n\t\t});\n\t}\n\n\t#prepareGroupChat(item: RawRecentItem): RawChat\n\t{\n\t\treturn {\n\t\t\t...item.chat,\n\t\t\tcounter: item.counter,\n\t\t\tdialogId: item.id,\n\t\t\tcopilot: item.copilot,\n\t\t};\n\t}\n\n\t#prepareChatForUser(item: RawRecentItem): RawChat\n\t{\n\t\treturn {\n\t\t\tchatId: item.chat_id,\n\t\t\tavatar: item.user.avatar,\n\t\t\tcolor: item.user.color,\n\t\t\tdialogId: item.id,\n\t\t\tname: item.user.name,\n\t\t\ttype: ChatType.user,\n\t\t\tcounter: item.counter,\n\t\t\trole: UserRole.member,\n\t\t};\n\t}\n\n\t#prepareChatForAdditionalUser(user: RawUser): RawChat\n\t{\n\t\treturn {\n\t\t\tdialogId: user.id,\n\t\t\tavatar: user.avatar,\n\t\t\tcolor: user.color,\n\t\t\tname: user.name,\n\t\t\ttype: ChatType.user,\n\t\t\trole: UserRole.member,\n\t\t};\n\t}\n\n\t#getBirthdayPlaceholder(item: RawRecentItem): { id: string, isBirthdayPlaceholder: true }\n\t{\n\t\treturn {\n\t\t\tid: item.id,\n\t\t\tisBirthdayPlaceholder: true,\n\t\t};\n\t}\n\n\t#mergeFileIds(existingMessage: ImModelMessage, fileId: number): number[]\n\t{\n\t\tconst existingMessageFilesIds = existingMessage.files.map((id) => {\n\t\t\treturn Number.parseInt(id, 10);\n\t\t});\n\t\tconst setOfFileIds = new Set([...existingMessageFilesIds, fileId]);\n\n\t\treturn [...setOfFileIds];\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod, Layout } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { LayoutManager } from 'im.v2.lib.layout';\n\nimport { RecentDataExtractor } from './classes/recent-data-extractor';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\nexport class RecentService\n{\n\tstatic instance = null;\n\n\tdataIsPreloaded: boolean = false;\n\tfirstPageIsLoaded: boolean = false;\n\titemsPerPage: number = 50;\n\tisLoading: boolean = false;\n\tpagesLoaded: number = 0;\n\thasMoreItemsToLoad: boolean = true;\n\tlastMessageDate: string = null;\n\n\tstatic getInstance(): RecentService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\t// region public\n\tgetCollection(): ImModelRecentItem[]\n\t{\n\t\treturn Core.getStore().getters['recent/getRecentCollection'];\n\t}\n\n\tasync loadFirstPage({ ignorePreloadedItems = false } = {}): Promise\n\t{\n\t\tif (this.dataIsPreloaded && !ignorePreloadedItems)\n\t\t{\n\t\t\tLogger.warn('Im.RecentList: first page was preloaded');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tthis.isLoading = true;\n\n\t\tconst result = await this.requestItems({ firstPage: true });\n\t\tthis.firstPageIsLoaded = true;\n\n\t\treturn result;\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tif (this.isLoading || !this.hasMoreItemsToLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.isLoading = true;\n\n\t\treturn this.requestItems();\n\t}\n\n\tsetPreloadedData(params)\n\t{\n\t\tLogger.warn('Im.RecentList: setting preloaded data', params);\n\t\tconst { items, hasMore } = params;\n\n\t\tthis.lastMessageDate = this.getLastMessageDate(items);\n\n\t\tif (!hasMore)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tthis.dataIsPreloaded = true;\n\n\t\tthis.updateModels(params);\n\t}\n\n\thideChat(dialogId: string): void\n\t{\n\t\tLogger.warn('Im.RecentList: hide chat', dialogId);\n\t\tconst recentItem = Core.getStore().getters['recent/get'](dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/delete', { id: dialogId });\n\n\t\tconst chatIsOpened = Core.getStore().getters['application/isChatOpen'](dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tLayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t\t\tvoid LayoutManager.getInstance().deleteLastOpenedElementById(dialogId);\n\t\t}\n\n\t\tCore.getRestClient().callMethod(RestMethod.imRecentHide, { DIALOG_ID: dialogId })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('Im.RecentList: hide chat error', error);\n\t\t\t});\n\t}\n\t// endregion public\n\n\tasync requestItems({ firstPage = false } = {}): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams(firstPage);\n\n\t\tconst result = await Core.getRestClient().callMethod(this.getQueryMethod(), queryParams)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('Im.RecentList: page request error', error);\n\t\t\t});\n\n\t\tthis.pagesLoaded++;\n\t\tLogger.warn(`Im.RecentList: ${firstPage ? 'First' : this.pagesLoaded} page request result`, result.data());\n\t\tconst { items, hasMore } = result.data();\n\t\tthis.lastMessageDate = this.getLastMessageDate(items);\n\t\tif (!hasMore)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tthis.isLoading = false;\n\n\t\treturn this.updateModels(result.data());\n\t}\n\n\tgetQueryMethod(): string\n\t{\n\t\treturn RestMethod.imRecentList;\n\t}\n\n\tgetQueryParams(firstPage: boolean): JsonObject\n\t{\n\t\treturn {\n\t\t\tSKIP_OPENLINES: 'Y',\n\t\t\tLIMIT: this.itemsPerPage,\n\t\t\tLAST_MESSAGE_DATE: firstPage ? null : this.lastMessageDate,\n\t\t\tGET_ORIGINAL_TEXT: 'Y',\n\t\t\tPARSE_TEXT: 'Y',\n\t\t};\n\t}\n\n\tgetModelSaveMethod(): string\n\t{\n\t\treturn 'recent/setRecent';\n\t}\n\n\tupdateModels(rawData): Promise\n\t{\n\t\tconst extractor = new RecentDataExtractor({ rawData, ...this.getExtractorOptions() });\n\t\tconst extractedItems = extractor.getItems();\n\t\tconst {\n\t\t\tusers,\n\t\t\tchats,\n\t\t\tmessages,\n\t\t\tfiles,\n\t\t\trecentItems,\n\t\t\tcopilot,\n\t\t} = extractedItems;\n\t\tLogger.warn('RecentService: prepared data for models', extractedItems);\n\n\t\tconst usersPromise = Core.getStore().dispatch('users/set', users);\n\t\tconst dialoguesPromise = Core.getStore().dispatch('chats/set', chats);\n\t\tconst messagesPromise = Core.getStore().dispatch('messages/store', messages);\n\t\tconst filesPromise = Core.getStore().dispatch('files/set', files);\n\t\tconst recentPromise = Core.getStore().dispatch(this.getModelSaveMethod(), recentItems);\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tconst copilotPromise = copilotManager.handleRecentListResponse(copilot);\n\n\t\treturn Promise.all([\n\t\t\tusersPromise,\n\t\t\tdialoguesPromise,\n\t\t\tmessagesPromise,\n\t\t\tfilesPromise,\n\t\t\trecentPromise,\n\t\t\tcopilotPromise,\n\t\t]);\n\t}\n\n\tgetLastMessageDate(items: Array): string\n\t{\n\t\tif (items.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn items.slice(-1)[0].message.date;\n\t}\n\n\tgetExtractorOptions(): { withBirthdays?: boolean }\n\t{\n\t\treturn {};\n\t}\n}\n","import { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\nimport { Core } from 'im.v2.application.core';\n\nimport type { Store } from 'ui.vue3.vuex';\n\ntype RestResult = {\n\tresult: boolean,\n};\n\nexport class DeleteService\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tasync deleteChat(dialogId: string): Promise<RestResult>\n\t{\n\t\tLogger.warn(`ChatService: deleteChat, dialogId: ${dialogId}`);\n\n\t\tconst deleteResult = await runAction(RestMethod.imV2ChatDelete, {\n\t\t\tdata: { dialogId },\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: deleteChat error:', error);\n\t\t\tthrow new Error(error);\n\t\t});\n\n\t\tawait this.#updateModels(dialogId);\n\n\t\treturn deleteResult;\n\t}\n\n\tasync deleteCollab(dialogId: string): Promise<RestResult>\n\t{\n\t\tLogger.warn(`ChatService: deleteCollab, dialogId: ${dialogId}`);\n\n\t\tconst deleteResult = await runAction(RestMethod.socialnetworkCollabDelete, {\n\t\t\tdata: { dialogId },\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: deleteCollab error:', error);\n\t\t\tthrow error;\n\t\t});\n\n\t\tawait this.#updateModels(dialogId);\n\n\t\treturn deleteResult;\n\t}\n\n\t#updateModels(dialogId: string): Promise\n\t{\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { inited: false },\n\t\t});\n\n\t\tvoid this.#store.dispatch('recent/delete', { id: dialogId });\n\n\t\tconst chat = this.#store.getters['chats/get'](dialogId, true);\n\t\tvoid this.#store.dispatch('messages/clearChatCollection', { chatId: chat.chatId });\n\t}\n}\n","import { ChatType } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { RawSession } from 'imopenlines.v2.provider.service';\nimport type {\n\tChatLoadRestResult,\n\tRawChat,\n\tRawFile,\n\tRawUser,\n\tRawShortUser,\n\tRawMessage,\n\tRawCommentInfo,\n\tRawCollabInfo,\n\tRawPin,\n\tRawReaction,\n\tRawCopilot,\n} from '../../types/rest';\n\nexport class ChatDataExtractor\n{\n\t#restResult: ChatLoadRestResult;\n\n\tconstructor(restResult: ChatLoadRestResult)\n\t{\n\t\tthis.#restResult = restResult;\n\t}\n\n\tgetChatId(): number\n\t{\n\t\treturn this.#restResult.chat.id;\n\t}\n\n\tgetDialogId(): string\n\t{\n\t\treturn this.#restResult.chat.dialogId;\n\t}\n\n\tisOpenlinesChat(): boolean\n\t{\n\t\treturn this.#restResult.chat.type === ChatType.lines;\n\t}\n\n\tisCopilotChat(): boolean\n\t{\n\t\treturn this.#restResult.chat.type === ChatType.copilot;\n\t}\n\n\tgetChats(): RawChat[]\n\t{\n\t\tconst mainChat = {\n\t\t\t...this.#restResult.chat,\n\t\t\thasPrevPage: this.#restResult.hasPrevPage,\n\t\t\thasNextPage: this.#restResult.hasNextPage,\n\t\t\ttariffRestrictions: this.#restResult.tariffRestrictions,\n\t\t};\n\t\tconst chats = {\n\t\t\t[this.#restResult.chat.dialogId]: mainChat,\n\t\t};\n\t\tthis.#restResult.users.forEach((user) => {\n\t\t\tif (chats[user.id])\n\t\t\t{\n\t\t\t\tchats[user.id] = { ...chats[user.id], ...UserManager.getDialogForUser(user) };\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchats[user.id] = UserManager.getDialogForUser(user);\n\t\t\t}\n\t\t});\n\n\t\treturn Object.values(chats);\n\t}\n\n\tgetFiles(): RawFile[]\n\t{\n\t\treturn this.#restResult.files ?? [];\n\t}\n\n\tgetUsers(): RawUser[]\n\t{\n\t\treturn this.#restResult.users ?? [];\n\t}\n\n\tgetAdditionalUsers(): RawShortUser[]\n\t{\n\t\treturn this.#restResult.usersShort ?? [];\n\t}\n\n\tgetMessages(): RawMessage[]\n\t{\n\t\treturn this.#restResult.messages ?? [];\n\t}\n\n\tgetCommentInfo(): RawCommentInfo[]\n\t{\n\t\treturn this.#restResult.commentInfo ?? [];\n\t}\n\n\tgetCollabInfo(): ?RawCollabInfo\n\t{\n\t\treturn this.#restResult.collabInfo ?? null;\n\t}\n\n\tgetMessagesToStore(): RawMessage[]\n\t{\n\t\treturn this.#restResult.additionalMessages ?? [];\n\t}\n\n\tgetPinnedMessageIds(): number[]\n\t{\n\t\tconst pinnedMessageIds = [];\n\t\tconst pins: RawPin[] = this.#restResult.pins ?? [];\n\t\tpins.forEach((pin) => {\n\t\t\tpinnedMessageIds.push(pin.messageId);\n\t\t});\n\n\t\treturn pinnedMessageIds;\n\t}\n\n\tgetReactions(): RawReaction[]\n\t{\n\t\treturn this.#restResult.reactions ?? [];\n\t}\n\n\tgetCopilot(): RawCopilot\n\t{\n\t\treturn this.#restResult.copilot;\n\t}\n\n\tgetSession(): RawSession\n\t{\n\t\treturn this.#restResult.session;\n\t}\n}\n","import { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { Loc, Type } from 'main.core';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { AccessErrorCode } from 'im.v2.lib.access';\nimport { Messenger } from 'im.public';\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod, Layout } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\nimport { MessageService } from 'im.v2.provider.service';\nimport { UserManager } from 'im.v2.lib.user';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { Utils } from 'im.v2.lib.utils';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { OpenLinesManager } from 'imopenlines.v2.lib.openlines';\n\nimport { ChatDataExtractor } from './chat-data-extractor';\n\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\nimport type { ChatLoadRestResult, CommentInfoRestResult } from '../../types/rest';\n\ntype UpdateModelsResult = {\n\tdialogId: string,\n\tchatId: number,\n};\n\ntype RequestChatError = {\n\tcode: $Values<typeof AccessErrorCode> | number,\n\tcustomData: Array | null,\n\tmessage: string,\n};\n\nexport class LoadService\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tloadChat(dialogId: string): Promise\n\t{\n\t\tconst params = { dialogId };\n\n\t\treturn this.#requestChat(RestMethod.imV2ChatShallowLoad, params);\n\t}\n\n\tloadChatByChatId(chatId: number): Promise\n\t{\n\t\tconst params = {\n\t\t\tchatId,\n\t\t\tmessageLimit: MessageService.getMessageRequestLimit(),\n\t\t};\n\n\t\treturn this.#requestChat(RestMethod.imV2ChatLoad, params);\n\t}\n\n\tloadChatWithMessages(dialogId: string): Promise\n\t{\n\t\tconst params = {\n\t\t\tdialogId,\n\t\t\tmessageLimit: MessageService.getMessageRequestLimit(),\n\t\t};\n\n\t\treturn this.#requestChat(RestMethod.imV2ChatLoad, params);\n\t}\n\n\tloadChatWithContext(dialogId: string, messageId: number): Promise\n\t{\n\t\tconst params = {\n\t\t\tdialogId,\n\t\t\tmessageId,\n\t\t\tmessageLimit: MessageService.getMessageRequestLimit(),\n\t\t};\n\n\t\treturn this.#requestChat(RestMethod.imV2ChatLoadInContext, params);\n\t}\n\n\tprepareDialogId(dialogId: string): Promise<string>\n\t{\n\t\tif (!Utils.dialog.isExternalId(dialogId))\n\t\t{\n\t\t\treturn Promise.resolve(dialogId);\n\t\t}\n\n\t\treturn runAction(RestMethod.imV2ChatGetDialogId, {\n\t\t\tdata: { externalId: dialogId },\n\t\t})\n\t\t\t.then((result: {dialogId: string}) => {\n\t\t\t\treturn result.dialogId;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ChatService: Load: error preparing external id', error);\n\t\t\t});\n\t}\n\n\tasync loadComments(postId: number): Promise\n\t{\n\t\tconst params = {\n\t\t\tpostId,\n\t\t\tmessageLimit: MessageService.getMessageRequestLimit(),\n\t\t\tautoJoin: true,\n\t\t\tcreateIfNotExists: true,\n\t\t};\n\n\t\tconst { chatId } = await this.#requestChat(RestMethod.imV2ChatLoad, params);\n\n\t\treturn this.#store.dispatch('messages/comments/set', {\n\t\t\tmessageId: postId,\n\t\t\tchatId,\n\t\t});\n\t}\n\n\tasync loadCommentInfo(channelDialogId: string): Promise\n\t{\n\t\tconst dialog: ImModelChat = this.#store.getters['chats/get'](channelDialogId, true);\n\t\tconst messages = this.#store.getters['messages/getByChatId'](dialog.chatId);\n\t\tconst messageIds = messages.map((message: ImModelMessage) => message.id);\n\t\tconst { commentInfo, usersShort }: CommentInfoRestResult = await runAction(\n\t\t\tRestMethod.imV2ChatMessageCommentInfoList,\n\t\t\t{ data: { messageIds } },\n\t\t)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ChatService: Load: error loading comment info', error);\n\t\t\t});\n\n\t\tconst userManager = new UserManager();\n\n\t\tvoid this.#store.dispatch('messages/comments/set', commentInfo);\n\t\tvoid userManager.addUsersToModel(usersShort);\n\t}\n\n\tresetChat(dialogId: string): Promise\n\t{\n\t\tconst dialog: ImModelChat = this.#store.getters['chats/get'](dialogId, true);\n\t\tthis.#store.dispatch('messages/clearChatCollection', { chatId: dialog.chatId });\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { inited: false },\n\t\t});\n\t}\n\n\tasync #requestChat(actionName: string, params: Object<string, any>): Promise<{ dialogId: string, chatId: number }>\n\t{\n\t\tconst { dialogId, messageId } = params;\n\t\tthis.#markDialogAsLoading(dialogId);\n\n\t\tconst actionResult = await runAction(actionName, { data: params })\n\t\t\t.catch((errors: RequestChatError[]) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ChatService: Load: error loading chat', errors);\n\t\t\t\tthis.#handleChatLoadError(errors);\n\t\t\t\tthis.#markDialogAsNotLoaded(dialogId);\n\t\t\t\tthrow errors;\n\t\t\t});\n\n\t\tif (this.#needLayoutRedirect(actionResult))\n\t\t{\n\t\t\treturn this.#redirectToLayout(actionResult, messageId);\n\t\t}\n\n\t\tconst {\n\t\t\tdialogId: loadedDialogId,\n\t\t\tchatId,\n\t\t} = await this.#updateModels(actionResult);\n\n\t\tif (this.#isDialogLoadedMarkNeeded(actionName))\n\t\t{\n\t\t\tawait this.#markDialogAsLoaded(loadedDialogId);\n\t\t}\n\n\t\treturn { dialogId: loadedDialogId, chatId };\n\t}\n\n\t#markDialogAsLoading(dialogId: string)\n\t{\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tloading: true,\n\t\t\t},\n\t\t});\n\t}\n\n\t#markDialogAsLoaded(dialogId: string): Promise\n\t{\n\t\treturn this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tinited: true,\n\t\t\t\tloading: false,\n\t\t\t},\n\t\t});\n\t}\n\n\t#markDialogAsNotLoaded(dialogId: string): Promise\n\t{\n\t\treturn this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tloading: false,\n\t\t\t},\n\t\t});\n\t}\n\n\t#isDialogLoadedMarkNeeded(actionName: string): boolean\n\t{\n\t\treturn actionName !== RestMethod.imV2ChatShallowLoad;\n\t}\n\n\tasync #updateModels(restResult: ChatLoadRestResult): Promise<UpdateModelsResult>\n\t{\n\t\tconst extractor = new ChatDataExtractor(restResult);\n\n\t\tconst chatsPromise = this.#store.dispatch('chats/set', extractor.getChats());\n\t\tconst filesPromise = this.#store.dispatch('files/set', extractor.getFiles());\n\n\t\tconst userManager = new UserManager();\n\t\tconst usersPromise = Promise.all([\n\t\t\tthis.#store.dispatch('users/set', extractor.getUsers()),\n\t\t\tuserManager.addUsersToModel(extractor.getAdditionalUsers()),\n\t\t]);\n\t\tconst messagesPromise = Promise.all([\n\t\t\tthis.#store.dispatch('messages/setChatCollection', {\n\t\t\t\tmessages: extractor.getMessages(),\n\t\t\t\tclearCollection: true,\n\t\t\t}),\n\t\t\tthis.#store.dispatch('messages/store', extractor.getMessagesToStore()),\n\t\t\tthis.#store.dispatch('messages/pin/setPinned', {\n\t\t\t\tchatId: extractor.getChatId(),\n\t\t\t\tpinnedMessages: extractor.getPinnedMessageIds(),\n\t\t\t}),\n\t\t\tthis.#store.dispatch('messages/reactions/set', extractor.getReactions()),\n\t\t\tthis.#store.dispatch('messages/comments/set', extractor.getCommentInfo()),\n\t\t]);\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tconst copilotPromise = copilotManager.handleChatLoadResponse(extractor.getCopilot());\n\n\t\tconst openLinesPromise = OpenLinesManager.handleChatLoadResponse(extractor.getSession());\n\n\t\tconst collabPromise = this.#store.dispatch('chats/collabs/set', {\n\t\t\tchatId: extractor.getChatId(),\n\t\t\tcollabInfo: extractor.getCollabInfo(),\n\t\t});\n\n\t\tawait Promise.all([\n\t\t\tchatsPromise,\n\t\t\tfilesPromise,\n\t\t\tusersPromise,\n\t\t\tmessagesPromise,\n\t\t\tcopilotPromise,\n\t\t\topenLinesPromise,\n\t\t\tcollabPromise,\n\t\t]);\n\n\t\treturn { dialogId: extractor.getDialogId(), chatId: extractor.getChatId() };\n\t}\n\n\t#needLayoutRedirect(actionResult: ChatLoadRestResult): boolean\n\t{\n\t\treturn this.#needRedirectToCopilotLayout(actionResult) || this.#needRedirectToOpenLinesLayout(actionResult);\n\t}\n\n\t#redirectToLayout(actionResult: ChatLoadRestResult, contextId: number = 0): Promise\n\t{\n\t\tconst extractor = new ChatDataExtractor(actionResult);\n\t\tLayoutManager.getInstance().setLastOpenedElement(Layout.chat.name, '');\n\n\t\tif (this.#needRedirectToCopilotLayout(actionResult))\n\t\t{\n\t\t\treturn Messenger.openCopilot(extractor.getDialogId(), contextId);\n\t\t}\n\n\t\tif (this.#needRedirectToOpenLinesLayout(actionResult))\n\t\t{\n\t\t\treturn Messenger.openLines(extractor.getDialogId());\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#needRedirectToCopilotLayout(actionResult: ChatLoadRestResult): boolean\n\t{\n\t\tconst extractor = new ChatDataExtractor(actionResult);\n\t\tconst currentLayoutName = LayoutManager.getInstance().getLayout().name;\n\n\t\treturn extractor.isCopilotChat() && currentLayoutName !== Layout.copilot.name;\n\t}\n\n\t#needRedirectToOpenLinesLayout(actionResult: ChatLoadRestResult): boolean\n\t{\n\t\tconst optionOpenLinesV2Activated = FeatureManager.isFeatureAvailable(Feature.openLinesV2);\n\n\t\tif (optionOpenLinesV2Activated)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst extractor = new ChatDataExtractor(actionResult);\n\n\t\treturn extractor.isOpenlinesChat() && Type.isStringFilled(extractor.getDialogId());\n\t}\n\n\t#handleChatLoadError(errors: RequestChatError[]): void\n\t{\n\t\tconst [firstError] = errors;\n\t\tif (firstError.code === AccessErrorCode.chatNotFound)\n\t\t{\n\t\t\tthis.#showNotification(Loc.getMessage('IM_CONTENT_CHAT_ACCESS_ERROR_MSGVER_1'));\n\t\t}\n\t}\n\n\t#showNotification(text: string)\n\t{\n\t\tBX.UI.Notification.Center.notify({ content: text });\n\t}\n}\n","import { Type } from 'main.core';\nimport { RestClient } from 'rest.client';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod, UserRole, ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { ChatConfig, RestChatConfig, RestCreateCollabConfig } from '../types/chat';\n\ntype CreateCollabResult = {\n\tCHAT_ID: number,\n};\n\nconst PRIVATE_CHAT = 'CHAT';\nconst OPEN_CHAT = 'OPEN';\n\nexport class CreateService\n{\n\t#restClient: RestClient;\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#restClient = Core.getRestClient();\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tasync createChat(chatConfig: ChatConfig): Promise<{ newDialogId: string, newChatId: number }>\n\t{\n\t\tLogger.warn('ChatService: createChat', chatConfig);\n\n\t\tconst preparedFields = await this.#prepareFields(chatConfig);\n\n\t\tconst createResult: RestResult = await this.#restClient.callMethod(RestMethod.imV2ChatAdd, {\n\t\t\tfields: preparedFields,\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: createChat error:', error);\n\t\t\tthrow new Error(error);\n\t\t});\n\n\t\tconst { chatId: newChatId } = createResult.data();\n\n\t\tLogger.warn('ChatService: createChat result', newChatId);\n\t\tconst newDialogId = `chat${newChatId}`;\n\t\tthis.#addChatToModel(newDialogId, preparedFields);\n\t\tthis.#sendAnalytics(newDialogId);\n\n\t\treturn { newDialogId, newChatId };\n\t}\n\n\tasync createCollab(collabConfig: RestCreateCollabConfig): Promise<{ newDialogId: string, newChatId: number }>\n\t{\n\t\tLogger.warn('ChatService: createCollab', collabConfig);\n\n\t\tconst preparedFields = await this.#prepareFields(collabConfig);\n\n\t\tconst params = {\n\t\t\townerId: preparedFields.ownerId,\n\t\t\tname: preparedFields.title,\n\t\t\tdescription: preparedFields.description,\n\t\t\tavatarId: preparedFields.avatar,\n\t\t\tmoderatorMembers: Utils.user.prepareSelectorIds(collabConfig.moderatorMembers),\n\t\t\tpermissions: collabConfig.permissions,\n\t\t\toptions: collabConfig.options,\n\t\t};\n\n\t\tconst createResult: CreateCollabResult = await runAction(RestMethod.socialnetworkCollabCreate, {\n\t\t\tdata: params,\n\t\t}).catch(([error]) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: createCollab error:', error);\n\t\t\tthrow error;\n\t\t});\n\n\t\tconst { chatId: newChatId } = createResult;\n\n\t\tLogger.warn('ChatService: createCollab result', newChatId);\n\t\tconst newDialogId = `chat${newChatId}`;\n\t\tthis.#addCollabToModel(newDialogId, preparedFields);\n\t\tthis.#sendAnalytics(newDialogId);\n\n\t\treturn { newDialogId, newChatId };\n\t}\n\n\tasync #prepareFields(chatConfig: ChatConfig): RestChatConfig\n\t{\n\t\tconst preparedConfig = { ...chatConfig };\n\t\tif (preparedConfig.avatar)\n\t\t{\n\t\t\tpreparedConfig.avatar = await Utils.file.getBase64(chatConfig.avatar);\n\t\t}\n\n\t\tpreparedConfig.managers = preparedConfig.managers ?? [];\n\t\tpreparedConfig.members = preparedConfig.members ?? [];\n\t\tconst allMembers = [...preparedConfig.members, ...preparedConfig.managers];\n\t\tif (preparedConfig.ownerId)\n\t\t{\n\t\t\tallMembers.push(preparedConfig.ownerId);\n\t\t}\n\t\tpreparedConfig.members = [...new Set(allMembers)];\n\n\t\tconst result = {\n\t\t\ttype: preparedConfig.type?.toUpperCase(),\n\t\t\tentityType: preparedConfig.entityType?.toUpperCase(),\n\t\t\ttitle: preparedConfig.title,\n\t\t\tavatar: preparedConfig.avatar,\n\t\t\tdescription: preparedConfig.description,\n\t\t\tusers: preparedConfig.members,\n\t\t\tmemberEntities: preparedConfig.memberEntities,\n\t\t\tmanagers: preparedConfig.managers,\n\t\t\townerId: preparedConfig.ownerId,\n\t\t\tsearchable: preparedConfig.isAvailableInSearch ? 'Y' : 'N',\n\t\t\tmanageUsersAdd: preparedConfig.manageUsersAdd,\n\t\t\tmanageUsersDelete: preparedConfig.manageUsersDelete,\n\t\t\tmanageUi: preparedConfig.manageUi,\n\t\t\tmanageSettings: preparedConfig.manageSettings,\n\t\t\tmanageMessages: preparedConfig.manageMessages,\n\t\t\tconferencePassword: preparedConfig.conferencePassword,\n\t\t\tcopilotMainRole: preparedConfig.copilotMainRole,\n\t\t};\n\n\t\tObject.entries(result).forEach(([key, value]) => {\n\t\t\tif (Type.isUndefined(value))\n\t\t\t{\n\t\t\t\tdelete result[key];\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#addCollabToModel(newDialogId: string, collabConfig: RestCreateCollabConfig): void\n\t{\n\t\tthis.#store.dispatch('chats/set', {\n\t\t\tdialogId: newDialogId,\n\t\t\ttype: ChatType.collab,\n\t\t\tname: collabConfig.title,\n\t\t});\n\t}\n\n\t#addChatToModel(newDialogId: string, chatConfig: RestChatConfig): void\n\t{\n\t\tlet chatType = chatConfig.searchable === 'Y' ? OPEN_CHAT : PRIVATE_CHAT;\n\t\tif (Type.isStringFilled(chatConfig.entityType))\n\t\t{\n\t\t\tchatType = chatConfig.entityType.toLowerCase();\n\t\t}\n\n\t\tif (Type.isStringFilled(chatConfig.type))\n\t\t{\n\t\t\tchatType = chatConfig.type.toLowerCase();\n\t\t}\n\n\t\tthis.#store.dispatch('chats/set', {\n\t\t\tdialogId: newDialogId,\n\t\t\ttype: chatType.toLowerCase(),\n\t\t\tname: chatConfig.title,\n\t\t\tuserCounter: chatConfig.users.length,\n\t\t\trole: UserRole.owner,\n\t\t\tpermissions: {\n\t\t\t\tmanageUi: chatConfig.manageUi,\n\t\t\t\tmanageSettings: chatConfig.manageSettings,\n\t\t\t\tmanageUsersAdd: chatConfig.manageUsersAdd,\n\t\t\t\tmanageUsersDelete: chatConfig.manageUsersDelete,\n\t\t\t\tmanageMessages: chatConfig.manageMessages,\n\t\t\t},\n\t\t});\n\t}\n\n\t#sendAnalytics(dialogId)\n\t{\n\t\tAnalytics.getInstance().ignoreNextChatOpen(dialogId);\n\t}\n}\n","import { Type } from 'main.core';\nimport { isResizableImage, resizeImage } from 'ui.uploader.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Core } from 'im.v2.application.core';\nimport { getChatRoleForUser } from 'im.v2.lib.role-manager';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type {\n\tRestUpdateChatConfig,\n\tUpdateChatConfig,\n\tUpdateCollabConfig,\n\tGetMemberEntitiesConfig,\n} from '../types/chat';\n\nexport class UpdateService\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tasync prepareAvatar(avatarFile: File): Promise<File>\n\t{\n\t\tif (!isResizableImage(avatarFile))\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\treturn Promise.reject(new Error('UpdateService: prepareAvatar: incorrect image'));\n\t\t}\n\n\t\tconst MAX_AVATAR_SIZE = 180;\n\t\tconst { preview: resizedAvatar } = await resizeImage(avatarFile, {\n\t\t\twidth: MAX_AVATAR_SIZE,\n\t\t\theight: MAX_AVATAR_SIZE,\n\t\t});\n\n\t\treturn resizedAvatar;\n\t}\n\n\tasync changeAvatar(chatId: number, avatarFile: File): Promise\n\t{\n\t\tLogger.warn('ChatService: changeAvatar', chatId, avatarFile);\n\t\tconst avatarInBase64 = await Utils.file.getBase64(avatarFile);\n\n\t\treturn runAction(RestMethod.imV2ChatUpdateAvatar, {\n\t\t\tdata: {\n\t\t\t\tid: chatId,\n\t\t\t\tavatar: avatarInBase64,\n\t\t\t},\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: changeAvatar error:', error);\n\t\t\tthrow new Error(error);\n\t\t});\n\t}\n\n\tasync updateChat(chatId: number, chatConfig: UpdateChatConfig): Promise<boolean>\n\t{\n\t\tLogger.warn(`ChatService: updateChat, chatId: ${chatId}`, chatConfig);\n\n\t\tconst preparedFields = await this.#prepareFields(chatConfig);\n\n\t\tconst updateResult: RestResult = await runAction(RestMethod.imV2ChatUpdate, {\n\t\t\tdata: {\n\t\t\t\tid: chatId,\n\t\t\t\tfields: preparedFields,\n\t\t\t},\n\t\t\tid: chatId,\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: updateChat error:', error);\n\t\t\tthrow new Error(error);\n\t\t});\n\n\t\tLogger.warn('ChatService: updateChat result', updateResult);\n\n\t\tconst dialogId = `chat${chatId}`;\n\t\tawait this.#updateChatInModel(dialogId, chatConfig);\n\n\t\treturn updateResult;\n\t}\n\n\tasync updateCollab(dialogId: string, collabConfig: UpdateCollabConfig): Promise<boolean>\n\t{\n\t\tLogger.warn(`ChatService: updateCollab, dialogId: ${dialogId}`, collabConfig);\n\n\t\tconst preparedFields = await this.#prepareFields(collabConfig);\n\n\t\tlet payload = {\n\t\t\tdialogId,\n\t\t\tname: preparedFields.title,\n\t\t\tdescription: preparedFields.description,\n\t\t\tavatarId: preparedFields.avatar,\n\t\t};\n\n\t\tif (collabConfig.groupSettings)\n\t\t{\n\t\t\tconst groupSettings = collabConfig.groupSettings;\n\t\t\tpayload = {\n\t\t\t\t...payload,\n\t\t\t\townerId: groupSettings.ownerId,\n\t\t\t\taddModeratorMembers: Utils.user.prepareSelectorIds(groupSettings.addModeratorMembers),\n\t\t\t\tdeleteModeratorMembers: Utils.user.prepareSelectorIds(groupSettings.deleteModeratorMembers),\n\t\t\t\tpermissions: groupSettings.permissions,\n\t\t\t\toptions: groupSettings.options,\n\t\t\t};\n\t\t}\n\n\t\tconst updateResult: RestResult = await runAction(RestMethod.socialnetworkCollabUpdate, {\n\t\t\tdata: payload,\n\t\t}).catch(([error]) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: updateCollab error:', error);\n\t\t\tthrow error;\n\t\t});\n\n\t\tLogger.warn('ChatService: updateCollab result', updateResult);\n\n\t\treturn updateResult;\n\t}\n\n\tasync getMemberEntities(chatId: number): Promise<GetMemberEntitiesConfig>\n\t{\n\t\treturn runAction(RestMethod.imV2ChatMemberEntitiesList, {\n\t\t\tdata: { chatId },\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ChatService: getMemberEntities error:', error);\n\t\t\tthrow new Error(error);\n\t\t});\n\t}\n\n\tasync #prepareFields(chatConfig: UpdateChatConfig): RestUpdateChatConfig\n\t{\n\t\tconst result = {\n\t\t\ttitle: chatConfig.title,\n\t\t\tdescription: chatConfig.description,\n\t\t\townerId: chatConfig.ownerId,\n\t\t\tsearchable: chatConfig.isAvailableInSearch ? 'Y' : 'N',\n\t\t\tmanageUi: chatConfig.manageUi,\n\t\t\tmanageUsersAdd: chatConfig.manageUsersAdd,\n\t\t\tmanageUsersDelete: chatConfig.manageUsersDelete,\n\t\t\tmanageMessages: chatConfig.manageMessages,\n\t\t\taddedMemberEntities: chatConfig.addedMemberEntities,\n\t\t\tdeletedMemberEntities: chatConfig.deletedMemberEntities,\n\t\t\taddedManagers: chatConfig.addedManagers,\n\t\t\tdeletedManagers: chatConfig.deletedManagers,\n\t\t};\n\n\t\tif (chatConfig.avatar)\n\t\t{\n\t\t\tresult.avatar = await Utils.file.getBase64(chatConfig.avatar);\n\t\t}\n\n\t\tObject.entries(result).forEach(([key, value]) => {\n\t\t\tif (Type.isUndefined(value))\n\t\t\t{\n\t\t\t\tdelete result[key];\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#updateChatInModel(dialogId: string, chatConfig: UpdateChatConfig): Promise\n\t{\n\t\treturn this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tname: chatConfig.title,\n\t\t\t\tdescription: chatConfig.description,\n\t\t\t\townerId: chatConfig.ownerId,\n\t\t\t\tmanagerList: chatConfig.managers,\n\t\t\t\ttype: chatConfig.type,\n\t\t\t\trole: getChatRoleForUser(chatConfig),\n\t\t\t\tpermissions: {\n\t\t\t\t\tmanageUi: chatConfig.manageUi,\n\t\t\t\t\tmanageUsersAdd: chatConfig.manageUsersAdd,\n\t\t\t\t\tmanageUsersDelete: chatConfig.manageUsersDelete,\n\t\t\t\t\tmanageMessages: chatConfig.manageMessages,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\nexport class RenameService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\trenameChat(dialogId: string, newName: string): Promise\n\t{\n\t\tLogger.warn('ChatService: renameChat', dialogId, newName);\n\t\tif (newName === '')\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst dialog = this.#store.getters['chats/get'](dialogId);\n\t\tconst oldName = dialog.name;\n\n\t\tthis.#updateChatTitleInModel(dialogId, newName);\n\n\t\treturn this.#restClient.callMethod(RestMethod.imChatUpdateTitle, {\n\t\t\tdialog_id: dialogId,\n\t\t\ttitle: newName,\n\t\t}).catch(() => {\n\t\t\tthis.#updateChatTitleInModel(dialogId, oldName);\n\n\t\t\tthrow new Error('Chat rename error');\n\t\t});\n\t}\n\n\t#updateChatTitleInModel(dialogId: string, title: string)\n\t{\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { name: title },\n\t\t});\n\t}\n}\n","import { Runtime } from 'main.core';\nimport { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\nexport class MuteService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\t#sendMuteRequestDebounced: Function;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\n\t\tconst DEBOUNCE_TIME = 500;\n\t\tthis.#sendMuteRequestDebounced = Runtime.debounce(this.#sendMuteRequest, DEBOUNCE_TIME);\n\t}\n\n\tmuteChat(dialogId: string)\n\t{\n\t\tLogger.warn('ChatService: muteChat', dialogId);\n\t\tthis.#store.dispatch('chats/mute', { dialogId });\n\t\tconst queryParams = { dialog_id: dialogId, action: 'Y' };\n\n\t\tthis.#sendMuteRequestDebounced(queryParams);\n\t}\n\n\tunmuteChat(dialogId: string)\n\t{\n\t\tLogger.warn('ChatService: unmuteChat', dialogId);\n\t\tthis.#store.dispatch('chats/unmute', { dialogId });\n\t\tconst queryParams = { dialog_id: dialogId, action: 'N' };\n\n\t\tthis.#sendMuteRequestDebounced(queryParams);\n\t}\n\n\t#sendMuteRequest(queryParams: {dialog_id: string, action: 'Y' | 'N'}): Promise\n\t{\n\t\tconst { dialog_id: dialogId, action } = queryParams;\n\n\t\treturn this.#restClient.callMethod(RestMethod.imChatMute, queryParams).catch((error) => {\n\t\t\tconst actionText = action === 'Y' ? 'muting' : 'unmuting';\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error(`Im.RecentList: error ${actionText} chat`, error);\n\n\t\t\tconst actionType = action === 'Y' ? 'chats/unmute' : 'chats/mute';\n\t\t\tthis.#store.dispatch(actionType, { dialogId });\n\t\t});\n\t}\n}","import { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\n\nexport class PinService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\tpinChat(dialogId: string)\n\t{\n\t\tLogger.warn('PinService: pinChat', dialogId);\n\t\tthis.#store.dispatch('recent/pin', {\n\t\t\tid: dialogId,\n\t\t\taction: true,\n\t\t});\n\t\tconst queryParams = { DIALOG_ID: dialogId, ACTION: 'Y' };\n\t\tthis.#restClient.callMethod(RestMethod.imRecentPin, queryParams).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('PinService: error pinning chat', error);\n\t\t\tthis.#store.dispatch('recent/pin', { id: dialogId, action: false });\n\t\t});\n\t}\n\n\tunpinChat(dialogId: string)\n\t{\n\t\tLogger.warn('PinService: unpinChat', dialogId);\n\t\tthis.#store.dispatch('recent/pin', {\n\t\t\tid: dialogId,\n\t\t\taction: false,\n\t\t});\n\t\tconst queryParams = { DIALOG_ID: dialogId, ACTION: 'N' };\n\t\tthis.#restClient.callMethod(RestMethod.imRecentPin, queryParams).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('PinService: error unpinning chat', error);\n\t\t\tthis.#store.dispatch('recent/pin', { id: dialogId, action: true });\n\t\t});\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod, ChatType } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { UuidManager } from 'im.v2.lib.uuid';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { ImModelChat, ImModelRecentItem } from 'im.v2.model';\n\ntype ReadResult = {\n\tchatId: number,\n\tcounter: number,\n\tlastId: number,\n\tviewedMessages: number[]\n};\n\nconst READ_TIMEOUT = 300;\n\nexport class ReadService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\t#messagesToRead: {[chatId: string]: Set<number>} = {};\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\treadAll(): Promise\n\t{\n\t\tLogger.warn('ReadService: readAll');\n\t\tthis.#store.dispatch('chats/clearCounters');\n\t\tthis.#store.dispatch('recent/clearUnread');\n\n\t\treturn this.#restClient.callMethod(RestMethod.imV2ChatReadAll)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ReadService: readAll error', error);\n\t\t\t});\n\t}\n\n\treadDialog(dialogId: string)\n\t{\n\t\tLogger.warn('ReadService: readDialog', dialogId);\n\t\tthis.#store.dispatch('recent/unread', {\n\t\t\tid: dialogId,\n\t\t\taction: false,\n\t\t});\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { counter: 0 },\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatRead, { dialogId })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ReadService: error reading chat', error);\n\t\t\t});\n\t}\n\n\tunreadDialog(dialogId: string)\n\t{\n\t\tLogger.warn('ReadService: unreadDialog', dialogId);\n\t\tthis.#store.dispatch('recent/unread', {\n\t\t\tid: dialogId,\n\t\t\taction: true,\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatUnread, { dialogId })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ReadService: error setting chat as unread', error);\n\t\t\t\tthis.#store.dispatch('recent/unread', { id: dialogId, action: false });\n\t\t\t});\n\t}\n\n\treadMessage(chatId: number, messageId: number)\n\t{\n\t\tif (!this.#messagesToRead[chatId])\n\t\t{\n\t\t\tthis.#messagesToRead[chatId] = new Set();\n\t\t}\n\t\tthis.#messagesToRead[chatId].add(messageId);\n\n\t\tclearTimeout(this.readTimeout);\n\t\tthis.readTimeout = setTimeout(() => {\n\t\t\tObject.entries(this.#messagesToRead).forEach(([rawChatId, messageIds]) => {\n\t\t\t\tthis.#readMessagesForChat(rawChatId, messageIds);\n\t\t\t});\n\t\t}, READ_TIMEOUT);\n\t}\n\n\tasync readChatQueuedMessages(chatId: number): Promise<boolean>\n\t{\n\t\tif (!this.#messagesToRead[chatId])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tclearTimeout(this.readTimeout);\n\n\t\treturn this.#readMessagesForChat(chatId, this.#messagesToRead[chatId]);\n\t}\n\n\tasync #readMessagesForChat(rawChatId: string, messageIds: Set<number>): Promise<boolean>\n\t{\n\t\tconst queueChatId = Number.parseInt(rawChatId, 10);\n\t\tLogger.warn('ReadService: readMessages', messageIds);\n\t\tif (messageIds.size === 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst copiedMessageIds = [...messageIds];\n\t\tdelete this.#messagesToRead[queueChatId];\n\n\t\tconst readMessagesCount = await this.#readMessageOnClient(queueChatId, copiedMessageIds);\n\n\t\tLogger.warn('ReadService: readMessage, need to reduce counter by', readMessagesCount);\n\t\tawait this.#decreaseChatCounter(queueChatId, readMessagesCount);\n\n\t\tconst readResult = await this.#readMessageOnServer(queueChatId, copiedMessageIds)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('ReadService: error reading message', error);\n\t\t\t});\n\n\t\tthis.#checkChatCounter(readResult);\n\n\t\treturn true;\n\t}\n\n\tclearDialogMark(dialogId: string)\n\t{\n\t\tLogger.warn('ReadService: clear dialog mark', dialogId);\n\t\tconst dialog: ImModelChat = this.#store.getters['chats/get'](dialogId);\n\t\tconst recentItem: ImModelRecentItem = this.#store.getters['recent/get'](dialogId);\n\t\tif (dialog.markedId === 0 && !recentItem?.unread)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#store.dispatch('recent/unread', {\n\t\t\tid: dialogId,\n\t\t\taction: false,\n\t\t});\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tmarkedId: 0,\n\t\t\t},\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatRead, {\n\t\t\tdialogId,\n\t\t\tonlyRecent: 'Y',\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('ReadService: error clearing dialog mark', error);\n\t\t});\n\t}\n\n\t#readMessageOnClient(chatId: number, messageIds: number[]): Promise<number>\n\t{\n\t\tconst maxMessageId = Math.max(...messageIds);\n\t\tconst dialog = this.#getDialogByChatId(chatId);\n\t\tif (maxMessageId > dialog.lastReadId)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: this.#getDialogIdByChatId(chatId),\n\t\t\t\tfields: {\n\t\t\t\t\tlastId: maxMessageId,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#store.dispatch('messages/readMessages', {\n\t\t\tchatId,\n\t\t\tmessageIds,\n\t\t});\n\t}\n\n\t#decreaseCommentCounter(chatId: number, readMessagesCount: number): Promise\n\t{\n\t\tconst chat = this.#getDialogByChatId(chatId);\n\t\tlet newCounter = chat.counter - readMessagesCount;\n\t\tif (newCounter < 0)\n\t\t{\n\t\t\tnewCounter = 0;\n\t\t}\n\n\t\tconst counters = {\n\t\t\t[chat.parentChatId]: {\n\t\t\t\t[chatId]: newCounter,\n\t\t\t},\n\t\t};\n\n\t\treturn Core.getStore().dispatch('counters/setCommentCounters', counters);\n\t}\n\n\t#decreaseChatCounter(chatId: number, readMessagesCount: number): Promise\n\t{\n\t\tconst chat = this.#getDialogByChatId(chatId);\n\t\tif (chat.type === ChatType.comment)\n\t\t{\n\t\t\treturn this.#decreaseCommentCounter(chatId, readMessagesCount);\n\t\t}\n\n\t\tlet newCounter = chat.counter - readMessagesCount;\n\t\tif (newCounter < 0)\n\t\t{\n\t\t\tnewCounter = 0;\n\t\t}\n\n\t\treturn this.#store.dispatch('chats/update', {\n\t\t\tdialogId: this.#getDialogIdByChatId(chatId),\n\t\t\tfields: { counter: newCounter },\n\t\t});\n\t}\n\n\t#readMessageOnServer(chatId: number, messageIds: number[]): Promise\n\t{\n\t\tLogger.warn('ReadService: readMessages on server', messageIds);\n\n\t\treturn runAction(RestMethod.imV2ChatMessageRead, {\n\t\t\tdata: {\n\t\t\t\tchatId,\n\t\t\t\tids: messageIds,\n\t\t\t\tactionUuid: UuidManager.getInstance().getActionUuid(),\n\t\t\t},\n\t\t});\n\t}\n\n\t#checkChatCounter(readResult: ReadResult)\n\t{\n\t\tif (!readResult)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { chatId, counter } = readResult;\n\n\t\tconst dialog = this.#getDialogByChatId(chatId);\n\t\tif (dialog.counter > counter)\n\t\t{\n\t\t\tLogger.warn('ReadService: counter from server is lower than local one', dialog.counter, counter);\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: dialog.dialogId,\n\t\t\t\tfields: { counter },\n\t\t\t});\n\t\t}\n\t}\n\n\t#getDialogIdByChatId(chatId: number): number\n\t{\n\t\tconst dialog = this.#store.getters['chats/getByChatId'](chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn dialog.dialogId;\n\t}\n\n\t#getDialogByChatId(chatId: number): ?ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/getByChatId'](chatId);\n\t}\n}\n","import 'ui.notification';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { Loc } from 'main.core';\nimport { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Messenger } from 'im.public';\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod, UserRole } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { ImModelChat } from 'im.v2.model';\n\ntype RestError = {\n\tanswer: {\n\t\terror: string,\n\t\terror_description: string,\n\t},\n\tstatus: number,\n};\n\nconst DeleteUserErrorCode = {\n\tuserInvitedFromStructure: 'USER_INVITED_FROM_STRUCTURE',\n\tuserNotFound: 'USER_NOT_FOUND',\n};\n\nexport class UserService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\taddToChat(addConfig: {chatId: number, members: string[], showHistory: boolean}): Promise\n\t{\n\t\tconst queryParams = {\n\t\t\tchat_id: addConfig.chatId,\n\t\t\tusers: addConfig.members,\n\t\t\thide_history: !addConfig.showHistory,\n\t\t};\n\n\t\treturn this.#restClient.callMethod(RestMethod.imChatUserAdd, queryParams);\n\t}\n\n\tasync kickUserFromChat(dialogId: string, userId: number)\n\t{\n\t\tconst queryParams = { dialogId, userId };\n\t\ttry\n\t\t{\n\t\t\tawait this.#restClient.callMethod(RestMethod.imV2ChatDeleteUser, queryParams);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.#onChatKickError(error);\n\t\t}\n\t}\n\n\tasync kickUserFromCollab(dialogId: string, userId: number)\n\t{\n\t\tconst USER_ENTITY_ID = 'user';\n\t\tconst members = [[USER_ENTITY_ID, userId]];\n\n\t\tconst payload = {\n\t\t\tdata: { dialogId, members },\n\t\t};\n\n\t\ttry\n\t\t{\n\t\t\tawait runAction(RestMethod.socialnetworkMemberDelete, payload);\n\t\t}\n\t\tcatch (errors)\n\t\t{\n\t\t\tconsole.error('UserService: error kicking from collab', errors);\n\t\t\tthis.#showNotification(Loc.getMessage('IM_MESSAGE_SERVICE_KICK_COLLAB_DEFAULT_ERROR'));\n\t\t}\n\t}\n\n\tasync leaveChat(dialogId: string)\n\t{\n\t\tconst queryParams = { dialogId, userId: Core.getUserId() };\n\t\ttry\n\t\t{\n\t\t\tawait this.#restClient.callMethod(RestMethod.imV2ChatDeleteUser, queryParams);\n\t\t\tthis.#onChatLeave(dialogId);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.#onChatLeaveError(error);\n\t\t}\n\t}\n\n\tasync leaveCollab(dialogId: string)\n\t{\n\t\tconst payload = {\n\t\t\tdata: { dialogId },\n\t\t};\n\n\t\ttry\n\t\t{\n\t\t\tawait runAction(RestMethod.socialnetworkMemberLeave, payload);\n\n\t\t\tthis.#onChatLeave(dialogId);\n\t\t}\n\t\tcatch (errors)\n\t\t{\n\t\t\tconsole.error('UserService: leave collab error', errors);\n\t\t\tthis.#showNotification(Loc.getMessage('IM_MESSAGE_SERVICE_LEAVE_COLLAB_DEFAULT_ERROR'));\n\t\t}\n\t}\n\n\tjoinChat(dialogId: string)\n\t{\n\t\tLogger.warn(`UserService: join chat ${dialogId}`);\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\trole: UserRole.member,\n\t\t\t},\n\t\t});\n\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatJoin, {\n\t\t\tdialogId,\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('UserService: error joining chat', error);\n\t\t});\n\t}\n\n\taddManager(dialogId: string, userId: number)\n\t{\n\t\tLogger.warn(`UserService: add manager ${userId} to ${dialogId}`);\n\t\tconst { managerList }: ImModelChat = this.#store.getters['chats/get'](dialogId);\n\t\tif (managerList.includes(userId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newManagerList = [...managerList, userId];\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { managerList: newManagerList },\n\t\t});\n\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tdialogId,\n\t\t\t\tuserIds: [userId],\n\t\t\t},\n\t\t};\n\n\t\trunAction(RestMethod.imV2ChatAddManagers, payload)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('UserService: add manager error', error);\n\t\t\t});\n\t}\n\n\tremoveManager(dialogId: string, userId: number): void\n\t{\n\t\tLogger.warn(`UserService: remove manager ${userId} from ${dialogId}`);\n\t\tconst { managerList }: ImModelChat = this.#store.getters['chats/get'](dialogId);\n\t\tif (!managerList.includes(userId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newManagerList = managerList.filter((managerId) => managerId !== userId);\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { managerList: newManagerList },\n\t\t});\n\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tdialogId,\n\t\t\t\tuserIds: [userId],\n\t\t\t},\n\t\t};\n\n\t\trunAction(RestMethod.imV2ChatDeleteManagers, payload)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('UserService: remove manager error', error);\n\t\t\t});\n\t}\n\n\t#onChatLeave(dialogId: string): void\n\t{\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { inited: false },\n\t\t});\n\t\tvoid this.#store.dispatch('recent/delete', { id: dialogId });\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tLayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t\t\tvoid LayoutManager.getInstance().deleteLastOpenedElementById(dialogId);\n\t\t}\n\t}\n\n\t#onChatKickError(error: RestError)\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error('UserService: error kicking from chat', error);\n\n\t\tconst NotificationTextByErrorCode = {\n\t\t\t[DeleteUserErrorCode.userInvitedFromStructure]: Loc.getMessage('IM_MESSAGE_SERVICE_KICK_CHAT_STRUCTURE_ERROR_MSGVER_1'),\n\t\t\tdefault: Loc.getMessage('IM_MESSAGE_SERVICE_KICK_CHAT_DEFAULT_ERROR'),\n\t\t};\n\n\t\tconst errorCode = this.#getErrorCode(error);\n\t\tconst notificationText = NotificationTextByErrorCode[errorCode] ?? NotificationTextByErrorCode.default;\n\t\tthis.#showNotification(notificationText);\n\t}\n\n\t#onChatLeaveError(error: RestError)\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error('UserService: error leaving chat', error);\n\n\t\tconst NotificationTextByErrorCode = {\n\t\t\t[DeleteUserErrorCode.userInvitedFromStructure]: Loc.getMessage('IM_MESSAGE_SERVICE_LEAVE_CHAT_STRUCTURE_ERROR'),\n\t\t\tdefault: Loc.getMessage('IM_MESSAGE_SERVICE_LEAVE_CHAT_DEFAULT_ERROR'),\n\t\t};\n\n\t\tconst errorCode = this.#getErrorCode(error);\n\t\tconst notificationText = NotificationTextByErrorCode[errorCode] ?? NotificationTextByErrorCode.default;\n\t\tthis.#showNotification(notificationText);\n\t}\n\n\t#showNotification(text: string): void\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: text,\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\t#getErrorCode(error: RestError): string\n\t{\n\t\tconst { answer: { error: errorCode } } = error;\n\n\t\treturn errorCode;\n\t}\n}\n","import { DeleteService } from './classes/delete';\nimport { LoadService } from './classes/load';\nimport { CreateService } from './classes/create';\nimport { UpdateService } from './classes/update';\nimport { RenameService } from './classes/rename';\nimport { MuteService } from './classes/mute';\nimport { PinService } from './classes/pin';\nimport { ReadService } from './classes/read';\nimport { UserService } from './classes/user';\n\nimport type { UpdateChatConfig, GetMemberEntitiesConfig } from './types/chat';\n\nexport class ChatService\n{\n\t#loadService: LoadService;\n\t#createService: CreateService;\n\t#updateService: UpdateService;\n\t#renameService: RenameService;\n\t#muteService: MuteService;\n\t#pinService: PinService;\n\t#readService: ReadService;\n\t#userService: UserService;\n\t#deleteService: DeleteService;\n\n\tconstructor()\n\t{\n\t\tthis.#initServices();\n\t}\n\n\t// region 'load'\n\tloadChat(dialogId: string): Promise\n\t{\n\t\treturn this.#loadService.loadChat(dialogId);\n\t}\n\n\tloadChatByChatId(chatId: number): Promise\n\t{\n\t\treturn this.#loadService.loadChatByChatId(chatId);\n\t}\n\n\tloadChatWithMessages(dialogId: string): Promise\n\t{\n\t\treturn this.#loadService.loadChatWithMessages(dialogId);\n\t}\n\n\tloadChatWithContext(dialogId: string, messageId: number): Promise\n\t{\n\t\treturn this.#loadService.loadChatWithContext(dialogId, messageId);\n\t}\n\n\tloadComments(postId: number): Promise\n\t{\n\t\treturn this.#loadService.loadComments(postId);\n\t}\n\n\tloadCommentInfo(channelDialogId: string): Promise\n\t{\n\t\treturn this.#loadService.loadCommentInfo(channelDialogId);\n\t}\n\n\tprepareDialogId(dialogId: string): Promise<string>\n\t{\n\t\treturn this.#loadService.prepareDialogId(dialogId);\n\t}\n\n\tresetChat(dialogId: string): Promise\n\t{\n\t\treturn this.#loadService.resetChat(dialogId);\n\t}\n\t// endregion 'load'\n\n\t// region 'create'\n\tcreateChat(chatConfig): Promise<{ newDialogId: string, newChatId: number }>\n\t{\n\t\treturn this.#createService.createChat(chatConfig);\n\t}\n\n\tcreateCollab(collabConfig): Promise<{ newDialogId: string, newChatId: number }>\n\t{\n\t\treturn this.#createService.createCollab(collabConfig);\n\t}\n\t// endregion 'create'\n\n\t// region 'update'\n\tprepareAvatar(avatarFile: File): Promise<File>\n\t{\n\t\treturn this.#updateService.prepareAvatar(avatarFile);\n\t}\n\n\tchangeAvatar(chatId: number, avatarFile: File): Promise\n\t{\n\t\treturn this.#updateService.changeAvatar(chatId, avatarFile);\n\t}\n\n\tupdateChat(chatId: number, chatConfig: UpdateChatConfig): Promise<boolean>\n\t{\n\t\treturn this.#updateService.updateChat(chatId, chatConfig);\n\t}\n\n\tupdateCollab(dialogId: string, collabConfig): Promise<boolean>\n\t{\n\t\treturn this.#updateService.updateCollab(dialogId, collabConfig);\n\t}\n\n\tgetMemberEntities(chatId: number): Promise<GetMemberEntitiesConfig>\n\t{\n\t\treturn this.#updateService.getMemberEntities(chatId);\n\t}\n\t// endregion 'update'\n\n\t// region 'delete'\n\tdeleteChat(dialogId: string): Promise\n\t{\n\t\treturn this.#deleteService.deleteChat(dialogId);\n\t}\n\n\tdeleteCollab(dialogId: string): Promise\n\t{\n\t\treturn this.#deleteService.deleteCollab(dialogId);\n\t}\n\t// endregion 'delete'\n\n\t// region 'rename'\n\trenameChat(dialogId: string, newName: string): Promise\n\t{\n\t\treturn this.#renameService.renameChat(dialogId, newName);\n\t}\n\t// endregion 'rename'\n\n\t// region 'mute'\n\tmuteChat(dialogId: string)\n\t{\n\t\tthis.#muteService.muteChat(dialogId);\n\t}\n\n\tunmuteChat(dialogId: string)\n\t{\n\t\tthis.#muteService.unmuteChat(dialogId);\n\t}\n\t// endregion 'mute'\n\n\t// region 'pin'\n\tpinChat(dialogId: string)\n\t{\n\t\tthis.#pinService.pinChat(dialogId);\n\t}\n\n\tunpinChat(dialogId: string)\n\t{\n\t\tthis.#pinService.unpinChat(dialogId);\n\t}\n\t// endregion 'pin'\n\n\t// region 'read'\n\treadAll(): Promise\n\t{\n\t\treturn this.#readService.readAll();\n\t}\n\n\treadDialog(dialogId: string)\n\t{\n\t\tthis.#readService.readDialog(dialogId);\n\t}\n\n\tunreadDialog(dialogId: string)\n\t{\n\t\tthis.#readService.unreadDialog(dialogId);\n\t}\n\n\treadMessage(chatId: number, messageId: number)\n\t{\n\t\tthis.#readService.readMessage(chatId, messageId);\n\t}\n\n\treadChatQueuedMessages(chatId: number): Promise<boolean>\n\t{\n\t\treturn this.#readService.readChatQueuedMessages(chatId);\n\t}\n\n\tclearDialogMark(dialogId: string)\n\t{\n\t\tthis.#readService.clearDialogMark(dialogId);\n\t}\n\t// endregion 'read'\n\n\t// region 'user'\n\tleaveChat(dialogId: string)\n\t{\n\t\tthis.#userService.leaveChat(dialogId);\n\t}\n\n\tleaveCollab(dialogId: string)\n\t{\n\t\tvoid this.#userService.leaveCollab(dialogId);\n\t}\n\n\tkickUserFromChat(dialogId: string, userId: number)\n\t{\n\t\tthis.#userService.kickUserFromChat(dialogId, userId);\n\t}\n\n\tkickUserFromCollab(dialogId: string, userId: number)\n\t{\n\t\tthis.#userService.kickUserFromCollab(dialogId, userId);\n\t}\n\n\taddToChat(addConfig: {chatId: number, members: string[], showHistory: boolean}): Promise\n\t{\n\t\treturn this.#userService.addToChat(addConfig);\n\t}\n\n\tjoinChat(dialogId: string)\n\t{\n\t\tthis.#userService.joinChat(dialogId);\n\t}\n\n\taddManager(dialogId: string, userId: number)\n\t{\n\t\tthis.#userService.addManager(dialogId, userId);\n\t}\n\n\tremoveManager(dialogId: string, userId: number)\n\t{\n\t\tthis.#userService.removeManager(dialogId, userId);\n\t}\n\t// endregion 'user\n\n\t#initServices()\n\t{\n\t\tthis.#loadService = new LoadService();\n\t\tthis.#createService = new CreateService();\n\t\tthis.#updateService = new UpdateService();\n\t\tthis.#renameService = new RenameService();\n\t\tthis.#muteService = new MuteService();\n\t\tthis.#pinService = new PinService();\n\t\tthis.#readService = new ReadService();\n\t\tthis.#userService = new UserService();\n\t\tthis.#deleteService = new DeleteService();\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { callBatch, runAction } from 'im.v2.lib.rest';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { AccessErrorCode } from 'im.v2.lib.access';\n\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\nimport type { PaginationRestResult } from '../types/message';\nimport type { RawMessage, RawCommentInfo, RawTariffRestrictions } from '../../types/rest';\n\nexport class LoadService\n{\n\tstatic MESSAGE_REQUEST_LIMIT = 25;\n\n\t#store: Store;\n\t#chatId: number;\n\t#userManager: UserManager;\n\n\t#preparedHistoryMessages: RawMessage[] = [];\n\t#preparedUnreadMessages: RawMessage[] = [];\n\t#isLoading: boolean = false;\n\n\tconstructor(chatId: number)\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#userManager = new UserManager();\n\n\t\tthis.#chatId = chatId;\n\t}\n\n\tasync loadUnread(): Promise\n\t{\n\t\tif (this.#isLoading || !this.#getDialog().hasNextPage)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tLogger.warn('MessageService: loadUnread');\n\t\tconst lastUnreadMessageId = this.#store.getters['messages/getLastId'](this.#chatId);\n\t\tif (!lastUnreadMessageId)\n\t\t{\n\t\t\tLogger.warn('MessageService: no lastUnreadMessageId, cant load unread');\n\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.#isLoading = true;\n\n\t\tconst query = {\n\t\t\tchatId: this.#chatId,\n\t\t\tfilter: { lastId: lastUnreadMessageId },\n\t\t\torder: { id: 'ASC' },\n\t\t\tlimit: LoadService.MESSAGE_REQUEST_LIMIT,\n\t\t};\n\n\t\tconst result: PaginationRestResult = await runAction(RestMethod.imV2ChatMessageTail, { data: query })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('MessageService: loadUnread error:', error);\n\t\t\t\tthis.#isLoading = false;\n\t\t\t});\n\n\t\tLogger.warn('MessageService: loadUnread result', result);\n\t\tthis.#preparedUnreadMessages = result.messages;\n\n\t\tconst rawData: PaginationRestResult = {\n\t\t\t...result,\n\t\t\ttariffRestrictions: this.#prepareTariffRestrictions(result.tariffRestrictions),\n\t\t};\n\t\tawait this.#updateModels(rawData);\n\n\t\tthis.#isLoading = false;\n\n\t\treturn Promise.resolve();\n\t}\n\n\tasync loadHistory(): Promise\n\t{\n\t\tif (this.#isLoading || !this.#getDialog().hasPrevPage)\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tLogger.warn('MessageService: loadHistory');\n\t\tconst lastHistoryMessageId = this.#store.getters['messages/getFirstId'](this.#chatId);\n\t\tif (!lastHistoryMessageId)\n\t\t{\n\t\t\tLogger.warn('MessageService: no lastHistoryMessageId, cant load unread');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#isLoading = true;\n\n\t\tconst query = {\n\t\t\tchatId: this.#chatId,\n\t\t\tfilter: { lastId: lastHistoryMessageId },\n\t\t\torder: { id: 'DESC' },\n\t\t\tlimit: LoadService.MESSAGE_REQUEST_LIMIT,\n\t\t};\n\n\t\tconst result: PaginationRestResult = await runAction(RestMethod.imV2ChatMessageTail, { data: query })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('MessageService: loadHistory error:', error);\n\t\t\t\tthis.#isLoading = false;\n\t\t\t});\n\n\t\tLogger.warn('MessageService: loadHistory result', result);\n\t\tthis.#preparedHistoryMessages = result.messages;\n\n\t\tconst hasPrevPage = result.hasNextPage;\n\t\tconst rawData = { ...result, hasPrevPage, hasNextPage: null };\n\t\tawait this.#updateModels(rawData);\n\n\t\tthis.#isLoading = false;\n\n\t\treturn Promise.resolve();\n\t}\n\n\thasPreparedHistoryMessages(): boolean\n\t{\n\t\treturn this.#preparedHistoryMessages.length > 0;\n\t}\n\n\tdrawPreparedHistoryMessages(): Promise\n\t{\n\t\tif (!this.hasPreparedHistoryMessages())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#store.dispatch('messages/setChatCollection', {\n\t\t\tmessages: this.#preparedHistoryMessages,\n\t\t}).then(() => {\n\t\t\tthis.#preparedHistoryMessages = [];\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\thasPreparedUnreadMessages(): boolean\n\t{\n\t\treturn this.#preparedUnreadMessages.length > 0;\n\t}\n\n\tdrawPreparedUnreadMessages(): Promise\n\t{\n\t\tif (!this.hasPreparedUnreadMessages())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#store.dispatch('messages/setChatCollection', {\n\t\t\tmessages: this.#preparedUnreadMessages,\n\t\t}).then(() => {\n\t\t\tthis.#preparedUnreadMessages = [];\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tasync loadFirstPage(): Promise\n\t{\n\t\tLogger.warn('MessageService: loadFirstPage for: ', this.#chatId);\n\t\tthis.#isLoading = true;\n\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tchatId: this.#chatId,\n\t\t\t\tlimit: LoadService.MESSAGE_REQUEST_LIMIT,\n\t\t\t\torder: { id: 'ASC' },\n\t\t\t},\n\t\t};\n\t\tconst restResult = await runAction(RestMethod.imV2ChatMessageTail, payload)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('MessageService: loadFirstPage error:', error);\n\t\t\t\tthis.#isLoading = false;\n\t\t\t\tthrow new Error(error);\n\t\t\t});\n\t\tLogger.warn('MessageService: loadFirstPage result', restResult);\n\n\t\tawait this.#handleLoadedMessages(restResult);\n\t\tawait this.#store.dispatch('chats/update', {\n\t\t\tdialogId: this.#getDialog().dialogId,\n\t\t\tfields: {\n\t\t\t\thasPrevPage: false,\n\t\t\t\thasNextPage: restResult.hasNextPage,\n\t\t\t},\n\t\t});\n\t\tthis.#isLoading = false;\n\t}\n\n\tloadContext(messageId: number): Promise\n\t{\n\t\tconst query = {\n\t\t\t[RestMethod.imV2ChatMessageGetContext]: {\n\t\t\t\tid: messageId,\n\t\t\t\trange: LoadService.MESSAGE_REQUEST_LIMIT,\n\t\t\t},\n\t\t\t[RestMethod.imV2ChatMessageRead]: {\n\t\t\t\tchatId: this.#chatId,\n\t\t\t\tids: [messageId],\n\t\t\t},\n\t\t};\n\t\tLogger.warn('MessageService: loadContext for: ', messageId);\n\t\tthis.#isLoading = true;\n\n\t\treturn callBatch(query)\n\t\t\t.then((data) => {\n\t\t\t\tLogger.warn('MessageService: loadContext result', data);\n\n\t\t\t\treturn this.#handleLoadedMessages(data[RestMethod.imV2ChatMessageGetContext]);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#sendAnalytics(error);\n\t\t\t\tthis.#handleLoadContextError(error);\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('MessageService: loadContext error:', error);\n\t\t\t\tthrow new Error(error);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.#isLoading = false;\n\t\t\t});\n\t}\n\n\tasync loadContextByChatId(chatId: number): Promise<number>\n\t{\n\t\tconst queryParams = {\n\t\t\tdata: { commentChatId: chatId },\n\t\t};\n\t\tconst result = await runAction(RestMethod.imV2ChatMessageGetContext, queryParams)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('MessageService: loadHistory error:', error);\n\t\t\t});\n\n\t\tconst commentInfo: RawCommentInfo[] = result.commentInfo;\n\t\tconst targetCommentInfo: ?RawCommentInfo = commentInfo.find((item) => {\n\t\t\treturn item.chatId === chatId;\n\t\t});\n\t\tconst targetMessageId = targetCommentInfo?.messageId;\n\n\t\tLogger.warn('MessageService: loadContextByChatId result', result);\n\t\tvoid this.#handleLoadedMessages(result);\n\n\t\treturn targetMessageId;\n\t}\n\n\treloadMessageList(): Promise\n\t{\n\t\tLogger.warn('MessageService: loadChatOnExit for: ', this.#chatId);\n\t\tlet targetMessageId = 0;\n\t\tif (this.#getDialog().chatId <= 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this.#getDialog().markedId)\n\t\t{\n\t\t\ttargetMessageId = this.#getDialog().markedId;\n\t\t}\n\t\telse if (this.#getDialog().savedPositionMessageId)\n\t\t{\n\t\t\ttargetMessageId = this.#getDialog().savedPositionMessageId;\n\t\t}\n\n\t\tconst wasInitedBefore = this.#getDialog().inited;\n\t\tthis.#setDialogInited(false);\n\t\tif (targetMessageId)\n\t\t{\n\t\t\treturn this.loadContext(targetMessageId)\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#setDialogInited(true, wasInitedBefore);\n\t\t\t\t});\n\t\t}\n\n\t\treturn this.loadInitialMessages()\n\t\t\t.finally(() => {\n\t\t\t\tthis.#setDialogInited(true, wasInitedBefore);\n\t\t\t});\n\t}\n\n\tasync loadInitialMessages(): Promise\n\t{\n\t\tLogger.warn('MessageService: loadInitialMessages for: ', this.#chatId);\n\t\tthis.#isLoading = true;\n\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tchatId: this.#chatId,\n\t\t\t\tlimit: LoadService.MESSAGE_REQUEST_LIMIT,\n\t\t\t},\n\t\t};\n\t\tconst restResult = await runAction(RestMethod.imV2ChatMessageList, payload)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('MessageService: loadInitialMessages error:', error);\n\t\t\t\tthis.#isLoading = false;\n\t\t\t\tthrow new Error(error);\n\t\t\t});\n\t\tLogger.warn('MessageService: loadInitialMessages result', restResult);\n\t\trestResult.messages = this.#prepareInitialMessages(restResult.messages);\n\n\t\tawait this.#handleLoadedMessages(restResult);\n\t\tthis.#isLoading = false;\n\t}\n\n\t#prepareInitialMessages(rawMessages: RawMessage[]): RawMessage[]\n\t{\n\t\tif (rawMessages.length === 0)\n\t\t{\n\t\t\treturn rawMessages;\n\t\t}\n\n\t\tconst lastMessageId = this.#getDialog().lastMessageId;\n\t\tconst newMaxId = Math.max(...rawMessages.map((message) => message.id));\n\t\tif (newMaxId >= lastMessageId)\n\t\t{\n\t\t\treturn rawMessages;\n\t\t}\n\n\t\tconst messagesCollection: ImModelMessage[] = this.#store.getters['messages/getByChatId'](this.#chatId);\n\t\tconst additionalMessages = messagesCollection.filter((message) => {\n\t\t\treturn message.id > newMaxId;\n\t\t});\n\t\tLogger.warn('MessageService: loadInitialMessages: local id is higher than server one', additionalMessages);\n\n\t\treturn [...rawMessages, ...additionalMessages];\n\t}\n\n\tisLoading(): boolean\n\t{\n\t\treturn this.#isLoading;\n\t}\n\n\t#handleLoadedMessages(restResult): Promise\n\t{\n\t\tconst { messages } = restResult;\n\t\tconst messagesPromise = this.#store.dispatch('messages/setChatCollection', {\n\t\t\tmessages,\n\t\t\tclearCollection: true,\n\t\t});\n\t\tconst updateModelsPromise = this.#updateModels(restResult);\n\n\t\treturn Promise.all([messagesPromise, updateModelsPromise]);\n\t}\n\n\t#updateModels(rawData: PaginationRestResult): Promise\n\t{\n\t\tconst {\n\t\t\tfiles,\n\t\t\tusers,\n\t\t\tusersShort,\n\t\t\treactions,\n\t\t\thasPrevPage,\n\t\t\thasNextPage,\n\t\t\tadditionalMessages,\n\t\t\tcommentInfo,\n\t\t\tcopilot,\n\t\t\ttariffRestrictions,\n\t\t} = rawData;\n\n\t\tconst dialogPromise = this.#store.dispatch('chats/update', {\n\t\t\tdialogId: this.#getDialog().dialogId,\n\t\t\tfields: {\n\t\t\t\thasPrevPage,\n\t\t\t\thasNextPage,\n\t\t\t\ttariffRestrictions,\n\t\t\t},\n\t\t});\n\t\tconst usersPromise = Promise.all([\n\t\t\tthis.#userManager.setUsersToModel(users),\n\t\t\tthis.#userManager.addUsersToModel(usersShort),\n\t\t]);\n\t\tconst filesPromise = this.#store.dispatch('files/set', files);\n\t\tconst reactionsPromise = this.#store.dispatch('messages/reactions/set', reactions);\n\t\tconst additionalMessagesPromise = this.#store.dispatch('messages/store', additionalMessages);\n\t\tconst commentInfoPromise = this.#store.dispatch('messages/comments/set', commentInfo);\n\t\tconst copilotManager = new CopilotManager();\n\t\tconst copilotPromise = copilotManager.handleChatLoadResponse(copilot);\n\n\t\treturn Promise.all([\n\t\t\tdialogPromise,\n\t\t\tfilesPromise,\n\t\t\tusersPromise,\n\t\t\treactionsPromise,\n\t\t\tadditionalMessagesPromise,\n\t\t\tcommentInfoPromise,\n\t\t\tcopilotPromise,\n\t\t]);\n\t}\n\n\t#setDialogInited(flag: boolean, wasInitedBefore: boolean = true)\n\t{\n\t\tconst fields = {\n\t\t\tinited: flag,\n\t\t\tloading: !flag,\n\t\t};\n\t\tif (flag === true && !wasInitedBefore)\n\t\t{\n\t\t\tdelete fields.inited;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: this.#getDialog().dialogId,\n\t\t\tfields,\n\t\t});\n\t}\n\n\t#prepareTariffRestrictions(restrictions: RawTariffRestrictions): RawTariffRestrictions\n\t{\n\t\tconst dialogId = this.#getDialog().dialogId;\n\t\tconst chat: ?ImModelChat = this.#store.getters['chats/get'](dialogId);\n\t\tif (!chat)\n\t\t{\n\t\t\treturn restrictions;\n\t\t}\n\n\t\tconst { tariffRestrictions: { isHistoryLimitExceeded } } = chat;\n\t\tif (isHistoryLimitExceeded === true)\n\t\t{\n\t\t\treturn {\n\t\t\t\t...restrictions,\n\t\t\t\tisHistoryLimitExceeded: true,\n\t\t\t};\n\t\t}\n\n\t\treturn restrictions;\n\t}\n\n\t#getDialog(): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/getByChatId'](this.#chatId);\n\t}\n\n\t#handleLoadContextError(error): void\n\t{\n\t\tif (error.code !== AccessErrorCode.messageNotFound)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showNotification(Loc.getMessage('IM_CONTENT_CHAT_CONTEXT_MESSAGE_NOT_FOUND'));\n\t}\n\n\t#showNotification(text: string)\n\t{\n\t\tBX.UI.Notification.Center.notify({ content: text });\n\t}\n\n\t#sendAnalytics(error)\n\t{\n\t\tif (error.code !== AccessErrorCode.messageNotFound)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chat = this.#getDialog();\n\t\tconst dialogId = chat.dialogId;\n\t\tAnalytics.getInstance().messageDelete.onNotFoundNotification({ dialogId });\n\t}\n}\n","import { RestClient } from 'rest.client';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\nexport class PinService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\tpinMessage(chatId: number, messageId: number)\n\t{\n\t\tLogger.warn(`Dialog: PinManager: pin message ${messageId}`);\n\t\tthis.#store.dispatch('messages/pin/add', {\n\t\t\tchatId,\n\t\t\tmessageId,\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessagePin, { id: messageId })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('Dialog: PinManager: error pinning message', error);\n\t\t\t\tthis.#store.dispatch('messages/pin/delete', {\n\t\t\t\t\tchatId,\n\t\t\t\t\tmessageId,\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tunpinMessage(chatId: number, messageId: number)\n\t{\n\t\tLogger.warn(`Dialog: PinManager: unpin message ${messageId}`);\n\t\tthis.#store.dispatch('messages/pin/delete', {\n\t\t\tchatId,\n\t\t\tmessageId,\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessageUnpin, { id: messageId })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('Dialog: PinManager: error unpinning message', error);\n\t\t\t\tthis.#store.dispatch('messages/pin/add', {\n\t\t\t\t\tchatId,\n\t\t\t\t\tmessageId,\n\t\t\t\t});\n\t\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\nexport class EditService\n{\n\teditMessageText(messageId: number, text: string)\n\t{\n\t\tLogger.warn('MessageService: editMessageText', messageId, text);\n\t\tconst message = this.#getMessage(messageId);\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateMessageModel(messageId, text);\n\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tid: messageId,\n\t\t\t\tfields: { message: text },\n\t\t\t},\n\t\t};\n\n\t\trunAction(RestMethod.imV2ChatMessageUpdate, payload)\n\t\t\t.catch((error) => {\n\t\t\t\tLogger.error('MessageService: editMessageText error:', error);\n\t\t\t});\n\t}\n\n\t#updateMessageModel(messageId: number, text: string): void\n\t{\n\t\tconst message = this.#getMessage(messageId);\n\t\tconst isEdited = message.viewedByOthers;\n\n\t\tCore.getStore().dispatch('messages/update', {\n\t\t\tid: messageId,\n\t\t\tfields: {\n\t\t\t\ttext,\n\t\t\t\tisEdited,\n\t\t\t},\n\t\t});\n\t}\n\n\t#getMessage(messageId: number): ImModelMessage | null\n\t{\n\t\treturn Core.getStore().getters['messages/getById'](messageId);\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { RestMethod, EventType, ChatType } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\nimport { Core } from 'im.v2.application.core';\n\nimport type { ImModelChat, ImModelMessage, ImModelRecentItem } from 'im.v2.model';\n\nexport class DeleteService\n{\n\t#store: Store;\n\t#chatId: number;\n\n\tconstructor(chatId: number)\n\t{\n\t\tthis.#chatId = chatId;\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tasync deleteMessages(messageIds: number[])\n\t{\n\t\tLogger.warn('MessageService: deleteMessage', messageIds);\n\n\t\tconst deleteMessageIds = [];\n\n\t\tmessageIds.forEach((messageId) => {\n\t\t\tif (Utils.text.isUuidV4(messageId))\n\t\t\t{\n\t\t\t\tthis.#deleteTemporaryMessage(messageId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#sendDeleteEvent(messageId);\n\t\t\tthis.#updateModels(messageId);\n\n\t\t\tdeleteMessageIds.push(messageId);\n\t\t});\n\n\t\tif (deleteMessageIds.length > 0)\n\t\t{\n\t\t\tvoid this.#deleteMessageOnServer(deleteMessageIds);\n\t\t}\n\t}\n\n\t#updateModels(messageId: number)\n\t{\n\t\tconst message: ImModelMessage = this.#store.getters['messages/getById'](messageId);\n\n\t\tif (this.#canDeleteCompletely(message))\n\t\t{\n\t\t\tvoid this.#completeMessageDelete(message);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.#shallowMessageDelete(message);\n\t}\n\n\t#shallowMessageDelete(message: ImModelMessage): Promise\n\t{\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: message.id,\n\t\t\tfields: {\n\t\t\t\ttext: '',\n\t\t\t\tisDeleted: true,\n\t\t\t\tfiles: [],\n\t\t\t\tattach: [],\n\t\t\t\treplyId: 0,\n\t\t\t},\n\t\t});\n\t}\n\n\t#canDeleteCompletely(message: ImModelMessage): boolean\n\t{\n\t\tconst alwaysCompleteDeleteChats = [ChatType.channel, ChatType.openChannel, ChatType.generalChannel];\n\t\tconst neverCompleteDeleteChats = [ChatType.comment, ChatType.lines];\n\n\t\tconst chat = this.#getChat();\n\t\tif (alwaysCompleteDeleteChats.includes(chat.type))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (neverCompleteDeleteChats.includes(chat.type))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !message.viewedByOthers;\n\t}\n\n\t#completeMessageDelete(message: ImModelMessage): Promise\n\t{\n\t\tconst chat = this.#getChat();\n\t\tif (message.id === chat.lastMessageId)\n\t\t{\n\t\t\tconst newLastId = this.#getPreviousMessageId(message.id);\n\t\t\tthis.#updateRecentForCompleteDelete(newLastId);\n\t\t\tthis.#updateChatForCompleteDelete(newLastId);\n\t\t}\n\n\t\tthis.#store.dispatch('messages/delete', {\n\t\t\tid: message.id,\n\t\t});\n\t}\n\n\t#updateRecentForCompleteDelete(newLastId: number)\n\t{\n\t\tconst chat = this.#getChat();\n\t\tif (!newLastId)\n\t\t{\n\t\t\tthis.#store.dispatch('recent/delete', { id: chat.dialogId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('recent/update', {\n\t\t\tid: chat.dialogId,\n\t\t\tfields: { messageId: newLastId },\n\t\t});\n\t}\n\n\t#updateChatForCompleteDelete(newLastId)\n\t{\n\t\tconst chat = this.#getChat();\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: chat.dialogId,\n\t\t\tfields: {\n\t\t\t\tlastMessageId: newLastId,\n\t\t\t\tlastId: newLastId,\n\t\t\t},\n\t\t});\n\t\tthis.#store.dispatch('chats/clearLastMessageViews', {\n\t\t\tdialogId: chat.dialogId,\n\t\t});\n\t}\n\n\t#deleteMessageOnServer(messageIds: number[]): Promise\n\t{\n\t\treturn runAction(RestMethod.imV2ChatMessageDelete, {\n\t\t\tdata: { messageIds },\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('MessageService: deleteMessage error:', error);\n\t\t});\n\t}\n\n\t#deleteTemporaryMessage(messageId: string)\n\t{\n\t\tconst chat = this.#getChat();\n\t\tconst recentItem: ImModelRecentItem = this.#store.getters['recent/get'](chat.dialogId);\n\t\tif (recentItem.messageId === messageId)\n\t\t{\n\t\t\tconst newLastId = this.#getPreviousMessageId(messageId);\n\t\t\tthis.#store.dispatch('recent/update', {\n\t\t\t\tid: chat.dialogId,\n\t\t\t\tfields: { messageId: newLastId },\n\t\t\t});\n\t\t}\n\n\t\tthis.#store.dispatch('messages/delete', {\n\t\t\tid: messageId,\n\t\t});\n\t}\n\n\t#getPreviousMessageId(messageId: number): number\n\t{\n\t\tconst previousMessage: ImModelMessage = this.#store.getters['messages/getPreviousMessage']({\n\t\t\tmessageId,\n\t\t\tchatId: this.#chatId,\n\t\t});\n\n\t\treturn previousMessage?.id ?? 0;\n\t}\n\n\t#sendDeleteEvent(messageId: number)\n\t{\n\t\tEventEmitter.emit(EventType.dialog.onMessageDeleted, { messageId });\n\t}\n\n\t#getChat(): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/getByChatId'](this.#chatId);\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\n\nexport class MarkService\n{\n\t#chatId: number;\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor(chatId: number)\n\t{\n\t\tthis.#chatId = chatId;\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\tmarkMessage(messageId: number)\n\t{\n\t\tLogger.warn('MessageService: markMessage', messageId);\n\t\tconst { dialogId } = this.#store.getters['chats/getByChatId'](this.#chatId);\n\t\tthis.#store.dispatch('recent/unread', {\n\t\t\tid: dialogId,\n\t\t\taction: true,\n\t\t});\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { markedId: messageId },\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessageMark, {\n\t\t\tdialogId,\n\t\t\tid: messageId\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('MessageService: error marking message', error);\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport 'ui.notification';\n\nexport class FavoriteService\n{\n\t#chatId: number;\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor(chatId: number)\n\t{\n\t\tthis.#chatId = chatId;\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\taddMessageToFavorite(messageId: number)\n\t{\n\t\tLogger.warn('MessageService: addMessageToFavorite', messageId);\n\t\tthis.#restClient.callMethod(RestMethod.imChatFavoriteAdd, {\n\t\t\tMESSAGE_ID: messageId,\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('MessageService: error adding message to favorite', error);\n\t\t});\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('IM_MESSAGE_SERVICE_ADD_MESSAGE_TO_FAVORITE_SUCCESS'),\n\t\t});\n\t}\n\n\tremoveMessageFromFavorite(messageId: number)\n\t{\n\t\tLogger.warn('MessageService: removeMessageFromFavorite', messageId);\n\t\tthis.#store.dispatch('sidebar/favorites/deleteByMessageId', {\n\t\t\tchatId: this.#chatId,\n\t\t\tmessageId,\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imChatFavoriteDelete, {\n\t\t\tMESSAGE_ID: messageId,\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('MessageService: error removing message from favorite', error);\n\t\t});\n\t}\n}\n","import { LoadService } from './classes/load';\nimport { PinService } from './classes/pin';\nimport { EditService } from './classes/edit';\nimport { DeleteService } from './classes/delete';\nimport { MarkService } from './classes/mark';\nimport { FavoriteService } from './classes/favorite';\n\nexport class MessageService\n{\n\t#loadService: LoadService;\n\t#pinService: PinService;\n\t#editService: EditService;\n\t#deleteService: DeleteService;\n\t#markService: MarkService;\n\t#favoriteService: FavoriteService;\n\n\tstatic getMessageRequestLimit(): number\n\t{\n\t\treturn LoadService.MESSAGE_REQUEST_LIMIT;\n\t}\n\n\tconstructor(params: {chatId: number})\n\t{\n\t\tconst { chatId } = params;\n\t\tthis.#initServices(chatId);\n\t}\n\n\t#initServices(chatId: number)\n\t{\n\t\tthis.#loadService = new LoadService(chatId);\n\t\tthis.#editService = new EditService();\n\t\tthis.#deleteService = new DeleteService(chatId);\n\t\tthis.#pinService = new PinService();\n\t\tthis.#markService = new MarkService(chatId);\n\t\tthis.#favoriteService = new FavoriteService(chatId);\n\t}\n\n\t// region 'pagination'\n\tloadUnread(): Promise\n\t{\n\t\treturn this.#loadService.loadUnread();\n\t}\n\n\tloadHistory(): Promise\n\t{\n\t\treturn this.#loadService.loadHistory();\n\t}\n\n\thasPreparedHistoryMessages(): boolean\n\t{\n\t\treturn this.#loadService.hasPreparedHistoryMessages();\n\t}\n\n\tdrawPreparedHistoryMessages(): Promise\n\t{\n\t\treturn this.#loadService.drawPreparedHistoryMessages();\n\t}\n\n\thasPreparedUnreadMessages(): boolean\n\t{\n\t\treturn this.#loadService.hasPreparedUnreadMessages();\n\t}\n\n\tdrawPreparedUnreadMessages(): Promise\n\t{\n\t\treturn this.#loadService.drawPreparedUnreadMessages();\n\t}\n\n\tisLoading(): boolean\n\t{\n\t\treturn this.#loadService.isLoading();\n\t}\n\t// endregion 'pagination'\n\n\t// region 'context'\n\tloadContext(messageId: number): Promise\n\t{\n\t\treturn this.#loadService.loadContext(messageId);\n\t}\n\n\tloadContextByChatId(chatId: number): Promise<number>\n\t{\n\t\treturn this.#loadService.loadContextByChatId(chatId);\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\treturn this.#loadService.loadFirstPage();\n\t}\n\t// endregion 'context\n\n\t// region 'reload messages'\n\treloadMessageList(): Promise\n\t{\n\t\treturn this.#loadService.reloadMessageList();\n\t}\n\n\tloadInitialMessages(): Promise\n\t{\n\t\treturn this.#loadService.loadInitialMessages();\n\t}\n\t// endregion 'reload messages'\n\n\t// region 'pin'\n\tpinMessage(chatId: number, messageId: number)\n\t{\n\t\tthis.#pinService.pinMessage(chatId, messageId);\n\t}\n\n\tunpinMessage(chatId: number, messageId: number)\n\t{\n\t\tthis.#pinService.unpinMessage(chatId, messageId);\n\t}\n\t// endregion 'pin'\n\n\t// region 'mark'\n\tmarkMessage(messageId: number)\n\t{\n\t\tthis.#markService.markMessage(messageId);\n\t}\n\t// endregion 'mark'\n\n\t// region 'favorite'\n\taddMessageToFavorite(messageId: number)\n\t{\n\t\tthis.#favoriteService.addMessageToFavorite(messageId);\n\t}\n\n\tremoveMessageFromFavorite(messageId: number)\n\t{\n\t\tthis.#favoriteService.removeMessageFromFavorite(messageId);\n\t}\n\t// endregion 'favorite'\n\n\t// region 'edit'\n\teditMessageText(messageId: number, text: string)\n\t{\n\t\tthis.#editService.editMessageText(messageId, text);\n\t}\n\t// endregion 'edit'\n\n\t// region 'delete'\n\tdeleteMessages(messageIds: number[])\n\t{\n\t\tthis.#deleteService.deleteMessages(messageIds);\n\t}\n\t// endregion 'delete'\n}\n","import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction, type RunActionError } from 'im.v2.lib.rest';\nimport { Core } from 'im.v2.application.core';\nimport { EventType, RestMethod, DialogScrollThreshold, ChatType } from 'im.v2.const';\n\nimport { MessageService } from '../registry';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject, JsonValue } from 'main.core';\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\n\ntype BaseMessageParams = {\n\tdialogId: string,\n\ttext: string,\n\ttempMessageId?: string,\n};\n\ntype PlainMessageParams = BaseMessageParams & {\n\treplyId?: number,\n\tforwardIds?: number[],\n};\n\ntype CopilotMessageParams = BaseMessageParams & {\n\tcopilot: {\n\t\tpromptCode: string,\n\t},\n};\n\ntype FileMessageParams = BaseMessageParams & {\n\tfileIds: string[],\n};\n\ntype PreparedMessage = {\n\ttemporaryId: string,\n\tchatId: number,\n\tdialogId: string,\n\tauthorId: number,\n\treplyId: number,\n\tforward: {userId: number, id: string},\n\tforwardIds: {[string]: number},\n\ttext: string,\n\tparams: JsonObject,\n\tcopilot: JsonObject,\n\tunread: boolean,\n\tsending: boolean,\n\tviewedByOthers: boolean,\n};\n\nexport type ForwardedEntityConfig = {\n\tid: number,\n\ttitle: string,\n};\n\nexport type PanelContext = {\n\tmessageId: number,\n\t[prop: string]: JsonValue,\n}\n\nexport type PanelContextWithMultipleIds = PanelContext & {\n\tmessagesIds: number[],\n}\n\nexport class SendingService\n{\n\t#store: Store;\n\n\tstatic instance: SendingService = null;\n\n\tstatic getInstance(): SendingService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tasync sendMessage(params: PlainMessageParams): Promise\n\t{\n\t\tconst { text = '' } = params;\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('SendingService: sendMessage', params);\n\t\tconst message = this.#prepareMessage(params);\n\n\t\treturn this.#processMessageSending(message);\n\t}\n\n\tasync #addLoadingMessage(message: PreparedMessage): Promise<void>\n\t{\n\t\treturn this.#store.dispatch('messages/addLoadingMessage', {\n\t\t\tmessage,\n\t\t});\n\t}\n\n\tasync sendMessageWithFiles(params: FileMessageParams): Promise<void>\n\t{\n\t\tconst { text = '', fileIds = [] } = params;\n\t\tif (!Type.isStringFilled(text) && !Type.isArrayFilled(fileIds))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('SendingService: sendMessage with files', params);\n\t\tconst message: PreparedMessage = this.#prepareMessageWithFiles(params);\n\n\t\tawait this.#handlePagination(message.dialogId);\n\t\tawait this.#addLoadingMessage(message);\n\t\tawait this.#addMessageToRecent(message);\n\t\tawait this.#clearLastMessageViews(message.dialogId);\n\n\t\tthis.#sendScrollEvent({\n\t\t\tforce: true,\n\t\t\tdialogId: message.dialogId,\n\t\t});\n\t}\n\n\tasync forwardMessages(params: PlainMessageParams): Promise\n\t{\n\t\tconst { forwardIds, dialogId, text } = params;\n\t\tif (!Type.isArrayFilled(forwardIds))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tLogger.warn('SendingService: forwardMessages', params);\n\n\t\tawait this.#handlePagination(dialogId);\n\n\t\tlet commentMessage = null;\n\t\tif (Type.isStringFilled(text))\n\t\t{\n\t\t\tcommentMessage = this.#prepareMessage(params);\n\t\t\tawait this.#addMessageToModels(commentMessage);\n\t\t}\n\n\t\tconst sortForwardIds = [...forwardIds].sort();\n\t\tconst forwardUuidMap = this.#getForwardUuidMap(sortForwardIds);\n\t\tconst forwardedMessages = this.#prepareForwardMessages(params, forwardUuidMap);\n\n\t\tawait this.#addForwardsToModels(forwardedMessages);\n\n\t\tthis.#sendScrollEvent({ force: true, dialogId });\n\n\t\treturn this.#sendForwardRequest({ forwardUuidMap, commentMessage, dialogId });\n\t}\n\n\tasync retrySendMessage(params: { tempMessageId: string, dialogId: string }): Promise\n\t{\n\t\tconst { tempMessageId, dialogId } = params;\n\t\tconst unsentMessage: ImModelMessage = this.#store.getters['messages/getById'](tempMessageId);\n\t\tif (!unsentMessage)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#removeMessageError(tempMessageId);\n\t\tconst message = this.#prepareMessage({\n\t\t\ttext: unsentMessage.text,\n\t\t\tdialogId,\n\t\t\ttempMessageId: unsentMessage.id,\n\t\t\treplyId: unsentMessage.replyId,\n\t\t});\n\n\t\tif (Type.isStringFilled(unsentMessage.forward.id))\n\t\t{\n\t\t\tconst [, forwardId] = unsentMessage.forward.id.split('/');\n\t\t\tconst forwardUuidMap = { [unsentMessage.id]: forwardId };\n\n\t\t\treturn this.#sendForwardRequest({ forwardUuidMap, dialogId });\n\t\t}\n\n\t\treturn this.#sendAndProcessMessage(message);\n\t}\n\n\tasync sendCopilotPrompt(params: CopilotMessageParams): Promise\n\t{\n\t\tconst { text = '' } = params;\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('SendingService: sendCopilotPrompt', params);\n\t\tconst message = this.#preparePrompt(params);\n\n\t\treturn this.#processMessageSending(message);\n\t}\n\n\tasync #processMessageSending(message: PreparedMessage): Promise\n\t{\n\t\tawait this.#handleAddingMessageToModels(message);\n\n\t\treturn this.#sendAndProcessMessage(message);\n\t}\n\n\tasync #handleAddingMessageToModels(message)\n\t{\n\t\tawait this.#handlePagination(message.dialogId);\n\t\tawait this.#addMessageToModels(message);\n\n\t\tthis.#sendScrollEvent({ force: true, dialogId: message.dialogId });\n\t}\n\n\tasync #sendAndProcessMessage(message: PreparedMessage): Promise\n\t{\n\t\tconst sendResult = await this.#sendMessageToServer(message)\n\t\t\t.catch((errors) => {\n\t\t\t\tthis.#updateMessageError(message.temporaryId);\n\t\t\t\tthis.#logSendErrors(errors, 'sendAndProcessMessage');\n\t\t\t});\n\n\t\tLogger.warn('SendingService: sendAndProcessMessage result -', sendResult);\n\t\tconst { id } = sendResult;\n\t\tif (!id)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#updateModels({\n\t\t\toldId: message.temporaryId,\n\t\t\tnewId: id,\n\t\t\tdialogId: message.dialogId,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#prepareMessage(params: PlainMessageParams): PreparedMessage\n\t{\n\t\tconst { text, tempMessageId, dialogId, replyId, forwardIds } = params;\n\n\t\tconst defaultFields = {\n\t\t\tauthorId: Core.getUserId(),\n\t\t\tunread: false,\n\t\t\tsending: true,\n\t\t};\n\n\t\treturn {\n\t\t\ttext,\n\t\t\tdialogId,\n\t\t\tchatId: this.#getDialog(dialogId).chatId,\n\t\t\ttemporaryId: tempMessageId ?? Utils.text.getUuidV4(),\n\t\t\treplyId,\n\t\t\tforwardIds,\n\t\t\tviewedByOthers: this.#needToSetAsViewed(dialogId),\n\t\t\t...defaultFields,\n\t\t};\n\t}\n\n\t#prepareMessageWithFiles(params: FileMessageParams): PreparedMessage\n\t{\n\t\tconst { fileIds } = params;\n\t\tif (!Type.isArrayFilled(fileIds))\n\t\t{\n\t\t\tthrow new Error('SendingService: sendMessageWithFile: no fileId provided');\n\t\t}\n\n\t\treturn {\n\t\t\t...this.#prepareMessage(params),\n\t\t\tparams: { FILE_ID: fileIds },\n\t\t};\n\t}\n\n\t#preparePrompt(params: CopilotMessageParams): PreparedMessage\n\t{\n\t\tconst { copilot } = params;\n\t\tif (!copilot || !copilot.promptCode)\n\t\t{\n\t\t\tthrow new Error('SendingService: preparePrompt: no code provided');\n\t\t}\n\n\t\treturn {\n\t\t\t...this.#prepareMessage(params),\n\t\t\tcopilot,\n\t\t};\n\t}\n\n\t#handlePagination(dialogId: string): Promise\n\t{\n\t\tif (!this.#getDialog(dialogId).hasNextPage)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('SendingService: sendMessage: there are unread pages, move to chat end');\n\t\tconst messageService = new MessageService({ chatId: this.#getDialog(dialogId).chatId });\n\n\t\treturn messageService.loadContext(this.#getDialog(dialogId).lastMessageId).then(() => {\n\t\t\tthis.#sendScrollEvent({ dialogId });\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('SendingService: loadContext error', error);\n\t\t});\n\t}\n\n\t#addMessageToModels(message: PreparedMessage): Promise\n\t{\n\t\tthis.#addMessageToRecent(message);\n\n\t\tvoid this.#clearLastMessageViews(message.dialogId);\n\n\t\treturn this.#store.dispatch('messages/add', message);\n\t}\n\n\t#addMessageToRecent(message: PreparedMessage)\n\t{\n\t\tconst hasMessageText: boolean = Type.isStringFilled(message.text);\n\t\tconst hasMessageFile: boolean = Type.isArrayFilled(message.params?.FILE_ID);\n\n\t\tif (hasMessageText || hasMessageFile)\n\t\t{\n\t\t\tvoid this.#store.dispatch('recent/update', {\n\t\t\t\tid: message.dialogId,\n\t\t\t\tfields: { messageId: message.temporaryId },\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendMessageToServer(message: PreparedMessage): Promise\n\t{\n\t\tconst fields = {};\n\n\t\tif (message.replyId)\n\t\t{\n\t\t\tfields.replyId = message.replyId;\n\t\t}\n\n\t\tif (message.forwardIds)\n\t\t{\n\t\t\tfields.forwardIds = message.forwardIds;\n\t\t}\n\n\t\tif (message.text)\n\t\t{\n\t\t\tfields.message = message.text;\n\t\t\tfields.templateId = message.temporaryId;\n\t\t}\n\n\t\tif (message.copilot)\n\t\t{\n\t\t\tfields.copilot = message.copilot;\n\t\t}\n\n\t\tconst queryData = {\n\t\t\tdialogId: message.dialogId.toString(),\n\t\t\tfields,\n\t\t};\n\n\t\treturn runAction(RestMethod.imV2ChatMessageSend, { data: queryData });\n\t}\n\n\t#updateModels(params: { oldId: string, newId: number, dialogId: string })\n\t{\n\t\tconst { oldId, newId, dialogId } = params;\n\t\tvoid this.#store.dispatch('messages/updateWithId', {\n\t\t\tid: oldId,\n\t\t\tfields: { id: newId },\n\t\t});\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tlastId: newId,\n\t\t\t\tlastMessageId: newId,\n\t\t\t},\n\t\t});\n\t\tvoid this.#store.dispatch('recent/update', {\n\t\t\tid: dialogId,\n\t\t\tfields: { messageId: newId },\n\t\t});\n\t}\n\n\t#updateMessageError(messageId: string)\n\t{\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: messageId,\n\t\t\tfields: { error: true },\n\t\t});\n\t}\n\n\t#removeMessageError(messageId: string)\n\t{\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: messageId,\n\t\t\tfields: {\n\t\t\t\tsending: true,\n\t\t\t\terror: false,\n\t\t\t},\n\t\t});\n\t}\n\n\t#sendScrollEvent(params: {force: boolean, dialogId: string} = {})\n\t{\n\t\tconst { force = false, dialogId } = params;\n\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\tchatId: this.#getDialog(dialogId).chatId,\n\t\t\tthreshold: force ? DialogScrollThreshold.none : DialogScrollThreshold.halfScreenUp,\n\t\t});\n\t}\n\n\t#getDialog(dialogId: string): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/get'](dialogId, true);\n\t}\n\n\t#getDialogByChatId(chatId: number): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/getByChatId'](chatId, true);\n\t}\n\n\t#needToSetAsViewed(dialogId: string): boolean\n\t{\n\t\treturn this.#store.getters['users/bots/isNetwork'](dialogId);\n\t}\n\n\t#handleForwardMessageResponse(params: { response: Object, dialogId: string, commentMessage: PreparedMessage })\n\t{\n\t\tconst { response, dialogId, commentMessage } = params;\n\t\tconst { id, uuidMap } = response;\n\n\t\tif (id)\n\t\t{\n\t\t\tthis.#updateModels({\n\t\t\t\toldId: commentMessage.temporaryId,\n\t\t\t\tnewId: id,\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t}\n\t\tObject.entries(uuidMap).forEach(([uuid: string, messageId: number]) => {\n\t\t\tthis.#updateModels({\n\t\t\t\toldId: uuid,\n\t\t\t\tnewId: messageId,\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t});\n\t}\n\n\t#handleForwardMessageError({ commentMessage, forwardUuidMap })\n\t{\n\t\tif (commentMessage)\n\t\t{\n\t\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\t\tid: commentMessage.temporaryId,\n\t\t\t\tfields: { error: true },\n\t\t\t});\n\t\t}\n\n\t\tObject.keys(forwardUuidMap).forEach((uuid: string) => {\n\t\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\t\tid: uuid,\n\t\t\t\tfields: { error: true },\n\t\t\t});\n\t\t});\n\t}\n\n\t#prepareForwardMessages(params: PlainMessageParams, forwardUuidMap: {[string]: number}): PreparedMessage[]\n\t{\n\t\tconst { forwardIds, dialogId } = params;\n\t\tif (forwardIds.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst preparedMessages = [];\n\t\tObject.entries(forwardUuidMap).forEach(([uuid: string, messageId: number]) => {\n\t\t\tconst message: ImModelMessage = this.#store.getters['messages/getById'](messageId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpreparedMessages.push({\n\t\t\t\t...this.#prepareMessage({ dialogId, text: message.text, tempMessageId: uuid, replyId: message.replyId }),\n\t\t\t\tforward: this.#prepareForwardParams(messageId),\n\t\t\t\tattach: message.attach,\n\t\t\t\tisDeleted: message.isDeleted,\n\t\t\t\tfiles: message.files,\n\t\t\t});\n\t\t});\n\n\t\treturn preparedMessages;\n\t}\n\n\t#prepareForwardParams(messageId: number): { id: string, userId: number, chatType: string, chatTitle: string }\n\t{\n\t\tconst message: ImModelMessage = this.#store.getters['messages/getById'](messageId);\n\t\tconst chat = this.#getDialogByChatId(message.chatId);\n\n\t\tconst isForward = this.#store.getters['messages/isForward'](messageId);\n\n\t\tconst userId = isForward ? message.forward.userId : message.authorId;\n\t\tconst chatType = isForward ? message.forward.chatType : chat.type;\n\t\tlet chatTitle = isForward ? message.forward.chatTitle : chat.name;\n\t\tif (chatType === ChatType.channel)\n\t\t{\n\t\t\tchatTitle = null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: this.#buildForwardContextId(message.chatId, messageId),\n\t\t\tuserId,\n\t\t\tchatType,\n\t\t\tchatTitle,\n\t\t};\n\t}\n\n\t#prepareSendForwardRequest(params: {\n\t\tforwardUuidMap: { [string]: number },\n\t\tcommentMessage: ?PreparedMessage,\n\t\tdialogId: string\n\t}): { dialogId: string, forwardIds: { [string]: number }, text?: string, temporaryId?: string }\n\t{\n\t\tconst { dialogId, forwardUuidMap, commentMessage } = params;\n\n\t\tconst requestPrams = {\n\t\t\tdialogId,\n\t\t\tforwardIds: forwardUuidMap,\n\t\t};\n\n\t\tif (commentMessage)\n\t\t{\n\t\t\trequestPrams.text = commentMessage.text;\n\t\t\trequestPrams.temporaryId = commentMessage.temporaryId;\n\t\t}\n\n\t\treturn requestPrams;\n\t}\n\n\t#addForwardsToModels(forwardedMessages: PreparedMessage[]): Promise\n\t{\n\t\tconst addPromises = [];\n\t\tforwardedMessages.forEach((message) => {\n\t\t\taddPromises.push(this.#addMessageToModels(message));\n\t\t});\n\n\t\treturn Promise.all(addPromises);\n\t}\n\n\t#getForwardUuidMap(forwardIds: number[]): { [string]: number }\n\t{\n\t\tconst uuidMap = {};\n\t\tforwardIds.forEach((id) => {\n\t\t\tuuidMap[Utils.text.getUuidV4()] = id;\n\t\t});\n\n\t\treturn uuidMap;\n\t}\n\n\t#buildForwardContextId(chatId: number, messageId: number): string\n\t{\n\t\tconst dialogId = this.#getDialogByChatId(chatId).dialogId;\n\t\tif (dialogId.startsWith('chat'))\n\t\t{\n\t\t\treturn `${dialogId}/${messageId}`;\n\t\t}\n\n\t\tconst currentUser = Core.getUserId();\n\n\t\treturn `${dialogId}:${currentUser}/${messageId}`;\n\t}\n\n\t#logSendErrors(errors: RunActionError[], methodName: string)\n\t{\n\t\terrors.forEach((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error(`SendingService: ${methodName} error: code: ${error.code} message: ${error.message}`);\n\t\t});\n\t}\n\n\t#clearLastMessageViews(dialogId: string): Promise<any>\n\t{\n\t\treturn this.#store.dispatch('chats/clearLastMessageViews', {\n\t\t\tdialogId,\n\t\t});\n\t}\n\n\tasync #sendForwardRequest({ forwardUuidMap, commentMessage, dialogId }): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst requestParams = this.#prepareSendForwardRequest({ forwardUuidMap, commentMessage, dialogId });\n\t\t\tconst response = await this.#sendMessageToServer(requestParams);\n\t\t\tLogger.warn('SendingService: forwardMessage result -', response);\n\t\t\tthis.#handleForwardMessageResponse({ response, dialogId, commentMessage });\n\t\t}\n\t\tcatch (errors)\n\t\t{\n\t\t\tthis.#handleForwardMessageError({ commentMessage, forwardUuidMap });\n\t\t\tthis.#logSendErrors(errors, 'forwardMessage');\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n}\n","import { Runtime, Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { NotificationTypesCodes, RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { NotificationGetRestResult, NotificationItemRest } from './types/notification';\n\nexport class NotificationService\n{\n\tstore: Object = null;\n\trestClient: Object = null;\n\tlimitPerPage: Number = 50;\n\tisLoading: boolean = false;\n\n\tlastId: number = 0;\n\tlastType: number = 0;\n\thasMoreItemsToLoad: boolean = true;\n\n\tnotificationsToDelete: Set<number> = new Set();\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.deleteWithDebounce = Runtime.debounce(this.deleteRequest, 500, this);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tthis.isLoading = true;\n\n\t\treturn this.requestItems({ firstPage: true });\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tif (this.isLoading || !this.hasMoreItemsToLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tthis.isLoading = true;\n\n\t\treturn this.requestItems();\n\t}\n\n\tdelete(notificationId: number)\n\t{\n\t\tthis.notificationsToDelete.add(notificationId);\n\t\tthis.store.dispatch('notifications/delete', { id: notificationId });\n\t\tthis.store.dispatch('notifications/deleteFromSearch', { id: notificationId });\n\n\t\tthis.deleteWithDebounce();\n\t}\n\n\tsendConfirmAction(notificationId: number, value: string)\n\t{\n\t\tconst requestParams = {\n\t\t\tNOTIFY_ID: notificationId,\n\t\t\tNOTIFY_VALUE: value,\n\t\t};\n\n\t\tthis.store.dispatch('notifications/delete', { id: notificationId });\n\n\t\tthis.restClient.callMethod('im.notify.confirm', requestParams)\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t}\n\n\tasync sendQuickAnswer(params)\n\t{\n\t\tconst { id, text, callbackSuccess = () => {}, callbackError = () => {} } = params;\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imNotifyAnswer, {\n\t\t\t\tnotify_id: id,\n\t\t\t\tanswer_text: text,\n\t\t\t});\n\t\t\tcallbackSuccess(response);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error(error);\n\t\t\tcallbackError();\n\t\t}\n\t}\n\n\tdeleteRequest()\n\t{\n\t\tconst idsToDelete = [...this.notificationsToDelete];\n\n\t\tthis.restClient.callMethod('im.notify.delete', { id: idsToDelete })\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\n\t\tthis.notificationsToDelete.clear();\n\t}\n\n\trequestItems({ firstPage = false } = {}): Promise\n\t{\n\t\tconst imNotifyGetQueryParams = {\n\t\t\tLIMIT: this.limitPerPage,\n\t\t\tCONVERT_TEXT: 'Y',\n\t\t};\n\t\tconst batchQueryParams = {\n\t\t\t[RestMethod.imNotifyGet]: [RestMethod.imNotifyGet, imNotifyGetQueryParams],\n\t\t};\n\n\t\tif (firstPage)\n\t\t{\n\t\t\tbatchQueryParams[RestMethod.imNotifySchemaGet] = [RestMethod.imNotifySchemaGet, {}];\n\t\t}\n\t\telse\n\t\t{\n\t\t\timNotifyGetQueryParams.LAST_ID = this.lastId;\n\t\t\timNotifyGetQueryParams.LAST_TYPE = this.lastType;\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.restClient.callBatch(batchQueryParams, (response) => {\n\t\t\t\tLogger.warn('im.notify.get: result', response);\n\t\t\t\tresolve(this.handleResponse(response));\n\t\t\t});\n\t\t});\n\t}\n\n\thandleResponse(response: Object): Promise\n\t{\n\t\tconst imNotifyGetResponse = response[RestMethod.imNotifyGet].data();\n\t\tthis.hasMoreItemsToLoad = !this.isLastPage(imNotifyGetResponse.notifications);\n\t\tif (imNotifyGetResponse.notifications.length === 0)\n\t\t{\n\t\t\tLogger.warn('im.notify.get: no notifications', imNotifyGetResponse);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.lastId = this.getLastItemId(imNotifyGetResponse.notifications);\n\t\tthis.lastType = this.getLastItemType(imNotifyGetResponse.notifications);\n\n\t\treturn this.updateModels(imNotifyGetResponse).then(() => {\n\t\t\tthis.isLoading = false;\n\n\t\t\tif (response[RestMethod.imNotifySchemaGet])\n\t\t\t{\n\t\t\t\treturn response[RestMethod.imNotifySchemaGet].data();\n\t\t\t}\n\n\t\t\treturn {};\n\t\t});\n\t}\n\n\tupdateModels(imNotifyGetResponse: NotificationGetRestResult): Promise\n\t{\n\t\tthis.userManager.setUsersToModel(imNotifyGetResponse.users);\n\n\t\treturn this.store.dispatch('notifications/initialSet', imNotifyGetResponse);\n\t}\n\n\tgetLastItemId(collection: NotificationItemRest[]): number\n\t{\n\t\treturn collection[collection.length - 1].id;\n\t}\n\n\tgetLastItemType(collection: NotificationItemRest[]): number\n\t{\n\t\treturn this.getItemType(collection[collection.length - 1]);\n\t}\n\n\tgetItemType(item: NotificationItemRest): number\n\t{\n\t\treturn item.notify_type === NotificationTypesCodes.confirm\n\t\t\t? NotificationTypesCodes.confirm\n\t\t\t: NotificationTypesCodes.simple\n\t\t;\n\t}\n\n\tisLastPage(notifications: Array): boolean\n\t{\n\t\tif (!Type.isArrayFilled(notifications))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn notifications.length < this.limitPerPage;\n\t}\n\n\tdestroy()\n\t{\n\t\tLogger.warn('Notification service destroyed');\n\t}\n}\n","import { RestClient } from 'rest.client';\n\nimport { runAction } from 'im.v2.lib.rest';\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\n\nexport class DiskService\n{\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\tdelete({ chatId, fileId }): Promise\n\t{\n\t\tconst queryParams = { chat_id: chatId, file_id: fileId };\n\n\t\treturn this.#restClient.callMethod(RestMethod.imDiskFileDelete, queryParams).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('DiskService: error deleting file', error);\n\t\t});\n\t}\n\n\tsave(fileIds: number[]): Promise\n\t{\n\t\treturn runAction(RestMethod.imV2DiskFileSave, {\n\t\t\tdata: {\n\t\t\t\tids: fileIds,\n\t\t\t},\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('DiskService: error saving file on disk', error);\n\t\t});\n\t}\n}\n","import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Uploader, UploaderEvent } from 'ui.uploader.core';\n\nimport { EventType } from 'im.v2.const';\n\nimport type { UploaderFile } from 'ui.uploader.core';\nimport type { MessageWithFile } from '../types/uploading';\n\ntype UploaderWrapperOptions = {\n\tdiskFolderId: number,\n\tuploaderId: string,\n\tchatId: number,\n\tdialogId: string,\n\tautoUpload: boolean,\n}\n\nconst MAX_FILES_IN_ONE_MESSAGE = 10;\n\nexport class UploaderWrapper extends EventEmitter\n{\n\t#uploaderRegistry: {[uploaderId: string]: Uploader} = {};\n\t#onUploadCancelHandler: Function;\n\n\tstatic eventNamespace = 'BX.Messenger.v2.Service.Uploading.UploaderWrapper';\n\n\tstatic events = {\n\t\tonFileAddStart: 'onFileAddStart',\n\t\tonFileAdd: 'onFileAdd',\n\t\tonFileUploadStart: 'onFileUploadStart',\n\t\tonFileUploadProgress: 'onFileUploadProgress',\n\t\tonFileUploadComplete: 'onFileUploadComplete',\n\t\tonFileUploadError: 'onFileUploadError',\n\t\tonFileUploadCancel: 'onFileUploadCancel',\n\t\tonMaxFileCountExceeded: 'onMaxFileCountExceeded',\n\t\tonUploadComplete: 'onUploadComplete',\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(UploaderWrapper.eventNamespace);\n\n\t\tthis.#onUploadCancelHandler = this.#onUploadCancel.bind(this);\n\t\tEventEmitter.subscribe(EventType.uploader.cancel, this.#onUploadCancelHandler);\n\t}\n\n\tcreateUploader(options: UploaderWrapperOptions)\n\t{\n\t\tconst { diskFolderId, uploaderId, autoUpload = false, chatId, dialogId } = options;\n\n\t\tthis.#uploaderRegistry[uploaderId] = new Uploader({\n\t\t\tautoUpload,\n\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\tmultiple: true,\n\t\t\tcontrollerOptions: {\n\t\t\t\tfolderId: diskFolderId,\n\t\t\t\tchat: {\n\t\t\t\t\tchatId,\n\t\t\t\t\tdialogId,\n\t\t\t\t},\n\t\t\t},\n\t\t\timageResizeWidth: 1280,\n\t\t\timageResizeHeight: 1280,\n\t\t\timageResizeMode: 'contain',\n\t\t\timageResizeFilter: (file: UploaderFile) => {\n\t\t\t\treturn !file.getCustomData('sendAsFile') && !file.isAnimated();\n\t\t\t},\n\t\t\timageResizeMimeType: 'image/jpeg',\n\t\t\timageResizeMimeTypeMode: 'force',\n\t\t\timagePreviewHeight: 720,\n\t\t\timagePreviewWidth: 720,\n\t\t\ttreatOversizeImageAsFile: true,\n\t\t\tignoreUnknownImageTypes: true,\n\t\t\tmaxFileSize: null,\n\t\t\tevents: {\n\t\t\t\t[UploaderEvent.FILE_ADD_START]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileAddStart, event);\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.FILE_UPLOAD_START]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileUploadStart, event);\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.FILE_ADD]: (event) => {\n\t\t\t\t\tconst { file } = event.getData();\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileAdd, { file, uploaderId });\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.FILE_UPLOAD_PROGRESS]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileUploadProgress, event);\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.FILE_UPLOAD_COMPLETE]: (event) => {\n\t\t\t\t\tconst { file } = event.getData();\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileUploadComplete, { file, uploaderId });\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.ERROR]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileUploadError, event);\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.FILE_ERROR]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onFileUploadError, event);\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.MAX_FILE_COUNT_EXCEEDED]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onMaxFileCountExceeded, event);\n\t\t\t\t},\n\t\t\t\t[UploaderEvent.UPLOAD_COMPLETE]: (event) => {\n\t\t\t\t\tthis.emit(UploaderWrapper.events.onUploadComplete, { uploaderId });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstart(uploaderId: string)\n\t{\n\t\tthis.#uploaderRegistry[uploaderId].setAutoUpload(true);\n\t\tthis.#uploaderRegistry[uploaderId].start();\n\t}\n\n\tdestroyUploader(uploaderId: string)\n\t{\n\t\tthis.#uploaderRegistry[uploaderId].destroy({ removeFilesFromServer: false });\n\t}\n\n\taddFiles(tasks: MessageWithFile[]): UploaderFile[]\n\t{\n\t\tconst firstTenTasks = tasks.slice(0, MAX_FILES_IN_ONE_MESSAGE);\n\n\t\tconst addedFiles = [];\n\t\tfirstTenTasks.forEach((task) => {\n\t\t\tconst file = this.#addFile(task);\n\t\t\tif (file)\n\t\t\t{\n\t\t\t\taddedFiles.push(file);\n\t\t\t}\n\t\t});\n\n\t\treturn addedFiles;\n\t}\n\n\tgetFiles(uploaderId): UploaderFile[]\n\t{\n\t\treturn this.#uploaderRegistry[uploaderId].getFiles();\n\t}\n\n\t#addFile(task: MessageWithFile): ?UploaderFile\n\t{\n\t\treturn this.#uploaderRegistry[task.uploaderId].addFile(\n\t\t\ttask.file,\n\t\t\t{\n\t\t\t\tid: task.tempFileId,\n\t\t\t\tcustomData: {\n\t\t\t\t\tdialogId: task.dialogId,\n\t\t\t\t\tchatId: task.chatId,\n\t\t\t\t\ttempMessageId: task.tempMessageId,\n\t\t\t\t\tsendAsFile: task.sendAsFile,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t#onUploadCancel(event: BaseEvent)\n\t{\n\t\tconst { tempFileId, tempMessageId } = event.getData();\n\t\tif (!tempFileId || !tempMessageId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#removeFileFromUploader(tempFileId);\n\t\tthis.emit(UploaderWrapper.events.onFileUploadCancel, { tempMessageId, tempFileId });\n\t}\n\n\t#removeFileFromUploader(tempFileId: string)\n\t{\n\t\tconst uploaderList = Object.values(this.#uploaderRegistry);\n\t\tfor (const uploader of uploaderList)\n\t\t{\n\t\t\tif (!uploader.getFile)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst file = uploader.getFile(tempFileId);\n\t\t\tif (file)\n\t\t\t{\n\t\t\t\tfile.remove();\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.uploader.cancel, this.#onUploadCancelHandler);\n\t}\n}\n","import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { getFilesFromDataTransfer, isFilePasted } from 'ui.uploader.core';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport { Core } from 'im.v2.application.core';\nimport { FileStatus, FileType, RestMethod } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { UploaderWrapper } from './classes/uploader-wrapper';\nimport { SendingService } from '../registry';\n\nimport type { ImModelChat, ImModelUser, ImModelMessage, ImModelFile } from 'im.v2.model';\nimport type { UploaderFile, UploaderError } from 'ui.uploader.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\nimport type {\n\tMessageWithFile,\n\tFileFromDisk,\n\tFileCommitParams,\n\tUploadFilesParams,\n\tUploadFromClipboardParams,\n\tUploadFromInputParams,\n\tUploadFromDragAndDrop,\n} from './types/uploading';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Service.UploadingService';\n\nexport class UploadingService extends EventEmitter\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\t#isRequestingDiskFolderId: boolean = false;\n\t#diskFolderIdRequestPromise: { [string]: Promise } = {};\n\t#uploaderWrapper: UploaderWrapper;\n\t#sendingService: SendingService;\n\t#uploaderFilesRegistry: {\n\t\t[uploaderId: string]: {\n\t\t\tautoUpload: boolean,\n\t\t\twasSent: boolean,\n\t\t\ttext: string,\n\t\t\tdialogId: string,\n\t\t\ttempMessageId: string,\n\t\t\tpreviewCreatedStatus: { [string]: boolean },\n\t\t\tpreviewSentStatus: { [string]: boolean },\n\t\t\tsourceFilesCount: number,\n\t\t}\n\t} = {};\n\n\tstatic event = {\n\t\tuploadStart: 'uploadStart',\n\t\tuploadComplete: 'uploadComplete',\n\t\tuploadError: 'uploadError',\n\t\tuploadCancel: 'uploadCancel',\n\t};\n\n\tstatic instance = null;\n\n\tstatic getInstance(): UploadingService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t\tthis.#sendingService = SendingService.getInstance();\n\t\tthis.#initUploader();\n\t}\n\n\tasync uploadFromClipboard(params: UploadFromClipboardParams): Promise<{files: UploaderFile[], uploaderId: string}>\n\t{\n\t\tconst { clipboardEvent, dialogId, autoUpload, imagesOnly } = params;\n\n\t\tconst { clipboardData } = clipboardEvent;\n\t\tif (!clipboardData || !isFilePasted(clipboardData))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tclipboardEvent.preventDefault();\n\n\t\tlet files: File[] = await getFilesFromDataTransfer(clipboardData);\n\t\tif (imagesOnly)\n\t\t{\n\t\t\tfiles = files.filter((file) => Utils.file.isImage(file.name));\n\t\t\tif (imagesOnly.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\tconst { uploaderFiles, uploaderId } = await this.#addFiles({\n\t\t\tfiles,\n\t\t\tdialogId,\n\t\t\tautoUpload,\n\t\t});\n\n\t\tif (uploaderFiles.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn uploaderId;\n\t}\n\n\tasync uploadFromInput(params: UploadFromInputParams): Promise<string>\n\t{\n\t\tconst { event, sendAsFile, autoUpload, dialogId } = params;\n\t\tconst rawFiles = Object.values(event.target.files);\n\t\tif (rawFiles.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst { uploaderId } = await this.#addFiles({\n\t\t\tfiles: rawFiles,\n\t\t\tdialogId,\n\t\t\tautoUpload,\n\t\t\tsendAsFile,\n\t\t});\n\n\t\treturn uploaderId;\n\t}\n\n\tasync uploadFromDragAndDrop(params: UploadFromDragAndDrop): Promise<string>\n\t{\n\t\tconst { event, dialogId, autoUpload, sendAsFile } = params;\n\t\tevent.preventDefault();\n\n\t\tconst rawFiles = await getFilesFromDataTransfer(event.dataTransfer);\n\t\tif (rawFiles.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst { uploaderId } = await this.#addFiles({\n\t\t\tfiles: rawFiles,\n\t\t\tdialogId,\n\t\t\tautoUpload,\n\t\t\tsendAsFile,\n\t\t});\n\n\t\treturn uploaderId;\n\t}\n\n\t#createUploader(params: { dialogId: string, autoUpload: boolean }): Promise<string>\n\t{\n\t\tconst { dialogId, autoUpload } = params;\n\n\t\tconst uploaderId = Utils.text.getUuidV4();\n\t\tconst chatId = this.#getChatId(dialogId);\n\n\t\treturn this.checkDiskFolderId(dialogId).then((diskFolderId: number) => {\n\t\t\tthis.#uploaderWrapper.createUploader({\n\t\t\t\tdiskFolderId,\n\t\t\t\tuploaderId,\n\t\t\t\tautoUpload,\n\t\t\t\tchatId,\n\t\t\t\tdialogId,\n\t\t\t});\n\n\t\t\treturn uploaderId;\n\t\t});\n\t}\n\n\t#registerSourceFilesCount({ uploaderId, filesCount })\n\t{\n\t\tthis.#uploaderFilesRegistry[uploaderId].sourceFilesCount = filesCount;\n\t}\n\n\tgetSourceFilesCount(uploaderId: string): number\n\t{\n\t\treturn this.#uploaderFilesRegistry[uploaderId].sourceFilesCount ?? 0;\n\t}\n\n\t#addFiles(params: UploadFilesParams): Promise<{uploaderFiles: UploaderFile[], uploaderId: string}>\n\t{\n\t\tconst { files, dialogId, autoUpload, sendAsFile = false } = params;\n\n\t\treturn this.#createUploader({ dialogId, autoUpload }).then((uploaderId: string) => {\n\t\t\tconst filesForUploader = [];\n\t\t\tfiles.forEach((file) => {\n\t\t\t\tconst preparedFile = this.#prepareFileForUploader(file, dialogId, uploaderId, sendAsFile);\n\t\t\t\tfilesForUploader.push(preparedFile);\n\t\t\t});\n\n\t\t\tconst addedFiles = this.#uploaderWrapper.addFiles(filesForUploader);\n\t\t\tthis.#registerFiles(uploaderId, addedFiles, dialogId, autoUpload);\n\n\t\t\tthis.#registerSourceFilesCount({\n\t\t\t\tfilesCount: files.length,\n\t\t\t\tuploaderId,\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tuploaderFiles: addedFiles,\n\t\t\t\tuploaderId,\n\t\t\t};\n\t\t});\n\t}\n\n\tgetFiles(uploaderId): UploaderFile[]\n\t{\n\t\treturn this.#uploaderWrapper.getFiles(uploaderId);\n\t}\n\n\tstart(uploaderId: string)\n\t{\n\t\tthis.#uploaderFilesRegistry[uploaderId].autoUpload = true;\n\t\tthis.#uploaderWrapper.start(uploaderId);\n\t}\n\n\tuploadFileFromDisk(files, dialogId)\n\t{\n\t\tObject.values(files).forEach((file) => {\n\t\t\tconst messageWithFile = this.#prepareFileFromDisk(file, dialogId);\n\n\t\t\tthis.#addFileFromDiskToModel(messageWithFile).then(() => {\n\t\t\t\tconst message = {\n\t\t\t\t\ttempMessageId: messageWithFile.tempMessageId,\n\t\t\t\t\tfileIds: [messageWithFile.tempFileId],\n\t\t\t\t\tdialogId: messageWithFile.dialogId,\n\t\t\t\t};\n\n\t\t\t\treturn this.#sendingService.sendMessageWithFiles(message);\n\t\t\t}).then(() => {\n\t\t\t\tthis.commitFile({\n\t\t\t\t\tchatId: messageWithFile.chatId,\n\t\t\t\t\ttemporaryFileId: messageWithFile.tempFileId,\n\t\t\t\t\ttempMessageId: messageWithFile.tempMessageId,\n\t\t\t\t\trealFileId: messageWithFile.file.id.slice(1),\n\t\t\t\t\tfromDisk: true,\n\t\t\t\t});\n\t\t\t}).catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('SendingService: sendFilesFromDisk error:', error);\n\t\t\t});\n\t\t});\n\t}\n\n\t#addFileFromDiskToModel(messageWithFile: MessageWithFile): Promise\n\t{\n\t\treturn this.#store.dispatch('files/add', {\n\t\t\tid: messageWithFile.tempFileId,\n\t\t\tchatId: messageWithFile.chatId,\n\t\t\tauthorId: Core.getUserId(),\n\t\t\tname: messageWithFile.file.name,\n\t\t\ttype: Utils.file.getFileTypeByExtension(messageWithFile.file.ext),\n\t\t\textension: messageWithFile.file.ext,\n\t\t\tsize: messageWithFile.file.sizeInt,\n\t\t\tstatus: FileStatus.wait,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.#getCurrentUser().name,\n\t\t});\n\t}\n\n\t#initUploader()\n\t{\n\t\tthis.#uploaderWrapper = new UploaderWrapper();\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileAddStart, (event: BaseEvent) => {\n\t\t\tconst { file } = event.getData();\n\t\t\tthis.#addFileToStore(file);\n\t\t});\n\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileAdd, (event: BaseEvent) => {\n\t\t\tconst { file, uploaderId } = event.getData();\n\t\t\tthis.#updateFilePreviewInStore(file);\n\t\t\tthis.#setPreviewCreatedStatus(uploaderId, file.getId());\n\t\t\tthis.#tryToSendMessage(uploaderId);\n\t\t});\n\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileUploadStart, (event: BaseEvent) => {\n\t\t\tconst { file } = event.getData();\n\t\t\tthis.#updateFileSizeInStore(file);\n\t\t\tthis.emit(UploadingService.event.uploadStart);\n\t\t});\n\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileUploadProgress, (event: BaseEvent) => {\n\t\t\tconst { file } = event.getData();\n\t\t\tthis.#updateFileProgress(file.getId(), file.getProgress(), FileStatus.upload);\n\t\t});\n\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileUploadComplete, async (event: BaseEvent) => {\n\t\t\tconst { file, uploaderId }: {file: UploaderFile, uploaderId: string} = event.getData();\n\t\t\tconst serverFileId: number = file.getServerFileId().toString().slice(1);\n\t\t\tconst temporaryFileId: string = file.getId();\n\t\t\tif (this.#isMediaFile(temporaryFileId))\n\t\t\t{\n\t\t\t\tthis.#setFileMapping({ serverFileId, temporaryFileId });\n\t\t\t}\n\n\t\t\tthis.#updateFileProgress(temporaryFileId, file.getProgress(), FileStatus.wait);\n\n\t\t\tawait this.#uploadPreview(file);\n\t\t\tthis.#setPreviewSentStatus(uploaderId, temporaryFileId);\n\n\t\t\tvoid this.#tryCommit(uploaderId);\n\t\t\tthis.emit(UploadingService.event.uploadComplete);\n\t\t});\n\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileUploadError, (event: BaseEvent) => {\n\t\t\tconst { file, error } = event.getData();\n\t\t\tthis.#updateFileProgress(file.getId(), 0, FileStatus.error);\n\t\t\tthis.#setMessageError(file.getCustomData('tempMessageId'));\n\t\t\tthis.#showError(error);\n\t\t\tLogger.error('UploadingService: upload error', error);\n\t\t\tthis.emit(UploadingService.event.uploadError);\n\t\t});\n\n\t\tthis.#uploaderWrapper.subscribe(UploaderWrapper.events.onFileUploadCancel, (event: BaseEvent) => {\n\t\t\tconst { tempMessageId, tempFileId } = event.getData();\n\t\t\tthis.#cancelUpload(tempMessageId, tempFileId);\n\t\t\tthis.emit(UploadingService.event.uploadCancel);\n\t\t});\n\t}\n\n\t#isMediaFile(fileId: string | number): boolean\n\t{\n\t\tconst mediaFileTypes: Array<string> = [FileType.image, FileType.video];\n\t\tconst file: ?ImModelFile = this.#store.getters['files/get'](fileId);\n\n\t\treturn Boolean(file) && mediaFileTypes.includes(file.type);\n\t}\n\n\t#setFileMapping(options: {serverFileId: number, temporaryFileId: string})\n\t{\n\t\tvoid this.#store.dispatch('files/setTemporaryFileMapping', options);\n\t}\n\n\tcheckDiskFolderId(dialogId: string): Promise<number>\n\t{\n\t\tif (this.#getDiskFolderId(dialogId) > 0)\n\t\t{\n\t\t\treturn Promise.resolve(this.#getDiskFolderId(dialogId));\n\t\t}\n\n\t\tif (this.#isRequestingDiskFolderId)\n\t\t{\n\t\t\treturn this.#diskFolderIdRequestPromise[dialogId];\n\t\t}\n\n\t\tthis.#diskFolderIdRequestPromise[dialogId] = this.#requestDiskFolderId(dialogId);\n\n\t\treturn this.#diskFolderIdRequestPromise[dialogId];\n\t}\n\n\t#requestDiskFolderId(dialogId: string): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#isRequestingDiskFolderId = true;\n\n\t\t\tconst chatId = this.#getChatId(dialogId);\n\t\t\tthis.#restClient.callMethod(RestMethod.imDiskFolderGet, { chat_id: chatId }).then((response) => {\n\t\t\t\tconst { ID: diskFolderId } = response.data();\n\t\t\t\tthis.#isRequestingDiskFolderId = false;\n\t\t\t\tthis.#store.commit('chats/update', {\n\t\t\t\t\tdialogId,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tdiskFolderId,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tresolve(diskFolderId);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.#isRequestingDiskFolderId = false;\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\tcommitFile(params: FileCommitParams)\n\t{\n\t\tconst { temporaryFileId, tempMessageId, chatId, realFileId, fromDisk, messageText = '', sendAsFile = false } = params;\n\n\t\tconst fileIdParams = {};\n\t\tif (fromDisk)\n\t\t{\n\t\t\tfileIdParams.disk_id = realFileId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfileIdParams.upload_id = realFileId.toString().slice(1);\n\t\t}\n\n\t\tthis.#restClient.callMethod(RestMethod.imDiskFileCommit, {\n\t\t\tchat_id: chatId,\n\t\t\tmessage: messageText,\n\t\t\ttemplate_id: tempMessageId,\n\t\t\tfile_template_id: temporaryFileId,\n\t\t\tas_file: sendAsFile ? 'Y' : 'N',\n\t\t\t...fileIdParams,\n\t\t}).catch((error) => {\n\t\t\tthis.#setMessageError(tempMessageId);\n\t\t\tthis.#updateFileProgress(temporaryFileId, 0, FileStatus.error);\n\t\t\tLogger.error('commitFile error', error);\n\t\t});\n\t}\n\n\tcommitMessage(uploaderId: string): Promise\n\t{\n\t\tconst dialogId = this.#uploaderFilesRegistry[uploaderId].dialogId;\n\t\tconst chatId = this.#getChatId(dialogId);\n\n\t\tconst fileIds = this.#uploaderWrapper.getFiles(uploaderId).map((file) => {\n\t\t\treturn file.getServerFileId().toString().slice(1);\n\t\t});\n\n\t\tconst sendAsFile = this.#uploaderWrapper.getFiles(uploaderId).every((file) => {\n\t\t\treturn file.getCustomData('sendAsFile');\n\t\t});\n\n\t\treturn this.#restClient.callMethod(RestMethod.imDiskFileCommit, {\n\t\t\tchat_id: chatId,\n\t\t\tmessage: this.#uploaderFilesRegistry[uploaderId].text,\n\t\t\ttemplate_id: this.#uploaderFilesRegistry[uploaderId].tempMessageId,\n\t\t\t// file_template_id: temporaryFileId,\n\t\t\tas_file: sendAsFile ? 'Y' : 'N',\n\t\t\tupload_id: fileIds,\n\t\t});\n\t}\n\n\tasync #tryCommit(uploaderId: string)\n\t{\n\t\tif (!this.#readyToCommit(uploaderId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.commitMessage(uploaderId);\n\t\tthis.#uploaderWrapper.destroyUploader(uploaderId);\n\t}\n\n\tasync #uploadPreview(file: UploaderFile): Promise\n\t{\n\t\tconst needPreview = this.#getFileType(file.getBinary()) === FileType.video || file.isAnimated();\n\t\tif (!needPreview)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst id = file.getServerFileId().toString().slice(1);\n\t\tconst previewFile = file.getClientPreview();\n\t\tif (!previewFile)\n\t\t{\n\t\t\tfile.setCustomData('sendAsFile', true);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst formData = new FormData();\n\t\tformData.append('id', id);\n\t\tformData.append('previewFile', previewFile, `preview_${file.getName()}.jpg`);\n\n\t\treturn runAction(RestMethod.imDiskFilePreviewUpload, { data: formData }).catch((error) => {\n\t\t\tLogger.error('imDiskFilePreviewUpload request error', error);\n\t\t});\n\t}\n\n\t#prepareFileForUploader(file: File, dialogId: string, uploaderId, sendAsFile: boolean): MessageWithFile\n\t{\n\t\tconst tempMessageId = Utils.text.getUuidV4();\n\t\tconst tempFileId = Utils.text.getUuidV4();\n\t\tconst chatId = this.#getChatId(dialogId);\n\n\t\treturn {\n\t\t\ttempMessageId,\n\t\t\ttempFileId,\n\t\t\tfile,\n\t\t\tdialogId,\n\t\t\tchatId,\n\t\t\tuploaderId,\n\t\t\tsendAsFile,\n\t\t};\n\t}\n\n\t#updateFileProgress(id: string, progress: number, status: string)\n\t{\n\t\tvoid this.#store.dispatch('files/update', {\n\t\t\tid,\n\t\t\tfields: {\n\t\t\t\tprogress: (progress === 100 ? 99 : progress),\n\t\t\t\tstatus,\n\t\t\t},\n\t\t});\n\t}\n\n\t#cancelUpload(tempMessageId: string, tempFileId)\n\t{\n\t\tconst message: ImModelMessage = this.#store.getters['messages/getById'](tempMessageId);\n\t\tif (message)\n\t\t{\n\t\t\tvoid this.#store.dispatch('messages/delete', { id: tempMessageId });\n\t\t\tvoid this.#store.dispatch('files/delete', { id: tempFileId });\n\n\t\t\tconst chat: ImModelChat = this.#store.getters['chats/getByChatId'](message.chatId);\n\t\t\tconst lastMessageId: string | number = this.#store.getters['messages/findLastChatMessageId'](message.chatId);\n\n\t\t\tif (lastMessageId > -1)\n\t\t\t{\n\t\t\t\tvoid this.#store.dispatch('recent/update', {\n\t\t\t\t\tid: chat.dialogId,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tmessageId: lastMessageId,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvoid this.#store.dispatch('recent/delete', {\n\t\t\t\t\tid: chat.dialogId,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t#addFileToStore(file: UploaderFile)\n\t{\n\t\tconst taskId = file.getId();\n\t\tconst fileBinary = file.getBinary();\n\t\tconst previewData = this.#preparePreview(file);\n\t\tconst asFile = file.getCustomData('sendAsFile');\n\n\t\tvoid this.#store.dispatch('files/add', {\n\t\t\tid: taskId,\n\t\t\tchatId: file.getCustomData('chatId'),\n\t\t\tauthorId: Core.getUserId(),\n\t\t\tname: fileBinary.name,\n\t\t\tsize: file.getSize(),\n\t\t\ttype: asFile ? FileType.file : this.#getFileType(fileBinary),\n\t\t\textension: this.#getFileExtension(fileBinary),\n\t\t\tstatus: file.isFailed() ? FileStatus.error : FileStatus.progress,\n\t\t\tprogress: 0,\n\t\t\tauthorName: this.#getCurrentUser().name,\n\t\t\turlDownload: URL.createObjectURL(file.getBinary()),\n\t\t\t...previewData,\n\t\t});\n\t}\n\n\t#updateFilePreviewInStore(file: UploaderFile)\n\t{\n\t\tconst previewData = this.#preparePreview(file);\n\n\t\tvoid this.#store.dispatch('files/update', {\n\t\t\tid: file.getId(),\n\t\t\tfields: {\n\t\t\t\t...previewData,\n\t\t\t},\n\t\t});\n\t}\n\n\t#updateFileSizeInStore(file: UploaderFile)\n\t{\n\t\tvoid this.#store.dispatch('files/update', {\n\t\t\tid: file.getId(),\n\t\t\tfields: {\n\t\t\t\tsize: file.getSize(),\n\t\t\t},\n\t\t});\n\t}\n\n\t#preparePreview(file: UploaderFile): { image: { width: number, height: number }, urlPreview: Blob }\n\t{\n\t\tif (file.getCustomData('sendAsFile'))\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tconst preview = {\n\t\t\tblob: file.getPreviewUrl(),\n\t\t\twidth: file.getPreviewWidth(),\n\t\t\theight: file.getPreviewHeight(),\n\t\t};\n\n\t\tconst previewData = {};\n\t\tif (preview.blob)\n\t\t{\n\t\t\tpreviewData.image = {\n\t\t\t\twidth: preview.width,\n\t\t\t\theight: preview.height,\n\t\t\t};\n\n\t\t\tpreviewData.urlPreview = preview.blob;\n\t\t}\n\n\t\tif (file.getClientPreview())\n\t\t{\n\t\t\tpreviewData.urlPreview = URL.createObjectURL(file.getClientPreview());\n\t\t}\n\n\t\treturn previewData;\n\t}\n\n\t#getDiskFolderId(dialogId: string): number\n\t{\n\t\treturn this.#getDialog(dialogId).diskFolderId;\n\t}\n\n\t#getFileType(file: File): string\n\t{\n\t\tlet fileType = FileType.file;\n\t\tif (file.type.startsWith('image'))\n\t\t{\n\t\t\tfileType = FileType.image;\n\t\t}\n\t\telse if (file.type.startsWith('video'))\n\t\t{\n\t\t\tfileType = FileType.video;\n\t\t}\n\n\t\treturn fileType;\n\t}\n\n\t#getFileExtension(file: File): string\n\t{\n\t\treturn file.name.split('.').splice(-1)[0];\n\t}\n\n\t#getDialog(dialogId: string): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/get'](dialogId);\n\t}\n\n\t#getCurrentUser(): ImModelUser\n\t{\n\t\tconst userId = Core.getUserId();\n\n\t\treturn this.#store.getters['users/get'](userId);\n\t}\n\n\t#getChatId(dialogId: string): ?number\n\t{\n\t\treturn this.#getDialog(dialogId)?.chatId;\n\t}\n\n\t#registerFiles(uploaderId: string, files: UploaderFile[], dialogId: string, autoUpload: boolean)\n\t{\n\t\tif (!this.#uploaderFilesRegistry[uploaderId])\n\t\t{\n\t\t\tthis.#uploaderFilesRegistry[uploaderId] = {\n\t\t\t\tpreviewCreatedStatus: {},\n\t\t\t\tpreviewSentStatus: {},\n\t\t\t\tdialogId,\n\t\t\t\ttext: '',\n\t\t\t\tautoUpload,\n\t\t\t};\n\t\t}\n\n\t\tfiles.forEach((file) => {\n\t\t\tconst fileId = file.getId();\n\t\t\tif (!this.#uploaderFilesRegistry[uploaderId].previewCreatedStatus)\n\t\t\t{\n\t\t\t\tthis.#uploaderFilesRegistry[uploaderId].previewCreatedStatus = {};\n\t\t\t}\n\n\t\t\tthis.#uploaderFilesRegistry[uploaderId].previewCreatedStatus[fileId] = false;\n\t\t\tthis.#uploaderFilesRegistry[uploaderId].previewSentStatus[fileId] = false;\n\t\t});\n\t}\n\n\t#unregisterFiles(uploaderId: string, files: UploaderFile[])\n\t{\n\t\tconst entry = this.#uploaderFilesRegistry[uploaderId];\n\t\tif (entry)\n\t\t{\n\t\t\tfiles.forEach((file: UploaderFile) => {\n\t\t\t\tconst fileId = file.getId();\n\t\t\t\tif (this.#uploaderFilesRegistry[uploaderId].previewCreatedStatus)\n\t\t\t\t{\n\t\t\t\t\tdelete this.#uploaderFilesRegistry[uploaderId].previewCreatedStatus[fileId];\n\t\t\t\t\tdelete this.#uploaderFilesRegistry[uploaderId].previewSentStatus[fileId];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#setPreviewCreatedStatus(uploaderId: string, fileId: string)\n\t{\n\t\tthis.#uploaderFilesRegistry[uploaderId].previewCreatedStatus[fileId] = true;\n\t}\n\n\t#setPreviewSentStatus(uploaderId: string, fileId: string)\n\t{\n\t\tthis.#uploaderFilesRegistry[uploaderId].previewSentStatus[fileId] = true;\n\t}\n\n\t#setMessagesText(uploaderId: string, text: string)\n\t{\n\t\tthis.#uploaderFilesRegistry[uploaderId].text = text;\n\t}\n\n\t#setAutoUpload(uploaderId: string, autoUploadFlag: boolean)\n\t{\n\t\tthis.#uploaderFilesRegistry[uploaderId].autoUpload = autoUploadFlag;\n\t}\n\n\t// we don't use it now, because we always send several files in ONE message\n\t// noinspection JSUnusedGlobalSymbols\n\tsendSeparateMessagesWithFiles(params: { uploaderId: string, text: string})\n\t{\n\t\tconst { uploaderId, text } = params;\n\n\t\tthis.#setMessagesText(uploaderId, text);\n\t\tthis.#setAutoUpload(uploaderId, true);\n\t\tthis.#tryToSendMessages(uploaderId);\n\t}\n\n\tsendMessageWithFiles(params: { uploaderId: string, text: string})\n\t{\n\t\tconst { uploaderId, text } = params;\n\n\t\tthis.#setMessagesText(uploaderId, text);\n\t\tthis.#setAutoUpload(uploaderId, true);\n\t\tthis.#tryToSendMessage(uploaderId);\n\t}\n\n\t#createMessagesFromFiles(uploaderId): {comment: {text: string, dialogId: string}, files: []}\n\t{\n\t\tconst messagesToSend = {\n\t\t\tcomment: {},\n\t\t\tfiles: [],\n\t\t};\n\n\t\tconst files = this.getFiles(uploaderId);\n\t\tconst text = this.#uploaderFilesRegistry[uploaderId].text;\n\t\tconst dialogId = this.#uploaderFilesRegistry[uploaderId].dialogId;\n\t\tconst hasText = text.length > 0;\n\n\t\t// if we have more than one file and text, we need to send text message first\n\t\tif (files.length > 1 && hasText)\n\t\t{\n\t\t\tmessagesToSend.comment = { dialogId, text };\n\t\t}\n\n\t\tfiles.forEach((file) => {\n\t\t\tif (file.getError())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst messageId = Utils.text.getUuidV4();\n\n\t\t\tfile.setCustomData('messageId', messageId);\n\t\t\tif (files.length === 1 && hasText)\n\t\t\t{\n\t\t\t\tfile.setCustomData('messageText', text);\n\t\t\t}\n\n\t\t\tmessagesToSend.files.push({\n\t\t\t\tfileIds: [file.getId()],\n\t\t\t\ttempMessageId: file.getCustomData('tempMessageId'),\n\t\t\t\tdialogId,\n\t\t\t\ttext: file.getCustomData('messageText') ?? '',\n\t\t\t});\n\t\t});\n\n\t\treturn messagesToSend;\n\t}\n\n\t#createMessageFromFiles(uploaderId): {text: string, dialogId: string, tempMessageId: string, fileIds: []}\n\t{\n\t\tconst tempMessageId = Utils.text.getUuidV4();\n\t\tthis.#uploaderFilesRegistry[uploaderId].tempMessageId = tempMessageId;\n\n\t\tconst fileIds = [];\n\t\tconst files = this.getFiles(uploaderId);\n\t\tfiles.forEach((file) => {\n\t\t\tif (!file.getError())\n\t\t\t{\n\t\t\t\tfileIds.push(file.getId());\n\t\t\t}\n\t\t});\n\n\t\tconst text = this.#uploaderFilesRegistry[uploaderId].text;\n\t\tconst dialogId = this.#uploaderFilesRegistry[uploaderId].dialogId;\n\n\t\treturn {\n\t\t\tfileIds,\n\t\t\ttempMessageId,\n\t\t\tdialogId,\n\t\t\ttext,\n\t\t};\n\t}\n\n\t#readyToAddMessages(uploaderId): boolean\n\t{\n\t\tif (\n\t\t\t!this.#uploaderFilesRegistry[uploaderId]\n\t\t\t|| !this.#uploaderFilesRegistry[uploaderId].autoUpload\n\t\t\t|| this.#uploaderFilesRegistry[uploaderId].wasSent\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { previewCreatedStatus } = this.#uploaderFilesRegistry[uploaderId];\n\n\t\treturn Object.values(previewCreatedStatus).every((flag) => flag === true);\n\t}\n\n\t#readyToCommit(uploaderId: string): boolean\n\t{\n\t\tif (!this.#uploaderFilesRegistry[uploaderId])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { previewSentStatus } = this.#uploaderFilesRegistry[uploaderId];\n\n\t\treturn Object.values(previewSentStatus).every((flag) => flag === true);\n\t}\n\n\t#tryToSendMessage(uploaderId: string)\n\t{\n\t\tif (!this.#readyToAddMessages(uploaderId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#uploaderFilesRegistry[uploaderId].wasSent = true;\n\n\t\tconst message = this.#createMessageFromFiles(uploaderId);\n\t\tvoid this.#sendingService.sendMessageWithFiles(message);\n\t\tthis.start(uploaderId);\n\t}\n\n\t// we don't use it now, because we always send several files in ONE message\n\t// noinspection JSUnusedGlobalSymbols\n\t#tryToSendMessages(uploaderId: string)\n\t{\n\t\tif (!this.#readyToAddMessages(uploaderId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#uploaderFilesRegistry[uploaderId].wasSent = true;\n\t\tconst { comment, files } = this.#createMessagesFromFiles(uploaderId);\n\t\tif (comment.text)\n\t\t{\n\t\t\tvoid this.#sendingService.sendMessage(comment);\n\t\t}\n\n\t\tfiles.forEach((message) => {\n\t\t\tvoid this.#sendingService.sendMessageWithFiles(message);\n\t\t});\n\t\tthis.start(uploaderId);\n\t}\n\n\t#prepareFileFromDisk(file: FileFromDisk, dialogId: string): MessageWithFile\n\t{\n\t\tconst tempMessageId = Utils.text.getUuidV4();\n\t\tconst realFileId = file.id.slice(1); // 'n123' => '123'\n\t\tconst tempFileId = `${tempMessageId}|${realFileId}`;\n\n\t\treturn {\n\t\t\ttempMessageId,\n\t\t\ttempFileId,\n\t\t\tdialogId,\n\t\t\tfile,\n\t\t\tchatId: this.#getDialog(dialogId).chatId,\n\t\t};\n\t}\n\n\t#showError(error: UploaderError)\n\t{\n\t\tif (error.getCode() === 'MAX_FILE_SIZE_EXCEEDED')\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: `${error.getMessage()}<br>${error.getDescription()}`,\n\t\t\t});\n\t\t}\n\t}\n\n\t#setMessageError(tempMessageId: string)\n\t{\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: tempMessageId,\n\t\t\tfields: {\n\t\t\t\terror: true,\n\t\t\t},\n\t\t});\n\t}\n\n\tremoveFileFromUploader(options: { uploaderId: string, filesIds: Array<string> })\n\t{\n\t\tconst { uploaderId, filesIds } = options;\n\n\t\tconst files: Array<UploaderFile> = this.#uploaderWrapper.getFiles(uploaderId).filter((file: UploaderFile) => {\n\t\t\treturn filesIds.includes(file.getId());\n\t\t});\n\n\t\tfiles.forEach((file: UploaderFile) => {\n\t\t\tfile.remove();\n\t\t});\n\n\t\tthis.#unregisterFiles(uploaderId, files);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#uploaderWrapper.destroy();\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\n\nexport class SettingsService\n{\n\tchangeSetting(settingName: string, value: any): Promise\n\t{\n\t\tLogger.warn('SettingsService: changeSetting', settingName, value);\n\t\tCore.getStore().dispatch('application/settings/set', {\n\t\t\t[settingName]: value,\n\t\t});\n\n\t\treturn runAction(RestMethod.imV2SettingsGeneralUpdate, {\n\t\t\tdata: {\n\t\t\t\tuserId: Core.getUserId(),\n\t\t\t\tname: settingName,\n\t\t\t\tvalue,\n\t\t\t},\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('SettingsService: changeSetting error', error);\n\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\n\nexport class LinesService\n{\n\tasync getDialogIdByUserCode(userCode: string): Promise<string>\n\t{\n\t\tconst result = await Core.getRestClient().callMethod(RestMethod.linesDialogGet, {\n\t\t\tUSER_CODE: userCode,\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('LinesService: error getting dialog id', error);\n\t\t});\n\n\t\tconst { dialog_id: dialogId } = result.data();\n\n\t\treturn dialogId;\n\t}\n}\n","import { ChatType } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport { ChatService } from '../registry';\n\nexport class CopilotService\n{\n\tasync createChat({ roleCode }: {roleCode: string}): Promise<string>\n\t{\n\t\tconst chatService = new ChatService();\n\t\tconst { newDialogId, newChatId } = await chatService.createChat({\n\t\t\ttype: ChatType.copilot,\n\t\t\tcopilotMainRole: roleCode,\n\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#onCreateError(error);\n\t\t\t});\n\n\t\tthis.#sendAnalytics({ chatId: newChatId, dialogId: newDialogId });\n\n\t\tawait chatService.loadChatWithMessages(newDialogId)\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#onCreateError(error);\n\t\t\t});\n\n\t\treturn newDialogId;\n\t}\n\n\t#onCreateError(error: Error)\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error('Copilot chat create error', error);\n\t\tthrow new Error('Copilot chat create error');\n\t}\n\n\t#sendAnalytics({ chatId, dialogId })\n\t{\n\t\tAnalytics.getInstance().copilot.onCreateChat(chatId);\n\t\tAnalytics.getInstance().ignoreNextChatOpen(dialogId);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { runAction } from 'im.v2.lib.rest';\nimport { RestMethod } from 'im.v2.const';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nexport const CommentsService = {\n\tsubscribe(messageId: number): Promise\n\t{\n\t\tCore.getStore().dispatch('messages/comments/subscribe', messageId);\n\n\t\treturn runAction(RestMethod.imV2ChatCommentSubscribe, {\n\t\t\tdata: {\n\t\t\t\tpostId: messageId,\n\t\t\t\tcreateIfNotExists: true,\n\t\t\t\tautoJoin: true,\n\t\t\t},\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('CommentsService: subscribe error', error);\n\t\t});\n\t},\n\n\tunsubscribe(messageId: number): Promise\n\t{\n\t\tCore.getStore().dispatch('messages/comments/unsubscribe', messageId);\n\n\t\treturn runAction(RestMethod.imV2ChatCommentUnsubscribe, {\n\t\t\tdata: {\n\t\t\t\tpostId: messageId,\n\t\t\t\tcreateIfNotExists: true,\n\t\t\t\tautoJoin: true,\n\t\t\t},\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('CommentsService: unsubscribe error', error);\n\t\t});\n\t},\n\n\treadAllChannelComments(channelDialogId: string): Promise\n\t{\n\t\tconst chat: ImModelChat = Core.getStore().getters['chats/get'](channelDialogId, true);\n\t\tconst currentChannelCounter: number = Core.getStore().getters['counters/getChannelCommentsCounter'](chat.chatId);\n\t\tif (currentChannelCounter === 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tCore.getStore().dispatch('counters/readAllChannelComments', chat.chatId);\n\n\t\treturn runAction(RestMethod.imV2ChatCommentReadAll, {\n\t\t\tdata: { dialogId: channelDialogId },\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('CommentsService: readAllChannelComments error', error);\n\t\t});\n\t},\n};\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { InputActionType } from 'im.v2.lib.input-action';\n\nconst ACTIVE_STATUS_DURATION = 15000;\nconst REQUEST_DELAY = 5000;\n\nexport class InputSenderService\n{\n\t#dialogId: string;\n\n\t#statusTimerMap: { [InputActionType]: number } = {};\n\t#requestDelayMap: { [InputActionType]: number } = {};\n\n\tconstructor(dialogId: string)\n\t{\n\t\tthis.#dialogId = dialogId;\n\t}\n\n\tstartAction(actionType: InputActionType)\n\t{\n\t\tif (this.#isActive(actionType) || this.#isSelfChat())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#statusTimerMap[actionType] = setTimeout(() => {\n\t\t\tdelete this.#statusTimerMap[actionType];\n\t\t}, ACTIVE_STATUS_DURATION);\n\n\t\tthis.#requestDelayMap[actionType] = setTimeout(() => {\n\t\t\tthis.#sendRequest(actionType);\n\t\t}, REQUEST_DELAY);\n\t}\n\n\tstopAction(actionType: InputActionType)\n\t{\n\t\tclearTimeout(this.#statusTimerMap[actionType]);\n\t\tdelete this.#statusTimerMap[actionType];\n\t\tclearTimeout(this.#requestDelayMap[actionType]);\n\t\tdelete this.#requestDelayMap[actionType];\n\t}\n\n\t#isActive(actionType: InputActionType): boolean\n\t{\n\t\treturn Boolean(this.#statusTimerMap[actionType]);\n\t}\n\n\t#sendRequest(actionType: InputActionType)\n\t{\n\t\tconst queryParams = {\n\t\t\tdialogId: this.#dialogId,\n\t\t\ttype: actionType,\n\t\t};\n\n\t\trunAction(RestMethod.imV2ChatInputActionNotify, {\n\t\t\tdata: queryParams,\n\t\t}).catch((error) => {\n\t\t\tconsole.error('InputSenderService: sendRequest error', error);\n\t\t});\n\t}\n\n\t#isSelfChat(): boolean\n\t{\n\t\treturn Number(this.#dialogId) === Core.getUserId();\n\t}\n}\n"],"names":["RecentDataExtractor","constructor","params","rawData","withBirthdays","getItems","items","copilot","forEach","item","users","Object","values","chats","messages","files","recentItems","user","id","chat","existingRecentItem","Core","getStore","getters","options","default_user_record","message","FakeMessagePrefix","viewedByOthers","status","MessageStatus","delivered","existingMessage","Type","isArrayFilled","attach","isPlainObject","file","existingFile","messageId","birthdayList","counter","dialogId","chatId","chat_id","avatar","color","name","type","ChatType","role","UserRole","member","isBirthdayPlaceholder","fileId","existingMessageFilesIds","map","Number","parseInt","setOfFileIds","Set","RecentService","dataIsPreloaded","firstPageIsLoaded","itemsPerPage","isLoading","pagesLoaded","hasMoreItemsToLoad","lastMessageDate","getInstance","instance","getCollection","loadFirstPage","ignorePreloadedItems","Logger","warn","Promise","resolve","result","requestItems","firstPage","loadNextPage","setPreloadedData","hasMore","getLastMessageDate","updateModels","hideChat","recentItem","dispatch","chatIsOpened","LayoutManager","clearCurrentLayoutEntityId","deleteLastOpenedElementById","getRestClient","callMethod","RestMethod","imRecentHide","DIALOG_ID","catch","error","console","queryParams","getQueryParams","getQueryMethod","data","imRecentList","SKIP_OPENLINES","LIMIT","LAST_MESSAGE_DATE","GET_ORIGINAL_TEXT","PARSE_TEXT","getModelSaveMethod","extractor","getExtractorOptions","extractedItems","usersPromise","dialoguesPromise","messagesPromise","filesPromise","recentPromise","copilotManager","CopilotManager","copilotPromise","handleRecentListResponse","all","length","slice","date","DeleteService","deleteChat","deleteResult","runAction","imV2ChatDelete","Error","deleteCollab","socialnetworkCollabDelete","fields","inited","ChatDataExtractor","restResult","getChatId","getDialogId","isOpenlinesChat","lines","isCopilotChat","getChats","mainChat","hasPrevPage","hasNextPage","tariffRestrictions","UserManager","getDialogForUser","getFiles","getUsers","getAdditionalUsers","usersShort","getMessages","getCommentInfo","commentInfo","getCollabInfo","collabInfo","getMessagesToStore","additionalMessages","getPinnedMessageIds","pinnedMessageIds","pins","pin","push","getReactions","reactions","getCopilot","getSession","session","LoadService","loadChat","imV2ChatShallowLoad","loadChatByChatId","messageLimit","MessageService","getMessageRequestLimit","imV2ChatLoad","loadChatWithMessages","loadChatWithContext","imV2ChatLoadInContext","prepareDialogId","Utils","dialog","isExternalId","imV2ChatGetDialogId","externalId","then","loadComments","postId","autoJoin","createIfNotExists","loadCommentInfo","channelDialogId","messageIds","imV2ChatMessageCommentInfoList","userManager","addUsersToModel","resetChat","actionName","actionResult","errors","loadedDialogId","loading","chatsPromise","clearCollection","pinnedMessages","handleChatLoadResponse","openLinesPromise","OpenLinesManager","collabPromise","contextId","setLastOpenedElement","Layout","Messenger","openCopilot","openLines","currentLayoutName","getLayout","optionOpenLinesV2Activated","FeatureManager","isFeatureAvailable","Feature","openLinesV2","isStringFilled","firstError","code","AccessErrorCode","chatNotFound","Loc","getMessage","text","BX","UI","Notification","Center","notify","content","PRIVATE_CHAT","OPEN_CHAT","CreateService","createChat","chatConfig","preparedFields","createResult","imV2ChatAdd","newChatId","newDialogId","createCollab","collabConfig","ownerId","title","description","avatarId","moderatorMembers","prepareSelectorIds","permissions","socialnetworkCollabCreate","preparedConfig","getBase64","managers","members","allMembers","toUpperCase","entityType","memberEntities","searchable","isAvailableInSearch","manageUsersAdd","manageUsersDelete","manageUi","manageSettings","manageMessages","conferencePassword","copilotMainRole","entries","key","value","isUndefined","collab","chatType","toLowerCase","userCounter","owner","Analytics","ignoreNextChatOpen","UpdateService","prepareAvatar","avatarFile","isResizableImage","reject","MAX_AVATAR_SIZE","preview","resizedAvatar","resizeImage","width","height","changeAvatar","avatarInBase64","imV2ChatUpdateAvatar","updateChat","updateResult","imV2ChatUpdate","updateCollab","payload","groupSettings","addModeratorMembers","deleteModeratorMembers","socialnetworkCollabUpdate","getMemberEntities","imV2ChatMemberEntitiesList","addedMemberEntities","deletedMemberEntities","addedManagers","deletedManagers","managerList","getChatRoleForUser","RenameService","renameChat","newName","oldName","imChatUpdateTitle","dialog_id","MuteService","DEBOUNCE_TIME","Runtime","debounce","muteChat","action","unmuteChat","imChatMute","actionText","actionType","PinService","pinChat","ACTION","imRecentPin","unpinChat","READ_TIMEOUT","ReadService","readAll","imV2ChatReadAll","readDialog","imV2ChatRead","unreadDialog","imV2ChatUnread","readMessage","add","clearTimeout","readTimeout","setTimeout","rawChatId","readChatQueuedMessages","clearDialogMark","markedId","unread","onlyRecent","queueChatId","size","copiedMessageIds","readMessagesCount","readResult","maxMessageId","Math","max","lastReadId","lastId","newCounter","counters","parentChatId","comment","imV2ChatMessageRead","ids","actionUuid","UuidManager","getActionUuid","DeleteUserErrorCode","userInvitedFromStructure","userNotFound","UserService","addToChat","addConfig","hide_history","showHistory","imChatUserAdd","kickUserFromChat","userId","imV2ChatDeleteUser","kickUserFromCollab","USER_ENTITY_ID","socialnetworkMemberDelete","leaveChat","getUserId","leaveCollab","socialnetworkMemberLeave","joinChat","imV2ChatJoin","addManager","includes","newManagerList","userIds","imV2ChatAddManagers","removeManager","filter","managerId","imV2ChatDeleteManagers","NotificationTextByErrorCode","default","errorCode","notificationText","autoHideDelay","answer","ChatService","loadUnread","lastUnreadMessageId","query","order","limit","MESSAGE_REQUEST_LIMIT","imV2ChatMessageTail","loadHistory","lastHistoryMessageId","hasPreparedHistoryMessages","drawPreparedHistoryMessages","hasPreparedUnreadMessages","drawPreparedUnreadMessages","loadContext","imV2ChatMessageGetContext","range","callBatch","finally","loadContextByChatId","commentChatId","targetCommentInfo","find","targetMessageId","reloadMessageList","savedPositionMessageId","wasInitedBefore","loadInitialMessages","imV2ChatMessageList","rawMessages","lastMessageId","newMaxId","messagesCollection","updateModelsPromise","dialogPromise","setUsersToModel","reactionsPromise","additionalMessagesPromise","commentInfoPromise","flag","restrictions","isHistoryLimitExceeded","messageNotFound","messageDelete","onNotFoundNotification","pinMessage","imV2ChatMessagePin","unpinMessage","imV2ChatMessageUnpin","EditService","editMessageText","imV2ChatMessageUpdate","isEdited","deleteMessages","deleteMessageIds","isUuidV4","isDeleted","replyId","alwaysCompleteDeleteChats","channel","openChannel","generalChannel","neverCompleteDeleteChats","newLastId","imV2ChatMessageDelete","previousMessage","EventEmitter","emit","EventType","onMessageDeleted","MarkService","markMessage","imV2ChatMessageMark","FavoriteService","addMessageToFavorite","imChatFavoriteAdd","MESSAGE_ID","removeMessageFromFavorite","imChatFavoriteDelete","SendingService","sendMessage","sendMessageWithFiles","fileIds","force","forwardMessages","forwardIds","commentMessage","sortForwardIds","sort","forwardUuidMap","forwardedMessages","retrySendMessage","tempMessageId","unsentMessage","forward","forwardId","split","sendCopilotPrompt","sendResult","temporaryId","oldId","newId","defaultFields","authorId","sending","getUuidV4","FILE_ID","promptCode","messageService","hasMessageText","hasMessageFile","templateId","queryData","toString","imV2ChatMessageSend","scrollToBottom","threshold","DialogScrollThreshold","none","halfScreenUp","response","uuidMap","uuid","keys","preparedMessages","isForward","chatTitle","requestPrams","addPromises","startsWith","currentUser","methodName","requestParams","NotificationService","store","restClient","limitPerPage","lastType","notificationsToDelete","deleteWithDebounce","deleteRequest","delete","notificationId","sendConfirmAction","NOTIFY_ID","NOTIFY_VALUE","sendQuickAnswer","callbackSuccess","callbackError","imNotifyAnswer","notify_id","answer_text","idsToDelete","clear","imNotifyGetQueryParams","CONVERT_TEXT","batchQueryParams","imNotifyGet","imNotifySchemaGet","LAST_ID","LAST_TYPE","handleResponse","imNotifyGetResponse","isLastPage","notifications","getLastItemId","getLastItemType","collection","getItemType","notify_type","NotificationTypesCodes","confirm","simple","destroy","DiskService","file_id","imDiskFileDelete","save","imV2DiskFileSave","MAX_FILES_IN_ONE_MESSAGE","UploaderWrapper","setEventNamespace","eventNamespace","bind","subscribe","uploader","cancel","createUploader","diskFolderId","uploaderId","autoUpload","Uploader","controller","multiple","controllerOptions","folderId","imageResizeWidth","imageResizeHeight","imageResizeMode","imageResizeFilter","getCustomData","isAnimated","imageResizeMimeType","imageResizeMimeTypeMode","imagePreviewHeight","imagePreviewWidth","treatOversizeImageAsFile","ignoreUnknownImageTypes","maxFileSize","events","UploaderEvent","FILE_ADD_START","event","onFileAddStart","FILE_UPLOAD_START","onFileUploadStart","FILE_ADD","getData","onFileAdd","FILE_UPLOAD_PROGRESS","onFileUploadProgress","FILE_UPLOAD_COMPLETE","onFileUploadComplete","ERROR","onFileUploadError","FILE_ERROR","MAX_FILE_COUNT_EXCEEDED","onMaxFileCountExceeded","UPLOAD_COMPLETE","onUploadComplete","start","setAutoUpload","destroyUploader","removeFilesFromServer","addFiles","tasks","firstTenTasks","addedFiles","task","unsubscribe","addFile","tempFileId","customData","sendAsFile","onFileUploadCancel","uploaderList","getFile","remove","EVENT_NAMESPACE","UploadingService","uploadFromClipboard","clipboardEvent","imagesOnly","clipboardData","isFilePasted","preventDefault","getFilesFromDataTransfer","isImage","uploaderFiles","uploadFromInput","rawFiles","target","uploadFromDragAndDrop","dataTransfer","getSourceFilesCount","sourceFilesCount","uploadFileFromDisk","messageWithFile","commitFile","temporaryFileId","realFileId","fromDisk","checkDiskFolderId","messageText","fileIdParams","disk_id","upload_id","imDiskFileCommit","template_id","file_template_id","as_file","FileStatus","commitMessage","getServerFileId","every","sendSeparateMessagesWithFiles","removeFileFromUploader","filesIds","getId","filesCount","filesForUploader","preparedFile","getFileTypeByExtension","ext","extension","sizeInt","wait","progress","authorName","uploadStart","getProgress","upload","serverFileId","uploadComplete","uploadError","uploadCancel","mediaFileTypes","FileType","image","video","Boolean","imDiskFolderGet","ID","commit","needPreview","getBinary","previewFile","getClientPreview","setCustomData","formData","FormData","append","getName","imDiskFilePreviewUpload","taskId","fileBinary","previewData","asFile","getSize","isFailed","urlDownload","URL","createObjectURL","blob","getPreviewUrl","getPreviewWidth","getPreviewHeight","urlPreview","fileType","splice","previewCreatedStatus","previewSentStatus","entry","autoUploadFlag","messagesToSend","hasText","getError","wasSent","getCode","getDescription","SettingsService","changeSetting","settingName","imV2SettingsGeneralUpdate","LinesService","getDialogIdByUserCode","userCode","linesDialogGet","USER_CODE","CopilotService","roleCode","chatService","onCreateChat","CommentsService","imV2ChatCommentSubscribe","imV2ChatCommentUnsubscribe","readAllChannelComments","currentChannelCounter","imV2ChatCommentReadAll","ACTIVE_STATUS_DURATION","REQUEST_DELAY","InputSenderService","startAction","stopAction","imV2ChatInputActionNotify"],"mappings":";;;;;;;CAGmF;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AA2BnF,CAAO,MAAMA,mBAAmB,CAChC;GAUCC,WAAW,CAACC,MAA8D,EAC1E;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAPoC;;KAAE;OAAA;OAAA,OACF;;KAAE;OAAA;OAAA,OACI;;KAAE;OAAA;OAAA,OACL;;KAAE;OAAA;OAAA,OACO;;KAI/C,MAAM;OAAEC,OAAO;OAAEC,aAAa,GAAG;MAAM,GAAGF,MAAM;KAChD,4CAAI,oCAAkBE,aAAa;KACnC,4CAAI,8BAAeD,OAAO;;GAG3BE,QAAQ,GACR;KACC,MAAM;OAAEC,KAAK,GAAG,EAAE;OAAEC;MAAS,2CAAG,IAAI,2BAAY;KAChDD,KAAK,CAACE,OAAO,CAAEC,IAAmB,IAAK;OACtC,4CAAI,8BAAcA,IAAI;OACtB,4CAAI,8BAAcA,IAAI;OACtB,4CAAI,oCAAiBA,IAAI;OACzB,4CAAI,0CAAoBA,IAAI;MAC5B,CAAC;KAEF,4CAAI;KAEJ,OAAO;OACNC,KAAK,EAAEC,MAAM,CAACC,MAAM,yCAAC,IAAI,kBAAQ;OACjCC,KAAK,EAAEF,MAAM,CAACC,MAAM,yCAAC,IAAI,kBAAQ;OACjCE,QAAQ,EAAEH,MAAM,CAACC,MAAM,yCAAC,IAAI,wBAAW;OACvCG,KAAK,EAAEJ,MAAM,CAACC,MAAM,yCAAC,IAAI,kBAAQ;OACjCI,WAAW,EAAEL,MAAM,CAACC,MAAM,yCAAC,IAAI,8BAAc;OAC7CL;MACA;;CA2KH;CAAC,uBAxKaE,IAAmB,EAChC;GAAA;GACC,IAAI,cAAAA,IAAI,CAACQ,IAAI,aAAT,WAAWC,EAAE,IAAI,CAAC,4CAAI,kBAAQT,IAAI,CAACQ,IAAI,CAACC,EAAE,CAAC,EAC/C;KACC,4CAAI,kBAAQT,IAAI,CAACQ,IAAI,CAACC,EAAE,CAAC,GAAGT,IAAI,CAACQ,IAAI;;CAEvC;CAAC,uBAEYR,IAAmB,EAChC;GACC,IAAIA,IAAI,CAACU,IAAI,EACb;KACC,4CAAI,kBAAQV,IAAI,CAACS,EAAE,CAAC,2CAAG,IAAI,wCAAmBT,IAAI,CAAC;KAEnD,IAAIA,IAAI,CAACQ,IAAI,CAACC,EAAE,IAAI,CAAC,4CAAI,kBAAQT,IAAI,CAACQ,IAAI,CAACC,EAAE,CAAC,EAC9C;OACC,4CAAI,kBAAQT,IAAI,CAACQ,IAAI,CAACC,EAAE,CAAC,2CAAG,IAAI,gEAA+BT,IAAI,CAACQ,IAAI,CAAC;;IAE1E,MACI,IAAIR,IAAI,CAACQ,IAAI,CAACC,EAAE,EACrB;KACC,MAAME,kBAAkB,GAAGC,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,YAAY,CAAC,CAACd,IAAI,CAACQ,IAAI,CAACC,EAAE,CAAC;;KAE9E,IAAI,CAACE,kBAAkB,IAAI,CAACX,IAAI,CAACe,OAAO,CAACC,mBAAmB,EAC5D;OACC,4CAAI,kBAAQhB,IAAI,CAACQ,IAAI,CAACC,EAAE,CAAC,2CAAG,IAAI,4CAAqBT,IAAI,CAAC;;;CAG7D;CAAC,0BAEeA,IAAmB,EACnC;GACC,MAAMiB,OAAO,GAAGjB,IAAI,CAACiB,OAAO;GAC5B,IAAI,CAACA,OAAO,EACZ;KACC;;GAGD,IAAIA,OAAO,CAACR,EAAE,KAAK,CAAC,EACpB;KACCQ,OAAO,CAACR,EAAE,GAAI,GAAES,6BAAkB,IAAGlB,IAAI,CAACS,EAAG,EAAC;;GAG/C,IAAIU,cAAc,GAAG,KAAK;GAC1B,IAAIF,OAAO,CAACG,MAAM,KAAKC,yBAAa,CAACC,SAAS,EAC9C;KACCH,cAAc,GAAG,IAAI;;GAGtB,MAAMI,eAA+B,GAAGX,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAACG,OAAO,CAACR,EAAE,CAAC;;GAE/F,IAAIe,cAAI,CAACC,aAAa,CAACF,eAAe,oBAAfA,eAAe,CAAEG,MAAM,CAAC,EAC/C;KACC,OAAOT,OAAO,CAACS,MAAM;;GAGtB,IAAIF,cAAI,CAACG,aAAa,CAACV,OAAO,CAACW,IAAI,CAAC,EACpC;KACC,MAAMA,IAAgB,GAAGX,OAAO,CAACW,IAAI;KACrC,IAAIL,eAAe,EACnB;;;OAGCN,OAAO,CAACX,KAAK,2CAAG,IAAI,gCAAeiB,eAAe,EAAEK,IAAI,CAACnB,EAAE,CAAC;MAC5D,MAED;OACCQ,OAAO,CAACX,KAAK,GAAG,CAACsB,IAAI,CAACnB,EAAE,CAAC;;KAG1B,MAAMoB,YAAY,GAAGjB,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,WAAW,CAAC,CAACc,IAAI,CAACnB,EAAE,CAAC;;KAElE,IAAI,CAACoB,YAAY,EACjB;OACC,4CAAI,kBAAQD,IAAI,CAACnB,EAAE,CAAC,GAAGmB,IAAI;;;GAI7B,4CAAI,wBAAWX,OAAO,CAACR,EAAE,CAAC,GAAG;KAAE,GAAGQ,OAAO;KAAEE;IAAgB;CAC5D;CAAC,6BAEkBnB,IAAmB,EACtC;GAAA;GACC,MAAM8B,SAAS,wCAAG9B,IAAI,CAACiB,OAAO,qBAAZ,cAAcR,EAAE,+BAAI,CAAC;GACvC,4CAAI,8BAAcT,IAAI,CAACS,EAAE,CAAC,GAAG;KAAE,GAAGT,IAAI;KAAE8B;IAAW;CACpD;CAAC,kCAGD;GACC,IAAI,yCAAC,IAAI,iCAAe,EACxB;KACC;;GAGD,MAAM;KAAEC,YAAY,GAAG;IAAI,2CAAG,IAAI,2BAAY;GAC9CA,YAAY,CAAChC,OAAO,CAAEC,IAAI,IAAK;KAC9B,IAAI,CAAC,4CAAI,kBAAQA,IAAI,CAACS,EAAE,CAAC,EACzB;OACC,4CAAI,kBAAQT,IAAI,CAACS,EAAE,CAAC,GAAGT,IAAI;;KAG5B,IAAI,CAAC,4CAAI,kBAAQA,IAAI,CAACS,EAAE,CAAC,EACzB;OACC,4CAAI,kBAAQT,IAAI,CAACS,EAAE,CAAC,2CAAG,IAAI,gEAA+BT,IAAI,CAAC;;KAGhE,IAAI,CAAC,4CAAI,8BAAcA,IAAI,CAACS,EAAE,CAAC,EAC/B;OACC,MAAMqB,SAAS,GAAI,GAAEZ,6BAAkB,IAAGlB,IAAI,CAACS,EAAG,EAAC;OACnD,4CAAI,8BAAcT,IAAI,CAACS,EAAE,CAAC,GAAG;SAAE,2CAAG,IAAI,oDAAyBT,IAAI,CAAC;SAAE8B;QAAW;OACjF,4CAAI,wBAAWA,SAAS,CAAC,GAAG;SAAErB,EAAE,EAAEqB;QAAW;;IAE9C,CAAC;CACH;CAAC,4BAEiB9B,IAAmB,EACrC;GACC,OAAO;KACN,GAAGA,IAAI,CAACU,IAAI;KACZsB,OAAO,EAAEhC,IAAI,CAACgC,OAAO;KACrBC,QAAQ,EAAEjC,IAAI,CAACS,EAAE;KACjBX,OAAO,EAAEE,IAAI,CAACF;IACd;CACF;CAAC,8BAEmBE,IAAmB,EACvC;GACC,OAAO;KACNkC,MAAM,EAAElC,IAAI,CAACmC,OAAO;KACpBC,MAAM,EAAEpC,IAAI,CAACQ,IAAI,CAAC4B,MAAM;KACxBC,KAAK,EAAErC,IAAI,CAACQ,IAAI,CAAC6B,KAAK;KACtBJ,QAAQ,EAAEjC,IAAI,CAACS,EAAE;KACjB6B,IAAI,EAAEtC,IAAI,CAACQ,IAAI,CAAC8B,IAAI;KACpBC,IAAI,EAAEC,oBAAQ,CAAChC,IAAI;KACnBwB,OAAO,EAAEhC,IAAI,CAACgC,OAAO;KACrBS,IAAI,EAAEC,oBAAQ,CAACC;IACf;CACF;CAAC,wCAE6BnC,IAAa,EAC3C;GACC,OAAO;KACNyB,QAAQ,EAAEzB,IAAI,CAACC,EAAE;KACjB2B,MAAM,EAAE5B,IAAI,CAAC4B,MAAM;KACnBC,KAAK,EAAE7B,IAAI,CAAC6B,KAAK;KACjBC,IAAI,EAAE9B,IAAI,CAAC8B,IAAI;KACfC,IAAI,EAAEC,oBAAQ,CAAChC,IAAI;KACnBiC,IAAI,EAAEC,oBAAQ,CAACC;IACf;CACF;CAAC,kCAEuB3C,IAAmB,EAC3C;GACC,OAAO;KACNS,EAAE,EAAET,IAAI,CAACS,EAAE;KACXmC,qBAAqB,EAAE;IACvB;CACF;CAAC,wBAEarB,eAA+B,EAAEsB,MAAc,EAC7D;GACC,MAAMC,uBAAuB,GAAGvB,eAAe,CAACjB,KAAK,CAACyC,GAAG,CAAEtC,EAAE,IAAK;KACjE,OAAOuC,MAAM,CAACC,QAAQ,CAACxC,EAAE,EAAE,EAAE,CAAC;IAC9B,CAAC;GACF,MAAMyC,YAAY,GAAG,IAAIC,GAAG,CAAC,CAAC,GAAGL,uBAAuB,EAAED,MAAM,CAAC,CAAC;GAElE,OAAO,CAAC,GAAGK,YAAY,CAAC;CACzB;;CClOM,MAAME,aAAa,CAC1B;GAAA;KAAA,KAGCC,eAAe,GAAY,KAAK;KAAA,KAChCC,iBAAiB,GAAY,KAAK;KAAA,KAClCC,YAAY,GAAW,EAAE;KAAA,KACzBC,SAAS,GAAY,KAAK;KAAA,KAC1BC,WAAW,GAAW,CAAC;KAAA,KACvBC,kBAAkB,GAAY,IAAI;KAAA,KAClCC,eAAe,GAAW,IAAI;;GAE9B,OAAOC,WAAW,GAClB;KACC,IAAI,CAAC,IAAI,CAACC,QAAQ,EAClB;OACC,IAAI,CAACA,QAAQ,GAAG,IAAI,IAAI,EAAE;;KAG3B,OAAO,IAAI,CAACA,QAAQ;;;;GAIrBC,aAAa,GACb;KACC,OAAOlD,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,4BAA4B,CAAC;;GAG7D,MAAMiD,aAAa,CAAC;KAAEC,oBAAoB,GAAG;IAAO,GAAG,EAAE,EACzD;KACC,IAAI,IAAI,CAACX,eAAe,IAAI,CAACW,oBAAoB,EACjD;OACCC,uBAAM,CAACC,IAAI,CAAC,yCAAyC,CAAC;OAEtD,OAAOC,OAAO,CAACC,OAAO,EAAE;;KAEzB,IAAI,CAACZ,SAAS,GAAG,IAAI;KAErB,MAAMa,MAAM,GAAG,MAAM,IAAI,CAACC,YAAY,CAAC;OAAEC,SAAS,EAAE;MAAM,CAAC;KAC3D,IAAI,CAACjB,iBAAiB,GAAG,IAAI;KAE7B,OAAOe,MAAM;;GAGdG,YAAY,GACZ;KACC,IAAI,IAAI,CAAChB,SAAS,IAAI,CAAC,IAAI,CAACE,kBAAkB,EAC9C;OACC,OAAOS,OAAO,CAACC,OAAO,EAAE;;KAGzB,IAAI,CAACZ,SAAS,GAAG,IAAI;KAErB,OAAO,IAAI,CAACc,YAAY,EAAE;;GAG3BG,gBAAgB,CAAChF,MAAM,EACvB;KACCwE,uBAAM,CAACC,IAAI,CAAC,uCAAuC,EAAEzE,MAAM,CAAC;KAC5D,MAAM;OAAEI,KAAK;OAAE6E;MAAS,GAAGjF,MAAM;KAEjC,IAAI,CAACkE,eAAe,GAAG,IAAI,CAACgB,kBAAkB,CAAC9E,KAAK,CAAC;KAErD,IAAI,CAAC6E,OAAO,EACZ;OACC,IAAI,CAAChB,kBAAkB,GAAG,KAAK;;KAGhC,IAAI,CAACL,eAAe,GAAG,IAAI;KAE3B,IAAI,CAACuB,YAAY,CAACnF,MAAM,CAAC;;GAG1BoF,QAAQ,CAAC5C,QAAgB,EACzB;KACCgC,uBAAM,CAACC,IAAI,CAAC,0BAA0B,EAAEjC,QAAQ,CAAC;KACjD,MAAM6C,UAAU,GAAGlE,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,YAAY,CAAC,CAACmB,QAAQ,CAAC;KAClE,IAAI,CAAC6C,UAAU,EACf;OACC;;KAGDlE,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,eAAe,EAAE;OAAEtE,EAAE,EAAEwB;MAAU,CAAC;KAE3D,MAAM+C,YAAY,GAAGpE,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,wBAAwB,CAAC,CAACmB,QAAQ,CAAC;KAChF,IAAI+C,YAAY,EAChB;OACCC,8BAAa,CAACrB,WAAW,EAAE,CAACsB,0BAA0B,EAAE;OACxD,KAAKD,8BAAa,CAACrB,WAAW,EAAE,CAACuB,2BAA2B,CAAClD,QAAQ,CAAC;;KAGvErB,2BAAI,CAACwE,aAAa,EAAE,CAACC,UAAU,CAACC,sBAAU,CAACC,YAAY,EAAE;OAAEC,SAAS,EAAEvD;MAAU,CAAC,CAC/EwD,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACtD,CAAC;;;;GAIJ,MAAMpB,YAAY,CAAC;KAAEC,SAAS,GAAG;IAAO,GAAG,EAAE,EAC7C;KACC,MAAMqB,WAAW,GAAG,IAAI,CAACC,cAAc,CAACtB,SAAS,CAAC;KAElD,MAAMF,MAAM,GAAG,MAAMzD,2BAAI,CAACwE,aAAa,EAAE,CAACC,UAAU,CAAC,IAAI,CAACS,cAAc,EAAE,EAAEF,WAAW,CAAC,CACtFH,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;MACzD,CAAC;KAEH,IAAI,CAACjC,WAAW,EAAE;KAClBQ,uBAAM,CAACC,IAAI,CAAE,kBAAiBK,SAAS,GAAG,OAAO,GAAG,IAAI,CAACd,WAAY,sBAAqB,EAAEY,MAAM,CAAC0B,IAAI,EAAE,CAAC;KAC1G,MAAM;OAAElG,KAAK;OAAE6E;MAAS,GAAGL,MAAM,CAAC0B,IAAI,EAAE;KACxC,IAAI,CAACpC,eAAe,GAAG,IAAI,CAACgB,kBAAkB,CAAC9E,KAAK,CAAC;KACrD,IAAI,CAAC6E,OAAO,EACZ;OACC,IAAI,CAAChB,kBAAkB,GAAG,KAAK;;KAGhC,IAAI,CAACF,SAAS,GAAG,KAAK;KAEtB,OAAO,IAAI,CAACoB,YAAY,CAACP,MAAM,CAAC0B,IAAI,EAAE,CAAC;;GAGxCD,cAAc,GACd;KACC,OAAOR,sBAAU,CAACU,YAAY;;GAG/BH,cAAc,CAACtB,SAAkB,EACjC;KACC,OAAO;OACN0B,cAAc,EAAE,GAAG;OACnBC,KAAK,EAAE,IAAI,CAAC3C,YAAY;OACxB4C,iBAAiB,EAAE5B,SAAS,GAAG,IAAI,GAAG,IAAI,CAACZ,eAAe;OAC1DyC,iBAAiB,EAAE,GAAG;OACtBC,UAAU,EAAE;MACZ;;GAGFC,kBAAkB,GAClB;KACC,OAAO,kBAAkB;;GAG1B1B,YAAY,CAAClF,OAAO,EACpB;KACC,MAAM6G,SAAS,GAAG,IAAIhH,mBAAmB,CAAC;OAAEG,OAAO;OAAE,GAAG,IAAI,CAAC8G,mBAAmB;MAAI,CAAC;KACrF,MAAMC,cAAc,GAAGF,SAAS,CAAC3G,QAAQ,EAAE;KAC3C,MAAM;OACLK,KAAK;OACLG,KAAK;OACLC,QAAQ;OACRC,KAAK;OACLC,WAAW;OACXT;MACA,GAAG2G,cAAc;KAClBxC,uBAAM,CAACC,IAAI,CAAC,yCAAyC,EAAEuC,cAAc,CAAC;KAEtE,MAAMC,YAAY,GAAG9F,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,WAAW,EAAE9E,KAAK,CAAC;KACjE,MAAM0G,gBAAgB,GAAG/F,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,WAAW,EAAE3E,KAAK,CAAC;KACrE,MAAMwG,eAAe,GAAGhG,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,gBAAgB,EAAE1E,QAAQ,CAAC;KAC5E,MAAMwG,YAAY,GAAGjG,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,WAAW,EAAEzE,KAAK,CAAC;KACjE,MAAMwG,aAAa,GAAGlG,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,IAAI,CAACuB,kBAAkB,EAAE,EAAE/F,WAAW,CAAC;KAEtF,MAAMwG,cAAc,GAAG,IAAIC,gCAAc,EAAE;KAC3C,MAAMC,cAAc,GAAGF,cAAc,CAACG,wBAAwB,CAACpH,OAAO,CAAC;KAEvE,OAAOqE,OAAO,CAACgD,GAAG,CAAC,CAClBT,YAAY,EACZC,gBAAgB,EAChBC,eAAe,EACfC,YAAY,EACZC,aAAa,EACbG,cAAc,CACd,CAAC;;GAGHtC,kBAAkB,CAAC9E,KAAY,EAC/B;KACC,IAAIA,KAAK,CAACuH,MAAM,KAAK,CAAC,EACtB;OACC,OAAO,EAAE;;KAGV,OAAOvH,KAAK,CAACwH,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAACpG,OAAO,CAACqG,IAAI;;GAGvCd,mBAAmB,GACnB;KACC,OAAO,EAAE;;CAEX;CA/LapD,aAAa,CAElBS,QAAQ,GAAG,IAAI;;CCVuB;CAAA;AAQ9C,CAAO,MAAM0D,aAAa,CAC1B;GAGC/H,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,oBAAUoB,2BAAI,CAACC,QAAQ,EAAE;;GAG9B,MAAM2G,UAAU,CAACvF,QAAgB,EACjC;KACCgC,uBAAM,CAACC,IAAI,CAAE,sCAAqCjC,QAAS,EAAC,CAAC;KAE7D,MAAMwF,YAAY,GAAG,MAAMC,wBAAS,CAACpC,sBAAU,CAACqC,cAAc,EAAE;OAC/D5B,IAAI,EAAE;SAAE9D;;MACR,CAAC,CAACwD,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;OACtD,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;KAEF,8CAAM,IAAI,gCAAezD,QAAQ,CAAC;KAElC,OAAOwF,YAAY;;GAGpB,MAAMI,YAAY,CAAC5F,QAAgB,EACnC;KACCgC,uBAAM,CAACC,IAAI,CAAE,wCAAuCjC,QAAS,EAAC,CAAC;KAE/D,MAAMwF,YAAY,GAAG,MAAMC,wBAAS,CAACpC,sBAAU,CAACwC,yBAAyB,EAAE;OAC1E/B,IAAI,EAAE;SAAE9D;;MACR,CAAC,CAACwD,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;OACxD,MAAMA,KAAK;MACX,CAAC;KAEF,8CAAM,IAAI,gCAAezD,QAAQ,CAAC;KAElC,OAAOwF,YAAY;;CAerB;CAAC,wBAZcxF,QAAgB,EAC9B;GACC,KAAK,4CAAI,kBAAQ8C,QAAQ,CAAC,cAAc,EAAE;KACzC9C,QAAQ;KACR8F,MAAM,EAAE;OAAEC,MAAM,EAAE;;IAClB,CAAC;GAEF,KAAK,4CAAI,kBAAQjD,QAAQ,CAAC,eAAe,EAAE;KAAEtE,EAAE,EAAEwB;IAAU,CAAC;GAE5D,MAAMvB,IAAI,GAAG,4CAAI,kBAAQI,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,EAAE,IAAI,CAAC;GAC7D,KAAK,4CAAI,kBAAQ8C,QAAQ,CAAC,8BAA8B,EAAE;KAAE7C,MAAM,EAAExB,IAAI,CAACwB;IAAQ,CAAC;CACnF;;CChE4C;AAiB7C,CAAO,MAAM+F,iBAAiB,CAC9B;GAGCzI,WAAW,CAAC0I,UAA8B,EAC1C;KAAA;OAAA;OAAA;;KACC,4CAAI,kCAAeA,UAAU;;GAG9BC,SAAS,GACT;KACC,OAAO,4CAAI,gCAAazH,IAAI,CAACD,EAAE;;GAGhC2H,WAAW,GACX;KACC,OAAO,4CAAI,gCAAa1H,IAAI,CAACuB,QAAQ;;GAGtCoG,eAAe,GACf;KACC,OAAO,4CAAI,gCAAa3H,IAAI,CAAC6B,IAAI,KAAKC,oBAAQ,CAAC8F,KAAK;;GAGrDC,aAAa,GACb;KACC,OAAO,4CAAI,gCAAa7H,IAAI,CAAC6B,IAAI,KAAKC,oBAAQ,CAAC1C,OAAO;;GAGvD0I,QAAQ,GACR;KACC,MAAMC,QAAQ,GAAG;OAChB,GAAG,4CAAI,gCAAa/H,IAAI;OACxBgI,WAAW,EAAE,4CAAI,gCAAaA,WAAW;OACzCC,WAAW,EAAE,4CAAI,gCAAaA,WAAW;OACzCC,kBAAkB,EAAE,4CAAI,gCAAaA;MACrC;KACD,MAAMxI,KAAK,GAAG;OACb,CAAC,4CAAI,gCAAaM,IAAI,CAACuB,QAAQ,GAAGwG;MAClC;KACD,4CAAI,gCAAaxI,KAAK,CAACF,OAAO,CAAES,IAAI,IAAK;OACxC,IAAIJ,KAAK,CAACI,IAAI,CAACC,EAAE,CAAC,EAClB;SACCL,KAAK,CAACI,IAAI,CAACC,EAAE,CAAC,GAAG;WAAE,GAAGL,KAAK,CAACI,IAAI,CAACC,EAAE,CAAC;WAAE,GAAGoI,0BAAW,CAACC,gBAAgB,CAACtI,IAAI;UAAG;QAC7E,MAED;SACCJ,KAAK,CAACI,IAAI,CAACC,EAAE,CAAC,GAAGoI,0BAAW,CAACC,gBAAgB,CAACtI,IAAI,CAAC;;MAEpD,CAAC;KAEF,OAAON,MAAM,CAACC,MAAM,CAACC,KAAK,CAAC;;GAG5B2I,QAAQ,GACR;KAAA;KACC,gCAAO,4CAAI,gCAAazI,KAAK,oCAAI,EAAE;;GAGpC0I,QAAQ,GACR;KAAA;KACC,iCAAO,4CAAI,gCAAa/I,KAAK,qCAAI,EAAE;;GAGpCgJ,kBAAkB,GAClB;KAAA;KACC,iCAAO,4CAAI,gCAAaC,UAAU,qCAAI,EAAE;;GAGzCC,WAAW,GACX;KAAA;KACC,iCAAO,4CAAI,gCAAa9I,QAAQ,qCAAI,EAAE;;GAGvC+I,cAAc,GACd;KAAA;KACC,iCAAO,4CAAI,gCAAaC,WAAW,qCAAI,EAAE;;GAG1CC,aAAa,GACb;KAAA;KACC,iCAAO,4CAAI,gCAAaC,UAAU,qCAAI,IAAI;;GAG3CC,kBAAkB,GAClB;KAAA;KACC,iCAAO,4CAAI,gCAAaC,kBAAkB,qCAAI,EAAE;;GAGjDC,mBAAmB,GACnB;KAAA;KACC,MAAMC,gBAAgB,GAAG,EAAE;KAC3B,MAAMC,IAAc,6BAAG,4CAAI,gCAAaA,IAAI,qCAAI,EAAE;KAClDA,IAAI,CAAC7J,OAAO,CAAE8J,GAAG,IAAK;OACrBF,gBAAgB,CAACG,IAAI,CAACD,GAAG,CAAC/H,SAAS,CAAC;MACpC,CAAC;KAEF,OAAO6H,gBAAgB;;GAGxBI,YAAY,GACZ;KAAA;KACC,iCAAO,4CAAI,gCAAaC,SAAS,qCAAI,EAAE;;GAGxCC,UAAU,GACV;KACC,OAAO,4CAAI,gCAAanK,OAAO;;GAGhCoK,UAAU,GACV;KACC,OAAO,4CAAI,gCAAaC,OAAO;;CAEjC;;CCpH0D;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAgB1D,CAAO,MAAMC,WAAW,CACxB;GAGC5K,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;;GAG9BwJ,QAAQ,CAACpI,QAAgB,EACzB;KACC,MAAMxC,MAAM,GAAG;OAAEwC;MAAU;KAE3B,+CAAO,IAAI,8BAAcqD,sBAAU,CAACgF,mBAAmB,EAAE7K,MAAM;;GAGhE8K,gBAAgB,CAACrI,MAAc,EAC/B;KACC,MAAMzC,MAAM,GAAG;OACdyC,MAAM;OACNsI,YAAY,EAAEC,qCAAc,CAACC,sBAAsB;MACnD;KAED,+CAAO,IAAI,8BAAcpF,sBAAU,CAACqF,YAAY,EAAElL,MAAM;;GAGzDmL,oBAAoB,CAAC3I,QAAgB,EACrC;KACC,MAAMxC,MAAM,GAAG;OACdwC,QAAQ;OACRuI,YAAY,EAAEC,qCAAc,CAACC,sBAAsB;MACnD;KAED,+CAAO,IAAI,8BAAcpF,sBAAU,CAACqF,YAAY,EAAElL,MAAM;;GAGzDoL,mBAAmB,CAAC5I,QAAgB,EAAEH,SAAiB,EACvD;KACC,MAAMrC,MAAM,GAAG;OACdwC,QAAQ;OACRH,SAAS;OACT0I,YAAY,EAAEC,qCAAc,CAACC,sBAAsB;MACnD;KAED,+CAAO,IAAI,8BAAcpF,sBAAU,CAACwF,qBAAqB,EAAErL,MAAM;;GAGlEsL,eAAe,CAAC9I,QAAgB,EAChC;KACC,IAAI,CAAC+I,qBAAK,CAACC,MAAM,CAACC,YAAY,CAACjJ,QAAQ,CAAC,EACxC;OACC,OAAOkC,OAAO,CAACC,OAAO,CAACnC,QAAQ,CAAC;;KAGjC,OAAOyF,wBAAS,CAACpC,sBAAU,CAAC6F,mBAAmB,EAAE;OAChDpF,IAAI,EAAE;SAAEqF,UAAU,EAAEnJ;;MACpB,CAAC,CACAoJ,IAAI,CAAEhH,MAA0B,IAAK;OACrC,OAAOA,MAAM,CAACpC,QAAQ;MACtB,CAAC,CACDwD,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,gDAAgD,EAAEA,KAAK,CAAC;MACtE,CAAC;;GAGJ,MAAM4F,YAAY,CAACC,MAAc,EACjC;KACC,MAAM9L,MAAM,GAAG;OACd8L,MAAM;OACNf,YAAY,EAAEC,qCAAc,CAACC,sBAAsB,EAAE;OACrDc,QAAQ,EAAE,IAAI;OACdC,iBAAiB,EAAE;MACnB;KAED,MAAM;OAAEvJ;MAAQ,GAAG,8CAAM,IAAI,8BAAcoD,sBAAU,CAACqF,YAAY,EAAElL,MAAM,CAAC;KAE3E,OAAO,4CAAI,sBAAQsF,QAAQ,CAAC,uBAAuB,EAAE;OACpDjD,SAAS,EAAEyJ,MAAM;OACjBrJ;MACA,CAAC;;GAGH,MAAMwJ,eAAe,CAACC,eAAuB,EAC7C;KACC,MAAMV,MAAmB,GAAG,4CAAI,sBAAQnK,OAAO,CAAC,WAAW,CAAC,CAAC6K,eAAe,EAAE,IAAI,CAAC;KACnF,MAAMtL,QAAQ,GAAG,4CAAI,sBAAQS,OAAO,CAAC,sBAAsB,CAAC,CAACmK,MAAM,CAAC/I,MAAM,CAAC;KAC3E,MAAM0J,UAAU,GAAGvL,QAAQ,CAAC0C,GAAG,CAAE9B,OAAuB,IAAKA,OAAO,CAACR,EAAE,CAAC;KACxE,MAAM;OAAE4I,WAAW;OAAEH;MAAmC,GAAG,MAAMxB,wBAAS,CACzEpC,sBAAU,CAACuG,8BAA8B,EACzC;OAAE9F,IAAI,EAAE;SAAE6F;;MAAc,CACxB,CACCnG,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,+CAA+C,EAAEA,KAAK,CAAC;MACrE,CAAC;KAEH,MAAMoG,WAAW,GAAG,IAAIjD,0BAAW,EAAE;KAErC,KAAK,4CAAI,sBAAQ9D,QAAQ,CAAC,uBAAuB,EAAEsE,WAAW,CAAC;KAC/D,KAAKyC,WAAW,CAACC,eAAe,CAAC7C,UAAU,CAAC;;GAG7C8C,SAAS,CAAC/J,QAAgB,EAC1B;KACC,MAAMgJ,MAAmB,GAAG,4CAAI,sBAAQnK,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,EAAE,IAAI,CAAC;KAC5E,4CAAI,sBAAQ8C,QAAQ,CAAC,8BAA8B,EAAE;OAAE7C,MAAM,EAAE+I,MAAM,CAAC/I;MAAQ,CAAC;KAC/E,4CAAI,sBAAQ6C,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SAAEC,MAAM,EAAE;;MAClB,CAAC;;CAkLJ;CAAC,6BA/KmBiE,UAAkB,EAAExM,MAA2B,EAClE;GACC,MAAM;KAAEwC,QAAQ;KAAEH;IAAW,GAAGrC,MAAM;GACtC,4CAAI,8CAAsBwC,QAAQ;GAElC,MAAMiK,YAAY,GAAG,MAAMxE,wBAAS,CAACuE,UAAU,EAAE;KAAElG,IAAI,EAAEtG;IAAQ,CAAC,CAChEgG,KAAK,CAAE0G,MAA0B,IAAK;;KAEtCxG,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEyG,MAAM,CAAC;KAC9D,4CAAI,8CAAsBA,MAAM;KAChC,4CAAI,kDAAwBlK,QAAQ;KACpC,MAAMkK,MAAM;IACZ,CAAC;GAEH,4CAAI,IAAI,4CAAqBD,YAAY,GACzC;KACC,+CAAO,IAAI,wCAAmBA,YAAY,EAAEpK,SAAS;;GAGtD,MAAM;KACLG,QAAQ,EAAEmK,cAAc;KACxBlK;IACA,GAAG,8CAAM,IAAI,oCAAegK,YAAY,CAAC;GAE1C,4CAAI,IAAI,wDAA2BD,UAAU,GAC7C;KACC,8CAAM,IAAI,4CAAqBG,cAAc,CAAC;;GAG/C,OAAO;KAAEnK,QAAQ,EAAEmK,cAAc;KAAElK;IAAQ;CAC5C;CAAC,+BAEoBD,QAAgB,EACrC;GACC,KAAK,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE;KACzC9C,QAAQ;KACR8F,MAAM,EAAE;OACPsE,OAAO,EAAE;;IAEV,CAAC;CACH;CAAC,8BAEmBpK,QAAgB,EACpC;GACC,OAAO,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE;KAC3C9C,QAAQ;KACR8F,MAAM,EAAE;OACPC,MAAM,EAAE,IAAI;OACZqE,OAAO,EAAE;;IAEV,CAAC;CACH;CAAC,iCAEsBpK,QAAgB,EACvC;GACC,OAAO,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE;KAC3C9C,QAAQ;KACR8F,MAAM,EAAE;OACPsE,OAAO,EAAE;;IAEV,CAAC;CACH;CAAC,oCAEyBJ,UAAkB,EAC5C;GACC,OAAOA,UAAU,KAAK3G,sBAAU,CAACgF,mBAAmB;CACrD;CAAC,gCAEmBpC,UAA8B,EAClD;GACC,MAAM3B,SAAS,GAAG,IAAI0B,iBAAiB,CAACC,UAAU,CAAC;GAEnD,MAAMoE,YAAY,GAAG,4CAAI,sBAAQvH,QAAQ,CAAC,WAAW,EAAEwB,SAAS,CAACiC,QAAQ,EAAE,CAAC;GAC5E,MAAM3B,YAAY,GAAG,4CAAI,sBAAQ9B,QAAQ,CAAC,WAAW,EAAEwB,SAAS,CAACwC,QAAQ,EAAE,CAAC;GAE5E,MAAM+C,WAAW,GAAG,IAAIjD,0BAAW,EAAE;GACrC,MAAMnC,YAAY,GAAGvC,OAAO,CAACgD,GAAG,CAAC,CAChC,4CAAI,sBAAQpC,QAAQ,CAAC,WAAW,EAAEwB,SAAS,CAACyC,QAAQ,EAAE,CAAC,EACvD8C,WAAW,CAACC,eAAe,CAACxF,SAAS,CAAC0C,kBAAkB,EAAE,CAAC,CAC3D,CAAC;GACF,MAAMrC,eAAe,GAAGzC,OAAO,CAACgD,GAAG,CAAC,CACnC,4CAAI,sBAAQpC,QAAQ,CAAC,4BAA4B,EAAE;KAClD1E,QAAQ,EAAEkG,SAAS,CAAC4C,WAAW,EAAE;KACjCoD,eAAe,EAAE;IACjB,CAAC,EACF,4CAAI,sBAAQxH,QAAQ,CAAC,gBAAgB,EAAEwB,SAAS,CAACiD,kBAAkB,EAAE,CAAC,EACtE,4CAAI,sBAAQzE,QAAQ,CAAC,wBAAwB,EAAE;KAC9C7C,MAAM,EAAEqE,SAAS,CAAC4B,SAAS,EAAE;KAC7BqE,cAAc,EAAEjG,SAAS,CAACmD,mBAAmB;IAC7C,CAAC,EACF,4CAAI,sBAAQ3E,QAAQ,CAAC,wBAAwB,EAAEwB,SAAS,CAACwD,YAAY,EAAE,CAAC,EACxE,4CAAI,sBAAQhF,QAAQ,CAAC,uBAAuB,EAAEwB,SAAS,CAAC6C,cAAc,EAAE,CAAC,CACzE,CAAC;GAEF,MAAMrC,cAAc,GAAG,IAAIC,gCAAc,EAAE;GAC3C,MAAMC,cAAc,GAAGF,cAAc,CAAC0F,sBAAsB,CAAClG,SAAS,CAAC0D,UAAU,EAAE,CAAC;GAEpF,MAAMyC,gBAAgB,GAAGC,6CAAgB,CAACF,sBAAsB,CAAClG,SAAS,CAAC2D,UAAU,EAAE,CAAC;GAExF,MAAM0C,aAAa,GAAG,4CAAI,sBAAQ7H,QAAQ,CAAC,mBAAmB,EAAE;KAC/D7C,MAAM,EAAEqE,SAAS,CAAC4B,SAAS,EAAE;KAC7BoB,UAAU,EAAEhD,SAAS,CAAC+C,aAAa;IACnC,CAAC;GAEF,MAAMnF,OAAO,CAACgD,GAAG,CAAC,CACjBmF,YAAY,EACZzF,YAAY,EACZH,YAAY,EACZE,eAAe,EACfK,cAAc,EACdyF,gBAAgB,EAChBE,aAAa,CACb,CAAC;GAEF,OAAO;KAAE3K,QAAQ,EAAEsE,SAAS,CAAC6B,WAAW,EAAE;KAAElG,MAAM,EAAEqE,SAAS,CAAC4B,SAAS;IAAI;CAC5E;CAAC,8BAEmB+D,YAAgC,EACpD;GACC,OAAO,4CAAI,8DAA8BA,YAAY,6CAAK,IAAI,kEAAgCA,YAAY,CAAC;CAC5G;CAAC,4BAEiBA,YAAgC,EAAEW,SAAiB,GAAG,CAAC,EACzE;GACC,MAAMtG,SAAS,GAAG,IAAI0B,iBAAiB,CAACiE,YAAY,CAAC;GACrDjH,8BAAa,CAACrB,WAAW,EAAE,CAACkJ,oBAAoB,CAACC,kBAAM,CAACrM,IAAI,CAAC4B,IAAI,EAAE,EAAE,CAAC;GAEtE,4CAAI,IAAI,8DAA8B4J,YAAY,GAClD;KACC,OAAOc,mBAAS,CAACC,WAAW,CAAC1G,SAAS,CAAC6B,WAAW,EAAE,EAAEyE,SAAS,CAAC;;GAGjE,4CAAI,IAAI,kEAAgCX,YAAY,GACpD;KACC,OAAOc,mBAAS,CAACE,SAAS,CAAC3G,SAAS,CAAC6B,WAAW,EAAE,CAAC;;GAGpD,OAAOjE,OAAO,CAACC,OAAO,EAAE;CACzB;CAAC,uCAE4B8H,YAAgC,EAC7D;GACC,MAAM3F,SAAS,GAAG,IAAI0B,iBAAiB,CAACiE,YAAY,CAAC;GACrD,MAAMiB,iBAAiB,GAAGlI,8BAAa,CAACrB,WAAW,EAAE,CAACwJ,SAAS,EAAE,CAAC9K,IAAI;GAEtE,OAAOiE,SAAS,CAACgC,aAAa,EAAE,IAAI4E,iBAAiB,KAAKJ,kBAAM,CAACjN,OAAO,CAACwC,IAAI;CAC9E;CAAC,yCAE8B4J,YAAgC,EAC/D;GACC,MAAMmB,0BAA0B,GAAGC,gCAAc,CAACC,kBAAkB,CAACC,yBAAO,CAACC,WAAW,CAAC;GAEzF,IAAIJ,0BAA0B,EAC9B;KACC,OAAO,KAAK;;GAGb,MAAM9G,SAAS,GAAG,IAAI0B,iBAAiB,CAACiE,YAAY,CAAC;GAErD,OAAO3F,SAAS,CAAC8B,eAAe,EAAE,IAAI7G,cAAI,CAACkM,cAAc,CAACnH,SAAS,CAAC6B,WAAW,EAAE,CAAC;CACnF;CAAC,+BAEoB+D,MAA0B,EAC/C;GACC,MAAM,CAACwB,UAAU,CAAC,GAAGxB,MAAM;GAC3B,IAAIwB,UAAU,CAACC,IAAI,KAAKC,gCAAe,CAACC,YAAY,EACpD;KACC,4CAAI,wCAAmBC,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC;;CAEhF;CAAC,4BAEiBC,IAAY,EAC9B;GACCC,EAAE,CAACC,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;KAAEC,OAAO,EAAEN;IAAM,CAAC;CACpD;;CC9SD,MAAMO,YAAY,GAAG,MAAM;CAC3B,MAAMC,SAAS,GAAG,MAAM;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;AAEzB,CAAO,MAAMC,aAAa,CAC1B;GAIClP,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,8BAAeoB,2BAAI,CAACwE,aAAa,EAAE;KACvC,4CAAI,wBAAUxE,2BAAI,CAACC,QAAQ,EAAE;;GAG9B,MAAM8N,UAAU,CAACC,UAAsB,EACvC;KACC3K,uBAAM,CAACC,IAAI,CAAC,yBAAyB,EAAE0K,UAAU,CAAC;KAElD,MAAMC,cAAc,GAAG,8CAAM,IAAI,kCAAgBD,UAAU,CAAC;KAE5D,MAAME,YAAwB,GAAG,MAAM,4CAAI,4BAAazJ,UAAU,CAACC,sBAAU,CAACyJ,WAAW,EAAE;OAC1FhH,MAAM,EAAE8G;MACR,CAAC,CAACpJ,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;OACtD,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;KAEF,MAAM;OAAExD,MAAM,EAAE8M;MAAW,GAAGF,YAAY,CAAC/I,IAAI,EAAE;KAEjD9B,uBAAM,CAACC,IAAI,CAAC,gCAAgC,EAAE8K,SAAS,CAAC;KACxD,MAAMC,WAAW,GAAI,OAAMD,SAAU,EAAC;KACtC,4CAAI,oCAAiBC,WAAW,EAAEJ,cAAc;KAChD,4CAAI,kCAAgBI,WAAW;KAE/B,OAAO;OAAEA,WAAW;OAAED;MAAW;;GAGlC,MAAME,YAAY,CAACC,YAAoC,EACvD;KACClL,uBAAM,CAACC,IAAI,CAAC,2BAA2B,EAAEiL,YAAY,CAAC;KAEtD,MAAMN,cAAc,GAAG,8CAAM,IAAI,kCAAgBM,YAAY,CAAC;KAE9D,MAAM1P,MAAM,GAAG;OACd2P,OAAO,EAAEP,cAAc,CAACO,OAAO;OAC/B9M,IAAI,EAAEuM,cAAc,CAACQ,KAAK;OAC1BC,WAAW,EAAET,cAAc,CAACS,WAAW;OACvCC,QAAQ,EAAEV,cAAc,CAACzM,MAAM;OAC/BoN,gBAAgB,EAAExE,qBAAK,CAACxK,IAAI,CAACiP,kBAAkB,CAACN,YAAY,CAACK,gBAAgB,CAAC;OAC9EE,WAAW,EAAEP,YAAY,CAACO,WAAW;OACrC3O,OAAO,EAAEoO,YAAY,CAACpO;MACtB;KAED,MAAM+N,YAAgC,GAAG,MAAMpH,wBAAS,CAACpC,sBAAU,CAACqK,yBAAyB,EAAE;OAC9F5J,IAAI,EAAEtG;MACN,CAAC,CAACgG,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,KAAK;;OAErBC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;OACxD,MAAMA,KAAK;MACX,CAAC;KAEF,MAAM;OAAExD,MAAM,EAAE8M;MAAW,GAAGF,YAAY;KAE1C7K,uBAAM,CAACC,IAAI,CAAC,kCAAkC,EAAE8K,SAAS,CAAC;KAC1D,MAAMC,WAAW,GAAI,OAAMD,SAAU,EAAC;KACtC,4CAAI,wCAAmBC,WAAW,EAAEJ,cAAc;KAClD,4CAAI,kCAAgBI,WAAW;KAE/B,OAAO;OAAEA,WAAW;OAAED;MAAW;;CA4FnC;CAAC,+BAzFqBJ,UAAsB,EAC3C;GAAA;GACC,MAAMgB,cAAc,GAAG;KAAE,GAAGhB;IAAY;GACxC,IAAIgB,cAAc,CAACxN,MAAM,EACzB;KACCwN,cAAc,CAACxN,MAAM,GAAG,MAAM4I,qBAAK,CAACpJ,IAAI,CAACiO,SAAS,CAACjB,UAAU,CAACxM,MAAM,CAAC;;GAGtEwN,cAAc,CAACE,QAAQ,4BAAGF,cAAc,CAACE,QAAQ,oCAAI,EAAE;GACvDF,cAAc,CAACG,OAAO,4BAAGH,cAAc,CAACG,OAAO,oCAAI,EAAE;GACrD,MAAMC,UAAU,GAAG,CAAC,GAAGJ,cAAc,CAACG,OAAO,EAAE,GAAGH,cAAc,CAACE,QAAQ,CAAC;GAC1E,IAAIF,cAAc,CAACR,OAAO,EAC1B;KACCY,UAAU,CAAClG,IAAI,CAAC8F,cAAc,CAACR,OAAO,CAAC;;GAExCQ,cAAc,CAACG,OAAO,GAAG,CAAC,GAAG,IAAI5M,GAAG,CAAC6M,UAAU,CAAC,CAAC;GAEjD,MAAM3L,MAAM,GAAG;KACd9B,IAAI,0BAAEqN,cAAc,CAACrN,IAAI,qBAAnB,qBAAqB0N,WAAW,EAAE;KACxCC,UAAU,2BAAEN,cAAc,CAACM,UAAU,qBAAzB,sBAA2BD,WAAW,EAAE;KACpDZ,KAAK,EAAEO,cAAc,CAACP,KAAK;KAC3BjN,MAAM,EAAEwN,cAAc,CAACxN,MAAM;KAC7BkN,WAAW,EAAEM,cAAc,CAACN,WAAW;KACvCrP,KAAK,EAAE2P,cAAc,CAACG,OAAO;KAC7BI,cAAc,EAAEP,cAAc,CAACO,cAAc;KAC7CL,QAAQ,EAAEF,cAAc,CAACE,QAAQ;KACjCV,OAAO,EAAEQ,cAAc,CAACR,OAAO;KAC/BgB,UAAU,EAAER,cAAc,CAACS,mBAAmB,GAAG,GAAG,GAAG,GAAG;KAC1DC,cAAc,EAAEV,cAAc,CAACU,cAAc;KAC7CC,iBAAiB,EAAEX,cAAc,CAACW,iBAAiB;KACnDC,QAAQ,EAAEZ,cAAc,CAACY,QAAQ;KACjCC,cAAc,EAAEb,cAAc,CAACa,cAAc;KAC7CC,cAAc,EAAEd,cAAc,CAACc,cAAc;KAC7CC,kBAAkB,EAAEf,cAAc,CAACe,kBAAkB;KACrDC,eAAe,EAAEhB,cAAc,CAACgB;IAChC;GAED1Q,MAAM,CAAC2Q,OAAO,CAACxM,MAAM,CAAC,CAACtE,OAAO,CAAC,CAAC,CAAC+Q,GAAG,EAAEC,KAAK,CAAC,KAAK;KAChD,IAAIvP,cAAI,CAACwP,WAAW,CAACD,KAAK,CAAC,EAC3B;OACC,OAAO1M,MAAM,CAACyM,GAAG,CAAC;;IAEnB,CAAC;GAEF,OAAOzM,MAAM;CACd;CAAC,4BAEiB4K,WAAmB,EAAEE,YAAoC,EAC3E;GACC,4CAAI,sBAAQpK,QAAQ,CAAC,WAAW,EAAE;KACjC9C,QAAQ,EAAEgN,WAAW;KACrB1M,IAAI,EAAEC,oBAAQ,CAACyO,MAAM;KACrB3O,IAAI,EAAE6M,YAAY,CAACE;IACnB,CAAC;CACH;CAAC,0BAEeJ,WAAmB,EAAEL,UAA0B,EAC/D;GACC,IAAIsC,QAAQ,GAAGtC,UAAU,CAACwB,UAAU,KAAK,GAAG,GAAG3B,SAAS,GAAGD,YAAY;GACvE,IAAIhN,cAAI,CAACkM,cAAc,CAACkB,UAAU,CAACsB,UAAU,CAAC,EAC9C;KACCgB,QAAQ,GAAGtC,UAAU,CAACsB,UAAU,CAACiB,WAAW,EAAE;;GAG/C,IAAI3P,cAAI,CAACkM,cAAc,CAACkB,UAAU,CAACrM,IAAI,CAAC,EACxC;KACC2O,QAAQ,GAAGtC,UAAU,CAACrM,IAAI,CAAC4O,WAAW,EAAE;;GAGzC,4CAAI,sBAAQpM,QAAQ,CAAC,WAAW,EAAE;KACjC9C,QAAQ,EAAEgN,WAAW;KACrB1M,IAAI,EAAE2O,QAAQ,CAACC,WAAW,EAAE;KAC5B7O,IAAI,EAAEsM,UAAU,CAACS,KAAK;KACtB+B,WAAW,EAAExC,UAAU,CAAC3O,KAAK,CAACmH,MAAM;KACpC3E,IAAI,EAAEC,oBAAQ,CAAC2O,KAAK;KACpB3B,WAAW,EAAE;OACZc,QAAQ,EAAE5B,UAAU,CAAC4B,QAAQ;OAC7BC,cAAc,EAAE7B,UAAU,CAAC6B,cAAc;OACzCH,cAAc,EAAE1B,UAAU,CAAC0B,cAAc;OACzCC,iBAAiB,EAAE3B,UAAU,CAAC2B,iBAAiB;OAC/CG,cAAc,EAAE9B,UAAU,CAAC8B;;IAE5B,CAAC;CACH;CAAC,yBAEczO,QAAQ,EACvB;GACCqP,6BAAS,CAAC1N,WAAW,EAAE,CAAC2N,kBAAkB,CAACtP,QAAQ,CAAC;CACrD;;CCzK2D;CAAA;CAAA;AAU5D,CAAO,MAAMuP,aAAa,CAC1B;GAGChS,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;;GAG9B,MAAM4Q,aAAa,CAACC,UAAgB,EACpC;KACC,IAAI,CAACC,iCAAgB,CAACD,UAAU,CAAC,EACjC;;OAEC,OAAOvN,OAAO,CAACyN,MAAM,CAAC,IAAIhK,KAAK,CAAC,+CAA+C,CAAC,CAAC;;KAGlF,MAAMiK,eAAe,GAAG,GAAG;KAC3B,MAAM;OAAEC,OAAO,EAAEC;MAAe,GAAG,MAAMC,4BAAW,CAACN,UAAU,EAAE;OAChEO,KAAK,EAAEJ,eAAe;OACtBK,MAAM,EAAEL;MACR,CAAC;KAEF,OAAOE,aAAa;;GAGrB,MAAMI,YAAY,CAACjQ,MAAc,EAAEwP,UAAgB,EACnD;KACCzN,uBAAM,CAACC,IAAI,CAAC,2BAA2B,EAAEhC,MAAM,EAAEwP,UAAU,CAAC;KAC5D,MAAMU,cAAc,GAAG,MAAMpH,qBAAK,CAACpJ,IAAI,CAACiO,SAAS,CAAC6B,UAAU,CAAC;KAE7D,OAAOhK,wBAAS,CAACpC,sBAAU,CAAC+M,oBAAoB,EAAE;OACjDtM,IAAI,EAAE;SACLtF,EAAE,EAAEyB,MAAM;SACVE,MAAM,EAAEgQ;;MAET,CAAC,CAAC3M,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;OACxD,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;;GAGH,MAAM4M,UAAU,CAACpQ,MAAc,EAAE0M,UAA4B,EAC7D;KACC3K,uBAAM,CAACC,IAAI,CAAE,oCAAmChC,MAAO,EAAC,EAAE0M,UAAU,CAAC;KAErE,MAAMC,cAAc,GAAG,8CAAM,IAAI,sCAAgBD,UAAU,CAAC;KAE5D,MAAM2D,YAAwB,GAAG,MAAM7K,wBAAS,CAACpC,sBAAU,CAACkN,cAAc,EAAE;OAC3EzM,IAAI,EAAE;SACLtF,EAAE,EAAEyB,MAAM;SACV6F,MAAM,EAAE8G;QACR;OACDpO,EAAE,EAAEyB;MACJ,CAAC,CAACuD,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;OACtD,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;KAEFzB,uBAAM,CAACC,IAAI,CAAC,gCAAgC,EAAEqO,YAAY,CAAC;KAE3D,MAAMtQ,QAAQ,GAAI,OAAMC,MAAO,EAAC;KAChC,8CAAM,IAAI,0CAAoBD,QAAQ,EAAE2M,UAAU,CAAC;KAEnD,OAAO2D,YAAY;;GAGpB,MAAME,YAAY,CAACxQ,QAAgB,EAAEkN,YAAgC,EACrE;KACClL,uBAAM,CAACC,IAAI,CAAE,wCAAuCjC,QAAS,EAAC,EAAEkN,YAAY,CAAC;KAE7E,MAAMN,cAAc,GAAG,8CAAM,IAAI,sCAAgBM,YAAY,CAAC;KAE9D,IAAIuD,OAAO,GAAG;OACbzQ,QAAQ;OACRK,IAAI,EAAEuM,cAAc,CAACQ,KAAK;OAC1BC,WAAW,EAAET,cAAc,CAACS,WAAW;OACvCC,QAAQ,EAAEV,cAAc,CAACzM;MACzB;KAED,IAAI+M,YAAY,CAACwD,aAAa,EAC9B;OACC,MAAMA,aAAa,GAAGxD,YAAY,CAACwD,aAAa;OAChDD,OAAO,GAAG;SACT,GAAGA,OAAO;SACVtD,OAAO,EAAEuD,aAAa,CAACvD,OAAO;SAC9BwD,mBAAmB,EAAE5H,qBAAK,CAACxK,IAAI,CAACiP,kBAAkB,CAACkD,aAAa,CAACC,mBAAmB,CAAC;SACrFC,sBAAsB,EAAE7H,qBAAK,CAACxK,IAAI,CAACiP,kBAAkB,CAACkD,aAAa,CAACE,sBAAsB,CAAC;SAC3FnD,WAAW,EAAEiD,aAAa,CAACjD,WAAW;SACtC3O,OAAO,EAAE4R,aAAa,CAAC5R;QACvB;;KAGF,MAAMwR,YAAwB,GAAG,MAAM7K,wBAAS,CAACpC,sBAAU,CAACwN,yBAAyB,EAAE;OACtF/M,IAAI,EAAE2M;MACN,CAAC,CAACjN,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,KAAK;;OAErBC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;OACxD,MAAMA,KAAK;MACX,CAAC;KAEFzB,uBAAM,CAACC,IAAI,CAAC,kCAAkC,EAAEqO,YAAY,CAAC;KAE7D,OAAOA,YAAY;;GAGpB,MAAMQ,iBAAiB,CAAC7Q,MAAc,EACtC;KACC,OAAOwF,wBAAS,CAACpC,sBAAU,CAAC0N,0BAA0B,EAAE;OACvDjN,IAAI,EAAE;SAAE7D;;MACR,CAAC,CAACuD,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;OAC7D,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;;CAuDJ;CAAC,iCApDqBkJ,UAA4B,EACjD;GACC,MAAMvK,MAAM,GAAG;KACdgL,KAAK,EAAET,UAAU,CAACS,KAAK;KACvBC,WAAW,EAAEV,UAAU,CAACU,WAAW;KACnCF,OAAO,EAAER,UAAU,CAACQ,OAAO;KAC3BgB,UAAU,EAAExB,UAAU,CAACyB,mBAAmB,GAAG,GAAG,GAAG,GAAG;KACtDG,QAAQ,EAAE5B,UAAU,CAAC4B,QAAQ;KAC7BF,cAAc,EAAE1B,UAAU,CAAC0B,cAAc;KACzCC,iBAAiB,EAAE3B,UAAU,CAAC2B,iBAAiB;KAC/CG,cAAc,EAAE9B,UAAU,CAAC8B,cAAc;KACzCuC,mBAAmB,EAAErE,UAAU,CAACqE,mBAAmB;KACnDC,qBAAqB,EAAEtE,UAAU,CAACsE,qBAAqB;KACvDC,aAAa,EAAEvE,UAAU,CAACuE,aAAa;KACvCC,eAAe,EAAExE,UAAU,CAACwE;IAC5B;GAED,IAAIxE,UAAU,CAACxM,MAAM,EACrB;KACCiC,MAAM,CAACjC,MAAM,GAAG,MAAM4I,qBAAK,CAACpJ,IAAI,CAACiO,SAAS,CAACjB,UAAU,CAACxM,MAAM,CAAC;;GAG9DlC,MAAM,CAAC2Q,OAAO,CAACxM,MAAM,CAAC,CAACtE,OAAO,CAAC,CAAC,CAAC+Q,GAAG,EAAEC,KAAK,CAAC,KAAK;KAChD,IAAIvP,cAAI,CAACwP,WAAW,CAACD,KAAK,CAAC,EAC3B;OACC,OAAO1M,MAAM,CAACyM,GAAG,CAAC;;IAEnB,CAAC;GAEF,OAAOzM,MAAM;CACd;CAAC,6BAEkBpC,QAAgB,EAAE2M,UAA4B,EACjE;GACC,OAAO,4CAAI,sBAAQ7J,QAAQ,CAAC,cAAc,EAAE;KAC3C9C,QAAQ;KACR8F,MAAM,EAAE;OACPzF,IAAI,EAAEsM,UAAU,CAACS,KAAK;OACtBC,WAAW,EAAEV,UAAU,CAACU,WAAW;OACnCF,OAAO,EAAER,UAAU,CAACQ,OAAO;OAC3BiE,WAAW,EAAEzE,UAAU,CAACkB,QAAQ;OAChCvN,IAAI,EAAEqM,UAAU,CAACrM,IAAI;OACrBE,IAAI,EAAE6Q,wCAAkB,CAAC1E,UAAU,CAAC;OACpCc,WAAW,EAAE;SACZc,QAAQ,EAAE5B,UAAU,CAAC4B,QAAQ;SAC7BF,cAAc,EAAE1B,UAAU,CAAC0B,cAAc;SACzCC,iBAAiB,EAAE3B,UAAU,CAAC2B,iBAAiB;SAC/CG,cAAc,EAAE9B,UAAU,CAAC8B;;;IAG7B,CAAC;CACH;;CCvLwC;CAAA;CAAA;AAEzC,CAAO,MAAM6C,aAAa,CAC1B;GAIC/T,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxCoO,UAAU,CAACvR,QAAgB,EAAEwR,OAAe,EAC5C;KACCxP,uBAAM,CAACC,IAAI,CAAC,yBAAyB,EAAEjC,QAAQ,EAAEwR,OAAO,CAAC;KACzD,IAAIA,OAAO,KAAK,EAAE,EAClB;OACC,OAAOtP,OAAO,CAACC,OAAO,EAAE;;KAEzB,MAAM6G,MAAM,GAAG,4CAAI,sBAAQnK,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,CAAC;KACzD,MAAMyR,OAAO,GAAGzI,MAAM,CAAC3I,IAAI;KAE3B,4CAAI,oDAAyBL,QAAQ,EAAEwR,OAAO;KAE9C,OAAO,4CAAI,gCAAapO,UAAU,CAACC,sBAAU,CAACqO,iBAAiB,EAAE;OAChEC,SAAS,EAAE3R,QAAQ;OACnBoN,KAAK,EAAEoE;MACP,CAAC,CAAChO,KAAK,CAAC,MAAM;OACd,4CAAI,oDAAyBxD,QAAQ,EAAEyR,OAAO;OAE9C,MAAM,IAAI9L,KAAK,CAAC,mBAAmB,CAAC;MACpC,CAAC;;CAUJ;CAAC,kCAPwB3F,QAAgB,EAAEoN,KAAa,EACvD;GACC,4CAAI,sBAAQtK,QAAQ,CAAC,cAAc,EAAE;KACpC9C,QAAQ;KACR8F,MAAM,EAAE;OAAEzF,IAAI,EAAE+M;;IAChB,CAAC;CACH;;CCxCwC;CAAA;CAAA;CAAA;AAEzC,CAAO,MAAMwE,WAAW,CACxB;GAMCrU,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;KAEvC,MAAM0O,aAAa,GAAG,GAAG;KACzB,4CAAI,0DAA6BC,iBAAO,CAACC,QAAQ,yCAAC,IAAI,uCAAmBF,aAAa,CAAC;;GAGxFG,QAAQ,CAAChS,QAAgB,EACzB;KACCgC,uBAAM,CAACC,IAAI,CAAC,uBAAuB,EAAEjC,QAAQ,CAAC;KAC9C,4CAAI,sBAAQ8C,QAAQ,CAAC,YAAY,EAAE;OAAE9C;MAAU,CAAC;KAChD,MAAM2D,WAAW,GAAG;OAAEgO,SAAS,EAAE3R,QAAQ;OAAEiS,MAAM,EAAE;MAAK;KAExD,4CAAI,wDAA2BtO,WAAW;;GAG3CuO,UAAU,CAAClS,QAAgB,EAC3B;KACCgC,uBAAM,CAACC,IAAI,CAAC,yBAAyB,EAAEjC,QAAQ,CAAC;KAChD,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE;OAAE9C;MAAU,CAAC;KAClD,MAAM2D,WAAW,GAAG;OAAEgO,SAAS,EAAE3R,QAAQ;OAAEiS,MAAM,EAAE;MAAK;KAExD,4CAAI,wDAA2BtO,WAAW;;CAgB5C;CAAC,2BAbiBA,WAAmD,EACpE;GACC,MAAM;KAAEgO,SAAS,EAAE3R,QAAQ;KAAEiS;IAAQ,GAAGtO,WAAW;GAEnD,OAAO,4CAAI,gCAAaP,UAAU,CAACC,sBAAU,CAAC8O,UAAU,EAAExO,WAAW,CAAC,CAACH,KAAK,CAAEC,KAAK,IAAK;KACvF,MAAM2O,UAAU,GAAGH,MAAM,KAAK,GAAG,GAAG,QAAQ,GAAG,UAAU;;KAEzDvO,OAAO,CAACD,KAAK,CAAE,wBAAuB2O,UAAW,OAAM,EAAE3O,KAAK,CAAC;KAE/D,MAAM4O,UAAU,GAAGJ,MAAM,KAAK,GAAG,GAAG,cAAc,GAAG,YAAY;KACjE,4CAAI,sBAAQnP,QAAQ,CAACuP,UAAU,EAAE;OAAErS;MAAU,CAAC;IAC9C,CAAC;CACH;;CCjDyC;CAAA;AAE1C,CAAO,MAAMsS,UAAU,CACvB;GAIC/U,WAAW,GACX;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxCoP,OAAO,CAACvS,QAAgB,EACxB;KACCgC,uBAAM,CAACC,IAAI,CAAC,qBAAqB,EAAEjC,QAAQ,CAAC;KAC5C,4CAAI,sBAAQ8C,QAAQ,CAAC,YAAY,EAAE;OAClCtE,EAAE,EAAEwB,QAAQ;OACZiS,MAAM,EAAE;MACR,CAAC;KACF,MAAMtO,WAAW,GAAG;OAAEJ,SAAS,EAAEvD,QAAQ;OAAEwS,MAAM,EAAE;MAAK;KACxD,4CAAI,gCAAapP,UAAU,CAACC,sBAAU,CAACoP,WAAW,EAAE9O,WAAW,CAAC,CAACH,KAAK,CAAEC,KAAK,IAAK;;OAEjFC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;OACtD,4CAAI,sBAAQX,QAAQ,CAAC,YAAY,EAAE;SAAEtE,EAAE,EAAEwB,QAAQ;SAAEiS,MAAM,EAAE;QAAO,CAAC;MACnE,CAAC;;GAGHS,SAAS,CAAC1S,QAAgB,EAC1B;KACCgC,uBAAM,CAACC,IAAI,CAAC,uBAAuB,EAAEjC,QAAQ,CAAC;KAC9C,4CAAI,sBAAQ8C,QAAQ,CAAC,YAAY,EAAE;OAClCtE,EAAE,EAAEwB,QAAQ;OACZiS,MAAM,EAAE;MACR,CAAC;KACF,MAAMtO,WAAW,GAAG;OAAEJ,SAAS,EAAEvD,QAAQ;OAAEwS,MAAM,EAAE;MAAK;KACxD,4CAAI,gCAAapP,UAAU,CAACC,sBAAU,CAACoP,WAAW,EAAE9O,WAAW,CAAC,CAACH,KAAK,CAAEC,KAAK,IAAK;;OAEjFC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;OACxD,4CAAI,sBAAQX,QAAQ,CAAC,YAAY,EAAE;SAAEtE,EAAE,EAAEwB,QAAQ;SAAEiS,MAAM,EAAE;QAAM,CAAC;MAClE,CAAC;;CAEJ;;CC7BA,MAAMU,YAAY,GAAG,GAAG;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEzB,CAAO,MAAMC,WAAW,CACxB;GAMCrV,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAHmD;;KAIlD,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxC0P,OAAO,GACP;KACC7Q,uBAAM,CAACC,IAAI,CAAC,sBAAsB,CAAC;KACnC,4CAAI,sBAAQa,QAAQ,CAAC,qBAAqB,CAAC;KAC3C,4CAAI,sBAAQA,QAAQ,CAAC,oBAAoB,CAAC;KAE1C,OAAO,4CAAI,gCAAaM,UAAU,CAACC,sBAAU,CAACyP,eAAe,CAAC,CAC5DtP,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAClD,CAAC;;GAGJsP,UAAU,CAAC/S,QAAgB,EAC3B;KACCgC,uBAAM,CAACC,IAAI,CAAC,yBAAyB,EAAEjC,QAAQ,CAAC;KAChD,4CAAI,sBAAQ8C,QAAQ,CAAC,eAAe,EAAE;OACrCtE,EAAE,EAAEwB,QAAQ;OACZiS,MAAM,EAAE;MACR,CAAC;KACF,4CAAI,sBAAQnP,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SAAE/F,OAAO,EAAE;;MACnB,CAAC;KACF,4CAAI,gCAAaqD,UAAU,CAACC,sBAAU,CAAC2P,YAAY,EAAE;OAAEhT;MAAU,CAAC,CAChEwD,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,CAAC;;GAGJwP,YAAY,CAACjT,QAAgB,EAC7B;KACCgC,uBAAM,CAACC,IAAI,CAAC,2BAA2B,EAAEjC,QAAQ,CAAC;KAClD,4CAAI,sBAAQ8C,QAAQ,CAAC,eAAe,EAAE;OACrCtE,EAAE,EAAEwB,QAAQ;OACZiS,MAAM,EAAE;MACR,CAAC;KACF,4CAAI,gCAAa7O,UAAU,CAACC,sBAAU,CAAC6P,cAAc,EAAE;OAAElT;MAAU,CAAC,CAClEwD,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;OACjE,4CAAI,sBAAQX,QAAQ,CAAC,eAAe,EAAE;SAAEtE,EAAE,EAAEwB,QAAQ;SAAEiS,MAAM,EAAE;QAAO,CAAC;MACtE,CAAC;;GAGJkB,WAAW,CAAClT,MAAc,EAAEJ,SAAiB,EAC7C;KACC,IAAI,CAAC,4CAAI,oCAAiBI,MAAM,CAAC,EACjC;OACC,4CAAI,oCAAiBA,MAAM,CAAC,GAAG,IAAIiB,GAAG,EAAE;;KAEzC,4CAAI,oCAAiBjB,MAAM,CAAC,CAACmT,GAAG,CAACvT,SAAS,CAAC;KAE3CwT,YAAY,CAAC,IAAI,CAACC,WAAW,CAAC;KAC9B,IAAI,CAACA,WAAW,GAAGC,UAAU,CAAC,MAAM;OACnCtV,MAAM,CAAC2Q,OAAO,yCAAC,IAAI,oCAAiB,CAAC9Q,OAAO,CAAC,CAAC,CAAC0V,SAAS,EAAE7J,UAAU,CAAC,KAAK;SACzE,4CAAI,8CAAsB6J,SAAS,EAAE7J,UAAU;QAC/C,CAAC;MACF,EAAEgJ,YAAY,CAAC;;GAGjB,MAAMc,sBAAsB,CAACxT,MAAc,EAC3C;KACC,IAAI,CAAC,4CAAI,oCAAiBA,MAAM,CAAC,EACjC;OACC,OAAO,IAAI;;KAGZoT,YAAY,CAAC,IAAI,CAACC,WAAW,CAAC;KAE9B,+CAAO,IAAI,8CAAsBrT,MAAM,EAAE,4CAAI,oCAAiBA,MAAM,CAAC;;GA+BtEyT,eAAe,CAAC1T,QAAgB,EAChC;KACCgC,uBAAM,CAACC,IAAI,CAAC,gCAAgC,EAAEjC,QAAQ,CAAC;KACvD,MAAMgJ,MAAmB,GAAG,4CAAI,sBAAQnK,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,CAAC;KACtE,MAAM6C,UAA6B,GAAG,4CAAI,sBAAQhE,OAAO,CAAC,YAAY,CAAC,CAACmB,QAAQ,CAAC;KACjF,IAAIgJ,MAAM,CAAC2K,QAAQ,KAAK,CAAC,IAAI,EAAC9Q,UAAU,YAAVA,UAAU,CAAE+Q,MAAM,GAChD;OACC;;KAED,4CAAI,sBAAQ9Q,QAAQ,CAAC,eAAe,EAAE;OACrCtE,EAAE,EAAEwB,QAAQ;OACZiS,MAAM,EAAE;MACR,CAAC;KACF,4CAAI,sBAAQnP,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SACP6N,QAAQ,EAAE;;MAEX,CAAC;KACF,4CAAI,gCAAavQ,UAAU,CAACC,sBAAU,CAAC2P,YAAY,EAAE;OACpDhT,QAAQ;OACR6T,UAAU,EAAE;MACZ,CAAC,CAACrQ,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;MAC/D,CAAC;;CA6GJ;CAAC,qCAlK2B+P,SAAiB,EAAE7J,UAAuB,EACrE;GACC,MAAMmK,WAAW,GAAG/S,MAAM,CAACC,QAAQ,CAACwS,SAAS,EAAE,EAAE,CAAC;GAClDxR,uBAAM,CAACC,IAAI,CAAC,2BAA2B,EAAE0H,UAAU,CAAC;GACpD,IAAIA,UAAU,CAACoK,IAAI,KAAK,CAAC,EACzB;KACC,OAAO,IAAI;;GAGZ,MAAMC,gBAAgB,GAAG,CAAC,GAAGrK,UAAU,CAAC;GACxC,OAAO,4CAAI,oCAAiBmK,WAAW,CAAC;GAExC,MAAMG,iBAAiB,GAAG,8CAAM,IAAI,8CAAsBH,WAAW,EAAEE,gBAAgB,CAAC;GAExFhS,uBAAM,CAACC,IAAI,CAAC,qDAAqD,EAAEgS,iBAAiB,CAAC;GACrF,8CAAM,IAAI,8CAAsBH,WAAW,EAAEG,iBAAiB,CAAC;GAE/D,MAAMC,UAAU,GAAG,MAAM,4CAAI,8CAAsBJ,WAAW,EAAEE,gBAAgB,EAC9ExQ,KAAK,CAAEC,KAAK,IAAK;;KAEjBC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC1D,CAAC;GAEH,4CAAI,wCAAmByQ,UAAU;GAEjC,OAAO,IAAI;CACZ;CAAC,+BA8BoBjU,MAAc,EAAE0J,UAAoB,EACzD;GACC,MAAMwK,YAAY,GAAGC,IAAI,CAACC,GAAG,CAAC,GAAG1K,UAAU,CAAC;GAC5C,MAAMX,MAAM,2CAAG,IAAI,0CAAoB/I,MAAM,CAAC;GAC9C,IAAIkU,YAAY,GAAGnL,MAAM,CAACsL,UAAU,EACpC;KACC,4CAAI,sBAAQxR,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ,0CAAE,IAAI,8CAAsBC,MAAM,CAAC;OAC3C6F,MAAM,EAAE;SACPyO,MAAM,EAAEJ;;MAET,CAAC;;GAGH,OAAO,4CAAI,sBAAQrR,QAAQ,CAAC,uBAAuB,EAAE;KACpD7C,MAAM;KACN0J;IACA,CAAC;CACH;CAAC,kCAEuB1J,MAAc,EAAEgU,iBAAyB,EACjE;GACC,MAAMxV,IAAI,2CAAG,IAAI,0CAAoBwB,MAAM,CAAC;GAC5C,IAAIuU,UAAU,GAAG/V,IAAI,CAACsB,OAAO,GAAGkU,iBAAiB;GACjD,IAAIO,UAAU,GAAG,CAAC,EAClB;KACCA,UAAU,GAAG,CAAC;;GAGf,MAAMC,QAAQ,GAAG;KAChB,CAAChW,IAAI,CAACiW,YAAY,GAAG;OACpB,CAACzU,MAAM,GAAGuU;;IAEX;GAED,OAAO7V,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,6BAA6B,EAAE2R,QAAQ,CAAC;CACzE;CAAC,+BAEoBxU,MAAc,EAAEgU,iBAAyB,EAC9D;GACC,MAAMxV,IAAI,2CAAG,IAAI,0CAAoBwB,MAAM,CAAC;GAC5C,IAAIxB,IAAI,CAAC6B,IAAI,KAAKC,oBAAQ,CAACoU,OAAO,EAClC;KACC,+CAAO,IAAI,oDAAyB1U,MAAM,EAAEgU,iBAAiB;;GAG9D,IAAIO,UAAU,GAAG/V,IAAI,CAACsB,OAAO,GAAGkU,iBAAiB;GACjD,IAAIO,UAAU,GAAG,CAAC,EAClB;KACCA,UAAU,GAAG,CAAC;;GAGf,OAAO,4CAAI,sBAAQ1R,QAAQ,CAAC,cAAc,EAAE;KAC3C9C,QAAQ,0CAAE,IAAI,8CAAsBC,MAAM,CAAC;KAC3C6F,MAAM,EAAE;OAAE/F,OAAO,EAAEyU;;IACnB,CAAC;CACH;CAAC,+BAEoBvU,MAAc,EAAE0J,UAAoB,EACzD;GACC3H,uBAAM,CAACC,IAAI,CAAC,qCAAqC,EAAE0H,UAAU,CAAC;GAE9D,OAAOlE,wBAAS,CAACpC,sBAAU,CAACuR,mBAAmB,EAAE;KAChD9Q,IAAI,EAAE;OACL7D,MAAM;OACN4U,GAAG,EAAElL,UAAU;OACfmL,UAAU,EAAEC,0BAAW,CAACpT,WAAW,EAAE,CAACqT,aAAa;;IAEpD,CAAC;CACH;CAAC,4BAEiBd,UAAsB,EACxC;GACC,IAAI,CAACA,UAAU,EACf;KACC;;GAGD,MAAM;KAAEjU,MAAM;KAAEF;IAAS,GAAGmU,UAAU;GAEtC,MAAMlL,MAAM,2CAAG,IAAI,0CAAoB/I,MAAM,CAAC;GAC9C,IAAI+I,MAAM,CAACjJ,OAAO,GAAGA,OAAO,EAC5B;KACCiC,uBAAM,CAACC,IAAI,CAAC,0DAA0D,EAAE+G,MAAM,CAACjJ,OAAO,EAAEA,OAAO,CAAC;KAChG,4CAAI,sBAAQ+C,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ,EAAEgJ,MAAM,CAAChJ,QAAQ;OACzB8F,MAAM,EAAE;SAAE/F;;MACV,CAAC;;CAEJ;CAAC,+BAEoBE,MAAc,EACnC;GACC,MAAM+I,MAAM,GAAG,4CAAI,sBAAQnK,OAAO,CAAC,mBAAmB,CAAC,CAACoB,MAAM,CAAC;GAC/D,IAAI,CAAC+I,MAAM,EACX;KACC,OAAO,CAAC;;GAGT,OAAOA,MAAM,CAAChJ,QAAQ;CACvB;CAAC,6BAEkBC,MAAc,EACjC;GACC,OAAO,4CAAI,sBAAQpB,OAAO,CAAC,mBAAmB,CAAC,CAACoB,MAAM,CAAC;CACxD;;CCtPD,MAAMgV,mBAAmB,GAAG;GAC3BC,wBAAwB,EAAE,6BAA6B;GACvDC,YAAY,EAAE;CACf,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEF,CAAO,MAAMC,WAAW,CACxB;GAIC7X,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxCkS,SAAS,CAACC,SAAoE,EAC9E;KACC,MAAM3R,WAAW,GAAG;OACnBzD,OAAO,EAAEoV,SAAS,CAACrV,MAAM;OACzBjC,KAAK,EAAEsX,SAAS,CAACxH,OAAO;OACxByH,YAAY,EAAE,CAACD,SAAS,CAACE;MACzB;KAED,OAAO,4CAAI,gCAAapS,UAAU,CAACC,sBAAU,CAACoS,aAAa,EAAE9R,WAAW,CAAC;;GAG1E,MAAM+R,gBAAgB,CAAC1V,QAAgB,EAAE2V,MAAc,EACvD;KACC,MAAMhS,WAAW,GAAG;OAAE3D,QAAQ;OAAE2V;MAAQ;KACxC,IACA;OACC,MAAM,4CAAI,gCAAavS,UAAU,CAACC,sBAAU,CAACuS,kBAAkB,EAAEjS,WAAW,CAAC;MAC7E,CACD,OAAOF,KAAK,EACZ;OACC,4CAAI,sCAAkBA,KAAK;;;GAI7B,MAAMoS,kBAAkB,CAAC7V,QAAgB,EAAE2V,MAAc,EACzD;KACC,MAAMG,cAAc,GAAG,MAAM;KAC7B,MAAMhI,OAAO,GAAG,CAAC,CAACgI,cAAc,EAAEH,MAAM,CAAC,CAAC;KAE1C,MAAMlF,OAAO,GAAG;OACf3M,IAAI,EAAE;SAAE9D,QAAQ;SAAE8N;;MAClB;KAED,IACA;OACC,MAAMrI,wBAAS,CAACpC,sBAAU,CAAC0S,yBAAyB,EAAEtF,OAAO,CAAC;MAC9D,CACD,OAAOvG,MAAM,EACb;OACCxG,OAAO,CAACD,KAAK,CAAC,wCAAwC,EAAEyG,MAAM,CAAC;OAC/D,4CAAI,4CAAmB4B,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;;;GAIvF,MAAMiK,SAAS,CAAChW,QAAgB,EAChC;KACC,MAAM2D,WAAW,GAAG;OAAE3D,QAAQ;OAAE2V,MAAM,EAAEhX,2BAAI,CAACsX,SAAS;MAAI;KAC1D,IACA;OACC,MAAM,4CAAI,gCAAa7S,UAAU,CAACC,sBAAU,CAACuS,kBAAkB,EAAEjS,WAAW,CAAC;OAC7E,4CAAI,8BAAc3D,QAAQ;MAC1B,CACD,OAAOyD,KAAK,EACZ;OACC,4CAAI,wCAAmBA,KAAK;;;GAI9B,MAAMyS,WAAW,CAAClW,QAAgB,EAClC;KACC,MAAMyQ,OAAO,GAAG;OACf3M,IAAI,EAAE;SAAE9D;;MACR;KAED,IACA;OACC,MAAMyF,wBAAS,CAACpC,sBAAU,CAAC8S,wBAAwB,EAAE1F,OAAO,CAAC;OAE7D,4CAAI,8BAAczQ,QAAQ;MAC1B,CACD,OAAOkK,MAAM,EACb;OACCxG,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEyG,MAAM,CAAC;OACxD,4CAAI,4CAAmB4B,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;;;GAIxFqK,QAAQ,CAACpW,QAAgB,EACzB;KACCgC,uBAAM,CAACC,IAAI,CAAE,0BAAyBjC,QAAS,EAAC,CAAC;KACjD,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SACPtF,IAAI,EAAEC,oBAAQ,CAACC;;MAEhB,CAAC;KAEF,4CAAI,gCAAa0C,UAAU,CAACC,sBAAU,CAACgT,YAAY,EAAE;OACpDrW;MACA,CAAC,CAACwD,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,CAAC;;GAGH6S,UAAU,CAACtW,QAAgB,EAAE2V,MAAc,EAC3C;KACC3T,uBAAM,CAACC,IAAI,CAAE,4BAA2B0T,MAAO,OAAM3V,QAAS,EAAC,CAAC;KAChE,MAAM;OAAEoR;MAA0B,GAAG,4CAAI,sBAAQvS,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,CAAC;KAC/E,IAAIoR,WAAW,CAACmF,QAAQ,CAACZ,MAAM,CAAC,EAChC;OACC;;KAED,MAAMa,cAAc,GAAG,CAAC,GAAGpF,WAAW,EAAEuE,MAAM,CAAC;KAC/C,4CAAI,sBAAQ7S,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SAAEsL,WAAW,EAAEoF;;MACvB,CAAC;KAEF,MAAM/F,OAAO,GAAG;OACf3M,IAAI,EAAE;SACL9D,QAAQ;SACRyW,OAAO,EAAE,CAACd,MAAM;;MAEjB;KAEDlQ,wBAAS,CAACpC,sBAAU,CAACqT,mBAAmB,EAAEjG,OAAO,CAAC,CAChDjN,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACtD,CAAC;;GAGJkT,aAAa,CAAC3W,QAAgB,EAAE2V,MAAc,EAC9C;KACC3T,uBAAM,CAACC,IAAI,CAAE,+BAA8B0T,MAAO,SAAQ3V,QAAS,EAAC,CAAC;KACrE,MAAM;OAAEoR;MAA0B,GAAG,4CAAI,sBAAQvS,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,CAAC;KAC/E,IAAI,CAACoR,WAAW,CAACmF,QAAQ,CAACZ,MAAM,CAAC,EACjC;OACC;;KAED,MAAMa,cAAc,GAAGpF,WAAW,CAACwF,MAAM,CAAEC,SAAS,IAAKA,SAAS,KAAKlB,MAAM,CAAC;KAC9E,4CAAI,sBAAQ7S,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SAAEsL,WAAW,EAAEoF;;MACvB,CAAC;KAEF,MAAM/F,OAAO,GAAG;OACf3M,IAAI,EAAE;SACL9D,QAAQ;SACRyW,OAAO,EAAE,CAACd,MAAM;;MAEjB;KAEDlQ,wBAAS,CAACpC,sBAAU,CAACyT,sBAAsB,EAAErG,OAAO,CAAC,CACnDjN,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;MACzD,CAAC;;CA+DL;CAAC,uBA5DazD,QAAgB,EAC7B;GACC,KAAK,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE;KACzC9C,QAAQ;KACR8F,MAAM,EAAE;OAAEC,MAAM,EAAE;;IAClB,CAAC;GACF,KAAK,4CAAI,sBAAQjD,QAAQ,CAAC,eAAe,EAAE;KAAEtE,EAAE,EAAEwB;IAAU,CAAC;GAE5D,MAAM+C,YAAY,GAAG,4CAAI,sBAAQlE,OAAO,CAAC,wBAAwB,CAAC,CAACmB,QAAQ,CAAC;GAC5E,IAAI+C,YAAY,EAChB;KACCC,8BAAa,CAACrB,WAAW,EAAE,CAACsB,0BAA0B,EAAE;KACxD,KAAKD,8BAAa,CAACrB,WAAW,EAAE,CAACuB,2BAA2B,CAAClD,QAAQ,CAAC;;CAExE;CAAC,2BAEgByD,KAAgB,EACjC;GAAA;;GAECC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;GAE5D,MAAMsT,2BAA2B,GAAG;KACnC,CAAC9B,mBAAmB,CAACC,wBAAwB,GAAGpJ,aAAG,CAACC,UAAU,CAAC,uDAAuD,CAAC;KACvHiL,OAAO,EAAElL,aAAG,CAACC,UAAU,CAAC,4CAA4C;IACpE;GAED,MAAMkL,SAAS,2CAAG,IAAI,gCAAexT,KAAK,CAAC;GAC3C,MAAMyT,gBAAgB,4BAAGH,2BAA2B,CAACE,SAAS,CAAC,oCAAIF,2BAA2B,CAACC,OAAO;GACtG,4CAAI,4CAAmBE,gBAAgB;CACxC;CAAC,4BAEiBzT,KAAgB,EAClC;GAAA;;GAECC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;GAEvD,MAAMsT,2BAA2B,GAAG;KACnC,CAAC9B,mBAAmB,CAACC,wBAAwB,GAAGpJ,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;KAC/GiL,OAAO,EAAElL,aAAG,CAACC,UAAU,CAAC,6CAA6C;IACrE;GAED,MAAMkL,SAAS,2CAAG,IAAI,gCAAexT,KAAK,CAAC;GAC3C,MAAMyT,gBAAgB,6BAAGH,2BAA2B,CAACE,SAAS,CAAC,qCAAIF,2BAA2B,CAACC,OAAO;GACtG,4CAAI,4CAAmBE,gBAAgB;CACxC;CAAC,8BAEiBlL,IAAY,EAC9B;GACCC,EAAE,CAACC,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;KAChCC,OAAO,EAAEN,IAAI;KACbmL,aAAa,EAAE;IACf,CAAC;CACH;CAAC,wBAEa1T,KAAgB,EAC9B;GACC,MAAM;KAAE2T,MAAM,EAAE;OAAE3T,KAAK,EAAEwT;;IAAa,GAAGxT,KAAK;GAE9C,OAAOwT,SAAS;CACjB;;CChP4C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAI7C,CAAO,MAAMI,WAAW,CACxB;GAWC9Z,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI;;;;GAIL6K,QAAQ,CAACpI,QAAgB,EACzB;KACC,OAAO,4CAAI,8BAAcoI,QAAQ,CAACpI,QAAQ,CAAC;;GAG5CsI,gBAAgB,CAACrI,MAAc,EAC/B;KACC,OAAO,4CAAI,8BAAcqI,gBAAgB,CAACrI,MAAM,CAAC;;GAGlD0I,oBAAoB,CAAC3I,QAAgB,EACrC;KACC,OAAO,4CAAI,8BAAc2I,oBAAoB,CAAC3I,QAAQ,CAAC;;GAGxD4I,mBAAmB,CAAC5I,QAAgB,EAAEH,SAAiB,EACvD;KACC,OAAO,4CAAI,8BAAc+I,mBAAmB,CAAC5I,QAAQ,EAAEH,SAAS,CAAC;;GAGlEwJ,YAAY,CAACC,MAAc,EAC3B;KACC,OAAO,4CAAI,8BAAcD,YAAY,CAACC,MAAM,CAAC;;GAG9CG,eAAe,CAACC,eAAuB,EACvC;KACC,OAAO,4CAAI,8BAAcD,eAAe,CAACC,eAAe,CAAC;;GAG1DZ,eAAe,CAAC9I,QAAgB,EAChC;KACC,OAAO,4CAAI,8BAAc8I,eAAe,CAAC9I,QAAQ,CAAC;;GAGnD+J,SAAS,CAAC/J,QAAgB,EAC1B;KACC,OAAO,4CAAI,8BAAc+J,SAAS,CAAC/J,QAAQ,CAAC;;;;;GAK7C0M,UAAU,CAACC,UAAU,EACrB;KACC,OAAO,4CAAI,kCAAgBD,UAAU,CAACC,UAAU,CAAC;;GAGlDM,YAAY,CAACC,YAAY,EACzB;KACC,OAAO,4CAAI,kCAAgBD,YAAY,CAACC,YAAY,CAAC;;;;;GAKtDsC,aAAa,CAACC,UAAgB,EAC9B;KACC,OAAO,4CAAI,kCAAgBD,aAAa,CAACC,UAAU,CAAC;;GAGrDS,YAAY,CAACjQ,MAAc,EAAEwP,UAAgB,EAC7C;KACC,OAAO,4CAAI,kCAAgBS,YAAY,CAACjQ,MAAM,EAAEwP,UAAU,CAAC;;GAG5DY,UAAU,CAACpQ,MAAc,EAAE0M,UAA4B,EACvD;KACC,OAAO,4CAAI,kCAAgB0D,UAAU,CAACpQ,MAAM,EAAE0M,UAAU,CAAC;;GAG1D6D,YAAY,CAACxQ,QAAgB,EAAEkN,YAAY,EAC3C;KACC,OAAO,4CAAI,kCAAgBsD,YAAY,CAACxQ,QAAQ,EAAEkN,YAAY,CAAC;;GAGhE4D,iBAAiB,CAAC7Q,MAAc,EAChC;KACC,OAAO,4CAAI,kCAAgB6Q,iBAAiB,CAAC7Q,MAAM,CAAC;;;;;GAKrDsF,UAAU,CAACvF,QAAgB,EAC3B;KACC,OAAO,4CAAI,kCAAgBuF,UAAU,CAACvF,QAAQ,CAAC;;GAGhD4F,YAAY,CAAC5F,QAAgB,EAC7B;KACC,OAAO,4CAAI,kCAAgB4F,YAAY,CAAC5F,QAAQ,CAAC;;;;;GAKlDuR,UAAU,CAACvR,QAAgB,EAAEwR,OAAe,EAC5C;KACC,OAAO,4CAAI,kCAAgBD,UAAU,CAACvR,QAAQ,EAAEwR,OAAO,CAAC;;;;;GAKzDQ,QAAQ,CAAChS,QAAgB,EACzB;KACC,4CAAI,8BAAcgS,QAAQ,CAAChS,QAAQ,CAAC;;GAGrCkS,UAAU,CAAClS,QAAgB,EAC3B;KACC,4CAAI,8BAAckS,UAAU,CAAClS,QAAQ,CAAC;;;;;GAKvCuS,OAAO,CAACvS,QAAgB,EACxB;KACC,4CAAI,4BAAauS,OAAO,CAACvS,QAAQ,CAAC;;GAGnC0S,SAAS,CAAC1S,QAAgB,EAC1B;KACC,4CAAI,4BAAa0S,SAAS,CAAC1S,QAAQ,CAAC;;;;;GAKrC6S,OAAO,GACP;KACC,OAAO,4CAAI,8BAAcA,OAAO,EAAE;;GAGnCE,UAAU,CAAC/S,QAAgB,EAC3B;KACC,4CAAI,8BAAc+S,UAAU,CAAC/S,QAAQ,CAAC;;GAGvCiT,YAAY,CAACjT,QAAgB,EAC7B;KACC,4CAAI,8BAAciT,YAAY,CAACjT,QAAQ,CAAC;;GAGzCmT,WAAW,CAAClT,MAAc,EAAEJ,SAAiB,EAC7C;KACC,4CAAI,8BAAcsT,WAAW,CAAClT,MAAM,EAAEJ,SAAS,CAAC;;GAGjD4T,sBAAsB,CAACxT,MAAc,EACrC;KACC,OAAO,4CAAI,8BAAcwT,sBAAsB,CAACxT,MAAM,CAAC;;GAGxDyT,eAAe,CAAC1T,QAAgB,EAChC;KACC,4CAAI,8BAAc0T,eAAe,CAAC1T,QAAQ,CAAC;;;;;GAK5CgW,SAAS,CAAChW,QAAgB,EAC1B;KACC,4CAAI,8BAAcgW,SAAS,CAAChW,QAAQ,CAAC;;GAGtCkW,WAAW,CAAClW,QAAgB,EAC5B;KACC,KAAK,4CAAI,8BAAckW,WAAW,CAAClW,QAAQ,CAAC;;GAG7C0V,gBAAgB,CAAC1V,QAAgB,EAAE2V,MAAc,EACjD;KACC,4CAAI,8BAAcD,gBAAgB,CAAC1V,QAAQ,EAAE2V,MAAM,CAAC;;GAGrDE,kBAAkB,CAAC7V,QAAgB,EAAE2V,MAAc,EACnD;KACC,4CAAI,8BAAcE,kBAAkB,CAAC7V,QAAQ,EAAE2V,MAAM,CAAC;;GAGvDN,SAAS,CAACC,SAAoE,EAC9E;KACC,OAAO,4CAAI,8BAAcD,SAAS,CAACC,SAAS,CAAC;;GAG9Cc,QAAQ,CAACpW,QAAgB,EACzB;KACC,4CAAI,8BAAcoW,QAAQ,CAACpW,QAAQ,CAAC;;GAGrCsW,UAAU,CAACtW,QAAgB,EAAE2V,MAAc,EAC3C;KACC,4CAAI,8BAAcW,UAAU,CAACtW,QAAQ,EAAE2V,MAAM,CAAC;;GAG/CgB,aAAa,CAAC3W,QAAgB,EAAE2V,MAAc,EAC9C;KACC,4CAAI,8BAAcgB,aAAa,CAAC3W,QAAQ,EAAE2V,MAAM,CAAC;;;CAgBnD;CAAC,0BAXA;GACC,4CAAI,gCAAgB,IAAIxN,WAAW,EAAE;GACrC,4CAAI,oCAAkB,IAAIsE,aAAa,EAAE;GACzC,4CAAI,oCAAkB,IAAI8C,aAAa,EAAE;GACzC,4CAAI,oCAAkB,IAAI+B,aAAa,EAAE;GACzC,4CAAI,gCAAgB,IAAIM,WAAW,EAAE;GACrC,4CAAI,8BAAe,IAAIU,UAAU,EAAE;GACnC,4CAAI,gCAAgB,IAAIM,WAAW,EAAE;GACrC,4CAAI,gCAAgB,IAAIwC,WAAW,EAAE;GACrC,4CAAI,oCAAkB,IAAI9P,aAAa,EAAE;CAC1C;;CCpOkD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAMnD,CAAO,MAAM6C,aAAW,CACxB;GAWC5K,WAAW,CAAC0C,MAAc,EAC1B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OALyC;;KAAE;OAAA;OAAA,OACH;;KAAE;OAAA;OAAA,OACpB;;KAIrB,4CAAI,wBAAUtB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,gCAAgB,IAAIgI,0BAAW,EAAE;KAErC,4CAAI,sBAAW3G,MAAM;;GAGtB,MAAMqX,UAAU,GAChB;KACC,IAAI,4CAAI,6BAAe,CAAC,4CAAI,4BAAc5Q,WAAW,EACrD;OACC,OAAOxE,OAAO,CAACC,OAAO,CAAC,KAAK,CAAC;;KAE9BH,uBAAM,CAACC,IAAI,CAAC,4BAA4B,CAAC;KACzC,MAAMsV,mBAAmB,GAAG,4CAAI,sBAAQ1Y,OAAO,CAAC,oBAAoB,CAAC,yCAAC,IAAI,oBAAS;KACnF,IAAI,CAAC0Y,mBAAmB,EACxB;OACCvV,uBAAM,CAACC,IAAI,CAAC,0DAA0D,CAAC;OAEvE,OAAOC,OAAO,CAACC,OAAO,CAAC,KAAK,CAAC;;KAG9B,4CAAI,4BAAc,IAAI;KAEtB,MAAMqV,KAAK,GAAG;OACbvX,MAAM,0CAAE,IAAI,mBAAQ;OACpB2W,MAAM,EAAE;SAAErC,MAAM,EAAEgD;QAAqB;OACvCE,KAAK,EAAE;SAAEjZ,EAAE,EAAE;QAAO;OACpBkZ,KAAK,EAAEvP,aAAW,CAACwP;MACnB;KAED,MAAMvV,MAA4B,GAAG,MAAMqD,wBAAS,CAACpC,sBAAU,CAACuU,mBAAmB,EAAE;OAAE9T,IAAI,EAAE0T;MAAO,CAAC,CACnGhU,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;OACzD,4CAAI,4BAAc,KAAK;MACvB,CAAC;KAEHzB,uBAAM,CAACC,IAAI,CAAC,mCAAmC,EAAEG,MAAM,CAAC;KACxD,4CAAI,sDAA2BA,MAAM,CAAChE,QAAQ;KAE9C,MAAMX,OAA6B,GAAG;OACrC,GAAG2E,MAAM;OACTuE,kBAAkB,0CAAE,IAAI,0DAA4BvE,MAAM,CAACuE,kBAAkB;MAC7E;KACD,8CAAM,IAAI,oCAAelJ,OAAO,CAAC;KAEjC,4CAAI,4BAAc,KAAK;KAEvB,OAAOyE,OAAO,CAACC,OAAO,EAAE;;GAGzB,MAAM0V,WAAW,GACjB;KACC,IAAI,4CAAI,6BAAe,CAAC,4CAAI,4BAAcpR,WAAW,EACrD;OACC,OAAOvE,OAAO,CAACC,OAAO,CAAC,KAAK,CAAC;;KAE9BH,uBAAM,CAACC,IAAI,CAAC,6BAA6B,CAAC;KAC1C,MAAM6V,oBAAoB,GAAG,4CAAI,sBAAQjZ,OAAO,CAAC,qBAAqB,CAAC,yCAAC,IAAI,oBAAS;KACrF,IAAI,CAACiZ,oBAAoB,EACzB;OACC9V,uBAAM,CAACC,IAAI,CAAC,2DAA2D,CAAC;OAExE,OAAOC,OAAO,CAACC,OAAO,EAAE;;KAGzB,4CAAI,4BAAc,IAAI;KAEtB,MAAMqV,KAAK,GAAG;OACbvX,MAAM,0CAAE,IAAI,mBAAQ;OACpB2W,MAAM,EAAE;SAAErC,MAAM,EAAEuD;QAAsB;OACxCL,KAAK,EAAE;SAAEjZ,EAAE,EAAE;QAAQ;OACrBkZ,KAAK,EAAEvP,aAAW,CAACwP;MACnB;KAED,MAAMvV,MAA4B,GAAG,MAAMqD,wBAAS,CAACpC,sBAAU,CAACuU,mBAAmB,EAAE;OAAE9T,IAAI,EAAE0T;MAAO,CAAC,CACnGhU,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;OAC1D,4CAAI,4BAAc,KAAK;MACvB,CAAC;KAEHzB,uBAAM,CAACC,IAAI,CAAC,oCAAoC,EAAEG,MAAM,CAAC;KACzD,4CAAI,wDAA4BA,MAAM,CAAChE,QAAQ;KAE/C,MAAMqI,WAAW,GAAGrE,MAAM,CAACsE,WAAW;KACtC,MAAMjJ,OAAO,GAAG;OAAE,GAAG2E,MAAM;OAAEqE,WAAW;OAAEC,WAAW,EAAE;MAAM;KAC7D,8CAAM,IAAI,oCAAejJ,OAAO,CAAC;KAEjC,4CAAI,4BAAc,KAAK;KAEvB,OAAOyE,OAAO,CAACC,OAAO,EAAE;;GAGzB4V,0BAA0B,GAC1B;KACC,OAAO,4CAAI,sDAA0B5S,MAAM,GAAG,CAAC;;GAGhD6S,2BAA2B,GAC3B;KACC,IAAI,CAAC,IAAI,CAACD,0BAA0B,EAAE,EACtC;OACC,OAAO7V,OAAO,CAACC,OAAO,EAAE;;KAGzB,OAAO,4CAAI,sBAAQW,QAAQ,CAAC,4BAA4B,EAAE;OACzD1E,QAAQ,0CAAE,IAAI;MACd,CAAC,CAACgL,IAAI,CAAC,MAAM;OACb,4CAAI,wDAA4B,EAAE;OAElC,OAAO,IAAI;MACX,CAAC;;GAGH6O,yBAAyB,GACzB;KACC,OAAO,4CAAI,oDAAyB9S,MAAM,GAAG,CAAC;;GAG/C+S,0BAA0B,GAC1B;KACC,IAAI,CAAC,IAAI,CAACD,yBAAyB,EAAE,EACrC;OACC,OAAO/V,OAAO,CAACC,OAAO,EAAE;;KAGzB,OAAO,4CAAI,sBAAQW,QAAQ,CAAC,4BAA4B,EAAE;OACzD1E,QAAQ,0CAAE,IAAI;MACd,CAAC,CAACgL,IAAI,CAAC,MAAM;OACb,4CAAI,sDAA2B,EAAE;OAEjC,OAAO,IAAI;MACX,CAAC;;GAGH,MAAMtH,aAAa,GACnB;KACCE,uBAAM,CAACC,IAAI,CAAC,qCAAqC,0CAAE,IAAI,oBAAS;KAChE,4CAAI,4BAAc,IAAI;KAEtB,MAAMwO,OAAO,GAAG;OACf3M,IAAI,EAAE;SACL7D,MAAM,0CAAE,IAAI,mBAAQ;SACpByX,KAAK,EAAEvP,aAAW,CAACwP,qBAAqB;SACxCF,KAAK,EAAE;WAAEjZ,EAAE,EAAE;;;MAEd;KACD,MAAMyH,UAAU,GAAG,MAAMR,wBAAS,CAACpC,sBAAU,CAACuU,mBAAmB,EAAEnH,OAAO,CAAC,CACzEjN,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;OAC5D,4CAAI,4BAAc,KAAK;OACvB,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;KACHzB,uBAAM,CAACC,IAAI,CAAC,sCAAsC,EAAEgE,UAAU,CAAC;KAE/D,8CAAM,IAAI,gDAAuBA,UAAU,CAAC;KAC5C,MAAM,4CAAI,sBAAQnD,QAAQ,CAAC,cAAc,EAAE;OAC1C9C,QAAQ,EAAE,4CAAI,4BAAcA,QAAQ;OACpC8F,MAAM,EAAE;SACPW,WAAW,EAAE,KAAK;SAClBC,WAAW,EAAET,UAAU,CAACS;;MAEzB,CAAC;KACF,4CAAI,4BAAc,KAAK;;GAGxByR,WAAW,CAACtY,SAAiB,EAC7B;KACC,MAAM2X,KAAK,GAAG;OACb,CAACnU,sBAAU,CAAC+U,yBAAyB,GAAG;SACvC5Z,EAAE,EAAEqB,SAAS;SACbwY,KAAK,EAAElQ,aAAW,CAACwP;QACnB;OACD,CAACtU,sBAAU,CAACuR,mBAAmB,GAAG;SACjC3U,MAAM,0CAAE,IAAI,mBAAQ;SACpB4U,GAAG,EAAE,CAAChV,SAAS;;MAEhB;KACDmC,uBAAM,CAACC,IAAI,CAAC,mCAAmC,EAAEpC,SAAS,CAAC;KAC3D,4CAAI,4BAAc,IAAI;KAEtB,OAAOyY,wBAAS,CAACd,KAAK,CAAC,CACrBpO,IAAI,CAAEtF,IAAI,IAAK;OACf9B,uBAAM,CAACC,IAAI,CAAC,oCAAoC,EAAE6B,IAAI,CAAC;OAEvD,+CAAO,IAAI,gDAAuBA,IAAI,CAACT,sBAAU,CAAC+U,yBAAyB,CAAC;MAC5E,CAAC,CACD5U,KAAK,CAAEC,KAAK,IAAK;OACjB,4CAAI,sCAAgBA,KAAK;OACzB,4CAAI,oDAAyBA,KAAK;;OAElCC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;OAC1D,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC,CACD8U,OAAO,CAAC,MAAM;OACd,4CAAI,4BAAc,KAAK;MACvB,CAAC;;GAGJ,MAAMC,mBAAmB,CAACvY,MAAc,EACxC;KACC,MAAM0D,WAAW,GAAG;OACnBG,IAAI,EAAE;SAAE2U,aAAa,EAAExY;;MACvB;KACD,MAAMmC,MAAM,GAAG,MAAMqD,wBAAS,CAACpC,sBAAU,CAAC+U,yBAAyB,EAAEzU,WAAW,CAAC,CAC/EH,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAC1D,CAAC;KAEH,MAAM2D,WAA6B,GAAGhF,MAAM,CAACgF,WAAW;KACxD,MAAMsR,iBAAkC,GAAGtR,WAAW,CAACuR,IAAI,CAAE5a,IAAI,IAAK;OACrE,OAAOA,IAAI,CAACkC,MAAM,KAAKA,MAAM;MAC7B,CAAC;KACF,MAAM2Y,eAAe,GAAGF,iBAAiB,oBAAjBA,iBAAiB,CAAE7Y,SAAS;KAEpDmC,uBAAM,CAACC,IAAI,CAAC,4CAA4C,EAAEG,MAAM,CAAC;KACjE,6CAAK,IAAI,gDAAuBA,MAAM,CAAC;KAEvC,OAAOwW,eAAe;;GAGvBC,iBAAiB,GACjB;KACC7W,uBAAM,CAACC,IAAI,CAAC,sCAAsC,0CAAE,IAAI,oBAAS;KACjE,IAAI2W,eAAe,GAAG,CAAC;KACvB,IAAI,4CAAI,4BAAc3Y,MAAM,IAAI,CAAC,EACjC;OACC,OAAOiC,OAAO,CAACC,OAAO,EAAE;;KAGzB,IAAI,4CAAI,4BAAcwR,QAAQ,EAC9B;OACCiF,eAAe,GAAG,4CAAI,4BAAcjF,QAAQ;MAC5C,MACI,IAAI,4CAAI,4BAAcmF,sBAAsB,EACjD;OACCF,eAAe,GAAG,4CAAI,4BAAcE,sBAAsB;;KAG3D,MAAMC,eAAe,GAAG,4CAAI,4BAAchT,MAAM;KAChD,4CAAI,sCAAkB,KAAK;KAC3B,IAAI6S,eAAe,EACnB;OACC,OAAO,IAAI,CAACT,WAAW,CAACS,eAAe,CAAC,CACtCL,OAAO,CAAC,MAAM;SACd,4CAAI,sCAAkB,IAAI,EAAEQ,eAAe;QAC3C,CAAC;;KAGJ,OAAO,IAAI,CAACC,mBAAmB,EAAE,CAC/BT,OAAO,CAAC,MAAM;OACd,4CAAI,sCAAkB,IAAI,EAAEQ,eAAe;MAC3C,CAAC;;GAGJ,MAAMC,mBAAmB,GACzB;KACChX,uBAAM,CAACC,IAAI,CAAC,2CAA2C,0CAAE,IAAI,oBAAS;KACtE,4CAAI,4BAAc,IAAI;KAEtB,MAAMwO,OAAO,GAAG;OACf3M,IAAI,EAAE;SACL7D,MAAM,0CAAE,IAAI,mBAAQ;SACpByX,KAAK,EAAEvP,aAAW,CAACwP;;MAEpB;KACD,MAAM1R,UAAU,GAAG,MAAMR,wBAAS,CAACpC,sBAAU,CAAC4V,mBAAmB,EAAExI,OAAO,CAAC,CACzEjN,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,4CAA4C,EAAEA,KAAK,CAAC;OAClE,4CAAI,4BAAc,KAAK;OACvB,MAAM,IAAIkC,KAAK,CAAClC,KAAK,CAAC;MACtB,CAAC;KACHzB,uBAAM,CAACC,IAAI,CAAC,4CAA4C,EAAEgE,UAAU,CAAC;KACrEA,UAAU,CAAC7H,QAAQ,2CAAG,IAAI,oDAAyB6H,UAAU,CAAC7H,QAAQ,CAAC;KAEvE,8CAAM,IAAI,gDAAuB6H,UAAU,CAAC;KAC5C,4CAAI,4BAAc,KAAK;;GA0BxB1E,SAAS,GACT;KACC,+CAAO,IAAI;;CAiIb;CAAC,kCA1JwB2X,WAAyB,EACjD;GACC,IAAIA,WAAW,CAAC/T,MAAM,KAAK,CAAC,EAC5B;KACC,OAAO+T,WAAW;;GAGnB,MAAMC,aAAa,GAAG,4CAAI,4BAAcA,aAAa;GACrD,MAAMC,QAAQ,GAAGhF,IAAI,CAACC,GAAG,CAAC,GAAG6E,WAAW,CAACpY,GAAG,CAAE9B,OAAO,IAAKA,OAAO,CAACR,EAAE,CAAC,CAAC;GACtE,IAAI4a,QAAQ,IAAID,aAAa,EAC7B;KACC,OAAOD,WAAW;;GAGnB,MAAMG,kBAAoC,GAAG,4CAAI,sBAAQxa,OAAO,CAAC,sBAAsB,CAAC,yCAAC,IAAI,oBAAS;GACtG,MAAM2I,kBAAkB,GAAG6R,kBAAkB,CAACzC,MAAM,CAAE5X,OAAO,IAAK;KACjE,OAAOA,OAAO,CAACR,EAAE,GAAG4a,QAAQ;IAC5B,CAAC;GACFpX,uBAAM,CAACC,IAAI,CAAC,yEAAyE,EAAEuF,kBAAkB,CAAC;GAE1G,OAAO,CAAC,GAAG0R,WAAW,EAAE,GAAG1R,kBAAkB,CAAC;CAC/C;CAAC,gCAOqBvB,UAAU,EAChC;GACC,MAAM;KAAE7H;IAAU,GAAG6H,UAAU;GAC/B,MAAMtB,eAAe,GAAG,4CAAI,sBAAQ7B,QAAQ,CAAC,4BAA4B,EAAE;KAC1E1E,QAAQ;KACRkM,eAAe,EAAE;IACjB,CAAC;GACF,MAAMgP,mBAAmB,2CAAG,IAAI,oCAAerT,UAAU,CAAC;GAE1D,OAAO/D,OAAO,CAACgD,GAAG,CAAC,CAACP,eAAe,EAAE2U,mBAAmB,CAAC,CAAC;CAC3D;CAAC,0BAEa7b,OAA6B,EAC3C;GACC,MAAM;KACLY,KAAK;KACLL,KAAK;KACLiJ,UAAU;KACVc,SAAS;KACTtB,WAAW;KACXC,WAAW;KACXc,kBAAkB;KAClBJ,WAAW;KACXvJ,OAAO;KACP8I;IACA,GAAGlJ,OAAO;GAEX,MAAM8b,aAAa,GAAG,4CAAI,sBAAQzW,QAAQ,CAAC,cAAc,EAAE;KAC1D9C,QAAQ,EAAE,4CAAI,4BAAcA,QAAQ;KACpC8F,MAAM,EAAE;OACPW,WAAW;OACXC,WAAW;OACXC;;IAED,CAAC;GACF,MAAMlC,YAAY,GAAGvC,OAAO,CAACgD,GAAG,CAAC,CAChC,4CAAI,8BAAcsU,eAAe,CAACxb,KAAK,CAAC,EACxC,4CAAI,8BAAc8L,eAAe,CAAC7C,UAAU,CAAC,CAC7C,CAAC;GACF,MAAMrC,YAAY,GAAG,4CAAI,sBAAQ9B,QAAQ,CAAC,WAAW,EAAEzE,KAAK,CAAC;GAC7D,MAAMob,gBAAgB,GAAG,4CAAI,sBAAQ3W,QAAQ,CAAC,wBAAwB,EAAEiF,SAAS,CAAC;GAClF,MAAM2R,yBAAyB,GAAG,4CAAI,sBAAQ5W,QAAQ,CAAC,gBAAgB,EAAE0E,kBAAkB,CAAC;GAC5F,MAAMmS,kBAAkB,GAAG,4CAAI,sBAAQ7W,QAAQ,CAAC,uBAAuB,EAAEsE,WAAW,CAAC;GACrF,MAAMtC,cAAc,GAAG,IAAIC,gCAAc,EAAE;GAC3C,MAAMC,cAAc,GAAGF,cAAc,CAAC0F,sBAAsB,CAAC3M,OAAO,CAAC;GAErE,OAAOqE,OAAO,CAACgD,GAAG,CAAC,CAClBqU,aAAa,EACb3U,YAAY,EACZH,YAAY,EACZgV,gBAAgB,EAChBC,yBAAyB,EACzBC,kBAAkB,EAClB3U,cAAc,CACd,CAAC;CACH;CAAC,2BAEgB4U,IAAa,EAAEb,eAAwB,GAAG,IAAI,EAC/D;GACC,MAAMjT,MAAM,GAAG;KACdC,MAAM,EAAE6T,IAAI;KACZxP,OAAO,EAAE,CAACwP;IACV;GACD,IAAIA,IAAI,KAAK,IAAI,IAAI,CAACb,eAAe,EACrC;KACC,OAAOjT,MAAM,CAACC,MAAM;;GAGrB,4CAAI,sBAAQjD,QAAQ,CAAC,cAAc,EAAE;KACpC9C,QAAQ,EAAE,4CAAI,4BAAcA,QAAQ;KACpC8F;IACA,CAAC;CACH;CAAC,qCAE0B+T,YAAmC,EAC9D;GACC,MAAM7Z,QAAQ,GAAG,4CAAI,4BAAcA,QAAQ;GAC3C,MAAMvB,IAAkB,GAAG,4CAAI,sBAAQI,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,CAAC;GACrE,IAAI,CAACvB,IAAI,EACT;KACC,OAAOob,YAAY;;GAGpB,MAAM;KAAElT,kBAAkB,EAAE;OAAEmT;;IAA0B,GAAGrb,IAAI;GAC/D,IAAIqb,sBAAsB,KAAK,IAAI,EACnC;KACC,OAAO;OACN,GAAGD,YAAY;OACfC,sBAAsB,EAAE;MACxB;;GAGF,OAAOD,YAAY;CACpB;CAAC,uBAGD;GACC,OAAO,4CAAI,sBAAQhb,OAAO,CAAC,mBAAmB,CAAC,yCAAC,IAAI,oBAAS;CAC9D;CAAC,kCAEuB4E,KAAK,EAC7B;GACC,IAAIA,KAAK,CAACkI,IAAI,KAAKC,gCAAe,CAACmO,eAAe,EAClD;KACC;;GAGD,4CAAI,4CAAmBjO,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;CACnF;CAAC,8BAEiBC,IAAY,EAC9B;GACCC,EAAE,CAACC,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;KAAEC,OAAO,EAAEN;IAAM,CAAC;CACpD;CAAC,2BAEcvI,KAAK,EACpB;GACC,IAAIA,KAAK,CAACkI,IAAI,KAAKC,gCAAe,CAACmO,eAAe,EAClD;KACC;;GAGD,MAAMtb,IAAI,2CAAG,IAAI,2BAAa;GAC9B,MAAMuB,QAAQ,GAAGvB,IAAI,CAACuB,QAAQ;GAC9BqP,6BAAS,CAAC1N,WAAW,EAAE,CAACqY,aAAa,CAACC,sBAAsB,CAAC;KAAEja;IAAU,CAAC;CAC3E;AAlcYmI,cAAW,CAEhBwP,qBAAqB,GAAG,EAAE;;CCbO;CAAA;AAEzC,CAAO,MAAMrF,YAAU,CACvB;GAIC/U,WAAW,GACX;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxC+W,UAAU,CAACja,MAAc,EAAEJ,SAAiB,EAC5C;KACCmC,uBAAM,CAACC,IAAI,CAAE,mCAAkCpC,SAAU,EAAC,CAAC;KAC3D,4CAAI,sBAAQiD,QAAQ,CAAC,kBAAkB,EAAE;OACxC7C,MAAM;OACNJ;MACA,CAAC;KACF,4CAAI,gCAAauD,UAAU,CAACC,sBAAU,CAAC8W,kBAAkB,EAAE;OAAE3b,EAAE,EAAEqB;MAAW,CAAC,CAC3E2D,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;OACjE,4CAAI,sBAAQX,QAAQ,CAAC,qBAAqB,EAAE;SAC3C7C,MAAM;SACNJ;QACA,CAAC;MACF,CAAC;;GAGJua,YAAY,CAACna,MAAc,EAAEJ,SAAiB,EAC9C;KACCmC,uBAAM,CAACC,IAAI,CAAE,qCAAoCpC,SAAU,EAAC,CAAC;KAC7D,4CAAI,sBAAQiD,QAAQ,CAAC,qBAAqB,EAAE;OAC3C7C,MAAM;OACNJ;MACA,CAAC;KACF,4CAAI,gCAAauD,UAAU,CAACC,sBAAU,CAACgX,oBAAoB,EAAE;OAAE7b,EAAE,EAAEqB;MAAW,CAAC,CAC7E2D,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAAC,6CAA6C,EAAEA,KAAK,CAAC;OACnE,4CAAI,sBAAQX,QAAQ,CAAC,kBAAkB,EAAE;SACxC7C,MAAM;SACNJ;QACA,CAAC;MACF,CAAC;;CAEL;;CClD2C;CAAA;AAI3C,CAAO,MAAMya,WAAW,CACxB;GAAA;KAAA;OAAA;;KAAA;OAAA;;;GACCC,eAAe,CAAC1a,SAAiB,EAAEmM,IAAY,EAC/C;KACChK,uBAAM,CAACC,IAAI,CAAC,iCAAiC,EAAEpC,SAAS,EAAEmM,IAAI,CAAC;KAC/D,MAAMhN,OAAO,2CAAG,IAAI,4BAAaa,SAAS,CAAC;KAC3C,IAAI,CAACb,OAAO,EACZ;OACC;;KAGD,4CAAI,4CAAqBa,SAAS,EAAEmM,IAAI;KAExC,MAAMyE,OAAO,GAAG;OACf3M,IAAI,EAAE;SACLtF,EAAE,EAAEqB,SAAS;SACbiG,MAAM,EAAE;WAAE9G,OAAO,EAAEgN;;;MAEpB;KAEDvG,wBAAS,CAACpC,sBAAU,CAACmX,qBAAqB,EAAE/J,OAAO,CAAC,CAClDjN,KAAK,CAAEC,KAAK,IAAK;OACjBzB,uBAAM,CAACyB,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;MAC7D,CAAC;;CAqBL;CAAC,8BAlBoB5D,SAAiB,EAAEmM,IAAY,EACnD;GACC,MAAMhN,OAAO,2CAAG,IAAI,4BAAaa,SAAS,CAAC;GAC3C,MAAM4a,QAAQ,GAAGzb,OAAO,CAACE,cAAc;GAEvCP,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,iBAAiB,EAAE;KAC3CtE,EAAE,EAAEqB,SAAS;KACbiG,MAAM,EAAE;OACPkG,IAAI;OACJyO;;IAED,CAAC;CACH;CAAC,sBAEW5a,SAAiB,EAC7B;GACC,OAAOlB,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAACgB,SAAS,CAAC;CAC9D;;CC3C6C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAI9C,CAAO,MAAMyF,eAAa,CAC1B;GAIC/H,WAAW,CAAC0C,MAAc,EAC1B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,0BAAWA,MAAM;KACrB,4CAAI,wBAAUtB,2BAAI,CAACC,QAAQ,EAAE;;GAG9B,MAAM8b,cAAc,CAAC/Q,UAAoB,EACzC;KACC3H,uBAAM,CAACC,IAAI,CAAC,+BAA+B,EAAE0H,UAAU,CAAC;KAExD,MAAMgR,gBAAgB,GAAG,EAAE;KAE3BhR,UAAU,CAAC7L,OAAO,CAAE+B,SAAS,IAAK;OACjC,IAAIkJ,qBAAK,CAACiD,IAAI,CAAC4O,QAAQ,CAAC/a,SAAS,CAAC,EAClC;SACC,4CAAI,oDAAyBA,SAAS;SAEtC;;OAGD,4CAAI,sCAAkBA,SAAS;OAC/B,4CAAI,oCAAeA,SAAS;OAE5B8a,gBAAgB,CAAC9S,IAAI,CAAChI,SAAS,CAAC;MAChC,CAAC;KAEF,IAAI8a,gBAAgB,CAACxV,MAAM,GAAG,CAAC,EAC/B;OACC,6CAAK,IAAI,kDAAwBwV,gBAAgB,CAAC;;;CAiJrD;CAAC,0BA7Ic9a,SAAiB,EAC/B;GACC,MAAMb,OAAuB,GAAG,4CAAI,sBAAQH,OAAO,CAAC,kBAAkB,CAAC,CAACgB,SAAS,CAAC;GAElF,4CAAI,IAAI,8CAAsBb,OAAO,GACrC;KACC,6CAAK,IAAI,kDAAwBA,OAAO,CAAC;KAEzC;;GAGD,6CAAK,IAAI,gDAAuBA,OAAO,CAAC;CACzC;CAAC,gCAEqBA,OAAuB,EAC7C;GACC,4CAAI,sBAAQ8D,QAAQ,CAAC,iBAAiB,EAAE;KACvCtE,EAAE,EAAEQ,OAAO,CAACR,EAAE;KACdsH,MAAM,EAAE;OACPkG,IAAI,EAAE,EAAE;OACR6O,SAAS,EAAE,IAAI;OACfxc,KAAK,EAAE,EAAE;OACToB,MAAM,EAAE,EAAE;OACVqb,OAAO,EAAE;;IAEV,CAAC;CACH;CAAC,+BAEoB9b,OAAuB,EAC5C;GACC,MAAM+b,yBAAyB,GAAG,CAACxa,oBAAQ,CAACya,OAAO,EAAEza,oBAAQ,CAAC0a,WAAW,EAAE1a,oBAAQ,CAAC2a,cAAc,CAAC;GACnG,MAAMC,wBAAwB,GAAG,CAAC5a,oBAAQ,CAACoU,OAAO,EAAEpU,oBAAQ,CAAC8F,KAAK,CAAC;GAEnE,MAAM5H,IAAI,2CAAG,IAAI,uBAAW;GAC5B,IAAIsc,yBAAyB,CAACxE,QAAQ,CAAC9X,IAAI,CAAC6B,IAAI,CAAC,EACjD;KACC,OAAO,IAAI;;GAGZ,IAAI6a,wBAAwB,CAAC5E,QAAQ,CAAC9X,IAAI,CAAC6B,IAAI,CAAC,EAChD;KACC,OAAO,KAAK;;GAGb,OAAO,CAACtB,OAAO,CAACE,cAAc;CAC/B;CAAC,iCAEsBF,OAAuB,EAC9C;GACC,MAAMP,IAAI,2CAAG,IAAI,uBAAW;GAC5B,IAAIO,OAAO,CAACR,EAAE,KAAKC,IAAI,CAAC0a,aAAa,EACrC;KACC,MAAMiC,SAAS,2CAAG,IAAI,gDAAuBpc,OAAO,CAACR,EAAE,CAAC;KACxD,4CAAI,kEAAgC4c,SAAS;KAC7C,4CAAI,8DAA8BA,SAAS;;GAG5C,4CAAI,sBAAQtY,QAAQ,CAAC,iBAAiB,EAAE;KACvCtE,EAAE,EAAEQ,OAAO,CAACR;IACZ,CAAC;CACH;CAAC,yCAE8B4c,SAAiB,EAChD;GACC,MAAM3c,IAAI,2CAAG,IAAI,uBAAW;GAC5B,IAAI,CAAC2c,SAAS,EACd;KACC,4CAAI,sBAAQtY,QAAQ,CAAC,eAAe,EAAE;OAAEtE,EAAE,EAAEC,IAAI,CAACuB;MAAU,CAAC;KAE5D;;GAGD,4CAAI,sBAAQ8C,QAAQ,CAAC,eAAe,EAAE;KACrCtE,EAAE,EAAEC,IAAI,CAACuB,QAAQ;KACjB8F,MAAM,EAAE;OAAEjG,SAAS,EAAEub;;IACrB,CAAC;CACH;CAAC,uCAE4BA,SAAS,EACtC;GACC,MAAM3c,IAAI,2CAAG,IAAI,uBAAW;GAE5B,4CAAI,sBAAQqE,QAAQ,CAAC,cAAc,EAAE;KACpC9C,QAAQ,EAAEvB,IAAI,CAACuB,QAAQ;KACvB8F,MAAM,EAAE;OACPqT,aAAa,EAAEiC,SAAS;OACxB7G,MAAM,EAAE6G;;IAET,CAAC;GACF,4CAAI,sBAAQtY,QAAQ,CAAC,6BAA6B,EAAE;KACnD9C,QAAQ,EAAEvB,IAAI,CAACuB;IACf,CAAC;CACH;CAAC,iCAEsB2J,UAAoB,EAC3C;GACC,OAAOlE,wBAAS,CAACpC,sBAAU,CAACgY,qBAAqB,EAAE;KAClDvX,IAAI,EAAE;OAAE6F;;IACR,CAAC,CAACnG,KAAK,CAAEC,KAAK,IAAK;;KAEnBC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;IAC5D,CAAC;CACH;CAAC,kCAEuB5D,SAAiB,EACzC;GACC,MAAMpB,IAAI,2CAAG,IAAI,uBAAW;GAC5B,MAAMoE,UAA6B,GAAG,4CAAI,sBAAQhE,OAAO,CAAC,YAAY,CAAC,CAACJ,IAAI,CAACuB,QAAQ,CAAC;GACtF,IAAI6C,UAAU,CAAChD,SAAS,KAAKA,SAAS,EACtC;KACC,MAAMub,SAAS,2CAAG,IAAI,gDAAuBvb,SAAS,CAAC;KACvD,4CAAI,sBAAQiD,QAAQ,CAAC,eAAe,EAAE;OACrCtE,EAAE,EAAEC,IAAI,CAACuB,QAAQ;OACjB8F,MAAM,EAAE;SAAEjG,SAAS,EAAEub;;MACrB,CAAC;;GAGH,4CAAI,sBAAQtY,QAAQ,CAAC,iBAAiB,EAAE;KACvCtE,EAAE,EAAEqB;IACJ,CAAC;CACH;CAAC,gCAEqBA,SAAiB,EACvC;GAAA;GACC,MAAMyb,eAA+B,GAAG,4CAAI,sBAAQzc,OAAO,CAAC,6BAA6B,CAAC,CAAC;KAC1FgB,SAAS;KACTI,MAAM,0CAAE,IAAI;IACZ,CAAC;GAEF,8BAAOqb,eAAe,oBAAfA,eAAe,CAAE9c,EAAE,kCAAI,CAAC;CAChC;CAAC,2BAEgBqB,SAAiB,EAClC;GACC0b,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACzS,MAAM,CAAC0S,gBAAgB,EAAE;KAAE7b;IAAW,CAAC;CACpE;CAAC,qBAGD;GACC,OAAO,4CAAI,sBAAQhB,OAAO,CAAC,mBAAmB,CAAC,yCAAC,IAAI,wBAAS;CAC9D;;CCvLyC;CAAA;CAAA;AAE1C,CAAO,MAAM8c,WAAW,CACxB;GAKCpe,WAAW,CAAC0C,MAAc,EAC1B;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,0BAAWA,MAAM;KACrB,4CAAI,wBAAUtB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxCyY,WAAW,CAAC/b,SAAiB,EAC7B;KACCmC,uBAAM,CAACC,IAAI,CAAC,6BAA6B,EAAEpC,SAAS,CAAC;KACrD,MAAM;OAAEG;MAAU,GAAG,4CAAI,sBAAQnB,OAAO,CAAC,mBAAmB,CAAC,yCAAC,IAAI,wBAAS;KAC3E,4CAAI,sBAAQiE,QAAQ,CAAC,eAAe,EAAE;OACrCtE,EAAE,EAAEwB,QAAQ;OACZiS,MAAM,EAAE;MACR,CAAC;KACF,4CAAI,sBAAQnP,QAAQ,CAAC,cAAc,EAAE;OACpC9C,QAAQ;OACR8F,MAAM,EAAE;SAAE6N,QAAQ,EAAE9T;;MACpB,CAAC;KACF,4CAAI,gCAAauD,UAAU,CAACC,sBAAU,CAACwY,mBAAmB,EAAE;OAC3D7b,QAAQ;OACRxB,EAAE,EAAEqB;MACJ,CAAC,CAAC2D,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;MAC7D,CAAC;;CAEJ;;CChCyB;CAAA;CAAA;AAEzB,CAAO,MAAMqY,eAAe,CAC5B;GAKCve,WAAW,CAAC0C,MAAc,EAC1B;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,0BAAWA,MAAM;KACrB,4CAAI,wBAAUtB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;;GAGxC4Y,oBAAoB,CAAClc,SAAiB,EACtC;KACCmC,uBAAM,CAACC,IAAI,CAAC,sCAAsC,EAAEpC,SAAS,CAAC;KAC9D,4CAAI,gCAAauD,UAAU,CAACC,sBAAU,CAAC2Y,iBAAiB,EAAE;OACzDC,UAAU,EAAEpc;MACZ,CAAC,CAAC2D,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,kDAAkD,EAAEA,KAAK,CAAC;MACxE,CAAC;KACFwI,EAAE,CAACC,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;OAChCC,OAAO,EAAER,aAAG,CAACC,UAAU,CAAC,oDAAoD;MAC5E,CAAC;;GAGHmQ,yBAAyB,CAACrc,SAAiB,EAC3C;KACCmC,uBAAM,CAACC,IAAI,CAAC,2CAA2C,EAAEpC,SAAS,CAAC;KACnE,4CAAI,sBAAQiD,QAAQ,CAAC,qCAAqC,EAAE;OAC3D7C,MAAM,0CAAE,IAAI,uBAAQ;OACpBJ;MACA,CAAC;KACF,4CAAI,gCAAauD,UAAU,CAACC,sBAAU,CAAC8Y,oBAAoB,EAAE;OAC5DF,UAAU,EAAEpc;MACZ,CAAC,CAAC2D,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,sDAAsD,EAAEA,KAAK,CAAC;MAC5E,CAAC;;CAEJ;;CC9CqD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAErD,CAAO,MAAM+E,cAAc,CAC3B;GAQC,OAAOC,sBAAsB,GAC7B;KACC,OAAON,aAAW,CAACwP,qBAAqB;;GAGzCpa,WAAW,CAACC,MAAwB,EACpC;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,MAAM;OAAEyC,MAAM,EAANA;MAAQ,GAAGzC,MAAM;KACzB,4CAAI,oCAAeyC,OAAM;;;GAc1BqX,UAAU,GACV;KACC,OAAO,4CAAI,kCAAcA,UAAU,EAAE;;GAGtCO,WAAW,GACX;KACC,OAAO,4CAAI,kCAAcA,WAAW,EAAE;;GAGvCE,0BAA0B,GAC1B;KACC,OAAO,4CAAI,kCAAcA,0BAA0B,EAAE;;GAGtDC,2BAA2B,GAC3B;KACC,OAAO,4CAAI,kCAAcA,2BAA2B,EAAE;;GAGvDC,yBAAyB,GACzB;KACC,OAAO,4CAAI,kCAAcA,yBAAyB,EAAE;;GAGrDC,0BAA0B,GAC1B;KACC,OAAO,4CAAI,kCAAcA,0BAA0B,EAAE;;GAGtD3W,SAAS,GACT;KACC,OAAO,4CAAI,kCAAcA,SAAS,EAAE;;;;;GAKrC4W,WAAW,CAACtY,SAAiB,EAC7B;KACC,OAAO,4CAAI,kCAAcsY,WAAW,CAACtY,SAAS,CAAC;;GAGhD2Y,mBAAmB,CAACvY,MAAc,EAClC;KACC,OAAO,4CAAI,kCAAcuY,mBAAmB,CAACvY,MAAM,CAAC;;GAGrD6B,aAAa,GACb;KACC,OAAO,4CAAI,kCAAcA,aAAa,EAAE;;;;;GAKzC+W,iBAAiB,GACjB;KACC,OAAO,4CAAI,kCAAcA,iBAAiB,EAAE;;GAG7CG,mBAAmB,GACnB;KACC,OAAO,4CAAI,kCAAcA,mBAAmB,EAAE;;;;;GAK/CkB,UAAU,CAACja,MAAc,EAAEJ,SAAiB,EAC5C;KACC,4CAAI,gCAAaqa,UAAU,CAACja,MAAM,EAAEJ,SAAS,CAAC;;GAG/Cua,YAAY,CAACna,MAAc,EAAEJ,SAAiB,EAC9C;KACC,4CAAI,gCAAaua,YAAY,CAACna,MAAM,EAAEJ,SAAS,CAAC;;;;;GAKjD+b,WAAW,CAAC/b,SAAiB,EAC7B;KACC,4CAAI,8BAAc+b,WAAW,CAAC/b,SAAS,CAAC;;;;;GAKzCkc,oBAAoB,CAAClc,SAAiB,EACtC;KACC,4CAAI,sCAAkBkc,oBAAoB,CAAClc,SAAS,CAAC;;GAGtDqc,yBAAyB,CAACrc,SAAiB,EAC3C;KACC,4CAAI,sCAAkBqc,yBAAyB,CAACrc,SAAS,CAAC;;;;;GAK3D0a,eAAe,CAAC1a,SAAiB,EAAEmM,IAAY,EAC/C;KACC,4CAAI,8BAAcuO,eAAe,CAAC1a,SAAS,EAAEmM,IAAI,CAAC;;;;;GAKnD0O,cAAc,CAAC/Q,UAAoB,EACnC;KACC,4CAAI,sCAAgB+Q,cAAc,CAAC/Q,UAAU,CAAC;;;CAGhD;CAAC,0BAxHc1J,MAAc,EAC5B;GACC,4CAAI,oCAAgB,IAAIkI,aAAW,CAAClI,MAAM,CAAC;GAC3C,4CAAI,gCAAgB,IAAIqa,WAAW,EAAE;GACrC,4CAAI,wCAAkB,IAAIhV,eAAa,CAACrF,MAAM,CAAC;GAC/C,4CAAI,kCAAe,IAAIqS,YAAU,EAAE;GACnC,4CAAI,gCAAgB,IAAIqJ,WAAW,CAAC1b,MAAM,CAAC;GAC3C,4CAAI,wCAAoB,IAAI6b,eAAe,CAAC7b,MAAM,CAAC;CACpD;;CC1B4C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAyD7C,CAAO,MAAMmc,iBAAc,CAC3B;GAKC,OAAOza,WAAW,GAClB;KACC,IAAI,CAAC,IAAI,CAACC,QAAQ,EAClB;OACC,IAAI,CAACA,QAAQ,GAAG,IAAI,IAAI,EAAE;;KAG3B,OAAO,IAAI,CAACA,QAAQ;;GAGrBrE,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,wBAAUoB,2BAAI,CAACC,QAAQ,EAAE;;GAG9B,MAAMyd,WAAW,CAAC7e,MAA0B,EAC5C;KACC,MAAM;OAAEwO,IAAI,GAAG;MAAI,GAAGxO,MAAM;KAC5B,IAAI,CAAC+B,cAAI,CAACkM,cAAc,CAACO,IAAI,CAAC,EAC9B;OACC,OAAO9J,OAAO,CAACC,OAAO,EAAE;;KAGzBH,uBAAM,CAACC,IAAI,CAAC,6BAA6B,EAAEzE,MAAM,CAAC;KAClD,MAAMwB,OAAO,2CAAG,IAAI,oCAAiBxB,MAAM,CAAC;KAE5C,+CAAO,IAAI,kDAAwBwB,OAAO;;GAU3C,MAAMsd,oBAAoB,CAAC9e,MAAyB,EACpD;KACC,MAAM;OAAEwO,IAAI,GAAG,EAAE;OAAEuQ,OAAO,GAAG;MAAI,GAAG/e,MAAM;KAC1C,IAAI,CAAC+B,cAAI,CAACkM,cAAc,CAACO,IAAI,CAAC,IAAI,CAACzM,cAAI,CAACC,aAAa,CAAC+c,OAAO,CAAC,EAC9D;OACC;;KAGDva,uBAAM,CAACC,IAAI,CAAC,wCAAwC,EAAEzE,MAAM,CAAC;KAC7D,MAAMwB,OAAwB,2CAAG,IAAI,sDAA0BxB,MAAM,CAAC;KAEtE,8CAAM,IAAI,wCAAmBwB,OAAO,CAACgB,QAAQ,CAAC;KAC9C,8CAAM,IAAI,0CAAoBhB,OAAO,CAAC;KACtC,8CAAM,IAAI,4CAAqBA,OAAO,CAAC;KACvC,8CAAM,IAAI,kDAAwBA,OAAO,CAACgB,QAAQ,CAAC;KAEnD,4CAAI,sCAAkB;OACrBwc,KAAK,EAAE,IAAI;OACXxc,QAAQ,EAAEhB,OAAO,CAACgB;MAClB;;GAGF,MAAMyc,eAAe,CAACjf,MAA0B,EAChD;KACC,MAAM;OAAEkf,UAAU;OAAE1c,QAAQ;OAAEgM;MAAM,GAAGxO,MAAM;KAC7C,IAAI,CAAC+B,cAAI,CAACC,aAAa,CAACkd,UAAU,CAAC,EACnC;OACC,OAAOxa,OAAO,CAACC,OAAO,EAAE;;KAEzBH,uBAAM,CAACC,IAAI,CAAC,iCAAiC,EAAEzE,MAAM,CAAC;KAEtD,8CAAM,IAAI,wCAAmBwC,QAAQ,CAAC;KAEtC,IAAI2c,cAAc,GAAG,IAAI;KACzB,IAAIpd,cAAI,CAACkM,cAAc,CAACO,IAAI,CAAC,EAC7B;OACC2Q,cAAc,2CAAG,IAAI,oCAAiBnf,MAAM,CAAC;OAC7C,8CAAM,IAAI,4CAAqBmf,cAAc,CAAC;;KAG/C,MAAMC,cAAc,GAAG,CAAC,GAAGF,UAAU,CAAC,CAACG,IAAI,EAAE;KAC7C,MAAMC,cAAc,2CAAG,IAAI,0CAAoBF,cAAc,CAAC;KAC9D,MAAMG,iBAAiB,2CAAG,IAAI,oDAAyBvf,MAAM,EAAEsf,cAAc,CAAC;KAE9E,8CAAM,IAAI,8CAAsBC,iBAAiB,CAAC;KAElD,4CAAI,sCAAkB;OAAEP,KAAK,EAAE,IAAI;OAAExc;MAAU;KAE/C,+CAAO,IAAI,4CAAqB;OAAE8c,cAAc;OAAEH,cAAc;OAAE3c;MAAU;;GAG7E,MAAMgd,gBAAgB,CAACxf,MAAmD,EAC1E;KACC,MAAM;OAAEyf,aAAa;OAAEjd;MAAU,GAAGxC,MAAM;KAC1C,MAAM0f,aAA6B,GAAG,4CAAI,sBAAQre,OAAO,CAAC,kBAAkB,CAAC,CAACoe,aAAa,CAAC;KAC5F,IAAI,CAACC,aAAa,EAClB;OACC,OAAOhb,OAAO,CAACC,OAAO,EAAE;;KAGzB,4CAAI,4CAAqB8a,aAAa;KACtC,MAAMje,OAAO,2CAAG,IAAI,oCAAiB;OACpCgN,IAAI,EAAEkR,aAAa,CAAClR,IAAI;OACxBhM,QAAQ;OACRid,aAAa,EAAEC,aAAa,CAAC1e,EAAE;OAC/Bsc,OAAO,EAAEoC,aAAa,CAACpC;MACvB,CAAC;KAEF,IAAIvb,cAAI,CAACkM,cAAc,CAACyR,aAAa,CAACC,OAAO,CAAC3e,EAAE,CAAC,EACjD;OACC,MAAM,GAAG4e,SAAS,CAAC,GAAGF,aAAa,CAACC,OAAO,CAAC3e,EAAE,CAAC6e,KAAK,CAAC,GAAG,CAAC;OACzD,MAAMP,cAAc,GAAG;SAAE,CAACI,aAAa,CAAC1e,EAAE,GAAG4e;QAAW;OAExD,+CAAO,IAAI,4CAAqB;SAAEN,cAAc;SAAE9c;QAAU;;KAG7D,+CAAO,IAAI,kDAAwBhB,OAAO;;GAG3C,MAAMse,iBAAiB,CAAC9f,MAA4B,EACpD;KACC,MAAM;OAAEwO,IAAI,GAAG;MAAI,GAAGxO,MAAM;KAC5B,IAAI,CAAC+B,cAAI,CAACkM,cAAc,CAACO,IAAI,CAAC,EAC9B;OACC,OAAO9J,OAAO,CAACC,OAAO,EAAE;;KAGzBH,uBAAM,CAACC,IAAI,CAAC,mCAAmC,EAAEzE,MAAM,CAAC;KACxD,MAAMwB,OAAO,2CAAG,IAAI,kCAAgBxB,MAAM,CAAC;KAE3C,+CAAO,IAAI,kDAAwBwB,OAAO;;CAuZ5C;CAAC,mCAxfyBA,OAAwB,EACjD;GACC,OAAO,4CAAI,sBAAQ8D,QAAQ,CAAC,4BAA4B,EAAE;KACzD9D;IACA,CAAC;CACH;CAAC,uCA+F4BA,OAAwB,EACrD;GACC,8CAAM,IAAI,8DAA8BA,OAAO,CAAC;GAEhD,+CAAO,IAAI,kDAAwBA,OAAO;CAC3C;CAAC,6CAEkCA,OAAO,EAC1C;GACC,8CAAM,IAAI,wCAAmBA,OAAO,CAACgB,QAAQ,CAAC;GAC9C,8CAAM,IAAI,4CAAqBhB,OAAO,CAAC;GAEvC,4CAAI,sCAAkB;KAAEwd,KAAK,EAAE,IAAI;KAAExc,QAAQ,EAAEhB,OAAO,CAACgB;IAAU;CAClE;CAAC,uCAE4BhB,OAAwB,EACrD;GACC,MAAMue,UAAU,GAAG,MAAM,4CAAI,8CAAsBve,OAAO,EACxDwE,KAAK,CAAE0G,MAAM,IAAK;KAClB,4CAAI,4CAAqBlL,OAAO,CAACwe,WAAW;KAC5C,4CAAI,kCAAgBtT,MAAM,EAAE,uBAAuB;IACnD,CAAC;GAEHlI,uBAAM,CAACC,IAAI,CAAC,gDAAgD,EAAEsb,UAAU,CAAC;GACzE,MAAM;KAAE/e;IAAI,GAAG+e,UAAU;GACzB,IAAI,CAAC/e,EAAE,EACP;KACC,OAAO0D,OAAO,CAACC,OAAO,EAAE;;GAGzB,4CAAI,oCAAe;KAClBsb,KAAK,EAAEze,OAAO,CAACwe,WAAW;KAC1BE,KAAK,EAAElf,EAAE;KACTwB,QAAQ,EAAEhB,OAAO,CAACgB;IAClB;GAED,OAAOkC,OAAO,CAACC,OAAO,EAAE;CACzB;CAAC,0BAEe3E,MAA0B,EAC1C;GACC,MAAM;KAAEwO,IAAI;KAAEiR,aAAa;KAAEjd,QAAQ;KAAE8a,OAAO;KAAE4B;IAAY,GAAGlf,MAAM;GAErE,MAAMmgB,aAAa,GAAG;KACrBC,QAAQ,EAAEjf,2BAAI,CAACsX,SAAS,EAAE;KAC1BrC,MAAM,EAAE,KAAK;KACbiK,OAAO,EAAE;IACT;GAED,OAAO;KACN7R,IAAI;KACJhM,QAAQ;KACRC,MAAM,EAAE,4CAAI,8BAAYD,QAAQ,EAAEC,MAAM;KACxCud,WAAW,EAAEP,aAAa,WAAbA,aAAa,GAAIlU,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;KACpDhD,OAAO;KACP4B,UAAU;KACVxd,cAAc,0CAAE,IAAI,0CAAoBc,QAAQ,CAAC;KACjD,GAAG2d;IACH;CACF;CAAC,mCAEwBngB,MAAyB,EAClD;GACC,MAAM;KAAE+e;IAAS,GAAG/e,MAAM;GAC1B,IAAI,CAAC+B,cAAI,CAACC,aAAa,CAAC+c,OAAO,CAAC,EAChC;KACC,MAAM,IAAI5W,KAAK,CAAC,yDAAyD,CAAC;;GAG3E,OAAO;KACN,2CAAG,IAAI,oCAAiBnI,MAAM,CAAC;KAC/BA,MAAM,EAAE;OAAEugB,OAAO,EAAExB;;IACnB;CACF;CAAC,yBAEc/e,MAA4B,EAC3C;GACC,MAAM;KAAEK;IAAS,GAAGL,MAAM;GAC1B,IAAI,CAACK,OAAO,IAAI,CAACA,OAAO,CAACmgB,UAAU,EACnC;KACC,MAAM,IAAIrY,KAAK,CAAC,iDAAiD,CAAC;;GAGnE,OAAO;KACN,2CAAG,IAAI,oCAAiBnI,MAAM,CAAC;KAC/BK;IACA;CACF;CAAC,4BAEiBmC,QAAgB,EAClC;GACC,IAAI,CAAC,4CAAI,8BAAYA,QAAQ,EAAE0G,WAAW,EAC1C;KACC,OAAOxE,OAAO,CAACC,OAAO,EAAE;;GAGzBH,uBAAM,CAACC,IAAI,CAAC,uEAAuE,CAAC;GACpF,MAAMgc,cAAc,GAAG,IAAIzV,cAAc,CAAC;KAAEvI,MAAM,EAAE,4CAAI,8BAAYD,QAAQ,EAAEC;IAAQ,CAAC;GAEvF,OAAOge,cAAc,CAAC9F,WAAW,CAAC,4CAAI,8BAAYnY,QAAQ,EAAEmZ,aAAa,CAAC,CAAC/P,IAAI,CAAC,MAAM;KACrF,4CAAI,sCAAkB;OAAEpJ;MAAU;IAClC,CAAC,CAACwD,KAAK,CAAEC,KAAK,IAAK;;KAEnBC,OAAO,CAACD,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;IACzD,CAAC;CACH;CAAC,8BAEmBzE,OAAwB,EAC5C;GACC,4CAAI,4CAAqBA,OAAO;GAEhC,6CAAK,IAAI,kDAAwBA,OAAO,CAACgB,QAAQ,CAAC;GAElD,OAAO,4CAAI,sBAAQ8C,QAAQ,CAAC,cAAc,EAAE9D,OAAO,CAAC;CACrD;CAAC,8BAEmBA,OAAwB,EAC5C;GAAA;GACC,MAAMkf,cAAuB,GAAG3e,cAAI,CAACkM,cAAc,CAACzM,OAAO,CAACgN,IAAI,CAAC;GACjE,MAAMmS,cAAuB,GAAG5e,cAAI,CAACC,aAAa,oBAACR,OAAO,CAACxB,MAAM,qBAAd,gBAAgBugB,OAAO,CAAC;GAE3E,IAAIG,cAAc,IAAIC,cAAc,EACpC;KACC,KAAK,4CAAI,sBAAQrb,QAAQ,CAAC,eAAe,EAAE;OAC1CtE,EAAE,EAAEQ,OAAO,CAACgB,QAAQ;OACpB8F,MAAM,EAAE;SAAEjG,SAAS,EAAEb,OAAO,CAACwe;;MAC7B,CAAC;;CAEJ;CAAC,+BAEoBxe,OAAwB,EAC7C;GACC,MAAM8G,MAAM,GAAG,EAAE;GAEjB,IAAI9G,OAAO,CAAC8b,OAAO,EACnB;KACChV,MAAM,CAACgV,OAAO,GAAG9b,OAAO,CAAC8b,OAAO;;GAGjC,IAAI9b,OAAO,CAAC0d,UAAU,EACtB;KACC5W,MAAM,CAAC4W,UAAU,GAAG1d,OAAO,CAAC0d,UAAU;;GAGvC,IAAI1d,OAAO,CAACgN,IAAI,EAChB;KACClG,MAAM,CAAC9G,OAAO,GAAGA,OAAO,CAACgN,IAAI;KAC7BlG,MAAM,CAACsY,UAAU,GAAGpf,OAAO,CAACwe,WAAW;;GAGxC,IAAIxe,OAAO,CAACnB,OAAO,EACnB;KACCiI,MAAM,CAACjI,OAAO,GAAGmB,OAAO,CAACnB,OAAO;;GAGjC,MAAMwgB,SAAS,GAAG;KACjBre,QAAQ,EAAEhB,OAAO,CAACgB,QAAQ,CAACse,QAAQ,EAAE;KACrCxY;IACA;GAED,OAAOL,wBAAS,CAACpC,sBAAU,CAACkb,mBAAmB,EAAE;KAAEza,IAAI,EAAEua;IAAW,CAAC;CACtE;CAAC,0BAEa7gB,MAA0D,EACxE;GACC,MAAM;KAAEigB,KAAK;KAAEC,KAAK;KAAE1d;IAAU,GAAGxC,MAAM;GACzC,KAAK,4CAAI,sBAAQsF,QAAQ,CAAC,uBAAuB,EAAE;KAClDtE,EAAE,EAAEif,KAAK;KACT3X,MAAM,EAAE;OAAEtH,EAAE,EAAEkf;;IACd,CAAC;GACF,KAAK,4CAAI,sBAAQ5a,QAAQ,CAAC,cAAc,EAAE;KACzC9C,QAAQ;KACR8F,MAAM,EAAE;OACPyO,MAAM,EAAEmJ,KAAK;OACbvE,aAAa,EAAEuE;;IAEhB,CAAC;GACF,KAAK,4CAAI,sBAAQ5a,QAAQ,CAAC,eAAe,EAAE;KAC1CtE,EAAE,EAAEwB,QAAQ;KACZ8F,MAAM,EAAE;OAAEjG,SAAS,EAAE6d;;IACrB,CAAC;CACH;CAAC,8BAEmB7d,SAAiB,EACrC;GACC,KAAK,4CAAI,sBAAQiD,QAAQ,CAAC,iBAAiB,EAAE;KAC5CtE,EAAE,EAAEqB,SAAS;KACbiG,MAAM,EAAE;OAAErC,KAAK,EAAE;;IACjB,CAAC;CACH;CAAC,8BAEmB5D,SAAiB,EACrC;GACC,KAAK,4CAAI,sBAAQiD,QAAQ,CAAC,iBAAiB,EAAE;KAC5CtE,EAAE,EAAEqB,SAAS;KACbiG,MAAM,EAAE;OACP+X,OAAO,EAAE,IAAI;OACbpa,KAAK,EAAE;;IAER,CAAC;CACH;CAAC,2BAEgBjG,MAA0C,GAAG,EAAE,EAChE;GACC,MAAM;KAAEgf,KAAK,GAAG,KAAK;KAAExc;IAAU,GAAGxC,MAAM;GAC1C+d,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACzS,MAAM,CAACwV,cAAc,EAAE;KAClDve,MAAM,EAAE,4CAAI,8BAAYD,QAAQ,EAAEC,MAAM;KACxCwe,SAAS,EAAEjC,KAAK,GAAGkC,iCAAqB,CAACC,IAAI,GAAGD,iCAAqB,CAACE;IACtE,CAAC;CACH;CAAC,uBAEU5e,QAAgB,EAC3B;GACC,OAAO,4CAAI,sBAAQnB,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,EAAE,IAAI,CAAC;CACxD;CAAC,+BAEkBC,MAAc,EACjC;GACC,OAAO,4CAAI,sBAAQpB,OAAO,CAAC,mBAAmB,CAAC,CAACoB,MAAM,EAAE,IAAI,CAAC;CAC9D;CAAC,6BAEkBD,QAAgB,EACnC;GACC,OAAO,4CAAI,sBAAQnB,OAAO,CAAC,sBAAsB,CAAC,CAACmB,QAAQ,CAAC;CAC7D;CAAC,wCAE6BxC,MAA+E,EAC7G;GACC,MAAM;KAAEqhB,QAAQ;KAAE7e,QAAQ;KAAE2c;IAAgB,GAAGnf,MAAM;GACrD,MAAM;KAAEgB,EAAE;KAAEsgB;IAAS,GAAGD,QAAQ;GAEhC,IAAIrgB,EAAE,EACN;KACC,4CAAI,oCAAe;OAClBif,KAAK,EAAEd,cAAc,CAACa,WAAW;OACjCE,KAAK,EAAElf,EAAE;OACTwB;MACA;;GAEF/B,MAAM,CAAC2Q,OAAO,CAACkQ,OAAO,CAAC,CAAChhB,OAAO,CAAC,CAAC,CAACihB,IAAY,EAAElf,SAAiB,CAAC,KAAK;KACtE,4CAAI,oCAAe;OAClB4d,KAAK,EAAEsB,IAAI;OACXrB,KAAK,EAAE7d,SAAS;OAChBG;MACA;IACD,CAAC;CACH;CAAC,qCAE0B;GAAE2c,cAAc;GAAEG;CAAe,CAAC,EAC7D;GACC,IAAIH,cAAc,EAClB;KACC,KAAK,4CAAI,sBAAQ7Z,QAAQ,CAAC,iBAAiB,EAAE;OAC5CtE,EAAE,EAAEme,cAAc,CAACa,WAAW;OAC9B1X,MAAM,EAAE;SAAErC,KAAK,EAAE;;MACjB,CAAC;;GAGHxF,MAAM,CAAC+gB,IAAI,CAAClC,cAAc,CAAC,CAAChf,OAAO,CAAEihB,IAAY,IAAK;KACrD,KAAK,4CAAI,sBAAQjc,QAAQ,CAAC,iBAAiB,EAAE;OAC5CtE,EAAE,EAAEugB,IAAI;OACRjZ,MAAM,EAAE;SAAErC,KAAK,EAAE;;MACjB,CAAC;IACF,CAAC;CACH;CAAC,kCAEuBjG,MAA0B,EAAEsf,cAAkC,EACtF;GACC,MAAM;KAAEJ,UAAU;KAAE1c;IAAU,GAAGxC,MAAM;GACvC,IAAIkf,UAAU,CAACvX,MAAM,KAAK,CAAC,EAC3B;KACC,OAAO,EAAE;;GAGV,MAAM8Z,gBAAgB,GAAG,EAAE;GAC3BhhB,MAAM,CAAC2Q,OAAO,CAACkO,cAAc,CAAC,CAAChf,OAAO,CAAC,CAAC,CAACihB,IAAY,EAAElf,SAAiB,CAAC,KAAK;KAC7E,MAAMb,OAAuB,GAAG,4CAAI,sBAAQH,OAAO,CAAC,kBAAkB,CAAC,CAACgB,SAAS,CAAC;KAClF,IAAI,CAACb,OAAO,EACZ;OACC;;KAGDigB,gBAAgB,CAACpX,IAAI,CAAC;OACrB,2CAAG,IAAI,oCAAiB;SAAE7H,QAAQ;SAAEgM,IAAI,EAAEhN,OAAO,CAACgN,IAAI;SAAEiR,aAAa,EAAE8B,IAAI;SAAEjE,OAAO,EAAE9b,OAAO,CAAC8b;QAAS,CAAC;OACxGqC,OAAO,0CAAE,IAAI,gDAAuBtd,SAAS,CAAC;OAC9CJ,MAAM,EAAET,OAAO,CAACS,MAAM;OACtBob,SAAS,EAAE7b,OAAO,CAAC6b,SAAS;OAC5Bxc,KAAK,EAAEW,OAAO,CAACX;MACf,CAAC;IACF,CAAC;GAEF,OAAO4gB,gBAAgB;CACxB;CAAC,gCAEqBpf,SAAiB,EACvC;GACC,MAAMb,OAAuB,GAAG,4CAAI,sBAAQH,OAAO,CAAC,kBAAkB,CAAC,CAACgB,SAAS,CAAC;GAClF,MAAMpB,IAAI,2CAAG,IAAI,8CAAoBO,OAAO,CAACiB,MAAM,CAAC;GAEpD,MAAMif,SAAS,GAAG,4CAAI,sBAAQrgB,OAAO,CAAC,oBAAoB,CAAC,CAACgB,SAAS,CAAC;GAEtE,MAAM8V,MAAM,GAAGuJ,SAAS,GAAGlgB,OAAO,CAACme,OAAO,CAACxH,MAAM,GAAG3W,OAAO,CAAC4e,QAAQ;GACpE,MAAM3O,QAAQ,GAAGiQ,SAAS,GAAGlgB,OAAO,CAACme,OAAO,CAAClO,QAAQ,GAAGxQ,IAAI,CAAC6B,IAAI;GACjE,IAAI6e,SAAS,GAAGD,SAAS,GAAGlgB,OAAO,CAACme,OAAO,CAACgC,SAAS,GAAG1gB,IAAI,CAAC4B,IAAI;GACjE,IAAI4O,QAAQ,KAAK1O,oBAAQ,CAACya,OAAO,EACjC;KACCmE,SAAS,GAAG,IAAI;;GAGjB,OAAO;KACN3gB,EAAE,0CAAE,IAAI,kDAAwBQ,OAAO,CAACiB,MAAM,EAAEJ,SAAS,CAAC;KAC1D8V,MAAM;KACN1G,QAAQ;KACRkQ;IACA;CACF;CAAC,qCAE0B3hB,MAI1B,EACD;GACC,MAAM;KAAEwC,QAAQ;KAAE8c,cAAc;KAAEH;IAAgB,GAAGnf,MAAM;GAE3D,MAAM4hB,YAAY,GAAG;KACpBpf,QAAQ;KACR0c,UAAU,EAAEI;IACZ;GAED,IAAIH,cAAc,EAClB;KACCyC,YAAY,CAACpT,IAAI,GAAG2Q,cAAc,CAAC3Q,IAAI;KACvCoT,YAAY,CAAC5B,WAAW,GAAGb,cAAc,CAACa,WAAW;;GAGtD,OAAO4B,YAAY;CACpB;CAAC,+BAEoBrC,iBAAoC,EACzD;GACC,MAAMsC,WAAW,GAAG,EAAE;GACtBtC,iBAAiB,CAACjf,OAAO,CAAEkB,OAAO,IAAK;KACtCqgB,WAAW,CAACxX,IAAI,yCAAC,IAAI,4CAAqB7I,OAAO,EAAE;IACnD,CAAC;GAEF,OAAOkD,OAAO,CAACgD,GAAG,CAACma,WAAW,CAAC;CAChC;CAAC,6BAEkB3C,UAAoB,EACvC;GACC,MAAMoC,OAAO,GAAG,EAAE;GAClBpC,UAAU,CAAC5e,OAAO,CAAEU,EAAE,IAAK;KAC1BsgB,OAAO,CAAC/V,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE,CAAC,GAAGtf,EAAE;IACpC,CAAC;GAEF,OAAOsgB,OAAO;CACf;CAAC,iCAEsB7e,MAAc,EAAEJ,SAAiB,EACxD;GACC,MAAMG,QAAQ,GAAG,4CAAI,8CAAoBC,MAAM,EAAED,QAAQ;GACzD,IAAIA,QAAQ,CAACsf,UAAU,CAAC,MAAM,CAAC,EAC/B;KACC,OAAQ,GAAEtf,QAAS,IAAGH,SAAU,EAAC;;GAGlC,MAAM0f,WAAW,GAAG5gB,2BAAI,CAACsX,SAAS,EAAE;GAEpC,OAAQ,GAAEjW,QAAS,IAAGuf,WAAY,IAAG1f,SAAU,EAAC;CACjD;CAAC,yBAEcqK,MAAwB,EAAEsV,UAAkB,EAC3D;GACCtV,MAAM,CAACpM,OAAO,CAAE2F,KAAK,IAAK;;KAEzBC,OAAO,CAACD,KAAK,CAAE,mBAAkB+b,UAAW,iBAAgB/b,KAAK,CAACkI,IAAK,aAAYlI,KAAK,CAACzE,OAAQ,EAAC,CAAC;IACnG,CAAC;CACH;CAAC,iCAEsBgB,QAAgB,EACvC;GACC,OAAO,4CAAI,sBAAQ8C,QAAQ,CAAC,6BAA6B,EAAE;KAC1D9C;IACA,CAAC;CACH;CAAC,oCAEyB;GAAE8c,cAAc;GAAEH,cAAc;GAAE3c;CAAS,CAAC,EACtE;GACC,IACA;KACC,MAAMyf,aAAa,2CAAG,IAAI,0DAA4B;OAAE3C,cAAc;OAAEH,cAAc;OAAE3c;MAAU,CAAC;KACnG,MAAM6e,QAAQ,GAAG,8CAAM,IAAI,8CAAsBY,aAAa,CAAC;KAC/Dzd,uBAAM,CAACC,IAAI,CAAC,yCAAyC,EAAE4c,QAAQ,CAAC;KAChE,4CAAI,gEAA+B;OAAEA,QAAQ;OAAE7e,QAAQ;OAAE2c;MAAgB;IACzE,CACD,OAAOzS,MAAM,EACb;KACC,4CAAI,0DAA4B;OAAEyS,cAAc;OAAEG;MAAgB;KAClE,4CAAI,kCAAgB5S,MAAM,EAAE,gBAAgB;;GAG7C,OAAOhI,OAAO,CAACC,OAAO,EAAE;CACzB;AA1hBYia,kBAAc,CAInBxa,QAAQ,GAAmB,IAAI;;CC7DhC,MAAM8d,mBAAmB,CAChC;GAYCniB,WAAW,GACX;KAAA,KAZAoiB,KAAK,GAAW,IAAI;KAAA,KACpBC,UAAU,GAAW,IAAI;KAAA,KACzBC,YAAY,GAAW,EAAE;KAAA,KACzBte,SAAS,GAAY,KAAK;KAAA,KAE1BgT,MAAM,GAAW,CAAC;KAAA,KAClBuL,QAAQ,GAAW,CAAC;KAAA,KACpBre,kBAAkB,GAAY,IAAI;KAAA,KAElCse,qBAAqB,GAAgB,IAAI7e,GAAG,EAAE;KAI7C,IAAI,CAACye,KAAK,GAAGhhB,2BAAI,CAACC,QAAQ,EAAE;KAC5B,IAAI,CAACghB,UAAU,GAAGjhB,2BAAI,CAACwE,aAAa,EAAE;KACtC,IAAI,CAAC6c,kBAAkB,GAAGlO,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACkO,aAAa,EAAE,GAAG,EAAE,IAAI,CAAC;KACzE,IAAI,CAACpW,WAAW,GAAG,IAAIjD,0BAAW,EAAE;;GAGrC9E,aAAa,GACb;KACC,IAAI,CAACP,SAAS,GAAG,IAAI;KAErB,OAAO,IAAI,CAACc,YAAY,CAAC;OAAEC,SAAS,EAAE;MAAM,CAAC;;GAG9CC,YAAY,GACZ;KACC,IAAI,IAAI,CAAChB,SAAS,IAAI,CAAC,IAAI,CAACE,kBAAkB,EAC9C;OACC,OAAOS,OAAO,CAACC,OAAO,EAAE;;KAEzB,IAAI,CAACZ,SAAS,GAAG,IAAI;KAErB,OAAO,IAAI,CAACc,YAAY,EAAE;;GAG3B6d,MAAM,CAACC,cAAsB,EAC7B;KACC,IAAI,CAACJ,qBAAqB,CAAC3M,GAAG,CAAC+M,cAAc,CAAC;KAC9C,IAAI,CAACR,KAAK,CAAC7c,QAAQ,CAAC,sBAAsB,EAAE;OAAEtE,EAAE,EAAE2hB;MAAgB,CAAC;KACnE,IAAI,CAACR,KAAK,CAAC7c,QAAQ,CAAC,gCAAgC,EAAE;OAAEtE,EAAE,EAAE2hB;MAAgB,CAAC;KAE7E,IAAI,CAACH,kBAAkB,EAAE;;GAG1BI,iBAAiB,CAACD,cAAsB,EAAErR,KAAa,EACvD;KACC,MAAM2Q,aAAa,GAAG;OACrBY,SAAS,EAAEF,cAAc;OACzBG,YAAY,EAAExR;MACd;KAED,IAAI,CAAC6Q,KAAK,CAAC7c,QAAQ,CAAC,sBAAsB,EAAE;OAAEtE,EAAE,EAAE2hB;MAAgB,CAAC;KAEnE,IAAI,CAACP,UAAU,CAACxc,UAAU,CAAC,mBAAmB,EAAEqc,aAAa,CAAC,CAC5Djc,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACpB,CAAC;;GAGJ,MAAM8c,eAAe,CAAC/iB,MAAM,EAC5B;KACC,MAAM;OAAEgB,EAAE;OAAEwN,IAAI;OAAEwU,eAAe,GAAG,MAAM,EAAE;OAAEC,aAAa,GAAG,MAAM;MAAI,GAAGjjB,MAAM;KAEjF,IACA;OACC,MAAMqhB,QAAQ,GAAG,MAAM,IAAI,CAACe,UAAU,CAACxc,UAAU,CAACC,sBAAU,CAACqd,cAAc,EAAE;SAC5EC,SAAS,EAAEniB,EAAE;SACboiB,WAAW,EAAE5U;QACb,CAAC;OACFwU,eAAe,CAAC3B,QAAQ,CAAC;MACzB,CACD,OAAOpb,KAAK,EACZ;;OAECC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;OACpBgd,aAAa,EAAE;;;GAIjBR,aAAa,GACb;KACC,MAAMY,WAAW,GAAG,CAAC,GAAG,IAAI,CAACd,qBAAqB,CAAC;KAEnD,IAAI,CAACH,UAAU,CAACxc,UAAU,CAAC,kBAAkB,EAAE;OAAE5E,EAAE,EAAEqiB;MAAa,CAAC,CACjErd,KAAK,CAAEC,KAAK,IAAK;;OAEjBC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACpB,CAAC;KAEH,IAAI,CAACsc,qBAAqB,CAACe,KAAK,EAAE;;GAGnCze,YAAY,CAAC;KAAEC,SAAS,GAAG;IAAO,GAAG,EAAE,EACvC;KACC,MAAMye,sBAAsB,GAAG;OAC9B9c,KAAK,EAAE,IAAI,CAAC4b,YAAY;OACxBmB,YAAY,EAAE;MACd;KACD,MAAMC,gBAAgB,GAAG;OACxB,CAAC5d,sBAAU,CAAC6d,WAAW,GAAG,CAAC7d,sBAAU,CAAC6d,WAAW,EAAEH,sBAAsB;MACzE;KAED,IAAIze,SAAS,EACb;OACC2e,gBAAgB,CAAC5d,sBAAU,CAAC8d,iBAAiB,CAAC,GAAG,CAAC9d,sBAAU,CAAC8d,iBAAiB,EAAE,EAAE,CAAC;MACnF,MAED;OACCJ,sBAAsB,CAACK,OAAO,GAAG,IAAI,CAAC7M,MAAM;OAC5CwM,sBAAsB,CAACM,SAAS,GAAG,IAAI,CAACvB,QAAQ;;KAGjD,OAAO,IAAI5d,OAAO,CAAEC,OAAO,IAAK;OAC/B,IAAI,CAACyd,UAAU,CAACtH,SAAS,CAAC2I,gBAAgB,EAAGpC,QAAQ,IAAK;SACzD7c,uBAAM,CAACC,IAAI,CAAC,uBAAuB,EAAE4c,QAAQ,CAAC;SAC9C1c,OAAO,CAAC,IAAI,CAACmf,cAAc,CAACzC,QAAQ,CAAC,CAAC;QACtC,CAAC;MACF,CAAC;;GAGHyC,cAAc,CAACzC,QAAgB,EAC/B;KACC,MAAM0C,mBAAmB,GAAG1C,QAAQ,CAACxb,sBAAU,CAAC6d,WAAW,CAAC,CAACpd,IAAI,EAAE;KACnE,IAAI,CAACrC,kBAAkB,GAAG,CAAC,IAAI,CAAC+f,UAAU,CAACD,mBAAmB,CAACE,aAAa,CAAC;KAC7E,IAAIF,mBAAmB,CAACE,aAAa,CAACtc,MAAM,KAAK,CAAC,EAClD;OACCnD,uBAAM,CAACC,IAAI,CAAC,iCAAiC,EAAEsf,mBAAmB,CAAC;OAEnE,OAAOrf,OAAO,CAACC,OAAO,EAAE;;KAGzB,IAAI,CAACoS,MAAM,GAAG,IAAI,CAACmN,aAAa,CAACH,mBAAmB,CAACE,aAAa,CAAC;KACnE,IAAI,CAAC3B,QAAQ,GAAG,IAAI,CAAC6B,eAAe,CAACJ,mBAAmB,CAACE,aAAa,CAAC;KAEvE,OAAO,IAAI,CAAC9e,YAAY,CAAC4e,mBAAmB,CAAC,CAACnY,IAAI,CAAC,MAAM;OACxD,IAAI,CAAC7H,SAAS,GAAG,KAAK;OAEtB,IAAIsd,QAAQ,CAACxb,sBAAU,CAAC8d,iBAAiB,CAAC,EAC1C;SACC,OAAOtC,QAAQ,CAACxb,sBAAU,CAAC8d,iBAAiB,CAAC,CAACrd,IAAI,EAAE;;OAGrD,OAAO,EAAE;MACT,CAAC;;GAGHnB,YAAY,CAAC4e,mBAA8C,EAC3D;KACC,IAAI,CAAC1X,WAAW,CAAC2P,eAAe,CAAC+H,mBAAmB,CAACvjB,KAAK,CAAC;KAE3D,OAAO,IAAI,CAAC2hB,KAAK,CAAC7c,QAAQ,CAAC,0BAA0B,EAAEye,mBAAmB,CAAC;;GAG5EG,aAAa,CAACE,UAAkC,EAChD;KACC,OAAOA,UAAU,CAACA,UAAU,CAACzc,MAAM,GAAG,CAAC,CAAC,CAAC3G,EAAE;;GAG5CmjB,eAAe,CAACC,UAAkC,EAClD;KACC,OAAO,IAAI,CAACC,WAAW,CAACD,UAAU,CAACA,UAAU,CAACzc,MAAM,GAAG,CAAC,CAAC,CAAC;;GAG3D0c,WAAW,CAAC9jB,IAA0B,EACtC;KACC,OAAOA,IAAI,CAAC+jB,WAAW,KAAKC,kCAAsB,CAACC,OAAO,GACvDD,kCAAsB,CAACC,OAAO,GAC9BD,kCAAsB,CAACE,MAAM;;GAIjCT,UAAU,CAACC,aAAoB,EAC/B;KACC,IAAI,CAACliB,cAAI,CAACC,aAAa,CAACiiB,aAAa,CAAC,EACtC;OACC,OAAO,IAAI;;KAGZ,OAAOA,aAAa,CAACtc,MAAM,GAAG,IAAI,CAAC0a,YAAY;;GAGhDqC,OAAO,GACP;KACClgB,uBAAM,CAACC,IAAI,CAAC,gCAAgC,CAAC;;CAE/C;;CCnMyC;AAEzC,CAAO,MAAMkgB,WAAW,CACxB;GAGC5kB,WAAW,GACX;KAAA;OAAA;OAAA;;KACC,4CAAI,kCAAeoB,2BAAI,CAACwE,aAAa,EAAE;;GAGxC+c,MAAM,CAAC;KAAEjgB,MAAM;KAAEW;IAAQ,EACzB;KACC,MAAM+C,WAAW,GAAG;OAAEzD,OAAO,EAAED,MAAM;OAAEmiB,OAAO,EAAExhB;MAAQ;KAExD,OAAO,4CAAI,gCAAawC,UAAU,CAACC,sBAAU,CAACgf,gBAAgB,EAAE1e,WAAW,CAAC,CAACH,KAAK,CAAEC,KAAK,IAAK;;OAE7FC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;MACxD,CAAC;;GAGH6e,IAAI,CAAC/F,OAAiB,EACtB;KACC,OAAO9W,wBAAS,CAACpC,sBAAU,CAACkf,gBAAgB,EAAE;OAC7Cze,IAAI,EAAE;SACL+Q,GAAG,EAAE0H;;MAEN,CAAC,CAAC/Y,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;MAC9D,CAAC;;CAEJ;;CCpBA,MAAM+e,wBAAwB,GAAG,EAAE;CAAC;CAAA;CAAA;CAAA;CAAA;AAEpC,CAAO,MAAMC,eAAe,SAASlH,6BAAY,CACjD;GAkBChe,WAAW,GACX;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAnB6C;;KAAE;OAAA;OAAA;;KAoBvD,IAAI,CAACmlB,iBAAiB,CAACD,eAAe,CAACE,cAAc,CAAC;KAEtD,4CAAI,oDAA0B,4CAAI,oCAAiBC,IAAI,CAAC,IAAI,CAAC;KAC7DrH,6BAAY,CAACsH,SAAS,CAACpH,qBAAS,CAACqH,QAAQ,CAACC,MAAM,0CAAE,IAAI,kDAAwB;;GAG/EC,cAAc,CAAClkB,OAA+B,EAC9C;KACC,MAAM;OAAEmkB,YAAY;OAAEC,UAAU;OAAEC,UAAU,GAAG,KAAK;OAAEljB,MAAM;OAAED;MAAU,GAAGlB,OAAO;KAElF,4CAAI,wCAAmBokB,UAAU,CAAC,GAAG,IAAIE,yBAAQ,CAAC;OACjDD,UAAU;OACVE,UAAU,EAAE,4CAA4C;OACxDC,QAAQ,EAAE,IAAI;OACdC,iBAAiB,EAAE;SAClBC,QAAQ,EAAEP,YAAY;SACtBxkB,IAAI,EAAE;WACLwB,MAAM;WACND;;QAED;OACDyjB,gBAAgB,EAAE,IAAI;OACtBC,iBAAiB,EAAE,IAAI;OACvBC,eAAe,EAAE,SAAS;OAC1BC,iBAAiB,EAAGjkB,IAAkB,IAAK;SAC1C,OAAO,CAACA,IAAI,CAACkkB,aAAa,CAAC,YAAY,CAAC,IAAI,CAAClkB,IAAI,CAACmkB,UAAU,EAAE;QAC9D;OACDC,mBAAmB,EAAE,YAAY;OACjCC,uBAAuB,EAAE,OAAO;OAChCC,kBAAkB,EAAE,GAAG;OACvBC,iBAAiB,EAAE,GAAG;OACtBC,wBAAwB,EAAE,IAAI;OAC9BC,uBAAuB,EAAE,IAAI;OAC7BC,WAAW,EAAE,IAAI;OACjBC,MAAM,EAAE;SACP,CAACC,8BAAa,CAACC,cAAc,GAAIC,KAAK,IAAK;WAC1C,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACI,cAAc,EAAED,KAAK,CAAC;UACvD;SACD,CAACF,8BAAa,CAACI,iBAAiB,GAAIF,KAAK,IAAK;WAC7C,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACM,iBAAiB,EAAEH,KAAK,CAAC;UAC1D;SACD,CAACF,8BAAa,CAACM,QAAQ,GAAIJ,KAAK,IAAK;WACpC,MAAM;aAAE9kB;YAAM,GAAG8kB,KAAK,CAACK,OAAO,EAAE;WAChC,IAAI,CAACtJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACS,SAAS,EAAE;aAAEplB,IAAI;aAAEujB;YAAY,CAAC;UACjE;SACD,CAACqB,8BAAa,CAACS,oBAAoB,GAAIP,KAAK,IAAK;WAChD,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACW,oBAAoB,EAAER,KAAK,CAAC;UAC7D;SACD,CAACF,8BAAa,CAACW,oBAAoB,GAAIT,KAAK,IAAK;WAChD,MAAM;aAAE9kB;YAAM,GAAG8kB,KAAK,CAACK,OAAO,EAAE;WAChC,IAAI,CAACtJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACa,oBAAoB,EAAE;aAAExlB,IAAI;aAAEujB;YAAY,CAAC;UAC5E;SACD,CAACqB,8BAAa,CAACa,KAAK,GAAIX,KAAK,IAAK;WACjC,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACe,iBAAiB,EAAEZ,KAAK,CAAC;UAC1D;SACD,CAACF,8BAAa,CAACe,UAAU,GAAIb,KAAK,IAAK;WACtC,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACe,iBAAiB,EAAEZ,KAAK,CAAC;UAC1D;SACD,CAACF,8BAAa,CAACgB,uBAAuB,GAAId,KAAK,IAAK;WACnD,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACkB,sBAAsB,EAAEf,KAAK,CAAC;UAC/D;SACD,CAACF,8BAAa,CAACkB,eAAe,GAAIhB,KAAK,IAAK;WAC3C,IAAI,CAACjJ,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACoB,gBAAgB,EAAE;aAAExC;YAAY,CAAC;;;MAGpE,CAAC;;GAGHyC,KAAK,CAACzC,UAAkB,EACxB;KACC,4CAAI,wCAAmBA,UAAU,CAAC,CAAC0C,aAAa,CAAC,IAAI,CAAC;KACtD,4CAAI,wCAAmB1C,UAAU,CAAC,CAACyC,KAAK,EAAE;;GAG3CE,eAAe,CAAC3C,UAAkB,EAClC;KACC,4CAAI,wCAAmBA,UAAU,CAAC,CAAChB,OAAO,CAAC;OAAE4D,qBAAqB,EAAE;MAAO,CAAC;;GAG7EC,QAAQ,CAACC,KAAwB,EACjC;KACC,MAAMC,aAAa,GAAGD,KAAK,CAAC5gB,KAAK,CAAC,CAAC,EAAEod,wBAAwB,CAAC;KAE9D,MAAM0D,UAAU,GAAG,EAAE;KACrBD,aAAa,CAACnoB,OAAO,CAAEqoB,IAAI,IAAK;OAC/B,MAAMxmB,IAAI,2CAAG,IAAI,sBAAUwmB,IAAI,CAAC;OAChC,IAAIxmB,IAAI,EACR;SACCumB,UAAU,CAACre,IAAI,CAAClI,IAAI,CAAC;;MAEtB,CAAC;KAEF,OAAOumB,UAAU;;GAGlBpf,QAAQ,CAACoc,UAAU,EACnB;KACC,OAAO,4CAAI,wCAAmBA,UAAU,CAAC,CAACpc,QAAQ,EAAE;;GAmDrDob,OAAO,GACP;KACC3G,6BAAY,CAAC6K,WAAW,CAAC3K,qBAAS,CAACqH,QAAQ,CAACC,MAAM,0CAAE,IAAI,kDAAwB;;CAElF;CAAC,mBApDSoD,IAAqB,EAC9B;GACC,OAAO,4CAAI,wCAAmBA,IAAI,CAACjD,UAAU,CAAC,CAACmD,OAAO,CACrDF,IAAI,CAACxmB,IAAI,EACT;KACCnB,EAAE,EAAE2nB,IAAI,CAACG,UAAU;KACnBC,UAAU,EAAE;OACXvmB,QAAQ,EAAEmmB,IAAI,CAACnmB,QAAQ;OACvBC,MAAM,EAAEkmB,IAAI,CAAClmB,MAAM;OACnBgd,aAAa,EAAEkJ,IAAI,CAAClJ,aAAa;OACjCuJ,UAAU,EAAEL,IAAI,CAACK;;IAElB,CACD;CACF;CAAC,0BAEe/B,KAAgB,EAChC;GACC,MAAM;KAAE6B,UAAU;KAAErJ;IAAe,GAAGwH,KAAK,CAACK,OAAO,EAAE;GACrD,IAAI,CAACwB,UAAU,IAAI,CAACrJ,aAAa,EACjC;KACC;;GAGD,4CAAI,oDAAyBqJ,UAAU;GACvC,IAAI,CAAC9K,IAAI,CAACiH,eAAe,CAAC6B,MAAM,CAACmC,kBAAkB,EAAE;KAAExJ,aAAa;KAAEqJ;IAAY,CAAC;CACpF;CAAC,kCAEuBA,UAAkB,EAC1C;GACC,MAAMI,YAAY,GAAGzoB,MAAM,CAACC,MAAM,yCAAC,IAAI,wCAAmB;GAC1D,KAAK,MAAM4kB,QAAQ,IAAI4D,YAAY,EACnC;KACC,IAAI,CAAC5D,QAAQ,CAAC6D,OAAO,EACrB;OACC;;KAGD,MAAMhnB,IAAI,GAAGmjB,QAAQ,CAAC6D,OAAO,CAACL,UAAU,CAAC;KACzC,IAAI3mB,IAAI,EACR;OACCA,IAAI,CAACinB,MAAM,EAAE;OAEb;;;CAGH;CAxKYnE,eAAe,CAKpBE,cAAc,GAAG,mDAAmD;CAL/DF,eAAe,CAOpB6B,MAAM,GAAG;GACfI,cAAc,EAAE,gBAAgB;GAChCK,SAAS,EAAE,WAAW;GACtBH,iBAAiB,EAAE,mBAAmB;GACtCK,oBAAoB,EAAE,sBAAsB;GAC5CE,oBAAoB,EAAE,sBAAsB;GAC5CE,iBAAiB,EAAE,mBAAmB;GACtCoB,kBAAkB,EAAE,oBAAoB;GACxCjB,sBAAsB,EAAE,wBAAwB;GAChDE,gBAAgB,EAAE;CACnB,CAAC;;CCTF,MAAMmB,eAAe,GAAG,0CAA0C;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEnE,CAAO,MAAMC,mBAAgB,SAASvL,6BAAY,CAClD;GA6BC,OAAO5Z,WAAW,GAClB;KACC,IAAI,CAAC,IAAI,CAACC,QAAQ,EAClB;OACC,IAAI,CAACA,QAAQ,GAAG,IAAI,IAAI,EAAE;;KAG3B,OAAO,IAAI,CAACA,QAAQ;;GAGrBrE,WAAW,GACX;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAtC4B;;KAAK;OAAA;OAAA,OACW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAcnD;;KAwBH,IAAI,CAACmlB,iBAAiB,CAACmE,eAAe,CAAC;KAEvC,4CAAI,wBAAUloB,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,kCAAeD,2BAAI,CAACwE,aAAa,EAAE;KACvC,4CAAI,sCAAmBiZ,iBAAc,CAACza,WAAW,EAAE;KACnD,4CAAI;;GAGL,MAAMolB,mBAAmB,CAACvpB,MAAiC,EAC3D;KACC,MAAM;OAAEwpB,cAAc;OAAEhnB,QAAQ;OAAEmjB,UAAU;OAAE8D;MAAY,GAAGzpB,MAAM;KAEnE,MAAM;OAAE0pB;MAAe,GAAGF,cAAc;KACxC,IAAI,CAACE,aAAa,IAAI,CAACC,6BAAY,CAACD,aAAa,CAAC,EAClD;OACC,OAAO,EAAE;;KAGVF,cAAc,CAACI,cAAc,EAAE;KAE/B,IAAI/oB,KAAa,GAAG,MAAMgpB,yCAAwB,CAACH,aAAa,CAAC;KACjE,IAAID,UAAU,EACd;OACC5oB,KAAK,GAAGA,KAAK,CAACuY,MAAM,CAAEjX,IAAI,IAAKoJ,qBAAK,CAACpJ,IAAI,CAAC2nB,OAAO,CAAC3nB,IAAI,CAACU,IAAI,CAAC,CAAC;OAC7D,IAAI4mB,UAAU,CAAC9hB,MAAM,KAAK,CAAC,EAC3B;SACC,OAAO,EAAE;;;KAIX,MAAM;OAAEoiB,aAAa;OAAErE;MAAY,GAAG,8CAAM,IAAI,wBAAW;OAC1D7kB,KAAK;OACL2B,QAAQ;OACRmjB;MACA,CAAC;KAEF,IAAIoE,aAAa,CAACpiB,MAAM,KAAK,CAAC,EAC9B;OACC,OAAO,EAAE;;KAGV,OAAO+d,UAAU;;GAGlB,MAAMsE,eAAe,CAAChqB,MAA6B,EACnD;KACC,MAAM;OAAEinB,KAAK;OAAE+B,UAAU;OAAErD,UAAU;OAAEnjB;MAAU,GAAGxC,MAAM;KAC1D,MAAMiqB,QAAQ,GAAGxpB,MAAM,CAACC,MAAM,CAACumB,KAAK,CAACiD,MAAM,CAACrpB,KAAK,CAAC;KAClD,IAAIopB,QAAQ,CAACtiB,MAAM,KAAK,CAAC,EACzB;OACC,OAAO,EAAE;;KAGV,MAAM;OAAE+d;MAAY,GAAG,8CAAM,IAAI,wBAAW;OAC3C7kB,KAAK,EAAEopB,QAAQ;OACfznB,QAAQ;OACRmjB,UAAU;OACVqD;MACA,CAAC;KAEF,OAAOtD,UAAU;;GAGlB,MAAMyE,qBAAqB,CAACnqB,MAA6B,EACzD;KACC,MAAM;OAAEinB,KAAK;OAAEzkB,QAAQ;OAAEmjB,UAAU;OAAEqD;MAAY,GAAGhpB,MAAM;KAC1DinB,KAAK,CAAC2C,cAAc,EAAE;KAEtB,MAAMK,QAAQ,GAAG,MAAMJ,yCAAwB,CAAC5C,KAAK,CAACmD,YAAY,CAAC;KACnE,IAAIH,QAAQ,CAACtiB,MAAM,KAAK,CAAC,EACzB;OACC,OAAO,EAAE;;KAGV,MAAM;OAAE+d;MAAY,GAAG,8CAAM,IAAI,wBAAW;OAC3C7kB,KAAK,EAAEopB,QAAQ;OACfznB,QAAQ;OACRmjB,UAAU;OACVqD;MACA,CAAC;KAEF,OAAOtD,UAAU;;GA4BlB2E,mBAAmB,CAAC3E,UAAkB,EACtC;KAAA;KACC,gCAAO,4CAAI,kDAAwBA,UAAU,CAAC,CAAC4E,gBAAgB,oCAAI,CAAC;;GA6BrEhhB,QAAQ,CAACoc,UAAU,EACnB;KACC,OAAO,4CAAI,sCAAkBpc,QAAQ,CAACoc,UAAU,CAAC;;GAGlDyC,KAAK,CAACzC,UAAkB,EACxB;KACC,4CAAI,kDAAwBA,UAAU,CAAC,CAACC,UAAU,GAAG,IAAI;KACzD,4CAAI,sCAAkBwC,KAAK,CAACzC,UAAU,CAAC;;GAGxC6E,kBAAkB,CAAC1pB,KAAK,EAAE2B,QAAQ,EAClC;KACC/B,MAAM,CAACC,MAAM,CAACG,KAAK,CAAC,CAACP,OAAO,CAAE6B,IAAI,IAAK;OACtC,MAAMqoB,eAAe,2CAAG,IAAI,8CAAsBroB,IAAI,EAAEK,QAAQ,CAAC;OAEjE,4CAAI,oDAAyBgoB,eAAe,EAAE5e,IAAI,CAAC,MAAM;SACxD,MAAMpK,OAAO,GAAG;WACfie,aAAa,EAAE+K,eAAe,CAAC/K,aAAa;WAC5CV,OAAO,EAAE,CAACyL,eAAe,CAAC1B,UAAU,CAAC;WACrCtmB,QAAQ,EAAEgoB,eAAe,CAAChoB;UAC1B;SAED,OAAO,4CAAI,oCAAiBsc,oBAAoB,CAACtd,OAAO,CAAC;QACzD,CAAC,CAACoK,IAAI,CAAC,MAAM;SACb,IAAI,CAAC6e,UAAU,CAAC;WACfhoB,MAAM,EAAE+nB,eAAe,CAAC/nB,MAAM;WAC9BioB,eAAe,EAAEF,eAAe,CAAC1B,UAAU;WAC3CrJ,aAAa,EAAE+K,eAAe,CAAC/K,aAAa;WAC5CkL,UAAU,EAAEH,eAAe,CAACroB,IAAI,CAACnB,EAAE,CAAC4G,KAAK,CAAC,CAAC,CAAC;WAC5CgjB,QAAQ,EAAE;UACV,CAAC;QACF,CAAC,CAAC5kB,KAAK,CAAEC,KAAK,IAAK;;SAEnBC,OAAO,CAACD,KAAK,CAAC,0CAA0C,EAAEA,KAAK,CAAC;QAChE,CAAC;MACF,CAAC;;GA4FH4kB,iBAAiB,CAACroB,QAAgB,EAClC;KACC,IAAI,4CAAI,sCAAkBA,QAAQ,IAAI,CAAC,EACvC;OACC,OAAOkC,OAAO,CAACC,OAAO,yCAAC,IAAI,sCAAkBnC,QAAQ,EAAE;;KAGxD,4CAAI,IAAI,yDACR;OACC,OAAO,4CAAI,4DAA6BA,QAAQ,CAAC;;KAGlD,4CAAI,4DAA6BA,QAAQ,CAAC,2CAAG,IAAI,8CAAsBA,QAAQ,CAAC;KAEhF,OAAO,4CAAI,4DAA6BA,QAAQ,CAAC;;GA0BlDioB,UAAU,CAACzqB,MAAwB,EACnC;KACC,MAAM;OAAE0qB,eAAe;OAAEjL,aAAa;OAAEhd,MAAM;OAAEkoB,UAAU;OAAEC,QAAQ;OAAEE,WAAW,GAAG,EAAE;OAAE9B,UAAU,GAAG;MAAO,GAAGhpB,MAAM;KAErH,MAAM+qB,YAAY,GAAG,EAAE;KACvB,IAAIH,QAAQ,EACZ;OACCG,YAAY,CAACC,OAAO,GAAGL,UAAU;MACjC,MAED;OACCI,YAAY,CAACE,SAAS,GAAGN,UAAU,CAAC7J,QAAQ,EAAE,CAAClZ,KAAK,CAAC,CAAC,CAAC;;KAGxD,4CAAI,gCAAahC,UAAU,CAACC,sBAAU,CAACqlB,gBAAgB,EAAE;OACxDxoB,OAAO,EAAED,MAAM;OACfjB,OAAO,EAAEspB,WAAW;OACpBK,WAAW,EAAE1L,aAAa;OAC1B2L,gBAAgB,EAAEV,eAAe;OACjCW,OAAO,EAAErC,UAAU,GAAG,GAAG,GAAG,GAAG;OAC/B,GAAG+B;MACH,CAAC,CAAC/kB,KAAK,CAAEC,KAAK,IAAK;OACnB,4CAAI,sCAAkBwZ,aAAa;OACnC,4CAAI,4CAAqBiL,eAAe,EAAE,CAAC,EAAEY,sBAAU,CAACrlB,KAAK;OAC7DzB,uBAAM,CAACyB,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;MACvC,CAAC;;GAGHslB,aAAa,CAAC7F,UAAkB,EAChC;KACC,MAAMljB,QAAQ,GAAG,4CAAI,kDAAwBkjB,UAAU,CAAC,CAACljB,QAAQ;KACjE,MAAMC,MAAM,2CAAG,IAAI,0BAAYD,QAAQ,CAAC;KAExC,MAAMuc,OAAO,GAAG,4CAAI,sCAAkBzV,QAAQ,CAACoc,UAAU,CAAC,CAACpiB,GAAG,CAAEnB,IAAI,IAAK;OACxE,OAAOA,IAAI,CAACqpB,eAAe,EAAE,CAAC1K,QAAQ,EAAE,CAAClZ,KAAK,CAAC,CAAC,CAAC;MACjD,CAAC;KAEF,MAAMohB,UAAU,GAAG,4CAAI,sCAAkB1f,QAAQ,CAACoc,UAAU,CAAC,CAAC+F,KAAK,CAAEtpB,IAAI,IAAK;OAC7E,OAAOA,IAAI,CAACkkB,aAAa,CAAC,YAAY,CAAC;MACvC,CAAC;KAEF,OAAO,4CAAI,gCAAazgB,UAAU,CAACC,sBAAU,CAACqlB,gBAAgB,EAAE;OAC/DxoB,OAAO,EAAED,MAAM;OACfjB,OAAO,EAAE,4CAAI,kDAAwBkkB,UAAU,CAAC,CAAClX,IAAI;OACrD2c,WAAW,EAAE,4CAAI,kDAAwBzF,UAAU,CAAC,CAACjG,aAAa;;OAElE4L,OAAO,EAAErC,UAAU,GAAG,GAAG,GAAG,GAAG;OAC/BiC,SAAS,EAAElM;MACX,CAAC;;;;GAuRH2M,6BAA6B,CAAC1rB,MAA2C,EACzE;KACC,MAAM;OAAE0lB,UAAU;OAAElX;MAAM,GAAGxO,MAAM;KAEnC,4CAAI,sCAAkB0lB,UAAU,EAAElX,IAAI;KACtC,4CAAI,kCAAgBkX,UAAU,EAAE,IAAI;KACpC,4CAAI,0CAAoBA,UAAU;;GAGnC5G,oBAAoB,CAAC9e,MAA2C,EAChE;KACC,MAAM;OAAE0lB,UAAU;OAAElX;MAAM,GAAGxO,MAAM;KAEnC,4CAAI,sCAAkB0lB,UAAU,EAAElX,IAAI;KACtC,4CAAI,kCAAgBkX,UAAU,EAAE,IAAI;KACpC,4CAAI,wCAAmBA,UAAU;;GA0KlCiG,sBAAsB,CAACrqB,OAAwD,EAC/E;KACC,MAAM;OAAEokB,UAAU;OAAEkG;MAAU,GAAGtqB,OAAO;KAExC,MAAMT,KAA0B,GAAG,4CAAI,sCAAkByI,QAAQ,CAACoc,UAAU,CAAC,CAACtM,MAAM,CAAEjX,IAAkB,IAAK;OAC5G,OAAOypB,QAAQ,CAAC7S,QAAQ,CAAC5W,IAAI,CAAC0pB,KAAK,EAAE,CAAC;MACtC,CAAC;KAEFhrB,KAAK,CAACP,OAAO,CAAE6B,IAAkB,IAAK;OACrCA,IAAI,CAACinB,MAAM,EAAE;MACb,CAAC;KAEF,4CAAI,sCAAkB1D,UAAU,EAAE7kB,KAAK;;GAGxC6jB,OAAO,GACP;KACC,4CAAI,sCAAkBA,OAAO,EAAE;;CAEjC;CAAC,0BAnvBgB1kB,MAAiD,EACjE;GACC,MAAM;KAAEwC,QAAQ;KAAEmjB;IAAY,GAAG3lB,MAAM;GAEvC,MAAM0lB,UAAU,GAAGna,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;GACzC,MAAM7d,MAAM,2CAAG,IAAI,0BAAYD,QAAQ,CAAC;GAExC,OAAO,IAAI,CAACqoB,iBAAiB,CAACroB,QAAQ,CAAC,CAACoJ,IAAI,CAAE6Z,YAAoB,IAAK;KACtE,4CAAI,sCAAkBD,cAAc,CAAC;OACpCC,YAAY;OACZC,UAAU;OACVC,UAAU;OACVljB,MAAM;OACND;MACA,CAAC;KAEF,OAAOkjB,UAAU;IACjB,CAAC;CACH;CAAC,oCAEyB;GAAEA,UAAU;GAAEoG;CAAW,CAAC,EACpD;GACC,4CAAI,kDAAwBpG,UAAU,CAAC,CAAC4E,gBAAgB,GAAGwB,UAAU;CACtE;CAAC,oBAOS9rB,MAAyB,EACnC;GACC,MAAM;KAAEa,KAAK;KAAE2B,QAAQ;KAAEmjB,UAAU;KAAEqD,UAAU,GAAG;IAAO,GAAGhpB,MAAM;GAElE,OAAO,4CAAI,oCAAiB;KAAEwC,QAAQ;KAAEmjB;IAAY,EAAE/Z,IAAI,CAAE8Z,UAAkB,IAAK;KAClF,MAAMqG,gBAAgB,GAAG,EAAE;KAC3BlrB,KAAK,CAACP,OAAO,CAAE6B,IAAI,IAAK;OACvB,MAAM6pB,YAAY,2CAAG,IAAI,oDAAyB7pB,IAAI,EAAEK,QAAQ,EAAEkjB,UAAU,EAAEsD,UAAU,CAAC;OACzF+C,gBAAgB,CAAC1hB,IAAI,CAAC2hB,YAAY,CAAC;MACnC,CAAC;KAEF,MAAMtD,UAAU,GAAG,4CAAI,sCAAkBH,QAAQ,CAACwD,gBAAgB,CAAC;KACnE,4CAAI,kCAAgBrG,UAAU,EAAEgD,UAAU,EAAElmB,QAAQ,EAAEmjB,UAAU;KAEhE,4CAAI,wDAA2B;OAC9BmG,UAAU,EAAEjrB,KAAK,CAAC8G,MAAM;OACxB+d;MACA;KAED,OAAO;OACNqE,aAAa,EAAErB,UAAU;OACzBhD;MACA;IACD,CAAC;CACH;CAAC,kCAyCuB8E,eAAgC,EACxD;GACC,OAAO,4CAAI,sBAAQllB,QAAQ,CAAC,WAAW,EAAE;KACxCtE,EAAE,EAAEwpB,eAAe,CAAC1B,UAAU;KAC9BrmB,MAAM,EAAE+nB,eAAe,CAAC/nB,MAAM;KAC9B2d,QAAQ,EAAEjf,2BAAI,CAACsX,SAAS,EAAE;KAC1B5V,IAAI,EAAE2nB,eAAe,CAACroB,IAAI,CAACU,IAAI;KAC/BC,IAAI,EAAEyI,qBAAK,CAACpJ,IAAI,CAAC8pB,sBAAsB,CAACzB,eAAe,CAACroB,IAAI,CAAC+pB,GAAG,CAAC;KACjEC,SAAS,EAAE3B,eAAe,CAACroB,IAAI,CAAC+pB,GAAG;KACnC3V,IAAI,EAAEiU,eAAe,CAACroB,IAAI,CAACiqB,OAAO;KAClCzqB,MAAM,EAAE2pB,sBAAU,CAACe,IAAI;KACvBC,QAAQ,EAAE,CAAC;KACXC,UAAU,EAAE,4CAAI,sCAAmB1pB;IACnC,CAAC;CACH;CAAC,0BAGD;GACC,4CAAI,wCAAoB,IAAIoiB,eAAe,EAAE;GAC7C,4CAAI,sCAAkBI,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACI,cAAc,EAAGD,KAAgB,IAAK;KAC5F,MAAM;OAAE9kB;MAAM,GAAG8kB,KAAK,CAACK,OAAO,EAAE;KAChC,4CAAI,oCAAiBnlB,IAAI;IACzB,CAAC;GAEF,4CAAI,sCAAkBkjB,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACS,SAAS,EAAGN,KAAgB,IAAK;KACvF,MAAM;OAAE9kB,IAAI;OAAEujB;MAAY,GAAGuB,KAAK,CAACK,OAAO,EAAE;KAC5C,4CAAI,wDAA2BnlB,IAAI;KACnC,4CAAI,sDAA0BujB,UAAU,EAAEvjB,IAAI,CAAC0pB,KAAK,EAAE;KACtD,4CAAI,wCAAmBnG,UAAU;IACjC,CAAC;GAEF,4CAAI,sCAAkBL,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACM,iBAAiB,EAAGH,KAAgB,IAAK;KAC/F,MAAM;OAAE9kB;MAAM,GAAG8kB,KAAK,CAACK,OAAO,EAAE;KAChC,4CAAI,kDAAwBnlB,IAAI;KAChC,IAAI,CAAC6b,IAAI,CAACsL,mBAAgB,CAACrC,KAAK,CAACuF,WAAW,CAAC;IAC7C,CAAC;GAEF,4CAAI,sCAAkBnH,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACW,oBAAoB,EAAGR,KAAgB,IAAK;KAClG,MAAM;OAAE9kB;MAAM,GAAG8kB,KAAK,CAACK,OAAO,EAAE;KAChC,4CAAI,4CAAqBnlB,IAAI,CAAC0pB,KAAK,EAAE,EAAE1pB,IAAI,CAACsqB,WAAW,EAAE,EAAEnB,sBAAU,CAACoB,MAAM;IAC5E,CAAC;GAEF,4CAAI,sCAAkBrH,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACa,oBAAoB,EAAE,MAAOV,KAAgB,IAAK;KACxG,MAAM;OAAE9kB,IAAI;OAAEujB;MAAsD,GAAGuB,KAAK,CAACK,OAAO,EAAE;KACtF,MAAMqF,YAAoB,GAAGxqB,IAAI,CAACqpB,eAAe,EAAE,CAAC1K,QAAQ,EAAE,CAAClZ,KAAK,CAAC,CAAC,CAAC;KACvE,MAAM8iB,eAAuB,GAAGvoB,IAAI,CAAC0pB,KAAK,EAAE;KAC5C,4CAAI,IAAI,8BAAcnB,eAAe,GACrC;OACC,4CAAI,oCAAiB;SAAEiC,YAAY;SAAEjC;QAAiB;;KAGvD,4CAAI,4CAAqBA,eAAe,EAAEvoB,IAAI,CAACsqB,WAAW,EAAE,EAAEnB,sBAAU,CAACe,IAAI;KAE7E,8CAAM,IAAI,kCAAgBlqB,IAAI,CAAC;KAC/B,4CAAI,gDAAuBujB,UAAU,EAAEgF,eAAe;KAEtD,6CAAK,IAAI,0BAAYhF,UAAU,CAAC;KAChC,IAAI,CAAC1H,IAAI,CAACsL,mBAAgB,CAACrC,KAAK,CAAC2F,cAAc,CAAC;IAChD,CAAC;GAEF,4CAAI,sCAAkBvH,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACe,iBAAiB,EAAGZ,KAAgB,IAAK;KAC/F,MAAM;OAAE9kB,IAAI;OAAE8D;MAAO,GAAGghB,KAAK,CAACK,OAAO,EAAE;KACvC,4CAAI,4CAAqBnlB,IAAI,CAAC0pB,KAAK,EAAE,EAAE,CAAC,EAAEP,sBAAU,CAACrlB,KAAK;KAC1D,4CAAI,sCAAkB9D,IAAI,CAACkkB,aAAa,CAAC,eAAe,CAAC;KACzD,4CAAI,0BAAYpgB,KAAK;KACrBzB,uBAAM,CAACyB,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;KACrD,IAAI,CAAC+X,IAAI,CAACsL,mBAAgB,CAACrC,KAAK,CAAC4F,WAAW,CAAC;IAC7C,CAAC;GAEF,4CAAI,sCAAkBxH,SAAS,CAACJ,eAAe,CAAC6B,MAAM,CAACmC,kBAAkB,EAAGhC,KAAgB,IAAK;KAChG,MAAM;OAAExH,aAAa;OAAEqJ;MAAY,GAAG7B,KAAK,CAACK,OAAO,EAAE;KACrD,4CAAI,gCAAe7H,aAAa,EAAEqJ,UAAU;KAC5C,IAAI,CAAC9K,IAAI,CAACsL,mBAAgB,CAACrC,KAAK,CAAC6F,YAAY,CAAC;IAC9C,CAAC;CACH;CAAC,uBAEY1pB,MAAuB,EACpC;GACC,MAAM2pB,cAA6B,GAAG,CAACC,oBAAQ,CAACC,KAAK,EAAED,oBAAQ,CAACE,KAAK,CAAC;GACtE,MAAM/qB,IAAkB,GAAG,4CAAI,sBAAQd,OAAO,CAAC,WAAW,CAAC,CAAC+B,MAAM,CAAC;GAEnE,OAAO+pB,OAAO,CAAChrB,IAAI,CAAC,IAAI4qB,cAAc,CAAChU,QAAQ,CAAC5W,IAAI,CAACW,IAAI,CAAC;CAC3D;CAAC,0BAEexB,OAAwD,EACxE;GACC,KAAK,4CAAI,sBAAQgE,QAAQ,CAAC,+BAA+B,EAAEhE,OAAO,CAAC;CACpE;CAAC,+BAmBoBkB,QAAgB,EACrC;GACC,OAAO,IAAIkC,OAAO,CAAC,CAACC,OAAO,EAAEwN,MAAM,KAAK;KACvC,4CAAI,0DAA6B,IAAI;KAErC,MAAM1P,MAAM,2CAAG,IAAI,0BAAYD,QAAQ,CAAC;KACxC,4CAAI,gCAAaoD,UAAU,CAACC,sBAAU,CAACunB,eAAe,EAAE;OAAE1qB,OAAO,EAAED;MAAQ,CAAC,CAACmJ,IAAI,CAAEyV,QAAQ,IAAK;OAC/F,MAAM;SAAEgM,EAAE,EAAE5H;QAAc,GAAGpE,QAAQ,CAAC/a,IAAI,EAAE;OAC5C,4CAAI,0DAA6B,KAAK;OACtC,4CAAI,sBAAQgnB,MAAM,CAAC,cAAc,EAAE;SAClC9qB,QAAQ;SACR8F,MAAM,EAAE;WACPmd;;QAED,CAAC;OACF9gB,OAAO,CAAC8gB,YAAY,CAAC;MACrB,CAAC,CAACzf,KAAK,CAAEC,KAAK,IAAK;OACnB,4CAAI,0DAA6B,KAAK;OACtCkM,MAAM,CAAClM,KAAK,CAAC;MACb,CAAC;IACF,CAAC;CACH;CAAC,2BAqDgByf,UAAkB,EACnC;GACC,IAAI,yCAAC,IAAI,kCAAgBA,UAAU,CAAC,EACpC;KACC;;GAGD,MAAM,IAAI,CAAC6F,aAAa,CAAC7F,UAAU,CAAC;GACpC,4CAAI,sCAAkB2C,eAAe,CAAC3C,UAAU,CAAC;CAClD;CAAC,+BAEoBvjB,IAAkB,EACvC;GACC,MAAMorB,WAAW,GAAG,4CAAI,8BAAcprB,IAAI,CAACqrB,SAAS,EAAE,MAAMR,oBAAQ,CAACE,KAAK,IAAI/qB,IAAI,CAACmkB,UAAU,EAAE;GAC/F,IAAI,CAACiH,WAAW,EAChB;KACC,OAAO7oB,OAAO,CAACC,OAAO,EAAE;;GAGzB,MAAM3D,EAAE,GAAGmB,IAAI,CAACqpB,eAAe,EAAE,CAAC1K,QAAQ,EAAE,CAAClZ,KAAK,CAAC,CAAC,CAAC;GACrD,MAAM6lB,WAAW,GAAGtrB,IAAI,CAACurB,gBAAgB,EAAE;GAC3C,IAAI,CAACD,WAAW,EAChB;KACCtrB,IAAI,CAACwrB,aAAa,CAAC,YAAY,EAAE,IAAI,CAAC;KAEtC,OAAOjpB,OAAO,CAACC,OAAO,EAAE;;GAGzB,MAAMipB,QAAQ,GAAG,IAAIC,QAAQ,EAAE;GAC/BD,QAAQ,CAACE,MAAM,CAAC,IAAI,EAAE9sB,EAAE,CAAC;GACzB4sB,QAAQ,CAACE,MAAM,CAAC,aAAa,EAAEL,WAAW,EAAG,WAAUtrB,IAAI,CAAC4rB,OAAO,EAAG,MAAK,CAAC;GAE5E,OAAO9lB,wBAAS,CAACpC,sBAAU,CAACmoB,uBAAuB,EAAE;KAAE1nB,IAAI,EAAEsnB;IAAU,CAAC,CAAC5nB,KAAK,CAAEC,KAAK,IAAK;KACzFzB,uBAAM,CAACyB,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;IAC5D,CAAC;CACH;CAAC,kCAEuB9D,IAAU,EAAEK,QAAgB,EAAEkjB,UAAU,EAAEsD,UAAmB,EACrF;GACC,MAAMvJ,aAAa,GAAGlU,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;GAC5C,MAAMwI,UAAU,GAAGvd,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;GACzC,MAAM7d,MAAM,2CAAG,IAAI,0BAAYD,QAAQ,CAAC;GAExC,OAAO;KACNid,aAAa;KACbqJ,UAAU;KACV3mB,IAAI;KACJK,QAAQ;KACRC,MAAM;KACNijB,UAAU;KACVsD;IACA;CACF;CAAC,8BAEmBhoB,EAAU,EAAEsrB,QAAgB,EAAE3qB,MAAc,EAChE;GACC,KAAK,4CAAI,sBAAQ2D,QAAQ,CAAC,cAAc,EAAE;KACzCtE,EAAE;KACFsH,MAAM,EAAE;OACPgkB,QAAQ,EAAGA,QAAQ,KAAK,GAAG,GAAG,EAAE,GAAGA,QAAS;OAC5C3qB;;IAED,CAAC;CACH;CAAC,wBAEa8d,aAAqB,EAAEqJ,UAAU,EAC/C;GACC,MAAMtnB,OAAuB,GAAG,4CAAI,sBAAQH,OAAO,CAAC,kBAAkB,CAAC,CAACoe,aAAa,CAAC;GACtF,IAAIje,OAAO,EACX;KACC,KAAK,4CAAI,sBAAQ8D,QAAQ,CAAC,iBAAiB,EAAE;OAAEtE,EAAE,EAAEye;MAAe,CAAC;KACnE,KAAK,4CAAI,sBAAQna,QAAQ,CAAC,cAAc,EAAE;OAAEtE,EAAE,EAAE8nB;MAAY,CAAC;KAE7D,MAAM7nB,IAAiB,GAAG,4CAAI,sBAAQI,OAAO,CAAC,mBAAmB,CAAC,CAACG,OAAO,CAACiB,MAAM,CAAC;KAClF,MAAMkZ,aAA8B,GAAG,4CAAI,sBAAQta,OAAO,CAAC,gCAAgC,CAAC,CAACG,OAAO,CAACiB,MAAM,CAAC;KAE5G,IAAIkZ,aAAa,GAAG,CAAC,CAAC,EACtB;OACC,KAAK,4CAAI,sBAAQrW,QAAQ,CAAC,eAAe,EAAE;SAC1CtE,EAAE,EAAEC,IAAI,CAACuB,QAAQ;SACjB8F,MAAM,EAAE;WACPjG,SAAS,EAAEsZ;;QAEZ,CAAC;MACF,MAED;OACC,KAAK,4CAAI,sBAAQrW,QAAQ,CAAC,eAAe,EAAE;SAC1CtE,EAAE,EAAEC,IAAI,CAACuB;QACT,CAAC;;;CAGL;CAAC,0BAEeL,IAAkB,EAClC;GACC,MAAM8rB,MAAM,GAAG9rB,IAAI,CAAC0pB,KAAK,EAAE;GAC3B,MAAMqC,UAAU,GAAG/rB,IAAI,CAACqrB,SAAS,EAAE;GACnC,MAAMW,WAAW,2CAAG,IAAI,oCAAiBhsB,IAAI,CAAC;GAC9C,MAAMisB,MAAM,GAAGjsB,IAAI,CAACkkB,aAAa,CAAC,YAAY,CAAC;GAE/C,KAAK,4CAAI,sBAAQ/gB,QAAQ,CAAC,WAAW,EAAE;KACtCtE,EAAE,EAAEitB,MAAM;KACVxrB,MAAM,EAAEN,IAAI,CAACkkB,aAAa,CAAC,QAAQ,CAAC;KACpCjG,QAAQ,EAAEjf,2BAAI,CAACsX,SAAS,EAAE;KAC1B5V,IAAI,EAAEqrB,UAAU,CAACrrB,IAAI;KACrB0T,IAAI,EAAEpU,IAAI,CAACksB,OAAO,EAAE;KACpBvrB,IAAI,EAAEsrB,MAAM,GAAGpB,oBAAQ,CAAC7qB,IAAI,2CAAG,IAAI,8BAAc+rB,UAAU,CAAC;KAC5D/B,SAAS,0CAAE,IAAI,wCAAmB+B,UAAU,CAAC;KAC7CvsB,MAAM,EAAEQ,IAAI,CAACmsB,QAAQ,EAAE,GAAGhD,sBAAU,CAACrlB,KAAK,GAAGqlB,sBAAU,CAACgB,QAAQ;KAChEA,QAAQ,EAAE,CAAC;KACXC,UAAU,EAAE,4CAAI,sCAAmB1pB,IAAI;KACvC0rB,WAAW,EAAEC,GAAG,CAACC,eAAe,CAACtsB,IAAI,CAACqrB,SAAS,EAAE,CAAC;KAClD,GAAGW;IACH,CAAC;CACH;CAAC,oCAEyBhsB,IAAkB,EAC5C;GACC,MAAMgsB,WAAW,2CAAG,IAAI,oCAAiBhsB,IAAI,CAAC;GAE9C,KAAK,4CAAI,sBAAQmD,QAAQ,CAAC,cAAc,EAAE;KACzCtE,EAAE,EAAEmB,IAAI,CAAC0pB,KAAK,EAAE;KAChBvjB,MAAM,EAAE;OACP,GAAG6lB;;IAEJ,CAAC;CACH;CAAC,iCAEsBhsB,IAAkB,EACzC;GACC,KAAK,4CAAI,sBAAQmD,QAAQ,CAAC,cAAc,EAAE;KACzCtE,EAAE,EAAEmB,IAAI,CAAC0pB,KAAK,EAAE;KAChBvjB,MAAM,EAAE;OACPiO,IAAI,EAAEpU,IAAI,CAACksB,OAAO;;IAEnB,CAAC;CACH;CAAC,0BAEelsB,IAAkB,EAClC;GACC,IAAIA,IAAI,CAACkkB,aAAa,CAAC,YAAY,CAAC,EACpC;KACC,OAAO,EAAE;;GAGV,MAAMhU,OAAO,GAAG;KACfqc,IAAI,EAAEvsB,IAAI,CAACwsB,aAAa,EAAE;KAC1Bnc,KAAK,EAAErQ,IAAI,CAACysB,eAAe,EAAE;KAC7Bnc,MAAM,EAAEtQ,IAAI,CAAC0sB,gBAAgB;IAC7B;GAED,MAAMV,WAAW,GAAG,EAAE;GACtB,IAAI9b,OAAO,CAACqc,IAAI,EAChB;KACCP,WAAW,CAAClB,KAAK,GAAG;OACnBza,KAAK,EAAEH,OAAO,CAACG,KAAK;OACpBC,MAAM,EAAEJ,OAAO,CAACI;MAChB;KAED0b,WAAW,CAACW,UAAU,GAAGzc,OAAO,CAACqc,IAAI;;GAGtC,IAAIvsB,IAAI,CAACurB,gBAAgB,EAAE,EAC3B;KACCS,WAAW,CAACW,UAAU,GAAGN,GAAG,CAACC,eAAe,CAACtsB,IAAI,CAACurB,gBAAgB,EAAE,CAAC;;GAGtE,OAAOS,WAAW;CACnB;CAAC,2BAEgB3rB,QAAgB,EACjC;GACC,OAAO,4CAAI,8BAAYA,QAAQ,EAAEijB,YAAY;CAC9C;CAAC,uBAEYtjB,IAAU,EACvB;GACC,IAAI4sB,QAAQ,GAAG/B,oBAAQ,CAAC7qB,IAAI;GAC5B,IAAIA,IAAI,CAACW,IAAI,CAACgf,UAAU,CAAC,OAAO,CAAC,EACjC;KACCiN,QAAQ,GAAG/B,oBAAQ,CAACC,KAAK;IACzB,MACI,IAAI9qB,IAAI,CAACW,IAAI,CAACgf,UAAU,CAAC,OAAO,CAAC,EACtC;KACCiN,QAAQ,GAAG/B,oBAAQ,CAACE,KAAK;;GAG1B,OAAO6B,QAAQ;CAChB;CAAC,4BAEiB5sB,IAAU,EAC5B;GACC,OAAOA,IAAI,CAACU,IAAI,CAACgd,KAAK,CAAC,GAAG,CAAC,CAACmP,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;CAC1C;CAAC,uBAEUxsB,QAAgB,EAC3B;GACC,OAAO,4CAAI,sBAAQnB,OAAO,CAAC,WAAW,CAAC,CAACmB,QAAQ,CAAC;CAClD;CAAC,4BAGD;GACC,MAAM2V,MAAM,GAAGhX,2BAAI,CAACsX,SAAS,EAAE;GAE/B,OAAO,4CAAI,sBAAQpX,OAAO,CAAC,WAAW,CAAC,CAAC8W,MAAM,CAAC;CAChD;CAAC,qBAEU3V,QAAgB,EAC3B;GAAA;GACC,yEAAO,IAAI,8BAAYA,QAAQ,sBAAxB,uBAA2BC,MAAM;CACzC;CAAC,yBAEcijB,UAAkB,EAAE7kB,KAAqB,EAAE2B,QAAgB,EAAEmjB,UAAmB,EAC/F;GACC,IAAI,CAAC,4CAAI,kDAAwBD,UAAU,CAAC,EAC5C;KACC,4CAAI,kDAAwBA,UAAU,CAAC,GAAG;OACzCuJ,oBAAoB,EAAE,EAAE;OACxBC,iBAAiB,EAAE,EAAE;OACrB1sB,QAAQ;OACRgM,IAAI,EAAE,EAAE;OACRmX;MACA;;GAGF9kB,KAAK,CAACP,OAAO,CAAE6B,IAAI,IAAK;KACvB,MAAMiB,MAAM,GAAGjB,IAAI,CAAC0pB,KAAK,EAAE;KAC3B,IAAI,CAAC,4CAAI,kDAAwBnG,UAAU,CAAC,CAACuJ,oBAAoB,EACjE;OACC,4CAAI,kDAAwBvJ,UAAU,CAAC,CAACuJ,oBAAoB,GAAG,EAAE;;KAGlE,4CAAI,kDAAwBvJ,UAAU,CAAC,CAACuJ,oBAAoB,CAAC7rB,MAAM,CAAC,GAAG,KAAK;KAC5E,4CAAI,kDAAwBsiB,UAAU,CAAC,CAACwJ,iBAAiB,CAAC9rB,MAAM,CAAC,GAAG,KAAK;IACzE,CAAC;CACH;CAAC,2BAEgBsiB,UAAkB,EAAE7kB,KAAqB,EAC1D;GACC,MAAMsuB,KAAK,GAAG,4CAAI,kDAAwBzJ,UAAU,CAAC;GACrD,IAAIyJ,KAAK,EACT;KACCtuB,KAAK,CAACP,OAAO,CAAE6B,IAAkB,IAAK;OACrC,MAAMiB,MAAM,GAAGjB,IAAI,CAAC0pB,KAAK,EAAE;OAC3B,IAAI,4CAAI,kDAAwBnG,UAAU,CAAC,CAACuJ,oBAAoB,EAChE;SACC,OAAO,4CAAI,kDAAwBvJ,UAAU,CAAC,CAACuJ,oBAAoB,CAAC7rB,MAAM,CAAC;SAC3E,OAAO,4CAAI,kDAAwBsiB,UAAU,CAAC,CAACwJ,iBAAiB,CAAC9rB,MAAM,CAAC;;MAEzE,CAAC;;CAEJ;CAAC,mCAEwBsiB,UAAkB,EAAEtiB,MAAc,EAC3D;GACC,4CAAI,kDAAwBsiB,UAAU,CAAC,CAACuJ,oBAAoB,CAAC7rB,MAAM,CAAC,GAAG,IAAI;CAC5E;CAAC,gCAEqBsiB,UAAkB,EAAEtiB,MAAc,EACxD;GACC,4CAAI,kDAAwBsiB,UAAU,CAAC,CAACwJ,iBAAiB,CAAC9rB,MAAM,CAAC,GAAG,IAAI;CACzE;CAAC,2BAEgBsiB,UAAkB,EAAElX,IAAY,EACjD;GACC,4CAAI,kDAAwBkX,UAAU,CAAC,CAAClX,IAAI,GAAGA,IAAI;CACpD;CAAC,yBAEckX,UAAkB,EAAE0J,cAAuB,EAC1D;GACC,4CAAI,kDAAwB1J,UAAU,CAAC,CAACC,UAAU,GAAGyJ,cAAc;CACpE;CAAC,mCAsBwB1J,UAAU,EACnC;GACC,MAAM2J,cAAc,GAAG;KACtBlY,OAAO,EAAE,EAAE;KACXtW,KAAK,EAAE;IACP;GAED,MAAMA,KAAK,GAAG,IAAI,CAACyI,QAAQ,CAACoc,UAAU,CAAC;GACvC,MAAMlX,IAAI,GAAG,4CAAI,kDAAwBkX,UAAU,CAAC,CAAClX,IAAI;GACzD,MAAMhM,QAAQ,GAAG,4CAAI,kDAAwBkjB,UAAU,CAAC,CAACljB,QAAQ;GACjE,MAAM8sB,OAAO,GAAG9gB,IAAI,CAAC7G,MAAM,GAAG,CAAC;;;GAG/B,IAAI9G,KAAK,CAAC8G,MAAM,GAAG,CAAC,IAAI2nB,OAAO,EAC/B;KACCD,cAAc,CAAClY,OAAO,GAAG;OAAE3U,QAAQ;OAAEgM;MAAM;;GAG5C3N,KAAK,CAACP,OAAO,CAAE6B,IAAI,IAAK;KAAA;KACvB,IAAIA,IAAI,CAACotB,QAAQ,EAAE,EACnB;OACC;;KAGD,MAAMltB,SAAS,GAAGkJ,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;KAExCne,IAAI,CAACwrB,aAAa,CAAC,WAAW,EAAEtrB,SAAS,CAAC;KAC1C,IAAIxB,KAAK,CAAC8G,MAAM,KAAK,CAAC,IAAI2nB,OAAO,EACjC;OACCntB,IAAI,CAACwrB,aAAa,CAAC,aAAa,EAAEnf,IAAI,CAAC;;KAGxC6gB,cAAc,CAACxuB,KAAK,CAACwJ,IAAI,CAAC;OACzB0U,OAAO,EAAE,CAAC5c,IAAI,CAAC0pB,KAAK,EAAE,CAAC;OACvBpM,aAAa,EAAEtd,IAAI,CAACkkB,aAAa,CAAC,eAAe,CAAC;OAClD7jB,QAAQ;OACRgM,IAAI,yBAAErM,IAAI,CAACkkB,aAAa,CAAC,aAAa,CAAC,kCAAI;MAC3C,CAAC;IACF,CAAC;GAEF,OAAOgJ,cAAc;CACtB;CAAC,kCAEuB3J,UAAU,EAClC;GACC,MAAMjG,aAAa,GAAGlU,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;GAC5C,4CAAI,kDAAwBoF,UAAU,CAAC,CAACjG,aAAa,GAAGA,aAAa;GAErE,MAAMV,OAAO,GAAG,EAAE;GAClB,MAAMle,KAAK,GAAG,IAAI,CAACyI,QAAQ,CAACoc,UAAU,CAAC;GACvC7kB,KAAK,CAACP,OAAO,CAAE6B,IAAI,IAAK;KACvB,IAAI,CAACA,IAAI,CAACotB,QAAQ,EAAE,EACpB;OACCxQ,OAAO,CAAC1U,IAAI,CAAClI,IAAI,CAAC0pB,KAAK,EAAE,CAAC;;IAE3B,CAAC;GAEF,MAAMrd,IAAI,GAAG,4CAAI,kDAAwBkX,UAAU,CAAC,CAAClX,IAAI;GACzD,MAAMhM,QAAQ,GAAG,4CAAI,kDAAwBkjB,UAAU,CAAC,CAACljB,QAAQ;GAEjE,OAAO;KACNuc,OAAO;KACPU,aAAa;KACbjd,QAAQ;KACRgM;IACA;CACF;CAAC,8BAEmBkX,UAAU,EAC9B;GACC,IACC,CAAC,4CAAI,kDAAwBA,UAAU,CAAC,IACrC,CAAC,4CAAI,kDAAwBA,UAAU,CAAC,CAACC,UAAU,IACnD,4CAAI,kDAAwBD,UAAU,CAAC,CAAC8J,OAAO,EAEnD;KACC,OAAO,KAAK;;GAGb,MAAM;KAAEP;IAAsB,GAAG,4CAAI,kDAAwBvJ,UAAU,CAAC;GAExE,OAAOjlB,MAAM,CAACC,MAAM,CAACuuB,oBAAoB,CAAC,CAACxD,KAAK,CAAErP,IAAI,IAAKA,IAAI,KAAK,IAAI,CAAC;CAC1E;CAAC,yBAEcsJ,UAAkB,EACjC;GACC,IAAI,CAAC,4CAAI,kDAAwBA,UAAU,CAAC,EAC5C;KACC,OAAO,KAAK;;GAGb,MAAM;KAAEwJ;IAAmB,GAAG,4CAAI,kDAAwBxJ,UAAU,CAAC;GAErE,OAAOjlB,MAAM,CAACC,MAAM,CAACwuB,iBAAiB,CAAC,CAACzD,KAAK,CAAErP,IAAI,IAAKA,IAAI,KAAK,IAAI,CAAC;CACvE;CAAC,4BAEiBsJ,UAAkB,EACpC;GACC,IAAI,yCAAC,IAAI,4CAAqBA,UAAU,CAAC,EACzC;KACC;;GAGD,4CAAI,kDAAwBA,UAAU,CAAC,CAAC8J,OAAO,GAAG,IAAI;GAEtD,MAAMhuB,OAAO,2CAAG,IAAI,oDAAyBkkB,UAAU,CAAC;GACxD,KAAK,4CAAI,oCAAiB5G,oBAAoB,CAACtd,OAAO,CAAC;GACvD,IAAI,CAAC2mB,KAAK,CAACzC,UAAU,CAAC;CACvB;CAAC,6BAIkBA,UAAkB,EACrC;GACC,IAAI,yCAAC,IAAI,4CAAqBA,UAAU,CAAC,EACzC;KACC;;GAGD,4CAAI,kDAAwBA,UAAU,CAAC,CAAC8J,OAAO,GAAG,IAAI;GACtD,MAAM;KAAErY,OAAO;KAAEtW;IAAO,2CAAG,IAAI,sDAA0B6kB,UAAU,CAAC;GACpE,IAAIvO,OAAO,CAAC3I,IAAI,EAChB;KACC,KAAK,4CAAI,oCAAiBqQ,WAAW,CAAC1H,OAAO,CAAC;;GAG/CtW,KAAK,CAACP,OAAO,CAAEkB,OAAO,IAAK;KAC1B,KAAK,4CAAI,oCAAiBsd,oBAAoB,CAACtd,OAAO,CAAC;IACvD,CAAC;GACF,IAAI,CAAC2mB,KAAK,CAACzC,UAAU,CAAC;CACvB;CAAC,+BAEoBvjB,IAAkB,EAAEK,QAAgB,EACzD;GACC,MAAMid,aAAa,GAAGlU,qBAAK,CAACiD,IAAI,CAAC8R,SAAS,EAAE;GAC5C,MAAMqK,UAAU,GAAGxoB,IAAI,CAACnB,EAAE,CAAC4G,KAAK,CAAC,CAAC,CAAC,CAAC;GACpC,MAAMkhB,UAAU,GAAI,GAAErJ,aAAc,IAAGkL,UAAW,EAAC;GAEnD,OAAO;KACNlL,aAAa;KACbqJ,UAAU;KACVtmB,QAAQ;KACRL,IAAI;KACJM,MAAM,EAAE,4CAAI,8BAAYD,QAAQ,EAAEC;IAClC;CACF;CAAC,qBAEUwD,KAAoB,EAC/B;GACC,IAAIA,KAAK,CAACwpB,OAAO,EAAE,KAAK,wBAAwB,EAChD;KACChhB,EAAE,CAACC,EAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;OAChCC,OAAO,EAAG,GAAE7I,KAAK,CAACsI,UAAU,EAAG,OAAMtI,KAAK,CAACypB,cAAc,EAAG;MAC5D,CAAC;;CAEJ;CAAC,2BAEgBjQ,aAAqB,EACtC;GACC,KAAK,4CAAI,sBAAQna,QAAQ,CAAC,iBAAiB,EAAE;KAC5CtE,EAAE,EAAEye,aAAa;KACjBnX,MAAM,EAAE;OACPrC,KAAK,EAAE;;IAER,CAAC;CACH;AA71BYqjB,oBAAgB,CAqBrBrC,KAAK,GAAG;GACduF,WAAW,EAAE,aAAa;GAC1BI,cAAc,EAAE,gBAAgB;GAChCC,WAAW,EAAE,aAAa;GAC1BC,YAAY,EAAE;CACf,CAAC;AA1BWxD,oBAAgB,CA4BrBllB,QAAQ,GAAG,IAAI;;CCnDhB,MAAMurB,eAAe,CAC5B;GACCC,aAAa,CAACC,WAAmB,EAAEve,KAAU,EAC7C;KACC9M,uBAAM,CAACC,IAAI,CAAC,gCAAgC,EAAEorB,WAAW,EAAEve,KAAK,CAAC;KACjEnQ,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,0BAA0B,EAAE;OACpD,CAACuqB,WAAW,GAAGve;MACf,CAAC;KAEF,OAAOrJ,wBAAS,CAACpC,sBAAU,CAACiqB,yBAAyB,EAAE;OACtDxpB,IAAI,EAAE;SACL6R,MAAM,EAAEhX,2BAAI,CAACsX,SAAS,EAAE;SACxB5V,IAAI,EAAEgtB,WAAW;SACjBve;;MAED,CAAC,CAACtL,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;MAC5D,CAAC;;CAEJ;;CCtBO,MAAM8pB,YAAY,CACzB;GACC,MAAMC,qBAAqB,CAACC,QAAgB,EAC5C;KACC,MAAMrrB,MAAM,GAAG,MAAMzD,2BAAI,CAACwE,aAAa,EAAE,CAACC,UAAU,CAACC,sBAAU,CAACqqB,cAAc,EAAE;OAC/EC,SAAS,EAAEF;MACX,CAAC,CAACjqB,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;MAC7D,CAAC;KAEF,MAAM;OAAEkO,SAAS,EAAE3R;MAAU,GAAGoC,MAAM,CAAC0B,IAAI,EAAE;KAE7C,OAAO9D,QAAQ;;CAEjB;;CCf0C;CAAA;AAE1C,CAAO,MAAM4tB,iBAAc,CAC3B;GAAA;KAAA;OAAA;;KAAA;OAAA;;;GACC,MAAMlhB,UAAU,CAAC;KAAEmhB;IAA8B,EACjD;KACC,MAAMC,WAAW,GAAG,IAAIzW,WAAW,EAAE;KACrC,MAAM;OAAErK,WAAW;OAAED;MAAW,GAAG,MAAM+gB,WAAW,CAACphB,UAAU,CAAC;OAC/DpM,IAAI,EAAEC,oBAAQ,CAAC1C,OAAO;OACtB8Q,eAAe,EAAEkf;MACjB,CAAC,CACArqB,KAAK,CAAEC,KAAK,IAAK;OACjB,4CAAI,kCAAgBA,KAAK;MACzB,CAAC;KAEH,4CAAI,sCAAgB;OAAExD,MAAM,EAAE8M,SAAS;OAAE/M,QAAQ,EAAEgN;MAAa;KAEhE,MAAM8gB,WAAW,CAACnlB,oBAAoB,CAACqE,WAAW,CAAC,CACjDxJ,KAAK,CAAEC,KAAK,IAAK;OACjB,4CAAI,kCAAgBA,KAAK;MACzB,CAAC;KAEH,OAAOuJ,WAAW;;CAepB;CAAC,yBAZevJ,KAAY,EAC3B;;GAECC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;GACjD,MAAM,IAAIkC,KAAK,CAAC,2BAA2B,CAAC;CAC7C;CAAC,2BAEc;GAAE1F,MAAM;GAAED;CAAS,CAAC,EACnC;GACCqP,6BAAS,CAAC1N,WAAW,EAAE,CAAC9D,OAAO,CAACkwB,YAAY,CAAC9tB,MAAM,CAAC;GACpDoP,6BAAS,CAAC1N,WAAW,EAAE,CAAC2N,kBAAkB,CAACtP,QAAQ,CAAC;CACrD;;OCjCYguB,eAAe,GAAG;GAC9BnL,SAAS,CAAChjB,SAAiB,EAC3B;KACClB,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,6BAA6B,EAAEjD,SAAS,CAAC;KAElE,OAAO4F,wBAAS,CAACpC,sBAAU,CAAC4qB,wBAAwB,EAAE;OACrDnqB,IAAI,EAAE;SACLwF,MAAM,EAAEzJ,SAAS;SACjB2J,iBAAiB,EAAE,IAAI;SACvBD,QAAQ,EAAE;;MAEX,CAAC,CAAC/F,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;MACxD,CAAC;IACF;GAED2iB,WAAW,CAACvmB,SAAiB,EAC7B;KACClB,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,+BAA+B,EAAEjD,SAAS,CAAC;KAEpE,OAAO4F,wBAAS,CAACpC,sBAAU,CAAC6qB,0BAA0B,EAAE;OACvDpqB,IAAI,EAAE;SACLwF,MAAM,EAAEzJ,SAAS;SACjB2J,iBAAiB,EAAE,IAAI;SACvBD,QAAQ,EAAE;;MAEX,CAAC,CAAC/F,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAC1D,CAAC;IACF;GAED0qB,sBAAsB,CAACzkB,eAAuB,EAC9C;KACC,MAAMjL,IAAiB,GAAGE,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC6K,eAAe,EAAE,IAAI,CAAC;KACrF,MAAM0kB,qBAA6B,GAAGzvB,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,oCAAoC,CAAC,CAACJ,IAAI,CAACwB,MAAM,CAAC;KAChH,IAAImuB,qBAAqB,KAAK,CAAC,EAC/B;OACC,OAAOlsB,OAAO,CAACC,OAAO,EAAE;;KAGzBxD,2BAAI,CAACC,QAAQ,EAAE,CAACkE,QAAQ,CAAC,iCAAiC,EAAErE,IAAI,CAACwB,MAAM,CAAC;KAExE,OAAOwF,wBAAS,CAACpC,sBAAU,CAACgrB,sBAAsB,EAAE;OACnDvqB,IAAI,EAAE;SAAE9D,QAAQ,EAAE0J;;MAClB,CAAC,CAAClG,KAAK,CAAEC,KAAK,IAAK;;OAEnBC,OAAO,CAACD,KAAK,CAAC,+CAA+C,EAAEA,KAAK,CAAC;MACrE,CAAC;;CAEJ,CAAC;;CCnDD,MAAM6qB,sBAAsB,GAAG,KAAK;CACpC,MAAMC,aAAa,GAAG,IAAI;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;AAE3B,CAAO,MAAMC,kBAAkB,CAC/B;GAMCjxB,WAAW,CAACyC,QAAgB,EAC5B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAJiD;;KAAE;OAAA;OAAA,OACD;;KAIjD,4CAAI,0BAAaA,QAAQ;;GAG1ByuB,WAAW,CAACpc,UAA2B,EACvC;KACC,IAAI,4CAAI,wBAAWA,UAAU,6CAAK,IAAI,6BAAc,EACpD;OACC;;KAGD,4CAAI,oCAAiBA,UAAU,CAAC,GAAGkB,UAAU,CAAC,MAAM;OACnD,OAAO,4CAAI,oCAAiBlB,UAAU,CAAC;MACvC,EAAEic,sBAAsB,CAAC;KAE1B,4CAAI,sCAAkBjc,UAAU,CAAC,GAAGkB,UAAU,CAAC,MAAM;OACpD,4CAAI,8BAAclB,UAAU;MAC5B,EAAEkc,aAAa,CAAC;;GAGlBG,UAAU,CAACrc,UAA2B,EACtC;KACCgB,YAAY,CAAC,4CAAI,oCAAiBhB,UAAU,CAAC,CAAC;KAC9C,OAAO,4CAAI,oCAAiBA,UAAU,CAAC;KACvCgB,YAAY,CAAC,4CAAI,sCAAkBhB,UAAU,CAAC,CAAC;KAC/C,OAAO,4CAAI,sCAAkBA,UAAU,CAAC;;CA0B1C;CAAC,oBAvBUA,UAA2B,EACrC;GACC,OAAOsY,OAAO,CAAC,4CAAI,oCAAiBtY,UAAU,CAAC,CAAC;CACjD;CAAC,uBAEYA,UAA2B,EACxC;GACC,MAAM1O,WAAW,GAAG;KACnB3D,QAAQ,0CAAE,IAAI,uBAAU;KACxBM,IAAI,EAAE+R;IACN;GAED5M,wBAAS,CAACpC,sBAAU,CAACsrB,yBAAyB,EAAE;KAC/C7qB,IAAI,EAAEH;IACN,CAAC,CAACH,KAAK,CAAEC,KAAK,IAAK;KACnBC,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;IAC7D,CAAC;CACH;CAAC,wBAGD;GACC,OAAO1C,MAAM,yCAAC,IAAI,wBAAW,KAAKpC,2BAAI,CAACsX,SAAS,EAAE;CACnD;;;;;;;;;;;;;;;;;;;"}